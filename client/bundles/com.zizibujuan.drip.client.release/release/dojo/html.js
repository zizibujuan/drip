//>>built
define("dojo/html",["./_base/kernel","./_base/lang","./_base/array","./_base/declare","./dom","./dom-construct","./parser"],function(kernel,lang,darray,declare,dom,domConstruct,parser){var html={};lang.setObject("dojo.html",html);var idCounter=0;return html._secureForInnerHtml=function(cont){return cont.replace(/(?:\s*<!DOCTYPE\s[^>]+>|<title[^>]*>[\s\S]*?<\/title>)/ig,"")},html._emptyNode=domConstruct.empty,html._setNodeContent=function(node,cont){domConstruct.empty(node);if(cont){typeof cont=="string"&&(cont=domConstruct.toDom(cont,node.ownerDocument));if(!cont.nodeType&&lang.isArrayLike(cont))for(var startlen=cont.length,i=0;i<cont.length;i=startlen==cont.length?i+1:0)domConstruct.place(cont[i],node,"last");else domConstruct.place(cont,node,"last")}return node},html._ContentSetter=declare("dojo.html._ContentSetter",null,{node:"",content:"",id:"",cleanContent:!1,extractContent:!1,parseContent:!1,parserScope:kernel._scopeName,startup:!0,constructor:function(params,node){lang.mixin(this,params||{}),node=this.node=dom.byId(this.node||node),this.id||(this.id=["Setter",node?node.id||node.tagName:"",idCounter++].join("_"))},set:function(cont,params){undefined!==cont&&(this.content=cont),params&&this._mixin(params),this.onBegin(),this.setContent();var ret=this.onEnd();return ret&&ret.then?ret:this.node},setContent:function(){var node=this.node;if(!node)throw new Error(this.declaredClass+": setContent given no node");try{node=html._setNodeContent(node,this.content)}catch(e){var errMess=this.onContentError(e);try{node.innerHTML=errMess}catch(e){0}}this.node=node},empty:function(){this.parseDeferred&&(this.parseDeferred.isResolved()||this.parseDeferred.cancel(),delete this.parseDeferred),this.parseResults&&this.parseResults.length&&(darray.forEach(this.parseResults,function(w){w.destroy&&w.destroy()}),delete this.parseResults),domConstruct.empty(this.node)},onBegin:function(){var cont=this.content;if(lang.isString(cont)){this.cleanContent&&(cont=html._secureForInnerHtml(cont));if(this.extractContent){var match=cont.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);match&&(cont=match[1])}}return this.empty(),this.content=cont,this.node},onEnd:function(){return this.parseContent&&this._parse(),this.node},tearDown:function(){delete this.parseResults,delete this.parseDeferred,delete this.node,delete this.content},onContentError:function(err){return"Error occurred setting content: "+err},onExecError:function(err){return"Error occurred executing scripts: "+err},_mixin:function(params){var empty={},key;for(key in params){if(key in empty)continue;this[key]=params[key]}},_parse:function(){var rootNode=this.node;try{var inherited={};darray.forEach(["dir","lang","textDir"],function(name){this[name]&&(inherited[name]=this[name])},this);var self=this;this.parseDeferred=parser.parse({rootNode:rootNode,noStart:!this.startup,inherited:inherited,scope:this.parserScope}).then(function(results){return self.parseResults=results})}catch(e){this._onError("Content",e,"Error parsing in _ContentSetter#"+this.id)}},_onError:function(type,err,consoleText){var errText=this["on"+type+"Error"].call(this,err);consoleText?0:errText&&html._setNodeContent(this.node,errText,!0)}}),html.set=function(node,cont,params){undefined==cont&&(0,cont="");if(!params)return html._setNodeContent(node,cont,!0);var op=new html._ContentSetter(lang.mixin(params,{content:cont,node:node}));return op.set()},html})