//>>built
define("dojo/query",["./_base/kernel","./has","./dom","./on","./_base/array","./_base/lang","./selector/_loader","./selector/_loader!default"],function(dojo,has,dom,on,array,lang,loader,defaultEngine){"use strict";function queryForEngine(engine,NodeList){var query=function(query,root){if(typeof root=="string"){root=dom.byId(root);if(!root)return new NodeList([])}var results=typeof query=="string"?engine(query,root):query?query.orphan?query:[query]:[];return results.orphan?results:new NodeList(results)};query.matches=engine.match||function(node,selector,root){return query.filter([node],selector,root).length>0},query.filter=engine.filter||function(nodes,selector,root){return query(selector,root).filter(function(node){return array.indexOf(nodes,node)>-1})};if(typeof engine!="function"){var search=engine.search;engine=function(selector,root){return search(root||document,selector)}}return query}has.add("array-extensible",function(){return lang.delegate([],{length:1}).length==1&&!has("bug-for-in-skips-shadowed")});var ap=Array.prototype,aps=ap.slice,apc=ap.concat,forEach=array.forEach,tnl=function(a,parent,NodeListCtor){var nodeList=new(NodeListCtor||this._NodeListCtor||nl)(a);return parent?nodeList._stash(parent):nodeList},loopBody=function(f,a,o){return a=[0].concat(aps.call(a,0)),o=o||dojo.global,function(node){return a[0]=node,f.apply(o,a)}},adaptAsForEach=function(f,o){return function(){return this.forEach(loopBody(f,arguments,o)),this}},adaptAsMap=function(f,o){return function(){return this.map(loopBody(f,arguments,o))}},adaptAsFilter=function(f,o){return function(){return this.filter(loopBody(f,arguments,o))}},adaptWithCondition=function(f,g,o){return function(){var a=arguments,body=loopBody(f,a,o);return g.call(o||dojo.global,a)?this.map(body):(this.forEach(body),this)}},NodeList=function(array){var isNew=this instanceof nl&&has("array-extensible");typeof array=="number"&&(array=Array(array));var nodeArray=array&&"length"in array?array:arguments;if(isNew||!nodeArray.sort){var target=isNew?this:[],l=target.length=nodeArray.length;for(var i=0;i<l;i++)target[i]=nodeArray[i];if(isNew)return target;nodeArray=target}return lang._mixin(nodeArray,nlp),nodeArray._NodeListCtor=function(array){return nl(array)},nodeArray},nl=NodeList,nlp=nl.prototype=has("array-extensible")?[]:{};nl._wrap=nlp._wrap=tnl,nl._adaptAsMap=adaptAsMap,nl._adaptAsForEach=adaptAsForEach,nl._adaptAsFilter=adaptAsFilter,nl._adaptWithCondition=adaptWithCondition,forEach(["slice","splice"],function(name){var f=ap[name];nlp[name]=function(){return this._wrap(f.apply(this,arguments),name=="slice"?this:null)}}),forEach(["indexOf","lastIndexOf","every","some"],function(name){var f=array[name];nlp[name]=function(){return f.apply(dojo,[this].concat(aps.call(arguments,0)))}}),lang.extend(NodeList,{constructor:nl,_NodeListCtor:nl,toString:function(){return this.join(",")},_stash:function(parent){return this._parent=parent,this},on:function(eventName,listener){var handles=this.map(function(node){return on(node,eventName,listener)});return handles.remove=function(){for(var i=0;i<handles.length;i++)handles[i].remove()},handles},end:function(){return this._parent?this._parent:new this._NodeListCtor(0)},concat:function(item){var t=aps.call(this,0),m=array.map(arguments,function(a){return aps.call(a,0)});return this._wrap(apc.apply(t,m),this)},map:function(func,obj){return this._wrap(array.map(this,func,obj),this)},forEach:function(callback,thisObj){return forEach(this,callback,thisObj),this},filter:function(filter){var a=arguments,items=this,start=0;if(typeof filter=="string"){items=query._filterResult(this,a[0]);if(a.length==1)return items._stash(this);start=1}return this._wrap(array.filter(items,a[start],a[start+1]),this)},instantiate:function(declaredClass,properties){var c=lang.isFunction(declaredClass)?declaredClass:lang.getObject(declaredClass);return properties=properties||{},this.forEach(function(node){new c(properties,node)})},at:function(){var t=new this._NodeListCtor(0);return forEach(arguments,function(i){i<0&&(i=this.length+i),this[i]&&t.push(this[i])},this),t._stash(this)}});var query=queryForEngine(defaultEngine,NodeList);return dojo.query=queryForEngine(defaultEngine,function(array){return NodeList(array)}),query.load=function(id,parentRequire,loaded){loader.load(id,parentRequire,function(engine){loaded(queryForEngine(engine,NodeList))})},dojo._filterQueryResult=query._filterResult=function(nodes,selector,root){return new NodeList(query.filter(nodes,selector,root))},dojo.NodeList=query.NodeList=NodeList,query})