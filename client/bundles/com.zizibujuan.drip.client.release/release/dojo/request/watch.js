//>>built
define("dojo/request/watch",["./util","../errors/RequestTimeoutError","../errors/CancelError","../_base/array","../_base/window","../has!host-browser?dom-addeventlistener?:../on:"],function(util,RequestTimeoutError,CancelError,array,win,on){function watchInFlight(){var now=+(new Date);for(var i=0,dfd;i<_inFlight.length&&(dfd=_inFlight[i]);i++){var response=dfd.response,options=response.options;dfd.isCanceled&&dfd.isCanceled()||dfd.isValid&&!dfd.isValid(response)?(_inFlight.splice(i--,1),watch._onAction&&watch._onAction()):dfd.isReady&&dfd.isReady(response)?(_inFlight.splice(i--,1),dfd.handleResponse(response),watch._onAction&&watch._onAction()):dfd.startTime&&dfd.startTime+(options.timeout||0)<now&&(_inFlight.splice(i--,1),dfd.cancel(new RequestTimeoutError("Timeout exceeded",response)),watch._onAction&&watch._onAction())}watch._onInFlight&&watch._onInFlight(dfd),_inFlight.length||(clearInterval(_inFlightIntvl),_inFlightIntvl=null)}function watch(dfd){dfd.response.options.timeout&&(dfd.startTime=+(new Date));if(dfd.isFulfilled())return;_inFlight.push(dfd),_inFlightIntvl||(_inFlightIntvl=setInterval(watchInFlight,50)),dfd.response.options.sync&&watchInFlight()}var _inFlightIntvl=null,_inFlight=[];return watch.cancelAll=function(){try{array.forEach(_inFlight,function(dfd){try{dfd.cancel(new CancelError("All requests canceled."))}catch(e){}})}catch(e){}},win&&on&&win.doc.attachEvent&&on(win.global,"unload",function(){watch.cancelAll()}),watch})