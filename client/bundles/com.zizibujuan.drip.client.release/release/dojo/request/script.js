//>>built
define("dojo/request/script",["module","./watch","./util","../_base/array","../_base/lang","../on","../dom","../dom-construct","../has","../_base/window"],function(module,watch,util,array,lang,on,dom,domConstruct,has,win){function attach(id,url,frameDoc){var doc=frameDoc||win.doc,element=doc.createElement("script");return element.type="text/javascript",element.src=url,element.id=id,element.async=!0,element.charset="utf-8",doc.getElementsByTagName("head")[0].appendChild(element)}function remove(id,frameDoc,cleanup){domConstruct.destroy(dom.byId(id,frameDoc)),callbacks[id]&&(cleanup?callbacks[id]=function(){delete callbacks[id]}:delete callbacks[id])}function _addDeadScript(dfd){var options=dfd.response.options,frameDoc=options.ioArgs?options.ioArgs.frameDoc:options.frameDoc;deadScripts.push({id:dfd.id,frameDoc:frameDoc}),options.ioArgs&&(options.ioArgs.frameDoc=null),options.frameDoc=null}function canceler(dfd,response){dfd.canDelete&&script._remove(dfd.id,response.options.frameDoc,!0)}function isValid(response){return deadScripts&&deadScripts.length&&(array.forEach(deadScripts,function(_script){script._remove(_script.id,_script.frameDoc),_script.frameDoc=null}),deadScripts=[]),response.options.jsonp?!response.data:!0}function isReadyScript(response){return!!this.scriptLoaded}function isReadyCheckString(response){var checkString=response.options.checkString;return checkString&&eval("typeof("+checkString+') !== "undefined"')}function handleResponse(response,error){this.canDelete&&_addDeadScript(this),error?this.reject(error):this.resolve(response)}function script(url,options,returnDeferred){var response=util.parseArgs(url,util.deepCopy({},options));url=response.url,options=response.options;var dfd=util.deferred(response,canceler,isValid,options.jsonp?null:options.checkString?isReadyCheckString:isReadyScript,handleResponse);lang.mixin(dfd,{id:mid+counter++,canDelete:!1});if(options.jsonp){var queryParameter=new RegExp("[?&]"+options.jsonp+"=");queryParameter.test(url)||(url+=(~url.indexOf("?")?"&":"?")+options.jsonp+"="+(options.frameDoc?"parent.":"")+mid+"_callbacks."+dfd.id),dfd.canDelete=!0,callbacks[dfd.id]=function(json){response.data=json,dfd.handleResponse(response)}}util.notify&&util.notify.emit("send",response,dfd.promise.cancel);if(!options.canAttach||options.canAttach(dfd)){var node=script._attach(dfd.id,url,options.frameDoc);if(!options.jsonp&&!options.checkString)var handle=on(node,loadEvent,function(evt){if(evt.type==="load"||readyRegExp.test(node.readyState))handle.remove(),dfd.scriptLoaded=evt})}return watch(dfd),returnDeferred?dfd:dfd.promise}has.add("script-readystatechange",function(global,document){var script=document.createElement("script");return typeof script.onreadystatechange!="undefined"&&(typeof global.opera=="undefined"||global.opera.toString()!=="[object Opera]")});var mid=module.id.replace(/[\/\.\-]/g,"_"),counter=0,loadEvent=has("script-readystatechange")?"readystatechange":"load",readyRegExp=/complete|loaded/,callbacks=this[mid+"_callbacks"]={},deadScripts=[];return script.get=script,script._attach=attach,script._remove=remove,script._callbacksProperty=mid+"_callbacks",script})