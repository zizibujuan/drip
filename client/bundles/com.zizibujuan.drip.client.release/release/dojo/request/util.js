//>>built
define("dojo/request/util",["exports","../errors/RequestError","../errors/CancelError","../Deferred","../io-query","../_base/array","../_base/lang"],function(exports,RequestError,CancelError,Deferred,ioQuery,array,lang){function okHandler(response){return freeze(response)}exports.deepCopy=function(target,source){for(var name in source){var tval=target[name],sval=source[name];tval!==sval&&(tval&&typeof tval=="object"&&sval&&typeof sval=="object"?exports.deepCopy(tval,sval):target[name]=sval)}return target},exports.deepCreate=function(source,properties){properties=properties||{};var target=lang.delegate(source),name,value;for(name in source)value=source[name],value&&typeof value=="object"&&(target[name]=exports.deepCreate(value,properties[name]));return exports.deepCopy(target,properties)};var freeze=Object.freeze||function(obj){return obj};exports.deferred=function(response,cancel,isValid,isReady,handleResponse,last){function errHandler(error){throw error.response=response,error}var def=new Deferred(function(reason){return cancel&&cancel(def,response),!!reason&&(reason instanceof RequestError||reason instanceof CancelError)?reason:new CancelError("Request canceled",response)});def.response=response,def.isValid=isValid,def.isReady=isReady,def.handleResponse=handleResponse;var responsePromise=def.then(okHandler).otherwise(errHandler);exports.notify&&responsePromise.then(lang.hitch(exports.notify,"emit","load"),lang.hitch(exports.notify,"emit","error"));var dataPromise=responsePromise.then(function(response){return response.data||response.text}),promise=freeze(lang.delegate(dataPromise,{response:responsePromise}));return last&&def.then(function(response){last.call(def,response)},function(error){last.call(def,response,error)}),def.promise=promise,def.then=promise.then,def},exports.addCommonMethods=function(provider,methods){array.forEach(methods||["GET","POST","PUT","DELETE"],function(method){provider[(method==="DELETE"?"DEL":method).toLowerCase()]=function(url,options){return options=lang.delegate(options||{}),options.method=method,provider(url,options)}})},exports.parseArgs=function(url,options,skipData){var data=options.data,query=options.query;return data&&!skipData&&typeof data=="object"&&(options.data=ioQuery.objectToQuery(data)),query?(typeof query=="object"&&(query=ioQuery.objectToQuery(query)),options.preventCache&&(query+=(query?"&":"")+"request.preventCache="+ +(new Date))):options.preventCache&&(query="request.preventCache="+ +(new Date)),url&&query&&(url+=(~url.indexOf("?")?"&":"?")+query),{url:url,options:options,getHeader:function(headerName){return null}}},exports.checkStatus=function(stat){return stat=stat||0,stat>=200&&stat<300||stat===304||stat===1223||!stat}})