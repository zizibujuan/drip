//>>built
define("dojo/touch",["./_base/kernel","./aspect","./dom","./_base/lang","./on","./has","./mouse","./domReady","./_base/window"],function(dojo,aspect,dom,lang,on,has,mouse,domReady,win){function dualEvent(mouseType,touchType,msPointerType){return msPointer&&msPointerType?function(node,listener){return on(node,msPointerType,listener)}:hasTouch?function(node,listener){var handle1=on(node,touchType,listener),handle2=on(node,mouseType,function(evt){(!lastTouch||(new Date).getTime()>lastTouch+1e3)&&listener.call(this,evt)});return{remove:function(){handle1.remove(),handle2.remove()}}}:function(node,listener){return on(node,mouseType,listener)}}var hasTouch=has("touch"),ios4=!1;if(has("ios")){var ua=navigator.userAgent,v=ua.match(/OS ([\d_]+)/)?RegExp.$1:"1",os=parseFloat(v.replace(/_/,".").replace(/_/g,""));ios4=os<5}var msPointer=navigator.msPointerEnabled,lastTouch,dojotouchmove,nativeTouchMoveEvent,hoveredNode;hasTouch&&!msPointer&&(domReady(function(){hoveredNode=win.body(),win.doc.addEventListener("touchstart",function(evt){lastTouch=(new Date).getTime();var oldNode=hoveredNode;hoveredNode=evt.target,on.emit(oldNode,"dojotouchout",{target:oldNode,relatedTarget:hoveredNode,bubbles:!0}),on.emit(hoveredNode,"dojotouchover",{target:hoveredNode,relatedTarget:oldNode,bubbles:!0})},!0),on(win.doc,"touchmove",function(evt){lastTouch=(new Date).getTime(),nativeTouchMoveEvent=evt;var newNode=win.doc.elementFromPoint(evt.pageX-(ios4?0:win.global.pageXOffset),evt.pageY-(ios4?0:win.global.pageYOffset));newNode&&(hoveredNode!==newNode&&(on.emit(hoveredNode,"dojotouchout",{target:hoveredNode,relatedTarget:newNode,bubbles:!0}),on.emit(newNode,"dojotouchover",{target:newNode,relatedTarget:hoveredNode,bubbles:!0}),hoveredNode=newNode),on.emit(newNode,"dojotouchmove",{target:newNode,bubbles:!0}))}),on(win.doc,"touchend",function(evt){var node=win.doc.elementFromPoint(evt.pageX-(ios4?0:win.global.pageXOffset),evt.pageY-(ios4?0:win.global.pageYOffset));on.emit(node,"dojotouchend",lang.delegate(evt,{target:node,bubbles:!0}))})}),dojotouchmove=function(node,listener){return on(node,"dojotouchmove",function(syntheticEvent){listener(lang.delegate(nativeTouchMoveEvent,{target:syntheticEvent.target,stopPropagation:function(){syntheticEvent.stopPropagation()}}))})});var touch={press:dualEvent("mousedown","touchstart","MSPointerDown"),move:dualEvent("mousemove",dojotouchmove,"MSPointerMove"),release:dualEvent("mouseup","dojotouchend","MSPointerUp"),cancel:dualEvent(mouse.leave,"touchcancel",hasTouch?"MSPointerCancel":null),over:dualEvent("mouseover","dojotouchover","MSPointerOver"),out:dualEvent("mouseout","dojotouchout","MSPointerOut"),enter:mouse._eventHandler(dualEvent("mouseover","dojotouchover","MSPointerOver")),leave:mouse._eventHandler(dualEvent("mouseout","dojotouchout","MSPointerOut"))};return dojo.touch=touch,touch})