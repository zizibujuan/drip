//>>built
define("dojo/on",["./has!dom-addeventlistener?:./aspect","./_base/kernel","./sniff"],function(aspect,dojo,has){"use strict";function addListener(target,type,listener,dontFix,matchesTarget){var selector=type.match(/(.*):(.*)/);if(selector)return type=selector[2],selector=selector[1],on.selector(selector,type).call(matchesTarget,target,listener);has("touch")&&(touchEvents.test(type)&&(listener=fixTouchListener(listener)),!has("event-orientationchange")&&type=="orientationchange"&&(type="resize",target=window,listener=fixTouchListener(listener))),addStopImmediate&&(listener=addStopImmediate(listener));if(target.addEventListener){var capture=type in captures,adjustedType=capture?captures[type]:type;return target.addEventListener(adjustedType,listener,capture),{remove:function(){target.removeEventListener(adjustedType,listener,capture)}}}type="on"+type;if(fixAttach&&target.attachEvent)return fixAttach(target,type,listener);throw new Error("Target must be an event emitter")}function syntheticPreventDefault(){this.cancelable=!1,this.defaultPrevented=!0}function syntheticStopPropagation(){this.bubbles=!1}var major=window.ScriptEngineMajorVersion;has.add("jscript",major&&major()+ScriptEngineMinorVersion()/10),has.add("event-orientationchange",has("touch")&&!has("android")),has.add("event-stopimmediatepropagation",window.Event&&!!window.Event.prototype&&!!window.Event.prototype.stopImmediatePropagation);var on=function(target,type,listener,dontFix){return typeof target.on=="function"&&typeof type!="function"?target.on(type,listener):on.parse(target,type,listener,addListener,dontFix,this)};on.pausable=function(target,type,listener,dontFix){var paused,signal=on(target,type,function(){if(!paused)return listener.apply(this,arguments)},dontFix);return signal.pause=function(){paused=!0},signal.resume=function(){paused=!1},signal},on.once=function(target,type,listener,dontFix){var signal=on(target,type,function(){return signal.remove(),listener.apply(this,arguments)});return signal},on.parse=function(target,type,listener,addListener,dontFix,matchesTarget){if(type.call)return type.call(matchesTarget,target,listener);if(type.indexOf(",")>-1){var events=type.split(/\s*,\s*/),handles=[],i=0,eventName;while(eventName=events[i++])handles.push(addListener(target,eventName,listener,dontFix,matchesTarget));return handles.remove=function(){for(var i=0;i<handles.length;i++)handles[i].remove()},handles}return addListener(target,type,listener,dontFix,matchesTarget)};var touchEvents=/^touch/;on.selector=function(selector,eventType,children){return function(target,listener){function select(eventTarget){matchesTarget=matchesTarget&&matchesTarget.matches?matchesTarget:dojo.query;while(!matchesTarget.matches(eventTarget,selector,target))if(eventTarget==target||children===!1||!(eventTarget=eventTarget.parentNode)||eventTarget.nodeType!=1)return;return eventTarget}var matchesTarget=typeof selector=="function"?{matches:selector}:this,bubble=eventType.bubble;return bubble?on(target,bubble(select),listener):on(target,eventType,function(event){var eventTarget=select(event.target);return eventTarget&&listener.call(eventTarget,event)})}};var slice=[].slice,syntheticDispatch=on.emit=function(target,type,event){var args=slice.call(arguments,2),method="on"+type;if("parentNode"in target){var newEvent=args[0]={};for(var i in event)newEvent[i]=event[i];newEvent.preventDefault=syntheticPreventDefault,newEvent.stopPropagation=syntheticStopPropagation,newEvent.target=target,newEvent.type=type,event=newEvent}do target[method]&&target[method].apply(target,args);while(event&&event.bubbles&&(target=target.parentNode));return event&&event.cancelable&&event},captures={};if(!has("event-stopimmediatepropagation"))var stopImmediatePropagation=function(){this.immediatelyStopped=!0,this.modified=!0},addStopImmediate=function(listener){return function(event){if(!event.immediatelyStopped)return event.stopImmediatePropagation=stopImmediatePropagation,listener.apply(this,arguments)}};if(has("dom-addeventlistener"))captures={focusin:"focus",focusout:"blur"},on.emit=function(target,type,event){if(target.dispatchEvent&&document.createEvent){var nativeEvent=target.ownerDocument.createEvent("HTMLEvents");nativeEvent.initEvent(type,!!event.bubbles,!!event.cancelable);for(var i in event){var value=event[i];i in nativeEvent||(nativeEvent[i]=event[i])}return target.dispatchEvent(nativeEvent)&&nativeEvent}return syntheticDispatch.apply(on,arguments)};else{on._fixEvent=function(evt,sender){if(!evt){var w=sender&&(sender.ownerDocument||sender.document||sender).parentWindow||window;evt=w.event}if(!evt)return evt;try{lastEvent&&evt.type==lastEvent.type&&evt.srcElement==lastEvent.target&&(evt=lastEvent)}catch(e){}if(!evt.target){evt.target=evt.srcElement,evt.currentTarget=sender||evt.srcElement,evt.type=="mouseover"&&(evt.relatedTarget=evt.fromElement),evt.type=="mouseout"&&(evt.relatedTarget=evt.toElement),evt.stopPropagation||(evt.stopPropagation=stopPropagation,evt.preventDefault=preventDefault);switch(evt.type){case"keypress":var c="charCode"in evt?evt.charCode:evt.keyCode;c==10?(c=0,evt.keyCode=13):c==13||c==27?c=0:c==3&&(c=99),evt.charCode=c,_setKeyChar(evt)}}return evt};var lastEvent,IESignal=function(handle){this.handle=handle};IESignal.prototype.remove=function(){delete _dojoIEListeners_[this.handle]};var fixListener=function(listener){return function(evt){evt=on._fixEvent(evt,this);var result=listener.call(this,evt);return evt.modified&&(lastEvent||setTimeout(function(){lastEvent=null}),lastEvent=evt),result}},fixAttach=function(target,type,listener){listener=fixListener(listener);if(((target.ownerDocument?target.ownerDocument.parentWindow:target.parentWindow||target.window||window)!=top||has("jscript")<5.8)&&!has("config-_allow_leaks")){typeof _dojoIEListeners_=="undefined"&&(_dojoIEListeners_=[]);var emitter=target[type];if(!emitter||!emitter.listeners){var oldListener=emitter;emitter=Function("event","var callee = arguments.callee; for(var i = 0; i<callee.listeners.length; i++){var listener = _dojoIEListeners_[callee.listeners[i]]; if(listener){listener.call(this,event);}}"),emitter.listeners=[],target[type]=emitter,emitter.global=this,oldListener&&emitter.listeners.push(_dojoIEListeners_.push(oldListener)-1)}var handle;return emitter.listeners.push(handle=emitter.global._dojoIEListeners_.push(listener)-1),new IESignal(handle)}return aspect.after(target,type,listener,!0)},_setKeyChar=function(evt){evt.keyChar=evt.charCode?String.fromCharCode(evt.charCode):"",evt.charOrCode=evt.keyChar||evt.keyCode},stopPropagation=function(){this.cancelBubble=!0},preventDefault=on._preventDefault=function(){this.bubbledKeyCode=this.keyCode;if(this.ctrlKey)try{this.keyCode=0}catch(e){}this.defaultPrevented=!0,this.returnValue=!1,this.modified=!0}}if(has("touch"))var Event=function(){},windowOrientation=window.orientation,fixTouchListener=function(listener){return function(originalEvent){var event=originalEvent.corrected;if(!event){var type=originalEvent.type;try{delete originalEvent.type}catch(e){}if(originalEvent.type){Event.prototype=originalEvent;var event=new Event;event.preventDefault=function(){originalEvent.preventDefault()},event.stopPropagation=function(){originalEvent.stopPropagation()}}else event=originalEvent,event.type=type;originalEvent.corrected=event;if(type=="resize")return windowOrientation==window.orientation?null:(windowOrientation=window.orientation,event.type="orientationchange",listener.call(this,event));"rotation"in event||(event.rotation=0,event.scale=1);var firstChangeTouch=event.changedTouches[0];for(var i in firstChangeTouch)delete event[i],event[i]=firstChangeTouch[i]}return listener.call(this,event)}};return on})