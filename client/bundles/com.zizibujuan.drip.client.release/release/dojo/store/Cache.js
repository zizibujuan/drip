//>>built
define("dojo/store/Cache",["../_base/lang","../when"],function(lang,when){var Cache=function(masterStore,cachingStore,options){return options=options||{},lang.delegate(masterStore,{query:function(query,directives){var results=masterStore.query(query,directives);return results.forEach(function(object){(!options.isLoaded||options.isLoaded(object))&&cachingStore.put(object)}),results},queryEngine:masterStore.queryEngine||cachingStore.queryEngine,get:function(id,directives){return when(cachingStore.get(id),function(result){return result||when(masterStore.get(id,directives),function(result){return result&&cachingStore.put(result,{id:id}),result})})},add:function(object,directives){return when(masterStore.add(object,directives),function(result){return cachingStore.add(object&&typeof result=="object"?result:object,directives),result})},put:function(object,directives){return cachingStore.remove(directives&&directives.id||this.getIdentity(object)),when(masterStore.put(object,directives),function(result){return cachingStore.put(object&&typeof result=="object"?result:object,directives),result})},remove:function(id,directives){return when(masterStore.remove(id,directives),function(result){return cachingStore.remove(id,directives)})},evict:function(id){return cachingStore.remove(id)}})};return lang.setObject("dojo.store.Cache",Cache),Cache})