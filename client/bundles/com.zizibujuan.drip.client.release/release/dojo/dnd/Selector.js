//>>built
define("dojo/dnd/Selector",["../_base/array","../_base/declare","../_base/kernel","../_base/lang","../dom","../dom-construct","../mouse","../_base/NodeList","../on","../touch","./common","./Container"],function(array,declare,kernel,lang,dom,domConstruct,mouse,NodeList,on,touch,dnd,Container){var Selector=declare("dojo.dnd.Selector",Container,{constructor:function(node,params){params||(params={}),this.singular=params.singular,this.autoSync=params.autoSync,this.selection={},this.anchor=null,this.simpleSelection=!1,this.events.push(on(this.node,touch.press,lang.hitch(this,"onMouseDown")),on(this.node,touch.release,lang.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var t=new NodeList,e=dnd._empty;for(var i in this.selection){if(i in e)continue;t.push(dom.byId(i))}return t},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){return this.forInItems(function(data,id){this._addItemClass(dom.byId(id),"Selected"),this.selection[id]=1},this),this._removeAnchor()},deleteSelectedNodes:function(){var e=dnd._empty;for(var i in this.selection){if(i in e)continue;var n=dom.byId(i);this.delItem(i),domConstruct.destroy(n)}return this.anchor=null,this.selection={},this},forInSelectedItems:function(f,o){o=o||kernel.global;var s=this.selection,e=dnd._empty;for(var i in s){if(i in e)continue;f.call(o,this.getItem(i),i,this)}},sync:function(){Selector.superclass.sync.call(this),this.anchor&&(this.getItem(this.anchor.id)||(this.anchor=null));var t=[],e=dnd._empty;for(var i in this.selection){if(i in e)continue;this.getItem(i)||t.push(i)}return array.forEach(t,function(i){delete this.selection[i]},this),this},insertNodes:function(addSelected,data,before,anchor){var oldCreator=this._normalizedCreator;return this._normalizedCreator=function(item,hint){var t=oldCreator.call(this,item,hint);return addSelected?(this.anchor?this.anchor!=t.node&&(this._removeItemClass(t.node,"Anchor"),this._addItemClass(t.node,"Selected")):(this.anchor=t.node,this._removeItemClass(t.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[t.node.id]=1):(this._removeItemClass(t.node,"Selected"),this._removeItemClass(t.node,"Anchor")),t},Selector.superclass.insertNodes.call(this,data,before,anchor),this._normalizedCreator=oldCreator,this},destroy:function(){Selector.superclass.destroy.call(this),this.selection=this.anchor=null},onMouseDown:function(e){this.autoSync&&this.sync();if(!this.current)return;if(!this.singular&&!dnd.getCopyKeyState(e)&&!e.shiftKey&&this.current.id in this.selection){this.simpleSelection=!0,mouse.isLeft(e)&&(e.stopPropagation(),e.preventDefault());return}if(!this.singular&&e.shiftKey){dnd.getCopyKeyState(e)||this._removeSelection();var c=this.getAllNodes();if(c.length){this.anchor||(this.anchor=c[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1;if(this.anchor!=this.current){var i=0,node;for(;i<c.length;++i){node=c[i];if(node==this.anchor||node==this.current)break}for(++i;i<c.length;++i){node=c[i];if(node==this.anchor||node==this.current)break;this._addItemClass(node,"Selected"),this.selection[node.id]=1}this._addItemClass(this.current,"Selected"),this.selection[this.current.id]=1}}}else this.singular?this.anchor==this.current?dnd.getCopyKeyState(e)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):dnd.getCopyKeyState(e)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);e.stopPropagation(),e.preventDefault()},onMouseUp:function(){if(!this.simpleSelection)return;this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1)},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=on(this.node,touch.move,lang.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var e=dnd._empty;for(var i in this.selection){if(i in e)continue;var node=dom.byId(i);node&&this._removeItemClass(node,"Selected")}return this.selection={},this},_removeAnchor:function(){return this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null),this}});return Selector})