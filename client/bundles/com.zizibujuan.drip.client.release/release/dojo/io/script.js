//>>built
define("dojo/io/script",["../_base/connect","../_base/kernel","../_base/lang","../sniff","../_base/window","../_base/xhr","../dom","../dom-construct","../request/script"],function(connect,kernel,lang,has,win,xhr,dom,domConstruct,_script){kernel.deprecated("dojo/io/script","Use dojo/request/script.","2.0");var script={get:function(args){var rDfd,dfd=this._makeScriptDeferred(args,function(dfd){rDfd&&rDfd.cancel()}),ioArgs=dfd.ioArgs;return xhr._ioAddQueryToUrl(ioArgs),xhr._ioNotifyStart(dfd),rDfd=_script.get(ioArgs.url,{timeout:args.timeout,jsonp:ioArgs.jsonp,checkString:args.checkString,ioArgs:ioArgs,frameDoc:args.frameDoc,canAttach:function(rDfd){return ioArgs.requestId=rDfd.id,ioArgs.scriptId=rDfd.scriptId,ioArgs.canDelete=rDfd.canDelete,script._canAttach(ioArgs)}},!0),rDfd.then(function(){dfd.resolve(dfd)}).otherwise(function(error){dfd.ioArgs.error=error,dfd.reject(error)}),dfd},attach:_script._attach,remove:_script._remove,_makeScriptDeferred:function(args,cancel){var dfd=xhr._ioSetArgs(args,cancel||this._deferredCancel,this._deferredOk,this._deferredError),ioArgs=dfd.ioArgs;return ioArgs.id=kernel._scopeName+"IoScript"+this._counter++,ioArgs.canDelete=!1,ioArgs.jsonp=args.callbackParamName||args.jsonp,ioArgs.jsonp&&(ioArgs.query=ioArgs.query||"",ioArgs.query.length>0&&(ioArgs.query+="&"),ioArgs.query+=ioArgs.jsonp+"="+(args.frameDoc?"parent.":"")+kernel._scopeName+".io.script.jsonp_"+ioArgs.id+"._jsonpCallback",ioArgs.frameDoc=args.frameDoc,ioArgs.canDelete=!0,dfd._jsonpCallback=this._jsonpCallback,this["jsonp_"+ioArgs.id]=dfd),dfd},_deferredCancel:function(dfd){dfd.canceled=!0},_deferredOk:function(dfd){var ioArgs=dfd.ioArgs;return ioArgs.json||ioArgs.scriptLoaded||ioArgs},_deferredError:function(error,dfd){return 0,error},_deadScripts:[],_counter:1,_addDeadScript:function(ioArgs){script._deadScripts.push({id:ioArgs.id,frameDoc:ioArgs.frameDoc}),ioArgs.frameDoc=null},_validCheck:function(dfd){var deadScripts=script._deadScripts;if(deadScripts&&deadScripts.length>0){for(var i=0;i<deadScripts.length;i++)script.remove(deadScripts[i].id,deadScripts[i].frameDoc),deadScripts[i].frameDoc=null;script._deadScripts=[]}return!0},_ioCheck:function(dfd){var ioArgs=dfd.ioArgs;if(ioArgs.json||ioArgs.scriptLoaded&&!ioArgs.args.checkString)return!0;var checkString=ioArgs.args.checkString;return checkString&&eval("typeof("+checkString+") != 'undefined'")},_resHandle:function(dfd){script._ioCheck(dfd)?dfd.callback(dfd):dfd.errback(new Error("inconceivable dojo.io.script._resHandle error"))},_canAttach:function(){return!0},_jsonpCallback:function(json){this.ioArgs.json=json,kernel.global[_script._callbacksProperty][this.ioArgs.requestId](json)}};return lang.setObject("dojo.io.script",script),script})