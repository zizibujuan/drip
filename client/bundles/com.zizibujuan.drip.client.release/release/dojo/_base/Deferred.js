//>>built
define("dojo/_base/Deferred","./kernel,../Deferred,../promise/Promise,../errors/CancelError,../has,./lang,../when".split(","),function(c,g,v,w,r,h,x){var p=function(){},y=Object.freeze||function(){},o=c.Deferred=function(c){function m(a){if(i)throw Error("This deferred has already been resolved");j=a;i=!0;s()}function s(){for(var a;!a&&e;){var b=e;e=e.next;if(a=b.progress==p)i=!1;var d=k?b.error:b.resolved;r("config-useDeferredInstrumentation")&&k&&g.instrumentRejected&&g.instrumentRejected(j,!!d);
if(d)try{var l=d(j);l&&"function"===typeof l.then?l.then(h.hitch(b.deferred,"resolve"),h.hitch(b.deferred,"reject"),h.hitch(b.deferred,"progress")):(d=a&&void 0===l,a&&!d&&(k=l instanceof Error),b.deferred[d&&k?"reject":"resolve"](d?j:l))}catch(c){b.deferred.reject(c)}else k?b.deferred.reject(j):b.deferred.resolve(j)}}var j,i,t,n,k,q,e,f=this.promise=new v;this.isResolved=f.isResolved=function(){return 0==n};this.isRejected=f.isRejected=function(){return 1==n};this.isFulfilled=f.isFulfilled=function(){return 0<=
n};this.isCanceled=f.isCanceled=function(){return t};this.resolve=this.callback=function(a){this.fired=n=0;this.results=[a,null];m(a)};this.reject=this.errback=function(a){k=!0;this.fired=n=1;r("config-useDeferredInstrumentation")&&g.instrumentRejected&&g.instrumentRejected(a,!!e);m(a);this.results=[null,a]};this.progress=function(a){for(var b=e;b;){var d=b.progress;d&&d(a);b=b.next}};this.addCallbacks=function(a,b){this.then(a,b,p);return this};f.then=this.then=function(a,b,d){var c=d==p?this:new o(f.cancel),
a={resolved:a,error:b,progress:d,deferred:c};e?q=q.next=a:e=q=a;i&&s();return c.promise};var u=this;f.cancel=this.cancel=function(){if(!i){var a=c&&c(u);if(!i)a instanceof Error||(a=new w(a)),a.log=!1,u.reject(a)}t=!0};y(f)};h.extend(o,{addCallback:function(g){return this.addCallbacks(h.hitch.apply(c,arguments))},addErrback:function(g){return this.addCallbacks(null,h.hitch.apply(c,arguments))},addBoth:function(g){var m=h.hitch.apply(c,arguments);return this.addCallbacks(m,m)},fired:-1});o.when=c.when=
x;return o});