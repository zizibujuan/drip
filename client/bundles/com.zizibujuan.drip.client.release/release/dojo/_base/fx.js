//>>built
define("dojo/_base/fx",["./kernel","./config","./lang","../Evented","./Color","../aspect","../sniff","../dom","../dom-style"],function(dojo,config,lang,Evented,Color,aspect,has,dom,style){var _mixin=lang.mixin,basefx={},_Line=basefx._Line=function(start,end){this.start=start,this.end=end};_Line.prototype.getValue=function(n){return(this.end-this.start)*n+this.start};var Animation=basefx.Animation=function(args){_mixin(this,args),lang.isArray(this.curve)&&(this.curve=new _Line(this.curve[0],this.curve[1]))};Animation.prototype=new Evented,lang.extend(Animation,{duration:350,repeat:0,rate:20,_percent:0,_startRepeatCount:0,_getStep:function(){var _p=this._percent,_e=this.easing;return _e?_e(_p):_p},_fire:function(evt,args){var a=args||[];if(this[evt])if(config.debugAtAllCosts)this[evt].apply(this,a);else try{this[evt].apply(this,a)}catch(e){0,0}return this},play:function(delay,gotoStart){var _t=this;_t._delayTimer&&_t._clearTimer();if(gotoStart)_t._stopTimer(),_t._active=_t._paused=!1,_t._percent=0;else if(_t._active&&!_t._paused)return _t;_t._fire("beforeBegin",[_t.node]);var de=delay||_t.delay,_p=lang.hitch(_t,"_play",gotoStart);return de>0?(_t._delayTimer=setTimeout(_p,de),_t):(_p(),_t)},_play:function(gotoStart){var _t=this;_t._delayTimer&&_t._clearTimer(),_t._startTime=(new Date).valueOf(),_t._paused&&(_t._startTime-=_t.duration*_t._percent),_t._active=!0,_t._paused=!1;var value=_t.curve.getValue(_t._getStep());return _t._percent||(_t._startRepeatCount||(_t._startRepeatCount=_t.repeat),_t._fire("onBegin",[value])),_t._fire("onPlay",[value]),_t._cycle(),_t},pause:function(){var _t=this;return _t._delayTimer&&_t._clearTimer(),_t._stopTimer(),_t._active?(_t._paused=!0,_t._fire("onPause",[_t.curve.getValue(_t._getStep())]),_t):_t},gotoPercent:function(percent,andPlay){var _t=this;return _t._stopTimer(),_t._active=_t._paused=!0,_t._percent=percent,andPlay&&_t.play(),_t},stop:function(gotoEnd){var _t=this;return _t._delayTimer&&_t._clearTimer(),_t._timer?(_t._stopTimer(),gotoEnd&&(_t._percent=1),_t._fire("onStop",[_t.curve.getValue(_t._getStep())]),_t._active=_t._paused=!1,_t):_t},status:function(){return this._active?this._paused?"paused":"playing":"stopped"},_cycle:function(){var _t=this;if(_t._active){var curr=(new Date).valueOf(),step=_t.duration===0?1:(curr-_t._startTime)/_t.duration;step>=1&&(step=1),_t._percent=step,_t.easing&&(step=_t.easing(step)),_t._fire("onAnimate",[_t.curve.getValue(step)]),_t._percent<1?_t._startTimer():(_t._active=!1,_t.repeat>0?(_t.repeat--,_t.play(null,!0)):_t.repeat==-1?_t.play(null,!0):_t._startRepeatCount&&(_t.repeat=_t._startRepeatCount,_t._startRepeatCount=0),_t._percent=0,_t._fire("onEnd",[_t.node]),!_t.repeat&&_t._stopTimer())}return _t},_clearTimer:function(){clearTimeout(this._delayTimer),delete this._delayTimer}});var ctr=0,timer=null,runner={run:function(){}};lang.extend(Animation,{_startTimer:function(){this._timer||(this._timer=aspect.after(runner,"run",lang.hitch(this,"_cycle"),!0),ctr++),timer||(timer=setInterval(lang.hitch(runner,"run"),this.rate))},_stopTimer:function(){this._timer&&(this._timer.remove(),this._timer=null,ctr--),ctr<=0&&(clearInterval(timer),timer=null,ctr=0)}});var _makeFadeable=has("ie")?function(node){var ns=node.style;!ns.width.length&&style.get(node,"width")=="auto"&&(ns.width="auto")}:function(){};basefx._fade=function(args){args.node=dom.byId(args.node);var fArgs=_mixin({properties:{}},args),props=fArgs.properties.opacity={};props.start="start"in fArgs?fArgs.start:function(){return+style.get(fArgs.node,"opacity")||0},props.end=fArgs.end;var anim=basefx.animateProperty(fArgs);return aspect.after(anim,"beforeBegin",lang.partial(_makeFadeable,fArgs.node),!0),anim},basefx.fadeIn=function(args){return basefx._fade(_mixin({end:1},args))},basefx.fadeOut=function(args){return basefx._fade(_mixin({end:0},args))},basefx._defaultEasing=function(n){return.5+Math.sin((n+1.5)*Math.PI)/2};var PropLine=function(properties){this._properties=properties;for(var p in properties){var prop=properties[p];prop.start instanceof Color&&(prop.tempColor=new Color)}};return PropLine.prototype.getValue=function(r){var ret={};for(var p in this._properties){var prop=this._properties[p],start=prop.start;start instanceof Color?ret[p]=Color.blendColors(start,prop.end,r,prop.tempColor).toCss():lang.isArray(start)||(ret[p]=(prop.end-start)*r+start+(p!="opacity"?prop.units||"px":0))}return ret},basefx.animateProperty=function(args){var n=args.node=dom.byId(args.node);args.easing||(args.easing=dojo._defaultEasing);var anim=new Animation(args);return aspect.after(anim,"beforeBegin",lang.hitch(anim,function(){var pm={};for(var p in this.properties){if(p=="width"||p=="height")this.node.display="block";var prop=this.properties[p];lang.isFunction(prop)&&(prop=prop(n)),prop=pm[p]=_mixin({},lang.isObject(prop)?prop:{end:prop}),lang.isFunction(prop.start)&&(prop.start=prop.start(n)),lang.isFunction(prop.end)&&(prop.end=prop.end(n));var isColor=p.toLowerCase().indexOf("color")>=0;function getStyle(node,p){var v={height:node.offsetHeight,width:node.offsetWidth}[p];return v!==undefined?v:(v=style.get(node,p),p=="opacity"?+v:isColor?v:parseFloat(v))}"end"in prop?"start"in prop||(prop.start=getStyle(n,p)):prop.end=getStyle(n,p),isColor?(prop.start=new Color(prop.start),prop.end=new Color(prop.end)):prop.start=p=="opacity"?+prop.start:parseFloat(prop.start)}this.curve=new PropLine(pm)}),!0),aspect.after(anim,"onAnimate",lang.hitch(style,"set",anim.node),!0),anim},basefx.anim=function(node,properties,duration,easing,onEnd,delay){return basefx.animateProperty({node:node,duration:duration||Animation.prototype.duration,properties:properties,easing:easing,onEnd:onEnd}).play(delay||0)},_mixin(dojo,basefx),dojo._Animation=Animation,basefx})