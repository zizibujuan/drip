//>>built
define("dojox/mobile/ComboBox",["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/dom-geometry","dojo/dom-style","dojo/window","dojo/touch","dijit/form/_AutoCompleterMixin","dijit/popup","./_ComboBoxMenu","./TextBox","./sniff"],function(kernel,declare,lang,win,domGeometry,domStyle,windowUtils,touch,AutoCompleterMixin,popup,ComboBoxMenu,TextBox,has){return kernel.experimental("dojox.mobile.ComboBox"),declare("dojox.mobile.ComboBox",[TextBox,AutoCompleterMixin],{dropDownClass:"dojox.mobile._ComboBoxMenu",selectOnClick:!1,autoComplete:!1,dropDown:null,maxHeight:-1,dropDownPosition:["below","above"],_throttleOpenClose:function(){this._throttleHandler&&this._throttleHandler.remove(),this._throttleHandler=this.defer(function(){this._throttleHandler=null},500)},_onFocus:function(){this.inherited(arguments),!this._opened&&!this._throttleHandler&&this._startSearchAll()},onInput:function(e){this._onKey(e),this.inherited(arguments)},_setListAttr:function(v){this._set("list",v)},closeDropDown:function(){this._throttleOpenClose(),this.endHandler&&(this.disconnect(this.startHandler),this.disconnect(this.endHandler),this.disconnect(this.moveHandler),clearInterval(this.repositionTimer),this.repositionTimer=this.endHandler=null),this.inherited(arguments),popup.close(this.dropDown),this._opened=!1},openDropDown:function(){var wasClosed=!this._opened,dropDown=this.dropDown,ddNode=dropDown.domNode,aroundNode=this.domNode,self=this;has("touch")&&win.global.scrollBy(0,domGeometry.position(aroundNode,!1).y),this._preparedNode||(this._preparedNode=!0,ddNode.style.width&&(this._explicitDDWidth=!0),ddNode.style.height&&(this._explicitDDHeight=!0));var myStyle={display:"",overflow:"hidden",visibility:"hidden"};this._explicitDDWidth||(myStyle.width=""),this._explicitDDHeight||(myStyle.height=""),domStyle.set(ddNode,myStyle);var maxHeight=this.maxHeight;if(maxHeight==-1){var viewport=windowUtils.getBox(),position=domGeometry.position(aroundNode,!1);maxHeight=Math.floor(Math.max(position.y,viewport.h-(position.y+position.h)))}popup.moveOffScreen(dropDown),dropDown.startup&&!dropDown._started&&dropDown.startup();var mb=domGeometry.position(this.dropDown.containerNode,!1),overHeight=maxHeight&&mb.h>maxHeight;overHeight&&(mb.h=maxHeight),mb.w=Math.max(mb.w,aroundNode.offsetWidth),domGeometry.setMarginBox(ddNode,mb);var retVal=popup.open({parent:this,popup:dropDown,around:aroundNode,orient:this.dropDownPosition,onExecute:function(){self.closeDropDown()},onCancel:function(){self.closeDropDown()},onClose:function(){self._opened=!1}});this._opened=!0;if(wasClosed){var isGesture=!1,skipReposition=!1,active=!1,wrapper=dropDown.domNode.parentNode,aroundNodePos=domGeometry.position(aroundNode,!1),popupPos=domGeometry.position(wrapper,!1),deltaX=popupPos.x-aroundNodePos.x,deltaY=popupPos.y-aroundNodePos.y,startX=-1,startY=-1;this.startHandler=this.connect(win.doc.documentElement,touch.press,function(e){skipReposition=!0,active=!0,isGesture=!1,startX=e.clientX,startY=e.clientY}),this.moveHandler=this.connect(win.doc.documentElement,touch.move,function(e){skipReposition=!0,e.touches?active=isGesture=!0:active&&(e.clientX!=startX||e.clientY!=startY)&&(isGesture=!0)}),this.clickHandler=this.connect(dropDown.domNode,"onclick",function(){skipReposition=!0,active=isGesture=!1}),this.endHandler=this.connect(win.doc.documentElement,"onmouseup",function(){this.defer(function(){skipReposition=!0,!isGesture&&active&&this.closeDropDown(),active=!1})}),this.repositionTimer=setInterval(lang.hitch(this,function(){if(skipReposition){skipReposition=!1;return}var currentAroundNodePos=domGeometry.position(aroundNode,!1),currentPopupPos=domGeometry.position(wrapper,!1),currentDeltaX=currentPopupPos.x-currentAroundNodePos.x,currentDeltaY=currentPopupPos.y-currentAroundNodePos.y;(Math.abs(currentDeltaX-deltaX)>=1||Math.abs(currentDeltaY-deltaY)>=1)&&domStyle.set(wrapper,{left:parseInt(domStyle.get(wrapper,"left"))+deltaX-currentDeltaX+"px",top:parseInt(domStyle.get(wrapper,"top"))+deltaY-currentDeltaY+"px"})}),50)}return retVal},postCreate:function(){this.inherited(arguments),this.connect(this.domNode,"onclick","_onClick")},destroy:function(){this.repositionTimer&&clearInterval(this.repositionTimer),this.inherited(arguments)},_onClick:function(e){this._throttleHandler||(this.opened?this.closeDropDown():this._startSearchAll())}})})