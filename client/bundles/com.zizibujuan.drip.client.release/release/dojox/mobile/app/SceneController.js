//>>built
define("dojox/mobile/app/SceneController",["dojo","dijit","dojox","dojo/require!dojox/mobile/_base"],function(dojo,dijit,dojox){dojo.provide("dojox.mobile.app.SceneController"),dojo.experimental("dojox.mobile.app.SceneController"),dojo.require("dojox.mobile._base"),function(){var app=dojox.mobile.app,templates={};dojo.declare("dojox.mobile.app.SceneController",dojox.mobile.View,{stageController:null,keepScrollPos:!1,init:function(sceneName,params){this.sceneName=sceneName,this.params=params;var templateUrl=app.resolveTemplate(sceneName);return this._deferredInit=new dojo.Deferred,templates[sceneName]?this._setContents(templates[sceneName]):dojo.xhrGet({url:templateUrl,handleAs:"text"}).addCallback(dojo.hitch(this,this._setContents)),this._deferredInit},_setContents:function(templateHtml){templates[this.sceneName]=templateHtml,this.domNode.innerHTML="<div>"+templateHtml+"</div>";var sceneAssistantName="",nameParts=this.sceneName.split("-");for(var i=0;i<nameParts.length;i++)sceneAssistantName+=nameParts[i].substring(0,1).toUpperCase()+nameParts[i].substring(1);sceneAssistantName+="Assistant",this.sceneAssistantName=sceneAssistantName;var _this=this;dojox.mobile.app.loadResourcesForScene(this.sceneName,function(){0;var assistant;if(typeof dojo.global[sceneAssistantName]!="undefined")_this._initAssistant();else{var assistantUrl=app.resolveAssistant(_this.sceneName);dojo.xhrGet({url:assistantUrl,handleAs:"text"}).addCallback(function(text){try{dojo.eval(text)}catch(e){throw 0,e}_this._initAssistant()})}})},_initAssistant:function(){0;var cls=dojo.getObject(this.sceneAssistantName);if(!cls)throw Error("Unable to resolve scene assistant "+this.sceneAssistantName);this.assistant=new cls(this.params),this.assistant.controller=this,this.assistant.domNode=this.domNode.firstChild,this.assistant.setup(),this._deferredInit.callback()},query:function(selector,node){return dojo.query(selector,node||this.domNode)},parse:function(node){var widgets=this._widgets=dojox.mobile.parser.parse(node||this.domNode,{controller:this});for(var i=0;i<widgets.length;i++)widgets[i].set("controller",this)},getWindowSize:function(){return{w:dojo.global.innerWidth,h:dojo.global.innerHeight}},showAlertDialog:function(props){var size=dojo.marginBox(this.assistant.domNode),dialog=new dojox.mobile.app.AlertDialog(dojo.mixin(props,{controller:this}));this.assistant.domNode.appendChild(dialog.domNode),0,dialog.show()},popupSubMenu:function(info){var widget=new dojox.mobile.app.ListSelector({controller:this,destroyOnHide:!0,onChoose:info.onChoose});this.assistant.domNode.appendChild(widget.domNode),widget.set("data",info.choices),widget.show(info.fromNode)}})}()})