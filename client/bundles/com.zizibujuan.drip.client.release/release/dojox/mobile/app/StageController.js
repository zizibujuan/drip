//>>built
define("dojox/mobile/app/StageController",["dojo","dijit","dojox","dojo/require!dojox/mobile/app/SceneController"],function(dojo,dijit,dojox){dojo.provide("dojox.mobile.app.StageController"),dojo.experimental("dojox.mobile.app.StageController"),dojo.require("dojox.mobile.app.SceneController"),dojo.declare("dojox.mobile.app.StageController",null,{scenes:null,effect:"fade",constructor:function(node){this.domNode=node,this.scenes=[],dojo.config.mobileAnim&&(this.effect=dojo.config.mobileAnim)},getActiveSceneController:function(){return this.scenes[this.scenes.length-1]},pushScene:function(sceneName,params){if(this._opInProgress)return;this._opInProgress=!0;var node=dojo.create("div",{"class":"scene-wrapper",style:{visibility:"hidden"}},this.domNode),controller=new dojox.mobile.app.SceneController({},node);this.scenes.length>0&&this.scenes[this.scenes.length-1].assistant.deactivate(),this.scenes.push(controller);var _this=this;dojo.forEach(this.scenes,this.setZIndex),controller.stageController=this,controller.init(sceneName,params).addCallback(function(){_this.scenes.length==1?(controller.domNode.style.visibility="visible",_this.scenes[_this.scenes.length-1].assistant.activate(params),_this._opInProgress=!1):_this.scenes[_this.scenes.length-2].performTransition(_this.scenes[_this.scenes.length-1].domNode,1,_this.effect,null,function(){_this.scenes[_this.scenes.length-1].assistant.activate(params),_this._opInProgress=!1})})},setZIndex:function(controller,idx){dojo.style(controller.domNode,"zIndex",idx+1)},popScene:function(data){if(this._opInProgress)return;var _this=this;this.scenes.length>1?(this._opInProgress=!0,this.scenes[_this.scenes.length-2].assistant.activate(data),this.scenes[_this.scenes.length-1].performTransition(_this.scenes[this.scenes.length-2].domNode,-1,this.effect,null,function(){_this._destroyScene(_this.scenes[_this.scenes.length-1]),_this.scenes.splice(_this.scenes.length-1,1),_this._opInProgress=!1})):0},popScenesTo:function(sceneName,data){if(this._opInProgress)return;while(this.scenes.length>2&&this.scenes[this.scenes.length-2].sceneName!=sceneName)this._destroyScene(this.scenes[this.scenes.length-2]),this.scenes.splice(this.scenes.length-2,1);this.popScene(data)},_destroyScene:function(scene){scene.assistant.deactivate(),scene.assistant.destroy(),scene.destroyRecursive()}})})