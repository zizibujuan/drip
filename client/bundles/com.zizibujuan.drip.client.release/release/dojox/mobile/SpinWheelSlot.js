//>>built
define("dojox/mobile/SpinWheelSlot",["dojo/_base/kernel","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/dom-class","dojo/dom-construct","dijit/_Contained","dijit/_WidgetBase","./scrollable","dojo/has","dojo/has!dojo-bidi?dojox/mobile/bidi/SpinWheelSlot"],function(dojo,array,declare,lang,win,domClass,domConstruct,Contained,WidgetBase,Scrollable,has,BidiSpinWheelSlot){var SpinWheelSlot=declare(has("dojo-bidi")?"dojox.mobile.NonBidiSpinWheelSlot":"dojox.mobile.SpinWheelSlot",[WidgetBase,Contained,Scrollable],{items:[],labels:[],labelFrom:0,labelTo:0,zeroPad:0,value:"",step:1,tabIndex:"0",_setTabIndexAttr:"",baseClass:"mblSpinWheelSlot",maxSpeed:500,minItems:15,centerPos:0,scrollBar:!1,constraint:!1,propagatable:!1,androidWorkaroud:!1,buildRendering:function(){this.inherited(arguments),this.initLabels();var i,j;if(this.labels.length>0){this.items=[];for(i=0;i<this.labels.length;i++)this.items.push([i,this.labels[i]])}this.containerNode=domConstruct.create("div",{className:"mblSpinWheelSlotContainer"}),this.containerNode.style.height=(win.global.innerHeight||win.doc.documentElement.clientHeight)*2+"px",this.panelNodes=[];for(var k=0;k<3;k++){this.panelNodes[k]=domConstruct.create("div",{className:"mblSpinWheelSlotPanel"});var len=this.items.length,n=Math.ceil(this.minItems/len);for(j=0;j<n;j++)for(i=0;i<len;i++)domConstruct.create("div",{className:"mblSpinWheelSlotLabel",name:this.items[i][0],val:this.items[i][1],innerHTML:this._cv?this._cv(this.items[i][1]):this.items[i][1]},this.panelNodes[k]);this.containerNode.appendChild(this.panelNodes[k])}this.domNode.appendChild(this.containerNode),this.touchNode=domConstruct.create("div",{className:"mblSpinWheelSlotTouch"},this.domNode),this.setSelectable(this.domNode,!1),this.value===""&&this.items.length>0&&(this.value=this.items[0][1]),this._initialValue=this.value},startup:function(){if(this._started)return;this.inherited(arguments),this.noResize=!0,this.init(),this.centerPos=this.getParent().centerPos;var items=this.panelNodes[1].childNodes;this._itemHeight=items[0].offsetHeight,this.adjust(),this._keydownHandle=this.connect(this.domNode,"onkeydown","_onKeyDown")},initLabels:function(){if(this.labelFrom!==this.labelTo){var a=this.labels=[],zeros=this.zeroPad&&Array(this.zeroPad).join("0");for(var i=this.labelFrom;i<=this.labelTo;i+=this.step)a.push(this.zeroPad?(zeros+i).slice(-this.zeroPad):i+"")}},adjust:function(){var items=this.panelNodes[1].childNodes,adjustY;for(var i=0,len=items.length;i<len;i++){var item=items[i];if(item.offsetTop<=this.centerPos&&this.centerPos<item.offsetTop+item.offsetHeight){adjustY=this.centerPos-(item.offsetTop+Math.round(item.offsetHeight/2));break}}var h=this.panelNodes[0].offsetHeight;this.panelNodes[0].style.top=-h+adjustY+"px",this.panelNodes[1].style.top=adjustY+"px",this.panelNodes[2].style.top=h+adjustY+"px"},setInitialValue:function(){this.set("value",this._initialValue)},_onKeyDown:function(e){if(!e||e.type!=="keydown")return;e.keyCode===40?this.spin(-1):e.keyCode===38&&this.spin(1)},_getCenterPanel:function(){var pos=this.getPos();for(var i=0,len=this.panelNodes.length;i<len;i++){var top=pos.y+this.panelNodes[i].offsetTop;if(top<=this.centerPos&&this.centerPos<top+this.panelNodes[i].offsetHeight)return this.panelNodes[i]}return null},setColor:function(value,color){array.forEach(this.panelNodes,function(panel){array.forEach(panel.childNodes,function(node,i){domClass.toggle(node,color||"mblSpinWheelSlotLabelBlue",node.innerHTML===value)},this)},this)},disableValues:function(n){array.forEach(this.panelNodes,function(panel){for(var i=0;i<panel.childNodes.length;i++)domClass.toggle(panel.childNodes[i],"mblSpinWheelSlotLabelGray",i>=n)})},getCenterItem:function(){var pos=this.getPos(),centerPanel=this._getCenterPanel();if(centerPanel){var top=pos.y+centerPanel.offsetTop,items=centerPanel.childNodes;for(var i=0,len=items.length;i<len;i++)if(top+items[i].offsetTop<=this.centerPos&&this.centerPos<top+items[i].offsetTop+items[i].offsetHeight)return items[i]}return null},_getKeyAttr:function(){var item=this.getCenterItem();return item&&item.getAttribute("name")},_getValueAttr:function(){var item=this.getCenterItem();return item&&item.getAttribute("val")},_setValueAttr:function(value){this._spinToValue(value,!0)},_spinToValue:function(value,applyValue){var idx0,idx1,curValue=this.get("value");if(!curValue){this._pendingValue=value;return}if(curValue==value)return;this._pendingValue=undefined,applyValue&&this._set("value",value);var n=this.items.length;for(var i=0;i<n;i++){this.items[i][1]===String(curValue)&&(idx0=i),this.items[i][1]===String(value)&&(idx1=i);if(idx0!==undefined&&idx1!==undefined)break}var d=idx1-(idx0||0),m;d>0?m=d<n-d?-d:n-d:m=-d<n+d?-d:-(n+d),this.spin(m)},spin:function(steps){if(!this._started)return;var to=this.getPos();if(to.y%this._itemHeight)return;to.y+=steps*this._itemHeight,this.slideTo(to,1)},getSpeed:function(){var y=0,n=this._time.length,delta=(new Date).getTime()-this.startTime-this._time[n-1];if(n>=2&&delta<200){var dy=this._posY[n-1]-this._posY[n-6>=0?n-6:0],dt=this._time[n-1]-this._time[n-6>=0?n-6:0];y=this.calcSpeed(dy,dt)}return{x:0,y:y}},calcSpeed:function(d,t){var speed=this.inherited(arguments);if(!speed)return 0;var v=Math.abs(speed),ret=speed;return v>this.maxSpeed&&(ret=this.maxSpeed*(speed/v)),ret},adjustDestination:function(to,pos,dim){var h=this._itemHeight,j=to.y+Math.round(h/2),r=j>=0?j%h:j%h+h;return to.y=j-r,!0},resize:function(e){this._pendingValue&&this.set("value",this._pendingValue)},slideTo:function(to,duration,easing){var pos=this.getPos(),top=pos.y+this.panelNodes[1].offsetTop,bottom=top+this.panelNodes[1].offsetHeight,vh=this.domNode.parentNode.offsetHeight,t;pos.y<to.y?bottom>vh&&(t=this.panelNodes[2],t.style.top=this.panelNodes[0].offsetTop-this.panelNodes[0].offsetHeight+"px",this.panelNodes[2]=this.panelNodes[1],this.panelNodes[1]=this.panelNodes[0],this.panelNodes[0]=t):pos.y>to.y&&top<0&&(t=this.panelNodes[0],t.style.top=this.panelNodes[2].offsetTop+this.panelNodes[2].offsetHeight+"px",this.panelNodes[0]=this.panelNodes[1],this.panelNodes[1]=this.panelNodes[2],this.panelNodes[2]=t),this._initialized?Math.abs(this._speed.y)<40&&(duration=.2):(duration=0,this._initialized=!0),this.inherited(arguments,[to,duration,easing])}});return has("dojo-bidi")?declare("dojox.mobile.SpinWheelSlot",[SpinWheelSlot,BidiSpinWheelSlot]):SpinWheelSlot})