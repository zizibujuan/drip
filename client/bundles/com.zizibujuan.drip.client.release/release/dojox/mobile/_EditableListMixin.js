//>>built
define("dojox/mobile/_EditableListMixin",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/event","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/touch","dijit/registry","./ListItem"],function(array,connect,declare,event,domClass,domGeometry,domStyle,touch,registry,ListItem){return declare("dojox.mobile._EditableListMixin",null,{rightIconForEdit:"mblDomButtonGrayKnob",deleteIconForEdit:"mblDomButtonRedCircleMinus",isEditing:!1,destroy:function(){this._blankItem&&this._blankItem.destroy(),this.inherited(arguments)},_setupMoveItem:function(node){domStyle.set(node,{width:domGeometry.getContentBox(node).w+"px",top:node.offsetTop+"px"}),domClass.add(node,"mblListItemFloat")},_resetMoveItem:function(node){setTimeout(function(){domClass.remove(node,"mblListItemFloat"),domStyle.set(node,{width:"",top:""})},0)},_onClick:function(e){if(e&&e.type==="keydown"&&e.keyCode!==13)return;if(this.onClick(e)===!1)return;var item=registry.getEnclosingWidget(e.target);for(var n=e.target;n!==item.domNode;n=n.parentNode)if(n===item.deleteIconNode){connect.publish("/dojox/mobile/deleteListItem",[item]);break}},onClick:function(){},_onTouchStart:function(e){if(this.getChildren().length<=1)return;this._blankItem||(this._blankItem=new ListItem);var item=this._movingItem=registry.getEnclosingWidget(e.target),rightIconPressed=!1;for(var n=e.target;n!==item.domNode;n=n.parentNode)if(n===item.rightIconNode){rightIconPressed=!0;break}if(!rightIconPressed)return;var ref=item.getNextSibling();ref=ref?ref.domNode:null,this.containerNode.insertBefore(this._blankItem.domNode,ref),this._setupMoveItem(item.domNode),this.containerNode.appendChild(item.domNode),this._conn||(this._conn=[this.connect(this.domNode,touch.move,"_onTouchMove"),this.connect(this.domNode,touch.release,"_onTouchEnd")]),this._pos=[],array.forEach(this.getChildren(),function(c,index){this._pos.push(domGeometry.position(c.domNode,!0).y)},this),this.touchStartY=e.touches?e.touches[0].pageY:e.pageY,this._startTop=domGeometry.getMarginBox(item.domNode).t,event.stop(e)},_onTouchMove:function(e){var y=e.touches?e.touches[0].pageY:e.pageY,index=this._pos.length-1;for(var i=1;i<this._pos.length;i++)if(y<this._pos[i]){index=i-1;break}var item=this.getChildren()[index],blank=this._blankItem;if(item!==blank){var p=item.domNode.parentNode;item.getIndexInParent()<blank.getIndexInParent()?p.insertBefore(blank.domNode,item.domNode):p.insertBefore(item.domNode,blank.domNode)}this._movingItem.domNode.style.top=this._startTop+(y-this.touchStartY)+"px"},_onTouchEnd:function(e){var ref=this._blankItem.getNextSibling();ref=ref?ref.domNode:null,this.containerNode.insertBefore(this._movingItem.domNode,ref),this.containerNode.removeChild(this._blankItem.domNode),this._resetMoveItem(this._movingItem.domNode),array.forEach(this._conn,connect.disconnect),this._conn=null},startEdit:function(){this.isEditing=!0,domClass.add(this.domNode,"mblEditableRoundRectList"),array.forEach(this.getChildren(),function(child){child.deleteIconNode||(child.set("rightIcon",this.rightIconForEdit),child.set("deleteIcon",this.deleteIconForEdit),child.deleteIconNode.tabIndex=child.tabIndex),child.rightIconNode.style.display="",child.deleteIconNode.style.display=""},this),this._handles||(this._handles=[this.connect(this.domNode,touch.press,"_onTouchStart"),this.connect(this.domNode,"onclick","_onClick"),this.connect(this.domNode,"onkeydown","_onClick")])},endEdit:function(){domClass.remove(this.domNode,"mblEditableRoundRectList"),array.forEach(this.getChildren(),function(child){child.rightIconNode.style.display="none",child.deleteIconNode.style.display="none"}),this._handles&&(array.forEach(this._handles,this.disconnect,this),this._handles=null),this.isEditing=!1}})})