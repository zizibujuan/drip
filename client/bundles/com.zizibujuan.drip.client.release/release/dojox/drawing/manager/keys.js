//>>built
define("dojox/drawing/manager/keys",["dojo","../util/common"],function(dojo,utilCommon){var isEdit=!1,enabled=!0,alphabet="abcdefghijklmnopqrstuvwxyz",keys={arrowIncrement:1,arrowShiftIncrement:10,shift:!1,ctrl:!1,alt:!1,cmmd:!1,meta:!1,onDelete:function(evt){},onEsc:function(evt){},onEnter:function(evt){},onArrow:function(evt){},onKeyDown:function(evt){},onKeyUp:function(evt){},listeners:[],register:function(options){var _handle=utilCommon.uid("listener");this.listeners.push({handle:_handle,scope:options.scope||window,callback:options.callback,keyCode:options.keyCode})},_getLetter:function(evt){return!evt.meta&&evt.keyCode>=65&&evt.keyCode<=90?alphabet.charAt(evt.keyCode-65):null},_mixin:function(evt){return evt.meta=this.meta,evt.shift=this.shift,evt.alt=this.alt,evt.cmmd=this.cmmd,evt.ctrl=this.ctrl,evt.letter=this._getLetter(evt),evt},editMode:function(_isedit){isEdit=_isedit},enable:function(_enabled){enabled=_enabled},scanForFields:function(){this._fieldCons&&dojo.forEach(this._fieldCons,dojo.disconnect,dojo),this._fieldCons=[],dojo.query("input").forEach(function(n){var a=dojo.connect(n,"focus",this,function(evt){this.enable(!1)}),b=dojo.connect(n,"blur",this,function(evt){this.enable(!0)});this._fieldCons.push(a),this._fieldCons.push(b)},this)},init:function(){setTimeout(dojo.hitch(this,"scanForFields"),500),dojo.connect(document,"blur",this,function(evt){this.meta=this.shift=this.ctrl=this.cmmd=this.alt=!1}),dojo.connect(document,"keydown",this,function(evt){if(!enabled)return;evt.keyCode==16&&(this.shift=!0),evt.keyCode==17&&(this.ctrl=!0),evt.keyCode==18&&(this.alt=!0),evt.keyCode==224&&(this.cmmd=!0),this.meta=this.shift||this.ctrl||this.cmmd||this.alt,isEdit||(this.onKeyDown(this._mixin(evt)),(evt.keyCode==8||evt.keyCode==46)&&dojo.stopEvent(evt))}),dojo.connect(document,"keyup",this,function(evt){if(!enabled)return;var _stop=!1;evt.keyCode==16&&(this.shift=!1),evt.keyCode==17&&(this.ctrl=!1),evt.keyCode==18&&(this.alt=!1),evt.keyCode==224&&(this.cmmd=!1),this.meta=this.shift||this.ctrl||this.cmmd||this.alt,!isEdit&&this.onKeyUp(this._mixin(evt)),evt.keyCode==13&&(0,this.onEnter(evt),_stop=!0),evt.keyCode==27&&(this.onEsc(evt),_stop=!0);if(evt.keyCode==8||evt.keyCode==46)this.onDelete(evt),_stop=!0;_stop&&!isEdit&&dojo.stopEvent(evt)}),dojo.connect(document,"keypress",this,function(evt){if(!enabled)return;var inc=this.shift?this.arrowIncrement*this.arrowShiftIncrement:this.arrowIncrement,x=0,y=0;evt.keyCode==32&&!isEdit&&dojo.stopEvent(evt),evt.keyCode==37&&(x=-inc),evt.keyCode==38&&(y=-inc),evt.keyCode==39&&(x=inc),evt.keyCode==40&&(y=inc);if(x||y)evt.x=x,evt.y=y,evt.shift=this.shift,isEdit||(this.onArrow(evt),dojo.stopEvent(evt))})}};return dojo.addOnLoad(keys,"init"),keys})