//>>built
define("dojox/drawing/tools/custom/Vector",["dojo","../../util/oo","../../manager/_registry","../../util/positioning","../Arrow"],function(dojo,oo,registry,positioning,Arrow){var Vector=oo.declare(Arrow,function(options){this.minimumSize=this.style.arrows.length,this.addShadow({size:3,mult:2})},{draws:!0,type:"dojox.drawing.tools.custom.Vector",minimumSize:30,showAngle:!0,changeAxis:function(cosphi){cosphi=cosphi!==undefined?cosphi:this.style.zAxis?0:1;if(cosphi==0)this.style.zAxis=!1,this.data.cosphi=0;else{this.style.zAxis=!0;var p=this.points,pt=this.zPoint();this.setPoints([{x:p[0].x,y:p[0].y},{x:pt.x,y:pt.y}])}this.render()},_createZeroVector:function(shp,d,sty){var s=shp=="hit"?this.minimumSize:this.minimumSize/6,f=shp=="hit"?sty.fill:null;d={cx:this.data.x1,cy:this.data.y1,rx:s,ry:s},this.remove(this[shp]),this[shp]=this.container.createEllipse(d).setStroke(sty).setFill(f),this.util.attr(this[shp],"drawingType","stencil")},_create:function(shp,d,sty){this.remove(this[shp]),this[shp]=this.container.createLine(d).setStroke(sty),this._setNodeAtts(this[shp])},onDrag:function(obj){if(this.created)return;var x1=obj.start.x,y1=obj.start.y,x2=obj.x,y2=obj.y;if(this.keys.shift&&!this.style.zAxis){var pt=this.util.snapAngle(obj,.25);x2=pt.x,y2=pt.y}if(this.keys.alt){var dx=x2>x1?(x2-x1)/2:(x1-x2)/-2,dy=y2>y1?(y2-y1)/2:(y1-y2)/-2;x1-=dx,x2-=dx,y1-=dy,y2-=dy}if(this.style.zAxis){var pts=this.zPoint(obj);x2=pts.x,y2=pts.y}this.setPoints([{x:x1,y:y1},{x:x2,y:y2}]),this.render()},onTransform:function(anchor){this._isBeingModified||this.onTransformBegin(),this.setPoints(this.points),this.render()},anchorConstrain:function(x,y){if(!this.style.zAxis)return null;var radians=this.style.zAngle*Math.PI/180,test=x<0?x>-y:x<-y,dx=test?x:-y/Math.tan(radians),dy=test?-Math.tan(radians)*x:y;return{x:dx,y:dy}},zPoint:function(obj){if(obj===undefined){if(!this.points[0])return null;var d=this.pointsToData();obj={start:{x:d.x1,y:d.y1},x:d.x2,y:d.y2}}var radius=this.util.length(obj),angle=positioning.angle(obj);return angle<0?angle=360+angle:angle,angle=angle>135&&angle<315?this.style.zAngle:this.util.oppAngle(this.style.zAngle),this.util.pointOnCircle(obj.start.x,obj.start.y,radius,angle)},pointsToData:function(p){p=p||this.points;var cosphi=0,obj={start:{x:p[0].x,y:p[0].y},x:p[1].x,y:p[1].y};if(this.style.zAxis&&this.util.length(obj)>this.minimumSize){var angle=positioning.angle(obj);angle<0?angle=360+angle:angle,cosphi=angle>135&&angle<315?1:-1}return this.data={x1:p[0].x,y1:p[0].y,x2:p[1].x,y2:p[1].y,cosphi:cosphi},this.data},dataToPoints:function(o){o=o||this.data;if(o.radius||o.angle){var cosphi=0,pt=this.util.pointOnCircle(o.x,o.y,o.radius,o.angle);if(this.style.zAxis||o.cosphi&&o.cosphi!=0)this.style.zAxis=!0,cosphi=o.angle>135&&o.angle<315?1:-1;this.data=o={x1:o.x,y1:o.y,x2:pt.x,y2:pt.y,cosphi:cosphi}}return this.points=[{x:o.x1,y:o.y1},{x:o.x2,y:o.y2}],this.points},render:function(){this.onBeforeRender(this),this.getRadius()>=this.minimumSize?(this._create("hit",this.data,this.style.currentHit),this._create("shape",this.data,this.style.current)):(this.data.cosphi=0,this._createZeroVector("hit",this.data,this.style.currentHit),this._createZeroVector("shape",this.data,this.style.current))},onUp:function(obj){if(this.created||!this._downOnCanvas)return;this._downOnCanvas=!1;if(!this.shape){var d=100;obj.start.x=this.style.zAxis?obj.start.x+d:obj.start.x,obj.y=obj.y+d,this.setPoints([{x:obj.start.x,y:obj.start.y},{x:obj.x,y:obj.y}]),this.render()}if(this.getRadius()<this.minimumSize){var p=this.points;this.setPoints([{x:p[0].x,y:p[0].y},{x:p[0].x,y:p[0].y}])}else{var p=this.points,pt=this.style.zAxis?this.zPoint(obj):this.util.snapAngle(obj,this.angleSnap/180);this.setPoints([{x:p[0].x,y:p[0].y},{x:pt.x,y:pt.y}])}this.renderedOnce=!0,this.onRender(this)}});return dojo.setObject("dojox.drawing.tools.custom.Vector",Vector),Vector.setup={name:"dojox.drawing.tools.custom.Vector",tooltip:"Vector Tool",iconClass:"iconVector"},registry.register(Vector.setup,"tool"),Vector})