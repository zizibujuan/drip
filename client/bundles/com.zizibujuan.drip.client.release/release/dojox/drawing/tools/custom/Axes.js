//>>built
define("dojox/drawing/tools/custom/Axes",["dojo/_base/lang","../../util/oo","../../manager/_registry","../../stencil/Path","../../annotations/Arrow","../../annotations/Label","../../tools/custom/Vector"],function(lang,oo,registry,StencilPath,Arrow,Label,Vector){var Axes=oo.declare(StencilPath,function(options){this.closePath=!1,this.xArrow=new Arrow({stencil:this,idx1:0,idx2:1}),this.yArrow=new Arrow({stencil:this,idx1:2,idx2:1}),options.data&&(this.style.zAxisEnabled=options.data.cosphi==1?!0:!1,this.setData(options.data));if(this.style.zAxisEnabled){this.data.cosphi=1;var ops={};lang.mixin(ops,options),lang.mixin(ops,{container:this.container.createGroup(),style:this.style,showAngle:!1,label:null}),options.data&&(!ops.data.radius||!ops.data.angle)&&(ops.data.x2=ops.data.x4,ops.data.y2=ops.data.y4),ops.style.zAxis=!0,this.zAxis=new Vector(ops),this.zAxis.minimumSize=5,this.connectMult([[this,"onChangeStyle",this.zAxis,"onChangeStyle"],[this,"select",this.zAxis,"select"],[this,"deselect",this.zAxis,"deselect"],[this,"onDelete",this.zAxis,"destroy"],[this,"onDrag",this,"zSet"],[this,"onTransform",this,"zSet"],[this.zAxis,"onBeforeRender",this,"zSet"],[this,"_onPostRender",this.zAxis,"render"]])}this.points&&this.points.length&&(this.setPoints=this._postSetPoints,this.render(),options.label&&this.setLabel(options.label),options.shadow&&this.addShadow(options.shadow))},{draws:!0,type:"dojox.drawing.tools.custom.Axes",minimumSize:30,showAngle:!0,closePath:!1,baseRender:!1,zScale:.5,zPoint:function(obj){obj.radius=this.util.length(obj);var pt=this.util.pointOnCircle(obj.start.x,obj.start.y,obj.radius*this.zScale,this.style.zAngle);return{x:pt.x,y:pt.y,skip:!0,noAnchor:!0}},zSet:function(){if(!this.zAxis)return;var c=this.points[1],z=this.points[3],p=[{x:c.x,y:c.y},{x:z.x,y:z.y}],len=this.util.length({start:{x:c.x,y:c.y},x:z.x,y:z.y});len>this.zAxis.minimumSize?this.zAxis.setPoints(p):!1,this.zAxis.cosphi=1},createLabels:function(){var props={align:"middle",valign:"middle",util:this.util,annotation:!0,container:this.container,mouse:this.mouse,stencil:this};this.labelX=new Label(lang.mixin(props,{labelPosition:this.setLabelX})),this.labelY=new Label(lang.mixin(props,{labelPosition:this.setLabelY})),this.style.zAxisEnabled&&(this.labelZ=new Label(lang.mixin(props,{labelPosition:this.setLabelZ})))},setLabelX:function(){var ax=this.points[0],c=this.points[1],dist=40,offdist=20,pt,px,py,pt2;return pt=this.util.lineSub(c.x,c.y,ax.x,ax.y,dist),px=pt.x+(pt.y-ax.y),py=pt.y+(ax.x-pt.x),pt2=this.util.lineSub(pt.x,pt.y,px,py,dist-offdist),{x:pt2.x,y:pt2.y,width:20}},setLabelY:function(){var c=this.points[1],ay=this.points[2],dist=40,offdist=20,pt,px,py,pt2;return pt=this.util.lineSub(c.x,c.y,ay.x,ay.y,dist),px=pt.x+(ay.y-pt.y),py=pt.y+(pt.x-ay.x),pt2=this.util.lineSub(pt.x,pt.y,px,py,dist-offdist),{x:pt2.x,y:pt2.y,width:20}},setLabelZ:function(){var c=this.points[1],z=this.points[3],dist=40,offdist=20,pt,px,py,pt2;return pt=this.util.lineSub(c.x,c.y,z.x,z.y,dist),px=pt.x+(pt.y-z.y),py=pt.y+(z.x-pt.x),pt2=this.util.lineSub(pt.x,pt.y,px,py,dist-offdist),{x:pt2.x,y:pt2.y,width:20}},setLabel:function(value){if(this._labelsCreated)return;!this.labelX&&this.createLabels();var x="x",y="y",z="z";if(value)if(this.labelZ){var lbls=value.match(/(.*?)(and|&)(.*?)(and|&)(.*)/i);lbls.length>4&&(x=lbls[1].replace(/^\s+/,"").replace(/\s+$/,""),y=lbls[3].replace(/^\s+/,"").replace(/\s+$/,""),z=lbls[5].replace(/^\s+/,"").replace(/\s+$/,""))}else{var lbls=value.match(/(.*?)(and|&)(.*)/i);lbls.length>2&&(x=lbls[1].replace(/^\s+/,"").replace(/\s+$/,""),y=lbls[3].replace(/^\s+/,"").replace(/\s+$/,""))}this.labelX.setLabel(x),this.labelY.setLabel(y),this.labelZ&&this.labelZ.setLabel(z),this._labelsCreated=!0},getLabel:function(){return this.labelX?{x:this.labelX.getText(),y:this.labelY.getText(),z:this.labelZ?this.labelZ.getText():null}:null},anchorPositionCheck:function(x,y,anchor){var pm=this.container.getParent().getTransform(),am=anchor.shape.getTransform(),p=this.points,o={x:am.dx+anchor.org.x+pm.dx,y:am.dy+anchor.org.y+pm.dy},c={x:p[1].x+pm.dx,y:p[1].y+pm.dy},ox=c.x-(c.y-o.y),oy=c.y-(o.x-c.x);return{x:ox,y:oy}},onTransformBegin:function(anchor){this._isBeingModified=!0},onTransformEnd:function(anchor){if(!anchor)return;this._isBeingModified=!1,this._toggleSelected(),0;var o=this.points[0],c=this.points[1],obj={start:{x:c.x,y:c.y},x:o.x,y:o.y},pt=this.util.constrainAngle(obj,0,89),zpt=this.style.zAxisEnabled?this.zPoint(obj):null;if(pt.x==o.x&&pt.y==o.y){pt=this.util.snapAngle(obj,this.angleSnap/180),obj.x=pt.x,obj.y=pt.y;var ox=obj.start.x-(obj.start.y-obj.y),oy=obj.start.y-(obj.x-obj.start.x);if(ox<0||oy<0){0;return}this.points=[{x:obj.x,y:obj.y},{x:obj.start.x,y:obj.start.y,noAnchor:!0}],this.points.push({x:ox,y:oy,noAnchor:!0}),zpt&&this.points.push(zpt),this.setPoints(this.points),this.onModify(this);return}this.points[0].x=pt.x,this.points[0].y=pt.y,o=this.points[0];var ox=c.x-(c.y-o.y),oy=c.y-(o.x-c.x);this.points[2]={x:ox,y:oy,noAnchor:!0},zpt&&this.points.push(zpt),this.setPoints(this.points),this.labelX.setLabel(),this.labelY.setLabel(),this.labelZ&&this.labelZ.setLabel(),this.onModify(this)},getBounds:function(absolute){var px=this.points[0],pc=this.points[1],py=this.points[2];if(this.style.zAxisEnabled)var pz=this.points[3];if(absolute){var bounds={x:pc.x,y:pc.y,x1:pc.x,y1:pc.y,x2:px.x,y2:px.y,x3:py.x,y3:py.y};return this.style.zAxisEnabled&&(bounds.x4=pz.x,bounds.y4=pz.y),bounds}var x1=this.style.zAxisEnabled?py.x<pz.x?py.x:pz.x:py.x;return y1=py.y<px.y?py.y:px.y,x2=px.x,y2=this.style.zAxisEnabled?pz.y:pc.y,{x1:x1,y1:y1,x2:x2,y2:y2,x:x1,y:y1,w:x2-x1,h:y2-y1}},_postSetPoints:function(pts){this.points[0]=pts[0],this.pointsToData&&(this.data=this.pointsToData())},onTransform:function(anchor){var o=this.points[0],c=this.points[1],ox=c.x-(c.y-o.y),oy=c.y-(o.x-c.x);this.points[2]={x:ox,y:oy,noAnchor:!0},this.style.zAxisEnabled&&(this.points[3]=this.zPoint({start:{x:c.x,y:c.y},x:o.x,y:o.y})),this.setPoints(this.points),this._isBeingModified||this.onTransformBegin(),this.render()},pointsToData:function(){var p=this.points,d={x1:p[1].x,y1:p[1].y,x2:p[0].x,y2:p[0].y,x3:p[2].x,y3:p[2].y};return this.style.zAxisEnabled&&(d.x4=p[3].x,d.y4=p[3].y,d.cosphi=1),d},getRadius:function(){var p=this.points,line={start:{x:p[1].x,y:p[1].y},x:p[0].x,y:p[0].y};return this.util.length(line)},dataToPoints:function(o){o=o||this.data;if(o.radius||o.angle){var pt=this.util.pointOnCircle(o.x,o.y,o.radius,o.angle),zpt,ox=o.x-(o.y-pt.y),oy=o.y-(pt.x-o.x);if(o.cosphi&&o.cosphi==1||this.style.zAxisEnabled)this.style.zAxisEnabled=!0,zpt=this.util.pointOnCircle(o.x,o.y,o.radius*this.zScale,this.style.zAngle);this.data=o={x1:o.x,y1:o.y,x2:pt.x,y2:pt.y,x3:ox,y3:oy},this.style.zAxisEnabled&&(this.data.x4=o.x4=zpt.x,this.data.y4=o.y4=zpt.y,this.data.cosphi=1)}return this.points=[{x:o.x2,y:o.y2},{x:o.x1,y:o.y1,noAnchor:!0},{x:o.x3,y:o.y3,noAnchor:!0}],this.style.zAxisEnabled&&this.points.push({x:o.x4,y:o.y4,skip:!0,noAnchor:!0}),this.points},onDrag:function(obj){var pt=this.util.constrainAngle(obj,0,89);obj.x=pt.x,obj.y=pt.y;var ox=obj.start.x-(obj.start.y-obj.y),oy=obj.start.y-(obj.x-obj.start.x);if(ox<0||oy<0)return;this.points=[{x:obj.x,y:obj.y},{x:obj.start.x,y:obj.start.y,noAnchor:!0}],this.points.push({x:ox,y:oy,noAnchor:!0});if(this.style.zAxisEnabled){var zpt=this.zPoint(obj);this.points.push(zpt)}this.render()},onUp:function(obj){if(!this._downOnCanvas)return;this._downOnCanvas=!1;var p=this.points;if(!p.length){var s=obj.start,d=100;this.points=[{x:s.x+d,y:s.y+d},{x:s.x,y:s.y+d,noAnchor:!0},{x:s.x,y:s.y,noAnchor:!0}];if(this.style.zAxisEnabled){var zpt=this.zPoint({start:{x:s.x,y:s.y+d},x:s.x+d,y:s.y+d});this.points.push(zpt)}this.setPoints=this._postSetPoints,this.pointsToData(),this.render(),this.onRender(this);return}var len=this.util.distance(p[1].x,p[1].y,p[0].x,p[0].y);if(!p||!p.length)return;if(len<this.minimumSize){this.remove(this.shape,this.hit),this.xArrow.remove(this.xArrow.shape,this.xArrow.hit),this.yArrow.remove(this.yArrow.shape,this.yArrow.hit),this.zArrow&&this.zArrow.remove(this.zArrow.shape,this.zArrow.hit);return}var o=p[0],c=p[1];obj={start:{x:c.x,y:c.y},x:o.x,y:o.y};var pt=this.util.snapAngle(obj,this.angleSnap/180);obj.x=pt.x,obj.y=pt.y;var ox=obj.start.x-(obj.start.y-obj.y),oy=obj.start.y-(obj.x-obj.start.x);if(ox<0||oy<0)return;this.points=[{x:obj.x,y:obj.y},{x:obj.start.x,y:obj.start.y,noAnchor:!0}],this.points.push({x:ox,y:oy,noAnchor:!0}),this.style.zAxisEnabled&&this.points.push(this.zPoint(obj)),this.onRender(this),this.setPoints=this._postSetPoints}});return lang.setObject("dojox.drawing.tools.custom.Axes",Axes),Axes.setup={name:"dojox.drawing.tools.custom.Axes",tooltip:"Axes Tool",iconClass:"iconAxes"},registry.register(Axes.setup,"tool"),Axes})