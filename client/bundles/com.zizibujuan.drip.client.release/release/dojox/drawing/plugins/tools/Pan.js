//>>built
define("dojox/drawing/plugins/tools/Pan",["dojo/_base/lang","../../util/oo","../_Plugin","../../manager/_registry"],function(lang,oo,Plugin,registry){var Pan=oo.declare(Plugin,function(options){this.domNode=options.node;var _scrollTimeout;this.toolbar=options.scope,this.connect(this.toolbar,"onToolClick",this,function(){this.onSetPan(!1)}),this.connect(this.keys,"onKeyUp",this,"onKeyUp"),this.connect(this.keys,"onKeyDown",this,"onKeyDown"),this.connect(this.keys,"onArrow",this,"onArrow"),this.connect(this.anchors,"onAnchorUp",this,"checkBounds"),this.connect(this.stencils,"register",this,"checkBounds"),this.connect(this.canvas,"resize",this,"checkBounds"),this.connect(this.canvas,"setZoom",this,"checkBounds"),this.connect(this.canvas,"onScroll",this,function(){if(this._blockScroll){this._blockScroll=!1;return}_scrollTimeout&&clearTimeout(_scrollTimeout),_scrollTimeout=setTimeout(lang.hitch(this,"checkBounds"),200)}),this._mouseHandle=this.mouse.register(this)},{selected:!1,keyScroll:!1,type:"dojox.drawing.plugins.tools.Pan",onPanUp:function(obj){obj.id==this.button.id&&this.onSetPan(!1)},onKeyUp:function(evt){switch(evt.keyCode){case 32:this.onSetPan(!1);break;case 39:case 37:case 38:case 40:clearInterval(this._timer)}},onKeyDown:function(evt){evt.keyCode==32&&this.onSetPan(!0)},interval:20,onArrow:function(evt){this._timer&&clearInterval(this._timer),this._timer=setInterval(lang.hitch(this,function(evt){this.canvas.domNode.parentNode.scrollLeft+=evt.x*10,this.canvas.domNode.parentNode.scrollTop+=evt.y*10},evt),this.interval)},onSetPan:function(bool){if(bool===!0||bool===!1)this.selected=!bool;0,this.selected?(this.selected=!1,this.button.deselect()):(this.selected=!0,this.button.select()),this.mouse.setEventMode(this.selected?"pan":"")},onPanDrag:function(obj){var x=obj.x-obj.last.x,y=obj.y-obj.last.y;this.canvas.domNode.parentNode.scrollTop-=obj.move.y,this.canvas.domNode.parentNode.scrollLeft-=obj.move.x,this.canvas.onScroll()},onUp:function(obj){obj.withinCanvas?this.keyScroll=!0:this.keyScroll=!1},onStencilUp:function(obj){this.checkBounds()},onStencilDrag:function(obj){},checkBounds:function(){var log=function(){},warn=function(){},t=Infinity,r=-Infinity,b=-1e4,l=1e4,sx=0,sy=0,dy=0,dx=0,mx=this.stencils.group?this.stencils.group.getTransform():{dx:0,dy:0},sc=this.mouse.scrollOffset(),scY=sc.left?10:0,scX=sc.top?10:0,ch=this.canvas.height,cw=this.canvas.width,z=this.canvas.zoom,pch=this.canvas.parentHeight,pcw=this.canvas.parentWidth;this.stencils.withSelected(function(m){var o=m.getBounds();warn("SEL BOUNDS:",o),t=Math.min(o.y1+mx.dy,t),r=Math.max(o.x2+mx.dx,r),b=Math.max(o.y2+mx.dy,b),l=Math.min(o.x1+mx.dx,l)}),this.stencils.withUnselected(function(m){var o=m.getBounds();warn("UN BOUNDS:",o),t=Math.min(o.y1,t),r=Math.max(o.x2,r),b=Math.max(o.y2,b),l=Math.min(o.x1,l),log("----------- B:",b,o.y2)}),b*=z;var xscroll=0,yscroll=0;log("Bottom test","b:",b,"z:",z,"ch:",ch,"pch:",pch,"top:",sc.top,"sy:",sy,"mx.dy:",mx.dy),b>pch||sc.top?(log("*bottom scroll*"),ch=Math.max(b,pch+sc.top),sy=sc.top,xscroll+=this.canvas.getScrollWidth()):!sy&&ch>pch&&(log("*bottom remove*"),ch=pch),r*=z,r>pcw||sc.left?(cw=Math.max(r,pcw+sc.left),sx=sc.left,yscroll+=this.canvas.getScrollWidth()):!sx&&cw>pcw&&(cw=pcw),cw+=xscroll*2,ch+=yscroll*2,this._blockScroll=!0,this.stencils.group&&this.stencils.group.applyTransform({dx:dx,dy:dy}),this.stencils.withUnselected(function(m){m.transformPoints({dx:dx,dy:dy})}),this.canvas.setDimensions(cw,ch,sx,sy)}});return Pan.setup={name:"dojox.drawing.plugins.tools.Pan",tooltip:"Pan Tool",iconClass:"iconPan",button:!1},lang.setObject("dojox.drawing.plugins.tools.Pan",Pan),registry.register(Pan.setup,"plugin"),Pan})