//>>built
define("dojox/drawing/plugins/drawing/Silverlight",["dojo","dijit","dojox"],function(dojo,dijit,dojox){dojo.provide("dojox.drawing.plugins.drawing.Silverlight"),dojox.drawing.plugins.drawing.Silverlight=dojox.drawing.util.oo.declare(function(options){if(dojox.gfx.renderer!="silverlight")return;this.mouse=options.mouse,this.stencils=options.stencils,this.anchors=options.anchors,this.canvas=options.canvas,this.util=options.util,dojo.connect(this.stencils,"register",this,function(item){var c1,c2,c3,c4,c5,self=this,conMouse=function(){c1=item.container.connect("onmousedown",function(evt){evt.superTarget=item,self.mouse.down(evt)})};conMouse(),c2=dojo.connect(item,"setTransform",this,function(){}),c3=dojo.connect(item,"onBeforeRender",function(){}),c4=dojo.connect(item,"onRender",this,function(){}),c5=dojo.connect(item,"destroy",this,function(){dojo.forEach([c1,c2,c3,c4,c5],dojo.disconnect,dojo)})}),dojo.connect(this.anchors,"onAddAnchor",this,function(anchor){var c1=anchor.shape.connect("onmousedown",this.mouse,function(evt){evt.superTarget=anchor,this.down(evt)}),c2=dojo.connect(anchor,"disconnectMouse",this,function(){dojo.disconnect(c1),dojo.disconnect(c2)})}),this.mouse._down=function(evt){var dim=this._getXY(evt),x=dim.x-this.origin.x,y=dim.y-this.origin.y;x*=this.zoom,y*=this.zoom,this.origin.startx=x,this.origin.starty=y,this._lastx=x,this._lasty=y,this.drawingType=this.util.attr(evt,"drawingType")||"";var id=this._getId(evt),obj={x:x,y:y,id:id};0,this.onDown(obj),this._clickTime=(new Date).getTime();if(this._lastClickTime&&this._clickTime-this._lastClickTime<this.doublClickSpeed){var dnm=this.eventName("doubleClick");0,this._broadcastEvent(dnm,obj)}this._lastClickTime=this._clickTime},this.mouse.down=function(evt){clearTimeout(this.__downInv);if(this.util.attr(evt,"drawingType")=="surface"){this.__downInv=setTimeout(dojo.hitch(this,function(){this._down(evt)}),500);return}this._down(evt)},this.mouse._getXY=function(evt){if(evt.pageX)return{x:evt.pageX,y:evt.pageY,cancelBubble:!0};0;for(var nm in evt);return 0,evt.x!==undefined?{x:evt.x+this.origin.x,y:evt.y+this.origin.y}:{x:evt.pageX,y:evt.pageY}},this.mouse._getId=function(evt){return this.util.attr(evt,"id")},this.util.attr=function(elem,prop,value,squelchErrors){if(!elem)return!1;try{var t;elem.superTarget?t=elem.superTarget:elem.superClass?t=elem.superClass:elem.target?t=elem.target:t=elem;if(value!==undefined)return elem[prop]=value,value;if(t.tagName){if(prop=="drawingType"&&t.tagName.toLowerCase()=="object")return"surface";var r=dojo.attr(t,prop)}var r=t[prop];return r}catch(e){return!!squelchErrors,!1}}},{})})