//>>built
define("dojox/testing/DocTest",["dojo/string"],function(){return dojo.declare("dojox.testing.DocTest",null,{errors:[],getTests:function(moduleName){var path=dojo.moduleUrl(moduleName).path,file=path.substring(0,path.length-1)+".js",xhr=dojo.xhrGet({url:file,handleAs:"text"}),data=dojo._getText(file);return this._getTestsFromString(data,!0)},getTestsFromString:function(data){return this._getTestsFromString(data,!1)},_getTestsFromString:function(data,insideComments){var trim=dojo.hitch(dojo.string,"trim"),lines=data.split("\n"),len=lines.length,tests=[],test={commands:[],expectedResult:[],line:null};for(var i=0;i<len+1;i++){var l=trim(lines[i]||"");insideComments&&l.match(/^\/\/\s+>>>\s.*/)||l.match(/^\s*>>>\s.*/)?(test.line||(test.line=i+1),test.expectedResult.length>0&&(tests.push({commands:test.commands,expectedResult:test.expectedResult.join("\n"),line:test.line}),test={commands:[],expectedResult:[],line:i+1}),l=insideComments?trim(l).substring(2,l.length):l,l=trim(l).substring(3,l.length),test.commands.push(trim(l))):(!insideComments||l.match(/^\/\/\s+.*/))&&test.commands.length&&test.expectedResult.length==0?(l=insideComments?trim(l).substring(3,l.length):l,test.expectedResult.push(trim(l))):test.commands.length>0&&test.expectedResult.length&&((!insideComments||l.match(/^\/\/\s*$/))&&tests.push({commands:test.commands,expectedResult:test.expectedResult.join("\n"),line:test.line}),insideComments&&!l.match(/^\/\//)&&tests.push({commands:test.commands,expectedResult:test.expectedResult.join("\n"),line:test.line}),test={commands:[],expectedResult:[],line:0})}return tests},run:function(moduleName){this.errors=[];var tests=this.getTests(moduleName);tests&&this._run(tests)},_run:function(tests){var len=tests.length;this.tests=len;var oks=0;for(var i=0;i<len;i++){var t=tests[i],res=this.runTest(t.commands,t.expectedResult),msg="Test "+(i+1)+": ",viewCommands=t.commands.join(" ");viewCommands=viewCommands.length>50?viewCommands.substr(0,50)+"...":viewCommands,res.success?(0,oks+=1):(this.errors.push({commands:t.commands,actual:res.actualResult,expected:t.expectedResult}),0)}0},runTest:function(commands,expected){var ret={success:!1,actualResult:null},cmds=commands.join("\n");ret.actualResult=eval(cmds);if(String(ret.actualResult)==expected||dojo.toJson(ret.actualResult)==expected||expected.charAt(0)=='"'&&expected.charAt(expected.length-1)=='"'&&String(ret.actualResult)==expected.substring(1,expected.length-1))ret.success=!0;return ret}}),dojox.testing.DocTest})