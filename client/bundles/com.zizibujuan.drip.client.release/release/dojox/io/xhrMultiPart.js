//>>built
define("dojox/io/xhrMultiPart",["dojo/_base/kernel","dojo/_base/array","dojo/_base/xhr","dojo/query","dojox/uuid/generateRandomUuid"],function(dojo,array,xhr,query,generateRandomUuid){function _createPart(args,boundary){if(!args.name&&!args.content)throw new Error("Each part of a multi-part request requires 'name' and 'content'.");var tmp=[];tmp.push("--"+boundary,'Content-Disposition: form-data; name="'+args.name+'"'+(args.filename?'; filename="'+args.filename+'"':""));if(args.contentType){var ct="Content-Type: "+args.contentType;args.charset&&(ct+="; Charset="+args.charset),tmp.push(ct)}return args.contentTransferEncoding&&tmp.push("Content-Transfer-Encoding: "+args.contentTransferEncoding),tmp.push("",args.content),tmp}function _partsFromNode(node,boundary){var o=dojo.formToObject(node),parts=[];for(var p in o)dojo.isArray(o[p])?dojo.forEach(o[p],function(item){parts=parts.concat(_createPart({name:p,content:item},boundary))}):parts=parts.concat(_createPart({name:p,content:o[p]},boundary));return parts}return dojo.getObject("io.xhrMultiPart",!0,dojox),dojox.io.xhrMultiPart=function(args){if(!args.file&&!args.content&&!args.form)throw new Error("content, file or form must be provided to dojox.io.xhrMultiPart's arguments");var boundary=generateRandomUuid(),tmp=[],out="";if(args.file||args.content){var v=args.file||args.content;dojo.forEach(dojo.isArray(v)?v:[v],function(item){tmp=tmp.concat(_createPart(item,boundary))})}else if(args.form){if(query("input[type=file]",args.form).length)throw new Error("dojox.io.xhrMultiPart cannot post files that are values of an INPUT TYPE=FILE.  Use dojo.io.iframe.send() instead.");tmp=_partsFromNode(args.form,boundary)}return tmp.length&&(tmp.push("--"+boundary+"--",""),out=tmp.join("\r\n")),0,dojo.rawXhrPost(dojo.mixin(args,{contentType:"multipart/form-data; boundary="+boundary,postData:out}))},dojox.io.xhrMultiPart})