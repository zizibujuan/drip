//>>built
define("dojox/io/OAuth",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/xhr","dojo/dom","dojox/encoding/digests/SHA1"],function(dojo,lang,array,xhr,dom,SHA1){return dojo.getObject("io.OAuth",!0,dojox),dojox.io.OAuth=new function(){function parseUrl(url){var keys=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],parser=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,match=parser.exec(url),map={},i=keys.length;while(i--)map[keys[i]]=match[i]||"";var p=map.protocol.toLowerCase(),a=map.authority.toLowerCase(),b=p=="http"&&map.port==80||p=="https"&&map.port==443;b&&a.lastIndexOf(":")>-1&&(a=a.substring(0,a.lastIndexOf(":")));var path=map.path||"/";return map.url=p+"://"+a+path,map}function nonce(length){var s="",tl=tab.length;for(var i=0;i<length;i++)s+=tab.charAt(Math.floor(Math.random()*tl));return s}function timestamp(){return Math.floor((new Date).valueOf()/1e3)-2}function signature(data,key,type){if(type&&type!="PLAINTEXT"&&type!="HMAC-SHA1")throw new Error("dojox.io.OAuth: the only supported signature encodings are PLAINTEXT and HMAC-SHA1.");return type=="PLAINTEXT"?key:SHA1._hmac(data,key)}function key(args){return encode(args.consumer.secret)+"&"+(args.token&&args.token.secret?encode(args.token.secret):"")}function addOAuth(args,oaa){var o={oauth_consumer_key:oaa.consumer.key,oauth_nonce:nonce(16),oauth_signature_method:oaa.sig_method||"HMAC-SHA1",oauth_timestamp:timestamp(),oauth_version:"1.0"};oaa.token&&(o.oauth_token=oaa.token.key),args.content=dojo.mixin(args.content||{},o)}function convertArgs(args){var miArgs=[{}],formObject;if(args.form){args.content||(args.content={});var form=dojo.byId(args.form),actnNode=form.getAttributeNode("action");args.url=args.url||(actnNode?actnNode.value:null),formObject=dojo.formToObject(form),delete args.form}formObject&&miArgs.push(formObject),args.content&&miArgs.push(args.content);var map=parseUrl(args.url);if(map.query){var tmp=dojo.queryToObject(map.query);for(var p in tmp)tmp[p]=encodeURIComponent(tmp[p]);miArgs.push(tmp)}args._url=map.url;var a=[];for(var i=0,l=miArgs.length;i<l;i++){var item=miArgs[i];for(var p in item)if(dojo.isArray(item[p]))for(var j=0,jl=item.length;j<jl;j++)a.push([p,item[j]]);else a.push([p,item[p]])}return args._parameters=a,args}function baseString(method,args,oaa){addOAuth(args,oaa),convertArgs(args);var a=args._parameters;a.sort(function(a,b){return a[0]>b[0]?1:a[0]<b[0]?-1:a[1]>b[1]?1:a[1]<b[1]?-1:0});var s=dojo.map(a,function(item){return encode(item[0])+"="+encode((""+item[1]).length?item[1]:"")}).join("&"),baseString=method.toUpperCase()+"&"+encode(args._url)+"&"+encode(s);return baseString}function sign(method,args,oaa){var k=key(oaa),message=baseString(method,args,oaa),s=signature(message,k,oaa.sig_method||"HMAC-SHA1");return args.content.oauth_signature=s,args}var encode=this.encode=function(s){return(""+s).length?encodeURIComponent(s).replace(/\!/g,"%21").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29"):""},decode=this.decode=function(str){var a=[],list=str.split("&");for(var i=0,l=list.length;i<l;i++){var item=list[i];if(list[i]=="")continue;if(list[i].indexOf("=")>-1){var tmp=list[i].split("=");a.push([decodeURIComponent(tmp[0]),decodeURIComponent(tmp[1])])}else a.push([decodeURIComponent(list[i]),null])}return a},tab="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";this.sign=function(method,args,oaa){return sign(method,args,oaa)},this.xhr=function(method,args,oaa,hasBody){return sign(method,args,oaa),xhr(method,args,hasBody)},this.xhrGet=function(args,oaa){return this.xhr("GET",args,oaa)},this.xhrPost=this.xhrRawPost=function(args,oaa){return this.xhr("POST",args,oaa,!0)},this.xhrPut=this.xhrRawPut=function(args,oaa){return this.xhr("PUT",args,oaa,!0)},this.xhrDelete=function(args,oaa){return this.xhr("DELETE",args,oaa)}},dojox.io.OAuth})