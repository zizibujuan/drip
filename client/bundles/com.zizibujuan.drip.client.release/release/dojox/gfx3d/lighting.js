//>>built
define("dojox/gfx3d/lighting",["dojo/_base/lang","dojo/_base/Color","dojo/_base/declare","dojox/gfx/_base","./_base"],function(lang,Color,declare,gfx,gfx3d){var lite=gfx3d.lighting={black:function(){return{r:0,g:0,b:0,a:1}},white:function(){return{r:1,g:1,b:1,a:1}},toStdColor:function(c){return c=gfx.normalizeColor(c),{r:c.r/255,g:c.g/255,b:c.b/255,a:c.a}},fromStdColor:function(c){return new Color([Math.round(255*c.r),Math.round(255*c.g),Math.round(255*c.b),c.a])},scaleColor:function(s,c){return{r:s*c.r,g:s*c.g,b:s*c.b,a:s*c.a}},addColor:function(a,b){return{r:a.r+b.r,g:a.g+b.g,b:a.b+b.b,a:a.a+b.a}},multiplyColor:function(a,b){return{r:a.r*b.r,g:a.g*b.g,b:a.b*b.b,a:a.a*b.a}},saturateColor:function(c){return{r:c.r<0?0:c.r>1?1:c.r,g:c.g<0?0:c.g>1?1:c.g,b:c.b<0?0:c.b>1?1:c.b,a:c.a<0?0:c.a>1?1:c.a}},mixColor:function(c1,c2,s){return lite.addColor(lite.scaleColor(s,c1),lite.scaleColor(1-s,c2))},diff2Color:function(c1,c2){var r=c1.r-c2.r,g=c1.g-c2.g,b=c1.b-c2.b,a=c1.a-c2.a;return r*r+g*g+b*b+a*a},length2Color:function(c){return c.r*c.r+c.g*c.g+c.b*c.b+c.a*c.a},dot:function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},scale:function(s,v){return{x:s*v.x,y:s*v.y,z:s*v.z}},add:function(a,b){return{x:a.x+b.x,y:a.y+b.y,z:a.z+b.z}},saturate:function(v){return Math.min(Math.max(v,0),1)},length:function(v){return Math.sqrt(gfx3d.lighting.dot(v,v))},normalize:function(v){return lite.scale(1/lite.length(v),v)},faceforward:function(n,i){var p=gfx3d.lighting,s=p.dot(i,n)<0?1:-1;return p.scale(s,n)},reflect:function(i,n){var p=gfx3d.lighting;return p.add(i,p.scale(-2*p.dot(i,n),n))},diffuse:function(normal,lights){var c=lite.black();for(var i=0;i<lights.length;++i){var l=lights[i],d=lite.dot(lite.normalize(l.direction),normal);c=lite.addColor(c,lite.scaleColor(d,l.color))}return lite.saturateColor(c)},specular:function(normal,v,roughness,lights){var c=lite.black();for(var i=0;i<lights.length;++i){var l=lights[i],h=lite.normalize(lite.add(lite.normalize(l.direction),v)),s=Math.pow(Math.max(0,lite.dot(normal,h)),1/roughness);c=lite.addColor(c,lite.scaleColor(s,l.color))}return lite.saturateColor(c)},phong:function(normal,v,size,lights){normal=lite.normalize(normal);var c=lite.black();for(var i=0;i<lights.length;++i){var l=lights[i],r=lite.reflect(lite.scale(-1,lite.normalize(v)),normal),s=Math.pow(Math.max(0,lite.dot(r,lite.normalize(l.direction))),size);c=lite.addColor(c,lite.scaleColor(s,l.color))}return lite.saturateColor(c)}};return declare("dojox.gfx3d.lighting.Model",null,{constructor:function(incident,lights,ambient,specular){this.incident=lite.normalize(incident),this.lights=[];for(var i=0;i<lights.length;++i){var l=lights[i];this.lights.push({direction:lite.normalize(l.direction),color:lite.toStdColor(l.color)})}this.ambient=lite.toStdColor(ambient.color?ambient.color:"white"),this.ambient=lite.scaleColor(ambient.intensity,this.ambient),this.ambient=lite.scaleColor(this.ambient.a,this.ambient),this.ambient.a=1,this.specular=lite.toStdColor(specular?specular:"white"),this.specular=lite.scaleColor(this.specular.a,this.specular),this.specular.a=1,this.npr_cool={r:0,g:0,b:.4,a:1},this.npr_warm={r:.4,g:.4,b:.2,a:1},this.npr_alpha=.2,this.npr_beta=.6,this.npr_scale=.6},constant:function(normal,finish,pigment){pigment=lite.toStdColor(pigment);var alpha=pigment.a,color=lite.scaleColor(alpha,pigment);return color.a=alpha,lite.fromStdColor(lite.saturateColor(color))},matte:function(normal,finish,pigment){typeof finish=="string"&&(finish=lite.finish[finish]),pigment=lite.toStdColor(pigment),normal=lite.faceforward(lite.normalize(normal),this.incident);var ambient=lite.scaleColor(finish.Ka,this.ambient),shadow=lite.saturate(-4*lite.dot(normal,this.incident)),diffuse=lite.scaleColor(shadow*finish.Kd,lite.diffuse(normal,this.lights)),color=lite.scaleColor(pigment.a,lite.multiplyColor(pigment,lite.addColor(ambient,diffuse)));return color.a=pigment.a,lite.fromStdColor(lite.saturateColor(color))},metal:function(normal,finish,pigment){typeof finish=="string"&&(finish=lite.finish[finish]),pigment=lite.toStdColor(pigment),normal=lite.faceforward(lite.normalize(normal),this.incident);var v=lite.scale(-1,this.incident),specular,color,ambient=lite.scaleColor(finish.Ka,this.ambient),shadow=lite.saturate(-4*lite.dot(normal,this.incident));return"phong"in finish?specular=lite.scaleColor(shadow*finish.Ks*finish.phong,lite.phong(normal,v,finish.phong_size,this.lights)):specular=lite.scaleColor(shadow*finish.Ks,lite.specular(normal,v,finish.roughness,this.lights)),color=lite.scaleColor(pigment.a,lite.addColor(lite.multiplyColor(pigment,ambient),lite.multiplyColor(this.specular,specular))),color.a=pigment.a,lite.fromStdColor(lite.saturateColor(color))},plastic:function(normal,finish,pigment){typeof finish=="string"&&(finish=lite.finish[finish]),pigment=lite.toStdColor(pigment),normal=lite.faceforward(lite.normalize(normal),this.incident);var v=lite.scale(-1,this.incident),specular,color,ambient=lite.scaleColor(finish.Ka,this.ambient),shadow=lite.saturate(-4*lite.dot(normal,this.incident)),diffuse=lite.scaleColor(shadow*finish.Kd,lite.diffuse(normal,this.lights));return"phong"in finish?specular=lite.scaleColor(shadow*finish.Ks*finish.phong,lite.phong(normal,v,finish.phong_size,this.lights)):specular=lite.scaleColor(shadow*finish.Ks,lite.specular(normal,v,finish.roughness,this.lights)),color=lite.scaleColor(pigment.a,lite.addColor(lite.multiplyColor(pigment,lite.addColor(ambient,diffuse)),lite.multiplyColor(this.specular,specular))),color.a=pigment.a,lite.fromStdColor(lite.saturateColor(color))},npr:function(normal,finish,pigment){typeof finish=="string"&&(finish=lite.finish[finish]),pigment=lite.toStdColor(pigment),normal=lite.faceforward(lite.normalize(normal),this.incident);var ambient=lite.scaleColor(finish.Ka,this.ambient),shadow=lite.saturate(-4*lite.dot(normal,this.incident)),diffuse=lite.scaleColor(shadow*finish.Kd,lite.diffuse(normal,this.lights)),color=lite.scaleColor(pigment.a,lite.multiplyColor(pigment,lite.addColor(ambient,diffuse))),cool=lite.addColor(this.npr_cool,lite.scaleColor(this.npr_alpha,color)),warm=lite.addColor(this.npr_warm,lite.scaleColor(this.npr_beta,color)),d=(1+lite.dot(this.incident,normal))/2,color=lite.scaleColor(this.npr_scale,lite.addColor(color,lite.mixColor(cool,warm,d)));return color.a=pigment.a,lite.fromStdColor(lite.saturateColor(color))}}),gfx3d.lighting.finish={defaults:{Ka:.1,Kd:.6,Ks:0,roughness:.05},dull:{Ka:.1,Kd:.6,Ks:.5,roughness:.15},shiny:{Ka:.1,Kd:.6,Ks:1,roughness:.001},glossy:{Ka:.1,Kd:.6,Ks:1,roughness:1e-4},phong_dull:{Ka:.1,Kd:.6,Ks:.5,phong:.5,phong_size:1},phong_shiny:{Ka:.1,Kd:.6,Ks:1,phong:1,phong_size:200},phong_glossy:{Ka:.1,Kd:.6,Ks:1,phong:1,phong_size:300},luminous:{Ka:1,Kd:0,Ks:0,roughness:.05},metalA:{Ka:.35,Kd:.3,Ks:.8,roughness:.05},metalB:{Ka:.3,Kd:.4,Ks:.7,roughness:1/60},metalC:{Ka:.25,Kd:.5,Ks:.8,roughness:1/80},metalD:{Ka:.15,Kd:.6,Ks:.8,roughness:.01},metalE:{Ka:.1,Kd:.7,Ks:.8,roughness:1/120}},lite})