//>>built
define("dojox/data/SnapLogicStore",["dojo","dojox","dojo/io/script","dojo/data/util/sorter"],function(dojo,dojox){return dojo.declare("dojox.data.SnapLogicStore",null,{Parts:{DATA:"data",COUNT:"count"},url:"",constructor:function(args){args.url&&(this.url=args.url),this._parameters=args.parameters},_assertIsItem:function(item){if(!this.isItem(item))throw new Error("dojox.data.SnapLogicStore: a function was passed an item argument that was not an item")},_assertIsAttribute:function(attribute){if(typeof attribute!="string")throw new Error("dojox.data.SnapLogicStore: a function was passed an attribute argument that was not an attribute name string")},getFeatures:function(){return{"dojo.data.api.Read":!0}},getValue:function(item,attribute,defaultValue){this._assertIsItem(item),this._assertIsAttribute(attribute);var i=dojo.indexOf(item.attributes,attribute);return i!==-1?item.values[i]:defaultValue},getAttributes:function(item){return this._assertIsItem(item),item.attributes},hasAttribute:function(item,attribute){this._assertIsItem(item),this._assertIsAttribute(attribute);for(var i=0;i<item.attributes.length;++i)if(attribute==item.attributes[i])return!0;return!1},isItemLoaded:function(item){return this.isItem(item)},loadItem:function(keywordArgs){},getLabel:function(item){return undefined},getLabelAttributes:function(item){return null},containsValue:function(item,attribute,value){return this.getValue(item,attribute)===value},getValues:function(item,attribute){this._assertIsItem(item),this._assertIsAttribute(attribute);var i=dojo.indexOf(item.attributes,attribute);return i!==-1?[item.values[i]]:[]},isItem:function(item){return item&&item._store===this?!0:!1},close:function(request){},_fetchHandler:function(request){var scope=request.scope||dojo.global;request.onBegin&&request.onBegin.call(scope,request._countResponse[0],request);if(request.onItem||request.onComplete){var response=request._dataResponse;if(!response.length){request.onError.call(scope,new Error("dojox.data.SnapLogicStore: invalid response of length 0"),request);return}if(request.query!="record count"){var field_names=response.shift(),items=[];for(var i=0;i<response.length;++i){if(request._aborted)break;items.push({attributes:field_names,values:response[i],_store:this})}request.sort&&!request._aborted&&items.sort(dojo.data.util.sorter.createSortFunction(request.sort,self))}else items=[{attributes:["count"],values:response,_store:this}];if(request.onItem){for(var i=0;i<items.length;++i){if(request._aborted)break;request.onItem.call(scope,items[i],request)}items=null}request.onComplete&&!request._aborted&&request.onComplete.call(scope,items,request)}},_partHandler:function(request,part,response){if(response instanceof Error)part==this.Parts.DATA?request._dataHandle=null:request._countHandle=null,request._aborted=!0,request.onError&&request.onError.call(request.scope,response,request);else{if(request._aborted)return;part==this.Parts.DATA?request._dataResponse=response:request._countResponse=response,(!request._dataHandle||request._dataResponse!==null)&&(!request._countHandle||request._countResponse!==null)&&this._fetchHandler(request)}},fetch:function(request){request._countResponse=null,request._dataResponse=null,request._aborted=!1,request.abort=function(){request._aborted||(request._aborted=!0,request._dataHandle&&request._dataHandle.cancel&&request._dataHandle.cancel(),request._countHandle&&request._countHandle.cancel&&request._countHandle.cancel())};if(request.onItem||request.onComplete){var content=this._parameters||{};if(request.start){if(request.start<0)throw new Error("dojox.data.SnapLogicStore: request start value must be 0 or greater");content["sn.start"]=request.start+1}if(request.count){if(request.count<0)throw new Error("dojox.data.SnapLogicStore: request count value 0 or greater");content["sn.limit"]=request.count}content["sn.content_type"]="application/javascript";var store=this,handler=function(response,ioArgs){response instanceof Error&&store._fetchHandler(response,request)},getArgs={url:this.url,content:content,timeout:6e4,callbackParamName:"sn.stream_header",handle:dojo.hitch(this,"_partHandler",request,this.Parts.DATA)};request._dataHandle=dojo.io.script.get(getArgs)}if(request.onBegin){var content={};content["sn.count"]="records",content["sn.content_type"]="application/javascript";var getArgs={url:this.url,content:content,timeout:6e4,callbackParamName:"sn.stream_header",handle:dojo.hitch(this,"_partHandler",request,this.Parts.COUNT)};request._countHandle=dojo.io.script.get(getArgs)}return request}}),dojox.data.SnapLogicStore})