//>>built
define("dojox/data/util/JsonQuery",["dojo","dojox"],function(dojo,dojox){return dojo.declare("dojox.data.util.JsonQuery",null,{useFullIdInQueries:!1,_toJsonQuery:function(args,jsonQueryPagination){function buildQuery(path,query){var isDataItem=query.__id;if(isDataItem){var newQuery={};newQuery[self.idAttribute]=self.useFullIdInQueries?query.__id:query[self.idAttribute],query=newQuery}for(var i in query){var value=query[i],newPath=path+(/^[a-zA-Z_][\w_]*$/.test(i)?"."+i:"["+dojo._escapeString(i)+"]");value&&typeof value=="object"?buildQuery(newPath,value):value!="*"&&(jsonQuery+=(first?"":"&")+newPath+(!isDataItem&&typeof value=="string"&&args.queryOptions&&args.queryOptions.ignoreCase?"~":"=")+(self.simplifiedQuery?encodeURIComponent(value):dojo.toJson(value)),first=!1)}}var first=!0,self=this;if(args.query&&typeof args.query=="object"){var jsonQuery="[?(";buildQuery("@",args.query),first?jsonQuery="":jsonQuery+=")]",args.queryStr=jsonQuery.replace(/\\"|"/g,function(t){return t=='"'?"'":t})}else if(!args.query||args.query=="*")args.query="";var sort=args.sort;if(sort){args.queryStr=args.queryStr||(typeof args.query=="string"?args.query:""),first=!0;for(i=0;i<sort.length;i++)args.queryStr+=(first?"[":",")+(sort[i].descending?"\\":"/")+"@["+dojo._escapeString(sort[i].attribute)+"]",first=!1;args.queryStr+="]"}return jsonQueryPagination&&(args.start||args.count)&&(args.queryStr=(args.queryStr||(typeof args.query=="string"?args.query:""))+"["+(args.start||"")+":"+(args.count?(args.start||0)+args.count:"")+"]"),typeof args.queryStr=="string"?(args.queryStr=args.queryStr.replace(/\\"|"/g,function(t){return t=='"'?"'":t}),args.queryStr):args.query},jsonQueryPagination:!0,fetch:function(args){return this._toJsonQuery(args,this.jsonQueryPagination),this.inherited(arguments)},isUpdateable:function(){return!0},matchesQuery:function(item,request){return request._jsonQuery=request._jsonQuery||dojox.json.query(this._toJsonQuery(request)),request._jsonQuery([item]).length},clientSideFetch:function(request,baseResults){return request._jsonQuery=request._jsonQuery||dojox.json.query(this._toJsonQuery(request)),this.clientSidePaging(request,request._jsonQuery(baseResults))},querySuperSet:function(argsSuper,argsSub){return argsSuper.query?this.inherited(arguments):argsSub.query}})})