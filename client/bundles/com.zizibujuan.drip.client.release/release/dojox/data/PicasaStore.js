//>>built
define("dojox/data/PicasaStore",["dojo/_base/lang","dojo/_base/declare","dojo/_base/connect","dojo/io/script","dojo/data/util/simpleFetch","dojo/date/stamp"],function(lang,declare,connect,scriptIO,simpleFetch,dateStamp){var PicasaStore=declare("dojox.data.PicasaStore",null,{constructor:function(args){args&&args.label&&(this.label=args.label),args&&"urlPreventCache"in args&&(this.urlPreventCache=args.urlPreventCache?!0:!1),args&&"maxResults"in args&&(this.maxResults=parseInt(args.maxResults),this.maxResults||(this.maxResults=20))},_picasaUrl:"http://picasaweb.google.com/data/feed/api/all",_storeRef:"_S",label:"title",urlPreventCache:!1,maxResults:20,_assertIsItem:function(item){if(!this.isItem(item))throw new Error("dojox.data.PicasaStore: a function was passed an item argument that was not an item")},_assertIsAttribute:function(attribute){if(typeof attribute!="string")throw new Error("dojox.data.PicasaStore: a function was passed an attribute argument that was not an attribute name string")},getFeatures:function(){return{"dojo.data.api.Read":!0}},getValue:function(item,attribute,defaultValue){var values=this.getValues(item,attribute);return values&&values.length>0?values[0]:defaultValue},getAttributes:function(item){return["id","published","updated","category","title$type","title","summary$type","summary","rights$type","rights","link","author","gphoto$id","gphoto$name","location","imageUrlSmall","imageUrlMedium","imageUrl","datePublished","dateTaken","description"]},hasAttribute:function(item,attribute){return this.getValue(item,attribute)?!0:!1},isItemLoaded:function(item){return this.isItem(item)},loadItem:function(keywordArgs){},getLabel:function(item){return this.getValue(item,this.label)},getLabelAttributes:function(item){return[this.label]},containsValue:function(item,attribute,value){var values=this.getValues(item,attribute);for(var i=0;i<values.length;i++)if(values[i]===value)return!0;return!1},getValues:function(item,attribute){return this._assertIsItem(item),this._assertIsAttribute(attribute),attribute==="title"?[this._unescapeHtml(item.title)]:attribute==="author"?[this._unescapeHtml(item.author[0].name)]:attribute==="datePublished"?[dateAtamp.fromISOString(item.published)]:attribute==="dateTaken"?[dateStamp.fromISOString(item.published)]:attribute==="updated"?[dateStamp.fromISOString(item.updated)]:attribute==="imageUrlSmall"?[item.media.thumbnail[1].url]:attribute==="imageUrl"?[item.content$src]:attribute==="imageUrlMedium"?[item.media.thumbnail[2].url]:attribute==="link"?[item.link[1]]:attribute==="tags"?item.tags.split(" "):attribute==="description"?[this._unescapeHtml(item.summary)]:[]},isItem:function(item){return item&&item[this._storeRef]===this?!0:!1},close:function(request){},_fetchItems:function(request,fetchHandler,errorHandler){request.query||(request.query={});var content={alt:"jsonm",pp:"1",psc:"G"};content["start-index"]="1",request.query.start&&(content["start-index"]=request.query.start),request.query.tags&&(content.q=request.query.tags),request.query.userid&&(content.uname=request.query.userid),request.query.userids&&(content.ids=request.query.userids),request.query.lang&&(content.hl=request.query.lang),content["max-results"]=this.maxResults;var self=this,handle=null,myHandler=function(data){handle!==null&&connect.disconnect(handle),fetchHandler(self._processPicasaData(data),request)},getArgs={url:this._picasaUrl,preventCache:this.urlPreventCache,content:content,callbackParamName:"callback",handle:myHandler},deferred=scriptIO.get(getArgs);deferred.addErrback(function(error){connect.disconnect(handle),errorHandler(error,request)})},_processPicasaData:function(data){var items=[];if(data.feed){items=data.feed.entry;for(var i=0;i<items.length;i++){var item=items[i];item[this._storeRef]=this}}return items},_unescapeHtml:function(str){return str&&(str=str.replace(/&amp;/gm,"&").replace(/&lt;/gm,"<").replace(/&gt;/gm,">").replace(/&quot;/gm,'"'),str=str.replace(/&#39;/gm,"'")),str}});return lang.extend(PicasaStore,simpleFetch),PicasaStore})