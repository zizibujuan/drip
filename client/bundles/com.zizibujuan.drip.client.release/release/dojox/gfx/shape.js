//>>built
define("dojox/gfx/shape",["./_base","dojo/_base/lang","dojo/_base/declare","dojo/_base/kernel","dojo/_base/sniff","dojo/_base/connect","dojo/_base/array","dojo/dom-construct","dojo/_base/Color","./matrix"],function(g,lang,declare,kernel,has,events,arr,domConstruct,Color,matrixLib){var shape=g.shape={},_ids={},registry={};return shape.register=function(s){var t=s.declaredClass.split(".").pop(),i=t in _ids?++_ids[t]:_ids[t]=0,uid=t+i;return registry[uid]=s,uid},shape.byId=function(id){return registry[id]},shape.dispose=function(s,recurse){if(recurse&&s.children)for(var i=0;i<s.children.length;++i)shape.dispose(s.children[i],!0);delete registry[s.getUID()]},shape.Shape=declare("dojox.gfx.shape.Shape",null,{constructor:function(){this.rawNode=null,this.shape=null,this.matrix=null,this.fillStyle=null,this.strokeStyle=null,this.bbox=null,this.parent=null,this.parentMatrix=null;var uid=shape.register(this);this.getUID=function(){return uid}},destroy:function(){shape.dispose(this)},getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var b=this.getBoundingBox();if(!b)return null;var m=this._getRealMatrix(),gm=matrixLib;return[gm.multiplyPoint(m,b.x,b.y),gm.multiplyPoint(m,b.x+b.width,b.y),gm.multiplyPoint(m,b.x+b.width,b.y+b.height),gm.multiplyPoint(m,b.x,b.y+b.height)]},getEventSource:function(){return this.rawNode},setClip:function(clip){this.clip=clip},getClip:function(){return this.clip},setShape:function(shape){return this.shape=g.makeParameters(this.shape,shape),this.bbox=null,this},setFill:function(fill){if(!fill)return this.fillStyle=null,this;var f=null;if(typeof fill=="object"&&"type"in fill)switch(fill.type){case"linear":f=g.makeParameters(g.defaultLinearGradient,fill);break;case"radial":f=g.makeParameters(g.defaultRadialGradient,fill);break;case"pattern":f=g.makeParameters(g.defaultPattern,fill)}else f=g.normalizeColor(fill);return this.fillStyle=f,this},setStroke:function(stroke){if(!stroke)return this.strokeStyle=null,this;if(typeof stroke=="string"||lang.isArray(stroke)||stroke instanceof Color)stroke={color:stroke};var s=this.strokeStyle=g.makeParameters(g.defaultStroke,stroke);return s.color=g.normalizeColor(s.color),this},setTransform:function(matrix){return this.matrix=matrixLib.clone(matrix?matrixLib.normalize(matrix):matrixLib.identity),this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var p=this.getParent();return p&&(p._moveChildToFront(this),this._moveToFront()),this},moveToBack:function(){var p=this.getParent();return p&&(p._moveChildToBack(this),this._moveToBack()),this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(matrix){return matrix?this.setTransform([this.matrix,matrix]):this},applyLeftTransform:function(matrix){return matrix?this.setTransform([matrix,this.matrix]):this},applyTransform:function(matrix){return matrix?this.setTransform([this.matrix,matrix]):this},removeShape:function(silently){return this.parent&&this.parent.remove(this,silently),this},_setParent:function(parent,matrix){return this.parent=parent,this._updateParentMatrix(matrix)},_updateParentMatrix:function(matrix){return this.parentMatrix=matrix?matrixLib.clone(matrix):null,this._applyTransform()},_getRealMatrix:function(){var m=this.matrix,p=this.parent;while(p)p.matrix&&(m=matrixLib.multiply(p.matrix,m)),p=p.parent;return m}}),shape._eventsProcessing={connect:function(name,object,method){return events.connect(this.getEventSource(),name,shape.fixCallback(this,g.fixTarget,object,method))},disconnect:function(token){events.disconnect(token)}},shape.fixCallback=function(gfxElement,fixFunction,scope,method){method||(method=scope,scope=null);if(lang.isString(method)){scope=scope||kernel.global;if(!scope[method])throw['dojox.gfx.shape.fixCallback: scope["',method,'"] is null (scope="',scope,'")'].join("");return function(e){return fixFunction(e,gfxElement)?scope[method].apply(scope,arguments||[]):undefined}}return scope?function(e){return fixFunction(e,gfxElement)?method.apply(scope,arguments||[]):undefined}:function(e){return fixFunction(e,gfxElement)?method.apply(scope,arguments):undefined}},lang.extend(shape.Shape,shape._eventsProcessing),shape.Container={_init:function(){this.children=[]},openBatch:function(){},closeBatch:function(){},add:function(shape){var oldParent=shape.getParent();return oldParent&&oldParent.remove(shape,!0),this.children.push(shape),shape._setParent(this,this._getRealMatrix())},remove:function(shape,silently){for(var i=0;i<this.children.length;++i)if(this.children[i]==shape){silently||(shape.parent=null,shape.parentMatrix=null),this.children.splice(i,1);break}return this},clear:function(destroy){var shape;for(var i=0;i<this.children.length;++i)shape=this.children[i],shape.parent=null,shape.parentMatrix=null,destroy&&shape.destroy();return this.children=[],this},getBoundingBox:function(){if(this.children){var result=null;return arr.forEach(this.children,function(shape){var bb=shape.getBoundingBox();if(bb){var ct=shape.getTransform();ct&&(bb=matrixLib.multiplyRectangle(ct,bb)),result?(result.x=Math.min(result.x,bb.x),result.y=Math.min(result.y,bb.y),result.endX=Math.max(result.endX,bb.x+bb.width),result.endY=Math.max(result.endY,bb.y+bb.height)):result={x:bb.x,y:bb.y,endX:bb.x+bb.width,endY:bb.y+bb.height}}}),result&&(result.width=result.endX-result.x,result.height=result.endY-result.y),result}return null},_moveChildToFront:function(shape){for(var i=0;i<this.children.length;++i)if(this.children[i]==shape){this.children.splice(i,1),this.children.push(shape);break}return this},_moveChildToBack:function(shape){for(var i=0;i<this.children.length;++i)if(this.children[i]==shape){this.children.splice(i,1),this.children.unshift(shape);break}return this}},shape.Surface=declare("dojox.gfx.shape.Surface",null,{constructor:function(){this.rawNode=null,this._parent=null,this._nodes=[],this._events=[]},destroy:function(){arr.forEach(this._nodes,domConstruct.destroy),this._nodes=[],arr.forEach(this._events,events.disconnect),this._events=[],this.rawNode=null;if(has("ie"))while(this._parent.lastChild)domConstruct.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(surface){},whenLoaded:function(context,method){var f=lang.hitch(context,method);if(this.isLoaded)f(this);else var h=events.connect(this,"onLoad",function(surface){events.disconnect(h),f(surface)})}}),lang.extend(shape.Surface,shape._eventsProcessing),shape.Rect=declare("dojox.gfx.shape.Rect",shape.Shape,{constructor:function(rawNode){this.shape=g.getDefault("Rect"),this.rawNode=rawNode},getBoundingBox:function(){return this.shape}}),shape.Ellipse=declare("dojox.gfx.shape.Ellipse",shape.Shape,{constructor:function(rawNode){this.shape=g.getDefault("Ellipse"),this.rawNode=rawNode},getBoundingBox:function(){if(!this.bbox){var shape=this.shape;this.bbox={x:shape.cx-shape.rx,y:shape.cy-shape.ry,width:2*shape.rx,height:2*shape.ry}}return this.bbox}}),shape.Circle=declare("dojox.gfx.shape.Circle",shape.Shape,{constructor:function(rawNode){this.shape=g.getDefault("Circle"),this.rawNode=rawNode},getBoundingBox:function(){if(!this.bbox){var shape=this.shape;this.bbox={x:shape.cx-shape.r,y:shape.cy-shape.r,width:2*shape.r,height:2*shape.r}}return this.bbox}}),shape.Line=declare("dojox.gfx.shape.Line",shape.Shape,{constructor:function(rawNode){this.shape=g.getDefault("Line"),this.rawNode=rawNode},getBoundingBox:function(){if(!this.bbox){var shape=this.shape;this.bbox={x:Math.min(shape.x1,shape.x2),y:Math.min(shape.y1,shape.y2),width:Math.abs(shape.x2-shape.x1),height:Math.abs(shape.y2-shape.y1)}}return this.bbox}}),shape.Polyline=declare("dojox.gfx.shape.Polyline",shape.Shape,{constructor:function(rawNode){this.shape=g.getDefault("Polyline"),this.rawNode=rawNode},setShape:function(points,closed){return points&&points instanceof Array?(this.inherited(arguments,[{points:points}]),closed&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[points]),this},_normalizePoints:function(){var p=this.shape.points,l=p&&p.length;if(l&&typeof p[0]=="number"){var points=[];for(var i=0;i<l;i+=2)points.push({x:p[i],y:p[i+1]});this.shape.points=points}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){var p=this.shape.points,l=p.length,t=p[0],bbox={l:t.x,t:t.y,r:t.x,b:t.y};for(var i=1;i<l;++i)t=p[i],bbox.l>t.x&&(bbox.l=t.x),bbox.r<t.x&&(bbox.r=t.x),bbox.t>t.y&&(bbox.t=t.y),bbox.b<t.y&&(bbox.b=t.y);this.bbox={x:bbox.l,y:bbox.t,width:bbox.r-bbox.l,height:bbox.b-bbox.t}}return this.bbox}}),shape.Image=declare("dojox.gfx.shape.Image",shape.Shape,{constructor:function(rawNode){this.shape=g.getDefault("Image"),this.rawNode=rawNode},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}}),shape.Text=declare(shape.Shape,{constructor:function(rawNode){this.fontStyle=null,this.shape=g.getDefault("Text"),this.rawNode=rawNode},getFont:function(){return this.fontStyle},setFont:function(newFont){return this.fontStyle=typeof newFont=="string"?g.splitFontString(newFont):g.makeParameters(g.defaultFont,newFont),this._setFont(),this}}),shape.Creator={createShape:function(shape){switch(shape.type){case g.defaultPath.type:return this.createPath(shape);case g.defaultRect.type:return this.createRect(shape);case g.defaultCircle.type:return this.createCircle(shape);case g.defaultEllipse.type:return this.createEllipse(shape);case g.defaultLine.type:return this.createLine(shape);case g.defaultPolyline.type:return this.createPolyline(shape);case g.defaultImage.type:return this.createImage(shape);case g.defaultText.type:return this.createText(shape);case g.defaultTextPath.type:return this.createTextPath(shape)}return null},createGroup:function(){return this.createObject(g.Group)},createRect:function(rect){return this.createObject(g.Rect,rect)},createEllipse:function(ellipse){return this.createObject(g.Ellipse,ellipse)},createCircle:function(circle){return this.createObject(g.Circle,circle)},createLine:function(line){return this.createObject(g.Line,line)},createPolyline:function(points){return this.createObject(g.Polyline,points)},createImage:function(image){return this.createObject(g.Image,image)},createText:function(text){return this.createObject(g.Text,text)},createPath:function(path){return this.createObject(g.Path,path)},createTextPath:function(text){return this.createObject(g.TextPath,{}).setText(text)},createObject:function(shapeType,rawShape){return null}},shape})