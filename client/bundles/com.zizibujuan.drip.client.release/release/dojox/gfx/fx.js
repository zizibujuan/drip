//>>built
define("dojox/gfx/fx",["dojo/_base/lang","./_base","./matrix","dojo/_base/Color","dojo/_base/array","dojo/_base/fx","dojo/_base/connect"],function(lang,g,m,Color,arr,fx,Hub){function InterpolNumber(start,end){this.start=start,this.end=end}function InterpolUnit(start,end,units){this.start=start,this.end=end,this.units=units}function InterpolColor(start,end){this.start=start,this.end=end,this.temp=new Color}function InterpolValues(values){this.values=values,this.length=values.length}function InterpolObject(values,def){this.values=values,this.def=def?def:{}}function InterpolTransform(stack,original){this.stack=stack,this.original=original}function getColorInterpol(prop,obj,name,def){if(prop.values)return new InterpolValues(prop.values);var value,start,end;return prop.start?start=g.normalizeColor(prop.start):start=value=obj?name?obj[name]:obj:def,prop.end?end=g.normalizeColor(prop.end):(value||(value=obj?name?obj[name]:obj:def),end=value),new InterpolColor(start,end)}function getNumberInterpol(prop,obj,name,def){if(prop.values)return new InterpolValues(prop.values);var value,start,end;return prop.start?start=prop.start:start=value=obj?obj[name]:def,prop.end?end=prop.end:(typeof value!="number"&&(value=obj?obj[name]:def),end=value),new InterpolNumber(start,end)}var fxg=g.fx={};InterpolNumber.prototype.getValue=function(r){return(this.end-this.start)*r+this.start},InterpolUnit.prototype.getValue=function(r){return(this.end-this.start)*r+this.start+this.units},InterpolColor.prototype.getValue=function(r){return Color.blendColors(this.start,this.end,r,this.temp)},InterpolValues.prototype.getValue=function(r){return this.values[Math.min(Math.floor(r*this.length),this.length-1)]},InterpolObject.prototype.getValue=function(r){var ret=lang.clone(this.def);for(var i in this.values)ret[i]=this.values[i].getValue(r);return ret},InterpolTransform.prototype.getValue=function(r){var ret=[];return arr.forEach(this.stack,function(t){if(t instanceof m.Matrix2D){ret.push(t);return}if(t.name=="original"&&this.original){ret.push(this.original);return}if(t.name=="matrix"){if(t.start instanceof m.Matrix2D&&t.end instanceof m.Matrix2D){var transfMatrix=new m.Matrix2D;for(var p in t.start)transfMatrix[p]=(t.end[p]-t.start[p])*r+t.start[p];ret.push(transfMatrix)}return}if(!(t.name in m))return;var f=m[t.name];if(typeof f!="function"){ret.push(f);return}var val=arr.map(t.start,function(v,i){return(t.end[i]-v)*r+v}),matrix=f.apply(m,val);matrix instanceof m.Matrix2D&&ret.push(matrix)},this),ret};var transparent=new Color(0,0,0,0);return fxg.animateStroke=function(args){args.easing||(args.easing=fx._defaultEasing);var anim=new fx.Animation(args),shape=args.shape,stroke;return Hub.connect(anim,"beforeBegin",anim,function(){stroke=shape.getStroke();var prop=args.color,values={},value,start,end;prop&&(values.color=getColorInterpol(prop,stroke,"color",transparent)),prop=args.style,prop&&prop.values&&(values.style=new InterpolValues(prop.values)),prop=args.width,prop&&(values.width=getNumberInterpol(prop,stroke,"width",1)),prop=args.cap,prop&&prop.values&&(values.cap=new InterpolValues(prop.values)),prop=args.join,prop&&(prop.values?values.join=new InterpolValues(prop.values):(start=prop.start?prop.start:stroke&&stroke.join||0,end=prop.end?prop.end:stroke&&stroke.join||0,typeof start=="number"&&typeof end=="number"&&(values.join=new InterpolNumber(start,end)))),this.curve=new InterpolObject(values,stroke)}),Hub.connect(anim,"onAnimate",shape,"setStroke"),anim},fxg.animateFill=function(args){args.easing||(args.easing=fx._defaultEasing);var anim=new fx.Animation(args),shape=args.shape,fill;return Hub.connect(anim,"beforeBegin",anim,function(){fill=shape.getFill();var prop=args.color,values={};prop&&(this.curve=getColorInterpol(prop,fill,"",transparent))}),Hub.connect(anim,"onAnimate",shape,"setFill"),anim},fxg.animateFont=function(args){args.easing||(args.easing=fx._defaultEasing);var anim=new fx.Animation(args),shape=args.shape,font;return Hub.connect(anim,"beforeBegin",anim,function(){font=shape.getFont();var prop=args.style,values={},value,start,end;prop&&prop.values&&(values.style=new InterpolValues(prop.values)),prop=args.variant,prop&&prop.values&&(values.variant=new InterpolValues(prop.values)),prop=args.weight,prop&&prop.values&&(values.weight=new InterpolValues(prop.values)),prop=args.family,prop&&prop.values&&(values.family=new InterpolValues(prop.values)),prop=args.size,prop&&prop.units&&(start=parseFloat(prop.start?prop.start:shape.font&&shape.font.size||"0"),end=parseFloat(prop.end?prop.end:shape.font&&shape.font.size||"0"),values.size=new InterpolUnit(start,end,prop.units)),this.curve=new InterpolObject(values,font)}),Hub.connect(anim,"onAnimate",shape,"setFont"),anim},fxg.animateTransform=function(args){args.easing||(args.easing=fx._defaultEasing);var anim=new fx.Animation(args),shape=args.shape,original;return Hub.connect(anim,"beforeBegin",anim,function(){original=shape.getTransform(),this.curve=new InterpolTransform(args.transform,original)}),Hub.connect(anim,"onAnimate",shape,"setTransform"),anim},fxg})