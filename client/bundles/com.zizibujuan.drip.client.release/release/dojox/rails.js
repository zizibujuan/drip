//>>built
define("dojox/rails",["dojo","dijit","dojox","dojo/require!dojo/NodeList-traverse"],function(dojo,dijit,dojox){dojo.provide("dojox.rails"),dojo.require("dojo.NodeList-traverse"),dojox.rails.live=function(selector,evtName,fn){dojo.isIE&&evtName.match(/^(on)?submit$/i)?dojox.rails.live(selector,"click",function(evt){var target=evt.target,tag=target.tagName.toLowerCase();if((tag=="input"||tag=="button")&&dojo.attr(target,"type").toLowerCase()=="submit"){var form=dojo.query(target).closest("form");if(form.length)var h=dojo.connect(form[0],"submit",function(evt){dojo.disconnect(h),fn.call(evt.target,evt)})}}):dojo.connect(dojo.body(),evtName,function(evt){var nl=dojo.query(evt.target).closest(selector);nl.length&&fn.call(nl[0],evt)})},dojo.ready(function(d,dr,dg){return function(){var q=d.query,live=dr.live,csrfToken=q("meta[name=csrf-token]").attr("content"),csrfParam=q("meta[name=csrf-param]").attr("content"),createFormForLink=function(url,method){var form='<form style="display:none" method="post" action="'+url+'">'+'<input type="hidden" name="_method" value="'+method+'" />'+'<input type="hidden" name="'+csrfParam+'" value="'+csrfToken+'" />'+"</form>";return dojo.place(form,dojo.body())},disable=function(elements){d.forEach(elements,function(node){if(!d.attr(node,"disabled")){var attr=node.tagName.toLowerCase()=="input"?"value":"innerHTML",message=d.attr(node,"data-disable-with"),originalValue=d.attr(node,attr);d.attr(node,"disabled",!0),d.attr(node,"data-original-value",originalValue),d.attr(node,attr,message)}})},typeMap={text:"text",json:"application/json","json-comment-optional":"text","json-comment-filtered":"text",javascript:"application/javascript",xml:"text/xml"},handleRemote=function(evt){var el=evt.target,tag=el.tagName.toLowerCase(),content=tag.toLowerCase()=="form"?d.formToObject(el):{},type=d.attr(el,"data-type")||"javascript",method=(d.attr(el,"method")||d.attr(el,"data-method")||"get").toLowerCase(),url=d.attr(el,"action")||d.attr(el,"href");tag!="form"&&method!="get"&&(el=createFormForLink(url,method),method="POST"),evt.preventDefault(),d.publish("ajax:before",[el]);var deferred=d.xhr(method,{url:url,headers:{Accept:typeMap[type]},content:content,handleAs:type,load:function(response,ioArgs){d.publish("ajax:success",[el,response,ioArgs])},error:function(response,ioArgs){d.publish("ajax:failure",[el,response,ioArgs])},handle:function(response,ioArgs){d.publish("ajax:complete",[el,response,ioArgs])}});d.publish("ajax:after",[el])},handleEnable=function(el){q("*[data-disable-with][disabled]",el).forEach(function(node){var attr=node.tagName.toLowerCase()=="input"?"value":"innerHTML",value=d.attr(node,"data-original-value");d.attr(node,"disabled",!1),d.attr(node,"data-original-value",null),d.attr(node,attr,value)})},handleDataMethod=function(evt){var el=evt.target,form=createFormForLink(el.href,dojo.attr(el,"data-method"));evt.preventDefault(),form.submit()},handleFormSubmit=function(evt){var el=evt.target,elements=q("*[data-disable-with]",el);elements.length&&disable(elements),d.attr(el,"data-remote")&&(evt.preventDefault(),handleRemote(evt))},handleConfirm=function(evt){var proceed=dg.confirm(d.attr(evt.target,"data-confirm"));proceed?d.attr(evt.target,"data-remote")&&handleRemote(evt):evt.preventDefault()};live("*[data-confirm]","click",handleConfirm),d.subscribe("ajax:complete",handleEnable),live("a[data-remote]:not([data-confirm])","click",handleRemote),live("a[data-method]:not([data-remote])","click",handleDataMethod),live("form","submit",handleFormSubmit)}}(dojo,dojox.rails,dojo.global))})