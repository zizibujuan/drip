//>>built
define("dojox/wire/ml/Invocation",["dojo","dijit","dojox","dojo/require!dojox/wire/ml/Action"],function(dojo,dijit,dojox){dojo.provide("dojox.wire.ml.Invocation"),dojo.require("dojox.wire.ml.Action"),dojo.declare("dojox.wire.ml.Invocation",dojox.wire.ml.Action,{object:"",method:"",topic:"",parameters:"",result:"",error:"",_run:function(){if(this.topic){var args=this._getParameters(arguments);try{dojo.publish(this.topic,args),this.onComplete()}catch(e){this.onError(e)}}else if(this.method){var scope=this.object?dojox.wire.ml._getValue(this.object):dojo.global;if(!scope)return;var args=this._getParameters(arguments),func=scope[this.method];if(!func){func=scope.callMethod;if(!func)return;args=[this.method,args]}try{var connected=!1;if(scope.getFeatures){var features=scope.getFeatures();if(this.method=="fetch"&&features["dojo.data.api.Read"]||this.method=="save"&&features["dojo.data.api.Write"]){var arg=args[0];arg.onComplete||(arg.onComplete=function(){}),this.connect(arg,"onComplete","onComplete"),arg.onError||(arg.onError=function(){}),this.connect(arg,"onError","onError"),connected=!0}}var r=func.apply(scope,args);if(!connected)if(r&&r instanceof dojo.Deferred){var self=this;r.addCallbacks(function(result){self.onComplete(result)},function(error){self.onError(error)})}else this.onComplete(r)}catch(e){this.onError(e)}}},onComplete:function(result){this.result&&dojox.wire.ml._setValue(this.result,result),this.error&&dojox.wire.ml._setValue(this.error,"")},onError:function(error){this.error&&(error&&error.message&&(error=error.message),dojox.wire.ml._setValue(this.error,error))},_getParameters:function(args){if(!this.parameters)return args;var parameters=[],list=this.parameters.split(",");if(list.length==1){var parameter=dojox.wire.ml._getValue(dojo.trim(list[0]),args);dojo.isArray(parameter)?parameters=parameter:parameters.push(parameter)}else for(var i in list)parameters.push(dojox.wire.ml._getValue(dojo.trim(list[i]),args));return parameters}})})