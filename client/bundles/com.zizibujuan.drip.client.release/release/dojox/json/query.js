//>>built
define("dojox/json/query",["dojo/_base/kernel","dojo/_base/lang","dojox","dojo/_base/array"],function(dojo,lang,dojox){return lang.getObject("json",!0,dojox),dojox.json._slice=function(obj,start,end,step){var len=obj.length,results=[];end=end||len,start=start<0?Math.max(0,start+len):Math.min(len,start),end=end<0?Math.max(0,end+len):Math.min(len,end);for(var i=start;i<end;i+=step)results.push(obj[i]);return results},dojox.json._find=function(obj,name){function walk(obj){name&&(name!==!0||obj instanceof Array?obj[name]&&results.push(obj[name]):results.push(obj));for(var i in obj){var val=obj[i];name?val&&typeof val=="object"&&walk(val):results.push(val)}}var results=[];if(name instanceof Array){if(name.length==1)return obj[name[0]];for(var i=0;i<name.length;i++)results.push(obj[name[i]])}else walk(obj);return results},dojox.json._distinctFilter=function(array,callback){var outArr=[],primitives={};for(var i=0,l=array.length;i<l;++i){var value=array[i];callback(value,i,array)&&(typeof value=="object"&&value?value.__included||(value.__included=!0,outArr.push(value)):primitives[value+typeof value]||(primitives[value+typeof value]=!0,outArr.push(value)))}for(i=0,l=outArr.length;i<l;++i)outArr[i]&&delete outArr[i].__included;return outArr},dojox.json.query=function(query,obj){function call(name){prefix=name+"("+prefix}function makeRegex(t,a,b,c,d,e,f,g){return str[g].match(/[\*\?]/)||f=="~"?"/^"+str[g].substring(1,str[g].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,"[\\w\\W]$1")+(f=="~"?"$/i":"$/")+".test("+a+")":t}var depth=0,str=[];query=query.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(t){return depth+=t=="["?1:t=="]"?-1:0,t=="]"&&depth>0?"`]":t.charAt(0)=='"'||t.charAt(0)=="'"?"`"+(str.push(t)-1):t});var prefix="";query.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw new Error("Unsafe function call")}),query=query.replace(/([^<>=]=)([^=])/g,"$1=$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(t){return t.charAt(0)=="."?t:t=="@"?"$obj":(t.match(/:|^(\$|Math|true|false|null)$/)?"":"$obj.")+t}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(t,a,b){var oper=t.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/);if(oper){var prefix="";return t.match(/^\./)&&(call("dojox.json._find"),prefix=",true)"),call(oper[1].match(/\=/)?"dojo.map":oper[1].match(/\^/)?"dojox.json._distinctFilter":"dojo.filter"),prefix+",function($obj){return "+oper[2]+"})"}return oper=t.match(/^\[\s*([\/\\].*)\]/),oper?".concat().sort(function(a,b){"+oper[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(t,a,b){return"var av= "+b.replace(/\$obj/,"a")+",bv= "+b.replace(/\$obj/,"b")+";if(av>bv||bv==null){return "+(a=="/"?1:-1)+";}\n"+"if(bv>av||av==null){return "+(a=="/"?-1:1)+";}\n"})+"return 0;})":(oper=t.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/),oper?(call("dojox.json._slice"),","+(oper[1]||0)+","+(oper[2]||0)+","+(oper[3]||1)+")"):t.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)?(call("dojox.json._find"),(t.charAt(1)=="."?",'"+b+"'":t.match(/,/)?","+t:"")+")"):t)}).replace(/(\$obj\s*((\.\s*[\w_$]+\s*)|(\[\s*`([0-9]+)\s*`\]))*)(==|~)\s*`([0-9]+)/g,makeRegex).replace(/`([0-9]+)\s*(==|~)\s*(\$obj\s*((\.\s*[\w_$]+)|(\[\s*`([0-9]+)\s*`\]))*)/g,function(t,a,b,c,d,e,f,g){return makeRegex(t,c,d,e,f,g,b,a)}),query=prefix+(query.charAt(0)=="$"?"":"$")+query.replace(/`([0-9]+|\])/g,function(t,a){return a=="]"?"]":str[a]});var executor=eval("1&&function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj=$;return "+query+"}");for(var i=0;i<arguments.length-1;i++)arguments[i]=arguments[i+1];return obj?executor.apply(this,arguments):executor}})