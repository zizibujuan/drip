//>>built
define("dojox/grid/enhanced/plugins/AutoScroll",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/_base/html","dojo/_base/window","../_Plugin","../../_RowSelector","../../EnhancedGrid"],function(declare,array,lang,html,win,_Plugin,_RowSelector,EnhancedGrid){var AutoScroll=declare("dojox.grid.enhanced.plugins.AutoScroll",_Plugin,{name:"autoScroll",autoScrollInterval:1e3,autoScrollMargin:30,constructor:function(grid,args){this.grid=grid,this.readyForAutoScroll=!1,this._scrolling=!1,args=lang.isObject(args)?args:{},"interval"in args&&(this.autoScrollInterval=args.interval),"margin"in args&&(this.autoScrollMargin=args.margin),this._initEvents(),this._mixinGrid()},_initEvents:function(){var g=this.grid;this.connect(g,"onCellMouseDown",function(){this.readyForAutoScroll=!0}),this.connect(g,"onHeaderCellMouseDown",function(){this.readyForAutoScroll=!0}),this.connect(g,"onRowSelectorMouseDown",function(){this.readyForAutoScroll=!0}),this.connect(win.doc,"onmouseup",function(evt){this._manageAutoScroll(!0),this.readyForAutoScroll=!1}),this.connect(win.doc,"onmousemove",function(evt){if(this.readyForAutoScroll){this._event=evt;var gridPos=html.position(g.domNode),hh=g._getHeaderHeight(),margin=this.autoScrollMargin,ey=evt.clientY,ex=evt.clientX,gy=gridPos.y,gx=gridPos.x,gh=gridPos.h,gw=gridPos.w;if(ex>=gx&&ex<=gx+gw){if(ey>=gy+hh&&ey<gy+hh+margin){this._manageAutoScroll(!1,!0,!1);return}if(ey>gy+gh-margin&&ey<=gy+gh){this._manageAutoScroll(!1,!0,!0);return}if(ey>=gy&&ey<=gy+gh){var withinSomeview=array.some(g.views.views,function(view,i){if(view instanceof _RowSelector)return!1;var viewPos=html.position(view.domNode);return ex<viewPos.x+margin&&ex>=viewPos.x?(this._manageAutoScroll(!1,!1,!1,view),!0):ex>viewPos.x+viewPos.w-margin&&ex<viewPos.x+viewPos.w?(this._manageAutoScroll(!1,!1,!0,view),!0):!1},this);if(withinSomeview)return}}this._manageAutoScroll(!0)}})},_mixinGrid:function(){var g=this.grid;g.onStartAutoScroll=function(){},g.onEndAutoScroll=function(){}},_fireEvent:function(eventName,args){var g=this.grid;switch(eventName){case"start":g.onStartAutoScroll.apply(g,args);break;case"end":g.onEndAutoScroll.apply(g,args)}},_manageAutoScroll:function(toStop,isVertical,isForward,view){toStop?(this._scrolling=!1,clearInterval(this._handler)):this._scrolling||(this._scrolling=!0,this._fireEvent("start",[isVertical,isForward,view]),this._autoScroll(isVertical,isForward,view),this._handler=setInterval(lang.hitch(this,"_autoScroll",isVertical,isForward,view),this.autoScrollInterval))},_autoScroll:function(isVertical,isForward,view){var g=this.grid,target=null;if(isVertical){var targetRow=g.scroller.firstVisibleRow+(isForward?1:-1);targetRow>=0&&targetRow<g.rowCount&&(g.scrollToRow(targetRow),target=targetRow)}else target=this._scrollColumn(isForward,view);target!==null&&this._fireEvent("end",[isVertical,isForward,view,target,this._event])},_scrollColumn:function(isForward,view){var node=view.scrollboxNode,target=null;if(node.clientWidth<node.scrollWidth){var cells=array.filter(this.grid.layout.cells,function(cell){return!cell.hidden}),viewPos=html.position(view.domNode),limit,edge,headerPos,i;if(isForward){limit=node.clientWidth;for(i=0;i<cells.length;++i){headerPos=html.position(cells[i].getHeaderNode()),edge=headerPos.x-viewPos.x+headerPos.w;if(edge>limit){target=cells[i].index,node.scrollLeft+=edge-limit+10;break}}}else{limit=0;for(i=cells.length-1;i>=0;--i){headerPos=html.position(cells[i].getHeaderNode()),edge=headerPos.x-viewPos.x;if(edge<limit){target=cells[i].index,node.scrollLeft+=edge-limit-10;break}}}}return target}});return EnhancedGrid.registerPlugin(AutoScroll),AutoScroll})