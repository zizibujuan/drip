//>>built
define("dojox/grid/enhanced/plugins/Search",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/data/util/filter","../../EnhancedGrid","../_Plugin"],function(dojo,lang,declare,array,dFilter,EnhancedGrid,_Plugin){var Search=declare("dojox.grid.enhanced.plugins.Search",_Plugin,{name:"search",constructor:function(grid,args){this.grid=grid,args=args&&lang.isObject(args)?args:{},this._cacheSize=args.cacheSize||-1,grid.searchRow=lang.hitch(this,"searchRow")},searchRow:function(searchArgs,onSearched){if(!lang.isFunction(onSearched))return;lang.isString(searchArgs)&&(searchArgs=dFilter.patternToRegExp(searchArgs));var isGlobal=!1;if(searchArgs instanceof RegExp)isGlobal=!0;else{if(!lang.isObject(searchArgs))return;var isEmpty=!0;for(var field in searchArgs)lang.isString(searchArgs[field])&&(searchArgs[field]=dFilter.patternToRegExp(searchArgs[field])),isEmpty=!1;if(isEmpty)return}this._search(searchArgs,0,onSearched,isGlobal)},_search:function(searchArgs,start,onSearched,isGlobal){var _this=this,cnt=this._cacheSize,args={start:start,query:this.grid.query,sort:this.grid.getSortProps(),queryOptions:this.grid.queryOptions,onBegin:function(size){_this._storeSize=size},onComplete:function(items){array.some(items,function(item,i){return _this._checkRow(item,searchArgs,isGlobal)?(onSearched(start+i,item),!0):!1})||(cnt>0&&start+cnt<_this._storeSize?_this._search(searchArgs,start+cnt,onSearched,isGlobal):onSearched(-1,null))}};cnt>0&&(args.count=cnt),this.grid._storeLayerFetch(args)},_checkRow:function(item,searchArgs,isGlobal){var g=this.grid,s=g.store,i,field,cells=array.filter(g.layout.cells,function(cell){return!cell.hidden});if(isGlobal)return array.some(cells,function(cell){try{if(cell.field)return String(s.getValue(item,cell.field)).search(searchArgs)>=0}catch(e){0}return!1});for(field in searchArgs)if(searchArgs[field]instanceof RegExp){for(i=cells.length-1;i>=0;--i)if(cells[i].field==field)try{if(String(s.getValue(item,field)).search(searchArgs[field])<0)return!1;break}catch(e){return!1}if(i<0)return!1}return!0}});return EnhancedGrid.registerPlugin(Search),Search})