//>>built
require({cache:{"url:dojox/grid/resources/Expando.html":'<div class="dojoxGridExpando"\n	><div class="dojoxGridExpandoNode" dojoAttachEvent="onclick:onToggle"\n		><div class="dojoxGridExpandoNodeInner" dojoAttachPoint="expandoInner"></div\n	></div\n></div>\n'}}),define("dojox/grid/_TreeView",["dijit/registry","../main","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/_base/event","dojo/dom-attr","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/query","dojo/parser","dojo/text!./resources/Expando.html","dijit/_Widget","dijit/_TemplatedMixin","./_View","./_Builder","./util"],function(dijit,dojox,declare,array,lang,event,domAttr,domClass,domStyle,domCtr,query,parser,template,_Widget,_TemplatedMixin,_View,_Builder,util){declare("dojox.grid._Expando",[_Widget,_TemplatedMixin],{open:!1,toggleClass:"",itemId:"",cellIdx:-1,view:null,rowNode:null,rowIdx:-1,expandoCell:null,level:0,templateString:template,_toggleRows:function(toggleClass,open){if(!toggleClass||!this.rowNode)return;if(query("table.dojoxGridRowTableNeedsRowUpdate").length){this._initialized&&this.view.grid.updateRow(this.rowIdx);return}var self=this,g=this.view.grid;if(g.treeModel){var p=this._tableRow?domAttr.get(this._tableRow,"dojoxTreeGridPath"):"";p&&query('tr[dojoxTreeGridPath^="'+p+'/"]',this.rowNode).forEach(function(n){var en=query(".dojoxGridExpando",n)[0];if(en&&en.parentNode&&en.parentNode.parentNode&&!domClass.contains(en.parentNode.parentNode,"dojoxGridNoChildren")){var ew=dijit.byNode(en);ew&&ew._toggleRows(toggleClass,ew.open&&open)}n.style.display=open?"":"none"})}else query("tr."+toggleClass,this.rowNode).forEach(function(n){if(domClass.contains(n,"dojoxGridExpandoRow")){var en=query(".dojoxGridExpando",n)[0];if(en){var ew=dijit.byNode(en),toggleClass=ew?ew.toggleClass:en.getAttribute("toggleClass"),wOpen=ew?ew.open:self.expandoCell.getOpenState(en.getAttribute("itemId"));self._toggleRows(toggleClass,wOpen&&open)}}n.style.display=open?"":"none"})},setOpen:function(open){open&&domClass.contains(this.domNode,"dojoxGridExpandoLoading")&&(open=!1);var view=this.view,grid=view.grid,store=grid.store,treeModel=grid.treeModel,d=this,idx=this.rowIdx,me=grid._by_idx[idx];if(!me)return;if(treeModel&&!this._loadedChildren)if(open){var itm=grid.getItem(domAttr.get(this._tableRow,"dojoxTreeGridPath"));itm?(this.expandoInner.innerHTML="o",domClass.add(this.domNode,"dojoxGridExpandoLoading"),treeModel.getChildren(itm,function(items){d._loadedChildren=!0,d._setOpen(open)})):this._setOpen(open)}else this._setOpen(open);else if(!treeModel&&store)if(open){var data=grid._by_idx[this.rowIdx];data&&!store.isItemLoaded(data.item)?(this.expandoInner.innerHTML="o",domClass.add(this.domNode,"dojoxGridExpandoLoading"),store.loadItem({item:data.item,onItem:lang.hitch(this,function(i){var idty=store.getIdentity(i);grid._by_idty[idty]=grid._by_idx[this.rowIdx]={idty:idty,item:i},this._setOpen(open)})})):this._setOpen(open)}else this._setOpen(open);else this._setOpen(open)},_setOpen:function(open){if(open&&this._tableRow&&domClass.contains(this._tableRow,"dojoxGridNoChildren")){this._setOpen(!1);return}this.expandoInner.innerHTML=open?"-":"+",domClass.remove(this.domNode,"dojoxGridExpandoLoading"),domClass.toggle(this.domNode,"dojoxGridExpandoOpened",open);if(this._tableRow){domClass.toggle(this._tableRow,"dojoxGridRowCollapsed",!open);var base=domAttr.get(this._tableRow,"dojoxTreeGridBaseClasses"),new_base="";open?new_base=lang.trim((" "+base+" ").replace(" dojoxGridRowCollapsed "," ")):(" "+base+" ").indexOf(" dojoxGridRowCollapsed ")<0?new_base=base+(base?" ":"")+"dojoxGridRowCollapsed":new_base=base,domAttr.set(this._tableRow,"dojoxTreeGridBaseClasses",new_base)}var changed=this.open!==open;this.open=open,this.expandoCell&&this.itemId&&(this.expandoCell.openStates[this.itemId]=open);var v=this.view,g=v.grid;this.toggleClass&&changed&&(!this._tableRow||!this._tableRow.style.display)&&this._toggleRows(this.toggleClass,open),v&&this._initialized&&this.rowIdx>=0&&(g.rowHeightChanged(this.rowIdx),g.postresize(),v.hasVScrollbar(!0)),this._initialized=!0},onToggle:function(e){this.setOpen(!this.open),event.stop(e)},setRowNode:function(rowIdx,rowNode,view){if(this.cellIdx<0||!this.itemId)return!1;this._initialized=!1,this.view=view,this.rowNode=rowNode,this.rowIdx=rowIdx,this.expandoCell=view.structure.cells[0][this.cellIdx];var d=this.domNode;return d&&d.parentNode&&d.parentNode.parentNode&&(this._tableRow=d.parentNode.parentNode),this.open=this.expandoCell.getOpenState(this.itemId),view.grid.treeModel&&(domStyle.set(this.domNode,"marginLeft",this.level*18+"px"),this.domNode.parentNode&&domStyle.set(this.domNode.parentNode,"backgroundPosition",this.level*18+3+"px")),this.setOpen(this.open),!0}});var _TreeContentBuilder=declare("dojox.grid._TreeContentBuilder",_Builder._ContentBuilder,{generateHtml:function(inDataIndex,inRowIndex){var html=this.getTableArray(),v=this.view,row=v.structure.cells[0],item=this.grid.getItem(inRowIndex),grid=this.grid,store=this.grid.store;util.fire(this.view,"onBeforeRow",[inRowIndex,[row]]);var createRow=function(level,rowItem,summaryRow,toggleClasses,rowStack,shown){if(!shown){html[0].indexOf("dojoxGridRowTableNeedsRowUpdate")==-1&&(html[0]=html[0].replace("dojoxGridRowTable","dojoxGridRowTable dojoxGridRowTableNeedsRowUpdate"));return}var rowNodeIdx=html.length;toggleClasses=toggleClasses||[];var tcJoin=toggleClasses.join("|"),tcString=toggleClasses[toggleClasses.length-1],clString=tcString+(summaryRow?" dojoxGridSummaryRow":""),sString="";grid.treeModel&&rowItem&&!grid.treeModel.mayHaveChildren(rowItem)&&(clString+=" dojoxGridNoChildren"),html.push('<tr style="'+sString+'" class="'+clString+'" dojoxTreeGridPath="'+rowStack.join("/")+'" dojoxTreeGridBaseClasses="'+clString+'">');var nextLevel=level+1,parentCell=null;for(var i=0,cell;cell=row[i];i++){var m=cell.markup,cc=cell.customClasses=[],cs=cell.customStyles=[];m[5]=cell.formatAtLevel(rowStack,rowItem,level,summaryRow,tcString,cc),m[1]=cc.join(" "),m[3]=cs.join(";"),html.push.apply(html,m),!parentCell&&cell.level===nextLevel&&cell.parentCell&&(parentCell=cell.parentCell)}html.push("</tr>");if(rowItem&&store&&store.isItem(rowItem)){var idty=store.getIdentity(rowItem);typeof grid._by_idty_paths[idty]=="undefined"&&(grid._by_idty_paths[idty]=rowStack.join("/"))}var expandoCell,parentOpen,path,values,iStack=rowStack.concat([]);if(grid.treeModel&&rowItem)grid.treeModel.mayHaveChildren(rowItem)&&(expandoCell=v.structure.cells[0][grid.expandoCell||0],parentOpen=expandoCell.getOpenState(rowItem)&&shown,path=new dojox.grid.TreePath(rowStack.join("/"),grid),values=path.children(!0)||[],array.forEach(values,function(cItm,idx){var nToggle=tcJoin.split("|");nToggle.push(nToggle[nToggle.length-1]+"-"+idx),iStack.push(idx),createRow(nextLevel,cItm,!1,nToggle,iStack,parentOpen),iStack.pop()}));else if(rowItem&&parentCell&&!summaryRow){expandoCell=v.structure.cells[0][parentCell.level],parentOpen=expandoCell.getOpenState(rowItem)&&shown;if(store.hasAttribute(rowItem,parentCell.field)){var tToggle=tcJoin.split("|");tToggle.pop(),path=new dojox.grid.TreePath(rowStack.join("/"),grid),values=path.children(!0)||[],values.length?(html[rowNodeIdx]='<tr class="'+tToggle.join(" ")+' dojoxGridExpandoRow" dojoxTreeGridPath="'+rowStack.join("/")+'">',array.forEach(values,function(cItm,idx){var nToggle=tcJoin.split("|");nToggle.push(nToggle[nToggle.length-1]+"-"+idx),iStack.push(idx),createRow(nextLevel,cItm,!1,nToggle,iStack,parentOpen),iStack.pop()}),iStack.push(values.length),createRow(level,rowItem,!0,toggleClasses,iStack,parentOpen)):html[rowNodeIdx]='<tr class="'+tcString+' dojoxGridNoChildren" dojoxTreeGridPath="'+rowStack.join("/")+'">'}else store.isItemLoaded(rowItem)?html[rowNodeIdx]='<tr class="'+tcString+' dojoxGridNoChildren" dojoxTreeGridPath="'+rowStack.join("/")+'">':html[0]=html[0].replace("dojoxGridRowTable","dojoxGridRowTable dojoxGridRowTableNeedsRowUpdate")}else rowItem&&!summaryRow&&toggleClasses.length>1&&(html[rowNodeIdx]='<tr class="'+toggleClasses[toggleClasses.length-2]+'" dojoxTreeGridPath="'+rowStack.join("/")+'">')};return createRow(0,item,!1,["dojoxGridRowToggle-"+inRowIndex],[inRowIndex],!0),html.push("</table>"),html.join("")},findTarget:function(inSource,inTag){var n=inSource;while(n&&n!=this.domNode){if(n.tagName&&n.tagName.toLowerCase()=="tr")break;n=n.parentNode}return n!=this.domNode?n:null},getCellNode:function(inRowNode,inCellIndex){var node=query("td[idx='"+inCellIndex+"']",inRowNode)[0];if(node&&node.parentNode&&!domClass.contains(node.parentNode,"dojoxGridSummaryRow"))return node},decorateEvent:function(e){return e.rowNode=this.findRowTarget(e.target),e.rowNode?(e.rowIndex=domAttr.get(e.rowNode,"dojoxTreeGridPath"),this.baseDecorateEvent(e),e.cell=this.grid.getCell(e.cellIndex),!0):!1}});return declare("dojox.grid._TreeView",_View,{_contentBuilderClass:_TreeContentBuilder,_onDndDrop:function(source,nodes,copy){this.grid&&this.grid.aggregator&&this.grid.aggregator.clearSubtotalCache(),this.inherited(arguments)},postCreate:function(){this.inherited(arguments),this.connect(this.grid,"_cleanupExpandoCache","_cleanupExpandoCache")},_cleanupExpandoCache:function(index,identity,item){if(index==-1)return;array.forEach(this.grid.layout.cells,function(cell){typeof cell["openStates"]!="undefined"&&identity in cell.openStates&&delete cell.openStates[identity]});if(typeof index=="string"&&index.indexOf("/")>-1){var path=new dojox.grid.TreePath(index,this.grid),ppath=path.parent();while(ppath)path=ppath,ppath=path.parent();var pitem=path.item();if(!pitem)return;var idty=this.grid.store.getIdentity(pitem);if(typeof this._expandos[idty]!="undefined"){for(var i in this._expandos[idty]){var exp=this._expandos[idty][i];exp&&exp.destroy(),delete this._expandos[idty][i]}delete this._expandos[idty]}}else{for(var i in this._expandos)if(typeof this._expandos[i]!="undefined")for(var j in this._expandos[i]){var exp=this._expandos[i][j];exp&&exp.destroy()}this._expandos={}}},postMixInProperties:function(){this.inherited(arguments),this._expandos={}},onBeforeRow:function(inRowIndex,cells){var g=this.grid;if(g._by_idx&&g._by_idx[inRowIndex]&&g._by_idx[inRowIndex].idty){var idty=g._by_idx[inRowIndex].idty;this._expandos[idty]=this._expandos[idty]||{}}this.inherited(arguments)},onAfterRow:function(inRowIndex,cells,inRowNode){array.forEach(query("span.dojoxGridExpando",inRowNode),function(n){if(n&&n.parentNode){var tc=n.getAttribute("toggleClass"),idty,expando,g=this.grid;g._by_idx&&g._by_idx[inRowIndex]&&g._by_idx[inRowIndex].idty&&(idty=g._by_idx[inRowIndex].idty,expando=this._expandos[idty][tc]),expando?(domCtr.place(expando.domNode,n,"replace"),expando.itemId=n.getAttribute("itemId"),expando.cellIdx=parseInt(n.getAttribute("cellIdx"),10),isNaN(expando.cellIdx)&&(expando.cellIdx=-1)):idty&&(expando=parser.parse(n.parentNode)[0],this._expandos[idty][tc]=expando),expando&&!expando.setRowNode(inRowIndex,inRowNode,this)&&expando.domNode.parentNode.removeChild(expando.domNode)}},this);var alt=!1,self=this;query("tr[dojoxTreeGridPath]",inRowNode).forEach(function(n){domClass.toggle(n,"dojoxGridSubRowAlt",alt),domAttr.set(n,"dojoxTreeGridBaseClasses",n.className),alt=!alt,self.grid.rows.styleRowNode(domAttr.get(n,"dojoxTreeGridPath"),n)}),this.inherited(arguments)},updateRowStyles:function(inRowIndex){var rowNodes=query("tr[dojoxTreeGridPath='"+inRowIndex+"']",this.domNode);rowNodes.length&&this.styleRowNode(inRowIndex,rowNodes[0])},getCellNode:function(inRowIndex,inCellIndex){var row=query("tr[dojoxTreeGridPath='"+inRowIndex+"']",this.domNode)[0];if(row)return this.content.getCellNode(row,inCellIndex)},destroy:function(){this._cleanupExpandoCache(),this.inherited(arguments)}})})