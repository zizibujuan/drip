//>>built
define("dojox/grid/_Selector",["../main","dojo/_base/declare","dojo/_base/lang","dojo/query","dojo/dom-class","./Selection","./_View","./_Builder","./util"],function(dojox,declare,lang,query,domClass,Selection,_View,_Builder,util){var _InputSelectorHeaderBuilder=dojox.grid._InputSelectorHeaderBuilder=lang.extend(function(view){_Builder._HeaderBuilder.call(this,view)},_Builder._HeaderBuilder.prototype,{generateHtml:function(){var w=this.view.contentWidth||0,selectedCount=this.view.grid.selection.getSelectedCount(),checked=selectedCount&&selectedCount==this.view.grid.rowCount?" dijitCheckBoxChecked dijitChecked":"";return'<table style="width:'+w+'px;" '+'border="0" cellspacing="0" cellpadding="0" '+'role="presentation"><tr><th style="text-align: center;">'+'<div class="dojoxGridCheckSelector dijitReset dijitInline dijitCheckBox'+checked+'"></div></th></tr></table>'},doclick:function(e){var selectedCount=this.view.grid.selection.getSelectedCount();return this.view._selectionChanging=!0,selectedCount==this.view.grid.rowCount?this.view.grid.selection.deselectAll():this.view.grid.selection.selectRange(0,this.view.grid.rowCount-1),this.view._selectionChanging=!1,this.view.onSelectionChanged(),!0}}),_SelectorContentBuilder=dojox.grid._SelectorContentBuilder=lang.extend(function(view){_Builder._ContentBuilder.call(this,view)},_Builder._ContentBuilder.prototype,{generateHtml:function(inDataIndex,inRowIndex){var w=this.view.contentWidth||0;return'<table class="dojoxGridRowbarTable" style="width:'+w+'px;" border="0" '+'cellspacing="0" cellpadding="0" role="presentation"><tr>'+'<td  style="text-align: center;" class="dojoxGridRowbarInner">'+this.getCellContent(inRowIndex)+"</td></tr></table>"},getCellContent:function(inRowIndex){return"&nbsp;"},findTarget:function(){var t=_Builder._ContentBuilder.prototype.findTarget.apply(this,arguments);return t},domouseover:function(e){this.view.grid.onMouseOverRow(e)},domouseout:function(e){this.isIntraRowEvent(e)||this.view.grid.onMouseOutRow(e)},doclick:function(e){var idx=e.rowIndex,selected=this.view.grid.selection.isSelected(idx),mode=this.view.grid.selection.mode;return selected?this.view.grid.selection.deselect(idx):mode=="single"?this.view.grid.selection.select(idx):mode!="none"&&this.view.grid.selection.addToSelection(idx),!0}}),_InputSelectorContentBuilder=dojox.grid._InputSelectorContentBuilder=lang.extend(function(view){_SelectorContentBuilder.call(this,view)},_SelectorContentBuilder.prototype,{getCellContent:function(rowIndex){var v=this.view,type=v.inputType=="checkbox"?"CheckBox":"Radio",checked=v.grid.selection.isSelected(rowIndex)?" dijit"+type+"Checked dijitChecked":"";return'<div class="dojoxGridCheckSelector dijitReset dijitInline dijit'+type+checked+'"></div>'}}),_Selector=declare("dojox.grid._Selector",_View,{inputType:"",selectionMode:"",defaultWidth:"2em",noscroll:!0,padBorderWidth:2,_contentBuilderClass:_SelectorContentBuilder,postCreate:function(){this.inherited(arguments),this.selectionMode&&(this.grid.selection.mode=this.selectionMode),this.connect(this.grid.selection,"onSelected","onSelected"),this.connect(this.grid.selection,"onDeselected","onDeselected")},buildRendering:function(){this.inherited(arguments),this.scrollboxNode.style.overflow="hidden"},getWidth:function(){return this.viewWidth||this.defaultWidth},resize:function(){this.adaptHeight()},setStructure:function(s){this.inherited(arguments),s.defaultWidth&&(this.defaultWidth=s.defaultWidth)},adaptWidth:function(){!("contentWidth"in this)&&this.contentNode&&(this.contentWidth=this.contentNode.offsetWidth-this.padBorderWidth)},doStyleRowNode:function(inRowIndex,inRowNode){var n=["dojoxGridRowbar dojoxGridNonNormalizedCell"];this.grid.rows.isOver(inRowIndex)&&n.push("dojoxGridRowbarOver"),this.grid.selection.isSelected(inRowIndex)&&n.push("dojoxGridRowbarSelected"),inRowNode.className=n.join(" ")},onSelected:function(inIndex){this.grid.updateRow(inIndex)},onDeselected:function(inIndex){this.grid.updateRow(inIndex)}});return!_View.prototype._headerBuilderClass&&!_View.prototype._contentBuilderClass&&(_Selector.prototype.postCreate=function(){this.connect(this.scrollboxNode,"onscroll","doscroll"),util.funnelEvents(this.contentNode,this,"doContentEvent",["mouseover","mouseout","click","dblclick","contextmenu","mousedown"]),util.funnelEvents(this.headerNode,this,"doHeaderEvent",["dblclick","mouseover","mouseout","mousemove","mousedown","click","contextmenu"]),this._contentBuilderClass?this.content=new this._contentBuilderClass(this):this.content=new _Builder._ContentBuilder(this),this._headerBuilderClass?this.header=new this._headerBuilderClass(this):this.header=new _Builder._HeaderBuilder(this),this.grid.isLeftToRight()||(this.headerNodeContainer.style.width=""),this.connect(this.grid.selection,"onSelected","onSelected"),this.connect(this.grid.selection,"onDeselected","onDeselected")}),declare("dojox.grid._RadioSelector",_Selector,{inputType:"radio",selectionMode:"single",_contentBuilderClass:_InputSelectorContentBuilder,buildRendering:function(){this.inherited(arguments),this.headerNode.style.visibility="hidden"},renderHeader:function(){}}),declare("dojox.grid._CheckBoxSelector",_Selector,{inputType:"checkbox",_headerBuilderClass:_InputSelectorHeaderBuilder,_contentBuilderClass:_InputSelectorContentBuilder,postCreate:function(){this.inherited(arguments),this.connect(this.grid,"onSelectionChanged","onSelectionChanged"),this.connect(this.grid,"updateRowCount","_updateVisibility")},renderHeader:function(){this.inherited(arguments),this._updateVisibility(this.grid.rowCount)},_updateVisibility:function(rowCount){this.headerNode.style.visibility=rowCount?"":"hidden"},onSelectionChanged:function(){if(this._selectionChanging)return;var inputDiv=query(".dojoxGridCheckSelector",this.headerNode)[0],g=this.grid,s=g.rowCount&&g.rowCount==g.selection.getSelectedCount();g.allItemsSelected=s||!1,domClass.toggle(inputDiv,"dijitChecked",g.allItemsSelected),domClass.toggle(inputDiv,"dijitCheckBoxChecked",g.allItemsSelected)}}),_Selector})