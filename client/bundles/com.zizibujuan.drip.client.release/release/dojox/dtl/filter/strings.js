//>>built
define("dojox/dtl/filter/strings",["dojo/_base/lang","dojo/_base/array","dojox/string/tokenize","dojox/string/sprintf","../filter/htmlstrings","../_base"],function(lang,array,Tokenize,Sprintf,htmlstrings,dd){return lang.getObject("dojox.dtl.filter.strings",!0),lang.mixin(dd.filter.strings,{_urlquote:function(url,safe){return safe||(safe="/"),Tokenize(url,/([^\w-_.])/g,function(token){if(safe.indexOf(token)==-1){if(token==" ")return"+";var hex=token.charCodeAt(0).toString(16).toUpperCase();while(hex.length<2)hex="0"+hex;return"%"+hex}return token}).join("")},addslashes:function(value){return value.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/'/g,"\\'")},capfirst:function(value){return value=""+value,value.charAt(0).toUpperCase()+value.substring(1)},center:function(value,arg){arg=arg||value.length,value+="";var diff=arg-value.length;diff%2&&(value+=" ",diff-=1);for(var i=0;i<diff;i+=2)value=" "+value+" ";return value},cut:function(value,arg){return arg=arg+""||"",value+="",value.replace(new RegExp(arg,"g"),"")},_fix_ampersands:/&(?!(\w+|#\d+);)/g,fix_ampersands:function(value){return value.replace(dojox.dtl.filter.strings._fix_ampersands,"&amp;")},floatformat:function(value,arg){arg=parseInt(arg||-1,10),value=parseFloat(value);var m=value-value.toFixed(0);return!m&&arg<0?value.toFixed():(value=value.toFixed(Math.abs(arg)),arg<0?parseFloat(value)+"":value)},iriencode:function(value){return dojox.dtl.filter.strings._urlquote(value,"/#%[]=:;$&()+,!")},linenumbers:function(value){var df=dojox.dtl.filter,lines=value.split("\n"),output=[],width=(lines.length+"").length;for(var i=0,line;i<lines.length;i++)line=lines[i],output.push(df.strings.ljust(i+1,width)+". "+dojox.dtl._base.escape(line));return output.join("\n")},ljust:function(value,arg){value+="",arg=parseInt(arg,10);while(value.length<arg)value+=" ";return value},lower:function(value){return(value+"").toLowerCase()},make_list:function(value){var output=[];typeof value=="number"&&(value+="");if(value.charAt){for(var i=0;i<value.length;i++)output.push(value.charAt(i));return output}if(typeof value=="object"){for(var key in value)output.push(value[key]);return output}return[]},rjust:function(value,arg){value+="",arg=parseInt(arg,10);while(value.length<arg)value=" "+value;return value},slugify:function(value){return value=value.replace(/[^\w\s-]/g,"").toLowerCase(),value.replace(/[\-\s]+/g,"-")},_strings:{},stringformat:function(value,arg){arg=""+arg;var strings=dojox.dtl.filter.strings._strings;return strings[arg]||(strings[arg]=new Sprintf.Formatter("%"+arg)),strings[arg].format(value)},title:function(value){var last,title="";for(var i=0,current;i<value.length;i++)current=value.charAt(i),last==" "||last=="\n"||last=="	"||!last?title+=current.toUpperCase():title+=current.toLowerCase(),last=current;return title},_truncatewords:/[ \n\r\t]/,truncatewords:function(value,arg){arg=parseInt(arg,10);if(!arg)return value;for(var i=0,j=value.length,count=0,current,last;i<value.length;i++){current=value.charAt(i);if(dojox.dtl.filter.strings._truncatewords.test(last)){if(!dojox.dtl.filter.strings._truncatewords.test(current)){++count;if(count==arg)return value.substring(0,j+1)}}else dojox.dtl.filter.strings._truncatewords.test(current)||(j=i);last=current}return value},_truncate_words:/(&.*?;|<.*?>|(\w[\w\-]*))/g,_truncate_tag:/<(\/)?([^ ]+?)(?: (\/)| .*?)?>/,_truncate_singlets:{br:!0,col:!0,link:!0,base:!0,img:!0,param:!0,area:!0,hr:!0,input:!0},truncatewords_html:function(value,arg){arg=parseInt(arg,10);if(arg<=0)return"";var strings=dojox.dtl.filter.strings,words=0,open=[],output=Tokenize(value,strings._truncate_words,function(all,word){if(word){++words;if(words<arg)return word;if(words==arg)return word+" ..."}var tag=all.match(strings._truncate_tag);if(!tag||words>=arg)return;var closing=tag[1],tagname=tag[2].toLowerCase(),selfclosing=tag[3];if(!closing&&!strings._truncate_singlets[tagname])if(closing){var i=array.indexOf(open,tagname);i!=-1&&(open=open.slice(i+1))}else open.unshift(tagname);return all}).join("");output=output.replace(/\s+$/g,"");for(var i=0,tag;tag=open[i];i++)output+="</"+tag+">";return output},upper:function(value){return value.toUpperCase()},urlencode:function(value){return dojox.dtl.filter.strings._urlquote(value)},_urlize:/^((?:[(>]|&lt;)*)(.*?)((?:[.,)>\n]|&gt;)*)$/,_urlize2:/^\S+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+$/,urlize:function(value){return dojox.dtl.filter.strings.urlizetrunc(value)},urlizetrunc:function(value,arg){return arg=parseInt(arg),Tokenize(value,/(\S+)/g,function(word){var matches=dojox.dtl.filter.strings._urlize.exec(word);if(!matches)return word;var lead=matches[1],middle=matches[2],trail=matches[3],startsWww=middle.indexOf("www.")==0,hasAt=middle.indexOf("@")!=-1,hasColon=middle.indexOf(":")!=-1,startsHttp=middle.indexOf("http://")==0,startsHttps=middle.indexOf("https://")==0,firstAlpha=/[a-zA-Z0-9]/.test(middle.charAt(0)),last4=middle.substring(middle.length-4),trimmed=middle;return arg>3&&(trimmed=trimmed.substring(0,arg-3)+"..."),startsWww||!hasAt&&!startsHttp&&middle.length&&firstAlpha&&(last4==".org"||last4==".net"||last4==".com")?'<a href="http://'+middle+'" rel="nofollow">'+trimmed+"</a>":startsHttp||startsHttps?'<a href="'+middle+'" rel="nofollow">'+trimmed+"</a>":hasAt&&!startsWww&&!hasColon&&dojox.dtl.filter.strings._urlize2.test(middle)?'<a href="mailto:'+middle+'">'+middle+"</a>":word}).join("")},wordcount:function(value){return value=lang.trim(value),value?value.split(/\s+/g).length:0},wordwrap:function(value,arg){arg=parseInt(arg);var output=[],parts=value.split(/\s+/g);if(parts.length){var word=parts.shift();output.push(word);var pos=word.length-word.lastIndexOf("\n")-1;for(var i=0;i<parts.length;i++){word=parts[i];if(word.indexOf("\n")!=-1)var lines=word.split(/\n/g);else var lines=[word];pos+=lines[0].length+1,arg&&pos>arg?(output.push("\n"),pos=lines[lines.length-1].length):(output.push(" "),lines.length>1&&(pos=lines[lines.length-1].length)),output.push(word)}}return output.join("")}}),dojox.dtl.filter.strings})