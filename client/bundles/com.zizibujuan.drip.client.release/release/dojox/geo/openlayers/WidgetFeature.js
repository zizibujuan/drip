//>>built
define("dojox/geo/openlayers/WidgetFeature",["dojo/_base/declare","dojo/dom-style","dojo/_base/lang","dijit/registry","./Feature"],function(declare,style,lang,registry,Feature){return declare("dojox.geo.openlayers.WidgetFeature",Feature,{_widget:null,_bbox:null,constructor:function(params){this._params=params},setParameters:function(params){this._params=params},getParameters:function(){return this._params},_getWidget:function(){var params=this._params;if(this._widget==null&&params!=null){var w=null;if(typeof params.createWidget=="function")w=params.createWidget.call(this);else if(params.dojoType){dojo.require(params.dojoType);var c=lang.getObject(params.dojoType);w=new c(params)}else params.dijitId?w=registry.byId(params.dijitId):params.widget&&(w=params.widget);if(w!=null){this._widget=w,typeof w.startup=="function"&&w.startup();var n=w.domNode;n!=null&&style.set(n,{position:"absolute"})}this._widget=w}return this._widget},_getWidgetWidth:function(){var p=this._params;if(p.width)return p.width;var w=this._getWidget();return w?style.get(w.domNode,"width"):10},_getWidgetHeight:function(){var p=this._params;if(p.height)return p.height;var w=this._getWidget();return w?style.get(w.domNode,"height"):10},render:function(){var layer=this.getLayer(),widget=this._getWidget();if(widget==null)return;var params=this._params,lon=params.longitude,lat=params.latitude,from=this.getCoordinateSystem(),map=layer.getDojoMap(),p=map.transformXY(lon,lat,from),a=this._getLocalXY(p),width=this._getWidgetWidth(),height=this._getWidgetHeight(),x=a[0]-width/2,y=a[1]-height/2,dom=widget.domNode,pa=layer.olLayer.div;dom.parentNode!=pa&&(dom.parentNode&&dom.parentNode.removeChild(dom),pa.appendChild(dom)),this._updateWidgetPosition({x:x,y:y,width:width,height:height})},_updateWidgetPosition:function(box){var w=this._widget,dom=w.domNode;style.set(dom,{position:"absolute",left:box.x+"px",top:box.y+"px",width:box.width+"px",height:box.height+"px"}),w.srcNodeRef&&style.set(w.srcNodeRef,{position:"absolute",left:box.x+"px",top:box.y+"px",width:box.width+"px",height:box.height+"px"}),lang.isFunction(w.resize)&&w.resize({w:box.width,h:box.height})},remove:function(){var w=this.getWidget();if(!w)return;var dom=w.domNode;dom.parentNode&&dom.parentNode.removeChild(dom)}})})