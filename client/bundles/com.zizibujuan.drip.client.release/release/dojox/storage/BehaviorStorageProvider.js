//>>built
define("dojox/storage/BehaviorStorageProvider",["dojo","dijit","dojox","dojo/require!dojox/storage/Provider,dojox/storage/manager"],function(dojo,dijit,dojox){dojo.provide("dojox.storage.BehaviorStorageProvider"),dojo.require("dojox.storage.Provider"),dojo.require("dojox.storage.manager"),dojo.declare("dojox.storage.BehaviorStorageProvider",[dojox.storage.Provider],{store:null,storeName:"__dojox_BehaviorStorage",keys:[],initialize:function(){try{this.store=this._createStore(),this.store.load(this.storeName)}catch(e){throw new Error("Store is not available: "+e)}var keys=this.get("keys","dojoxSystemNS");this.keys=keys||[],this.initialized=!0,dojox.storage.manager.loaded()},isAvailable:function(){return dojo.isIE&&dojo.isIE>=5},_createStore:function(){var storeNode=dojo.create("link",{id:this.storeName+"Node",style:{display:"none"}},dojo.query("head")[0]);return storeNode.addBehavior("#default#userdata"),storeNode},put:function(key,value,resultsHandler,namespace){this._assertIsValidKey(key),namespace=namespace||this.DEFAULT_NAMESPACE,this._assertIsValidNamespace(namespace);var fullKey=this.getFullKey(key,namespace);value=dojo.toJson(value),this.store.setAttribute(fullKey,value),this.store.save(this.storeName);var success=this.store.getAttribute(fullKey)===value;success&&(this._addKey(fullKey),this.store.setAttribute("__dojoxSystemNS_keys",dojo.toJson(this.keys)),this.store.save(this.storeName)),resultsHandler&&resultsHandler(success?this.SUCCESS:this.FAILED,key,null,namespace)},get:function(key,namespace){return this._assertIsValidKey(key),namespace=namespace||this.DEFAULT_NAMESPACE,this._assertIsValidNamespace(namespace),key=this.getFullKey(key,namespace),dojo.fromJson(this.store.getAttribute(key))},getKeys:function(namespace){namespace=namespace||this.DEFAULT_NAMESPACE,this._assertIsValidNamespace(namespace),namespace="__"+namespace+"_";var keys=[];for(var i=0;i<this.keys.length;i++){var currentKey=this.keys[i];this._beginsWith(currentKey,namespace)&&(currentKey=currentKey.substring(namespace.length),keys.push(currentKey))}return keys},clear:function(namespace){namespace=namespace||this.DEFAULT_NAMESPACE,this._assertIsValidNamespace(namespace),namespace="__"+namespace+"_";var keys=[];for(var i=0;i<this.keys.length;i++){var currentKey=this.keys[i];this._beginsWith(currentKey,namespace)&&keys.push(currentKey)}dojo.forEach(keys,function(key){this.store.removeAttribute(key),this._removeKey(key)},this),this.put("keys",this.keys,null,"dojoxSystemNS"),this.store.save(this.storeName)},remove:function(key,namespace){this._assertIsValidKey(key),namespace=namespace||this.DEFAULT_NAMESPACE,this._assertIsValidNamespace(namespace),key=this.getFullKey(key,namespace),this.store.removeAttribute(key),this._removeKey(key),this.put("keys",this.keys,null,"dojoxSystemNS"),this.store.save(this.storeName)},getNamespaces:function(){var results=[this.DEFAULT_NAMESPACE],found={};found[this.DEFAULT_NAMESPACE]=!0;var tester=/^__([^_]*)_/;for(var i=0;i<this.keys.length;i++){var currentKey=this.keys[i];if(tester.test(currentKey)==1){var currentNS=currentKey.match(tester)[1];typeof found[currentNS]=="undefined"&&(found[currentNS]=!0,results.push(currentNS))}}return results},isPermanent:function(){return!0},getMaximumSize:function(){return 64},hasSettingsUI:function(){return!1},isValidKey:function(keyName){return keyName===null||keyName===undefined?!1:/^[0-9A-Za-z_-]*$/.test(keyName)},isValidNamespace:function(keyName){return keyName===null||keyName===undefined?!1:/^[0-9A-Za-z-]*$/.test(keyName)},getFullKey:function(key,namespace){return"__"+namespace+"_"+key},_beginsWith:function(haystack,needle){return needle.length>haystack.length?!1:haystack.substring(0,needle.length)===needle},_assertIsValidNamespace:function(namespace){if(this.isValidNamespace(namespace)===!1)throw new Error("Invalid namespace given: "+namespace)},_assertIsValidKey:function(key){if(this.isValidKey(key)===!1)throw new Error("Invalid key given: "+key)},_addKey:function(key){this._removeKey(key),this.keys.push(key)},_removeKey:function(key){this.keys=dojo.filter(this.keys,function(item){return item!==key},this)}}),dojox.storage.manager.register("dojox.storage.BehaviorStorageProvider",new dojox.storage.BehaviorStorageProvider)})