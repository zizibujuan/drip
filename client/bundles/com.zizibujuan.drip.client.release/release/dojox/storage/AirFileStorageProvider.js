//>>built
define("dojox/storage/AirFileStorageProvider",["dojo","dijit","dojox","dojo/require!dojox/storage/manager,dojox/storage/Provider"],function(dojo,dijit,dojox){dojo.provide("dojox.storage.AirFileStorageProvider"),dojo.require("dojox.storage.manager"),dojo.require("dojox.storage.Provider"),dojo.isAIR&&function(){if(!air)var air={};air.File=window.runtime.flash.filesystem.File,air.FileStream=window.runtime.flash.filesystem.FileStream,air.FileMode=window.runtime.flash.filesystem.FileMode,dojo.declare("dojox.storage.AirFileStorageProvider",[dojox.storage.Provider],{initialized:!1,_storagePath:"__DOJO_STORAGE/",initialize:function(){this.initialized=!1;try{var dir=air.File.applicationStorageDirectory.resolvePath(this._storagePath);dir.exists||dir.createDirectory(),this.initialized=!0}catch(e){0}dojox.storage.manager.loaded()},isAvailable:function(){return!0},put:function(key,value,resultsHandler,namespace){if(this.isValidKey(key)==0)throw new Error("Invalid key given: "+key);namespace=namespace||this.DEFAULT_NAMESPACE;if(this.isValidKey(namespace)==0)throw new Error("Invalid namespace given: "+namespace);try{this.remove(key,namespace);var dir=air.File.applicationStorageDirectory.resolvePath(this._storagePath+namespace);dir.exists||dir.createDirectory();var file=dir.resolvePath(key),stream=new air.FileStream;stream.open(file,air.FileMode.WRITE),stream.writeObject(value),stream.close()}catch(e){0,resultsHandler(this.FAILED,key,e.toString(),namespace);return}resultsHandler&&resultsHandler(this.SUCCESS,key,null,namespace)},get:function(key,namespace){if(this.isValidKey(key)==0)throw new Error("Invalid key given: "+key);namespace=namespace||this.DEFAULT_NAMESPACE;var results=null,file=air.File.applicationStorageDirectory.resolvePath(this._storagePath+namespace+"/"+key);if(file.exists&&!file.isDirectory){var stream=new air.FileStream;stream.open(file,air.FileMode.READ),results=stream.readObject(),stream.close()}return results},getNamespaces:function(){var results=[this.DEFAULT_NAMESPACE],dir=air.File.applicationStorageDirectory.resolvePath(this._storagePath),files=dir.getDirectoryListing(),i;for(i=0;i<files.length;i++)files[i].isDirectory&&files[i].name!=this.DEFAULT_NAMESPACE&&results.push(files[i].name);return results},getKeys:function(namespace){namespace=namespace||this.DEFAULT_NAMESPACE;if(this.isValidKey(namespace)==0)throw new Error("Invalid namespace given: "+namespace);var results=[],dir=air.File.applicationStorageDirectory.resolvePath(this._storagePath+namespace);if(dir.exists&&dir.isDirectory){var files=dir.getDirectoryListing(),i;for(i=0;i<files.length;i++)results.push(files[i].name)}return results},clear:function(namespace){if(this.isValidKey(namespace)==0)throw new Error("Invalid namespace given: "+namespace);var dir=air.File.applicationStorageDirectory.resolvePath(this._storagePath+namespace);dir.exists&&dir.isDirectory&&dir.deleteDirectory(!0)},remove:function(key,namespace){namespace=namespace||this.DEFAULT_NAMESPACE;var file=air.File.applicationStorageDirectory.resolvePath(this._storagePath+namespace+"/"+key);file.exists&&!file.isDirectory&&file.deleteFile()},putMultiple:function(keys,values,resultsHandler,namespace){if(this.isValidKeyArray(keys)===!1||!values instanceof Array||keys.length!=values.length)throw new Error("Invalid arguments: keys = ["+keys+"], values = ["+values+"]");if(namespace==null||typeof namespace=="undefined")namespace=this.DEFAULT_NAMESPACE;if(this.isValidKey(namespace)==0)throw new Error("Invalid namespace given: "+namespace);this._statusHandler=resultsHandler;try{for(var i=0;i<keys.length;i++)this.put(keys[i],values[i],null,namespace)}catch(e){0,resultsHandler&&resultsHandler(this.FAILED,keys,e.toString(),namespace);return}resultsHandler&&resultsHandler(this.SUCCESS,keys,null,namespace)},getMultiple:function(keys,namespace){if(this.isValidKeyArray(keys)===!1)throw new Error("Invalid key array given: "+keys);if(namespace==null||typeof namespace=="undefined")namespace=this.DEFAULT_NAMESPACE;if(this.isValidKey(namespace)==0)throw new Error("Invalid namespace given: "+namespace);var results=[];for(var i=0;i<keys.length;i++)results[i]=this.get(keys[i],namespace);return results},removeMultiple:function(keys,namespace){namespace=namespace||this.DEFAULT_NAMESPACE;for(var i=0;i<keys.length;i++)this.remove(keys[i],namespace)},isPermanent:function(){return!0},getMaximumSize:function(){return this.SIZE_NO_LIMIT},hasSettingsUI:function(){return!1},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface")},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface")}}),dojox.storage.manager.register("dojox.storage.AirFileStorageProvider",new dojox.storage.AirFileStorageProvider),dojox.storage.manager.initialize()}()})