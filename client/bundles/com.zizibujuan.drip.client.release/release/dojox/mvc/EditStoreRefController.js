//>>built
define("dojox/mvc/EditStoreRefController",["dojo/_base/declare","dojo/_base/lang","dojo/when","./getPlainValue","./EditModelRefController","./StoreRefController"],function(declare,lang,when,getPlainValue,EditModelRefController,StoreRefController){return declare("dojox.mvc.EditStoreRefController",[StoreRefController,EditModelRefController],{getPlainValueOptions:null,_removals:[],_resultsWatchHandle:null,_refSourceModelProp:"sourceModel",queryStore:function(query,options){if(!(this.store||{}).query)return;this._resultsWatchHandle&&this._resultsWatchHandle.unwatch(),this._removals=[];var _self=this;return when(this.inherited(arguments),function(results){if(_self._beingDestroyed)return;return lang.isArray(results)&&(_self._resultsWatchHandle=results.watchElements(function(idx,removals,adds){[].push.apply(_self._removals,removals)})),results})},getStore:function(id,options){return this._resultsWatchHandle&&this._resultsWatchHandle.unwatch(),this.inherited(arguments)},commit:function(){if(this._removals){for(var i=0;i<this._removals.length;i++)this.store.remove(this.store.getIdentity(this._removals[i]));this._removals=[]}var data=getPlainValue(this.get(this._refEditModelProp),this.getPlainValueOptions);if(lang.isArray(data))for(var i=0;i<data.length;i++)this.store.put(data[i]);else this.store.put(data);this.inherited(arguments)},reset:function(){this.inherited(arguments),this._removals=[]},destroy:function(){this._resultsWatchHandle&&this._resultsWatchHandle.unwatch(),this.inherited(arguments)}})})