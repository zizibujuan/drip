//>>built
define("dojox/form/_SelectStackMixin",["dojo/_base/lang","dojo/_base/array","dijit/_base/manager","dojo/_base/connect","dojo/_base/declare"],function(lang,array,manager,connect,declare){return declare("dojox.form._SelectStackMixin",null,{stackId:"",stackPrefix:"",_paneIdFromOption:function(oVal){return(this.stackPrefix||"")+oVal},_optionValFromPane:function(id){var sp=this.stackPrefix;return sp&&id.indexOf(sp)===0?id.substring(sp.length):id},_togglePane:function(pane,shown){if(pane._shown!=undefined&&pane._shown==shown)return;var widgets=array.filter(pane.getDescendants(),"return item.name;");if(!shown)savedStates={},array.forEach(widgets,function(w){savedStates[w.id]=w.disabled,w.set("disabled",!0)}),pane._savedStates=savedStates;else{var savedStates=pane._savedStates||{};array.forEach(widgets,function(w){var state=savedStates[w.id];state==undefined&&(state=!1),w.set("disabled",state)}),delete pane._savedStates}pane._shown=shown},_connectTitle:function(pane,value){var fx=lang.hitch(this,function(title){this.updateOption({value:value,label:title})});pane._setTitleAttr?this.connect(pane,"_setTitleAttr",fx):this.connect(pane,"attr",function(attr,val){attr=="title"&&arguments.length>1&&fx(val)})},onAddChild:function(pane,insertIndex){if(!this._panes[pane.id]){this._panes[pane.id]=pane;var v=this._optionValFromPane(pane.id);this.addOption({value:v,label:pane.title}),this._connectTitle(pane,v)}if(!pane.onShow||!pane.onHide||pane._shown==undefined)pane.onShow=lang.hitch(this,"_togglePane",pane,!0),pane.onHide=lang.hitch(this,"_togglePane",pane,!1),pane.onHide()},_setValueAttr:function(v){if("_savedValue"in this)return;this.inherited(arguments)},attr:function(name,value){return name=="value"&&arguments.length==2&&"_savedValue"in this&&(this._savedValue=value),this.inherited(arguments)},onRemoveChild:function(pane){this._panes[pane.id]&&(delete this._panes[pane.id],this.removeOption(this._optionValFromPane(pane.id)))},onSelectChild:function(pane){this._setValueAttr(this._optionValFromPane(pane.id))},onStartup:function(info){var selPane=info.selected;this.addOption(array.filter(array.map(info.children,function(c){var v=this._optionValFromPane(c.id);this._connectTitle(c,v);var toAdd=null;this._panes[c.id]||(this._panes[c.id]=c,toAdd={value:v,label:c.title});if(!c.onShow||!c.onHide||c._shown==undefined)c.onShow=lang.hitch(this,"_togglePane",c,!0),c.onHide=lang.hitch(this,"_togglePane",c,!1),c.onHide();return"_savedValue"in this&&v===this._savedValue&&(selPane=c),toAdd},this),function(i){return i}));var _this=this,fx=function(){delete _this._savedValue,_this.onSelectChild(selPane),selPane._shown||_this._togglePane(selPane,!0)};if(selPane!==info.selected)var stack=manager.byId(this.stackId),c=this.connect(stack,"_showChild",function(sel){this.disconnect(c),fx()});else fx()},postMixInProperties:function(){this._savedValue=this.value,this.inherited(arguments),this.connect(this,"onChange","_handleSelfOnChange")},postCreate:function(){this.inherited(arguments),this._panes={},this._subscriptions=[connect.subscribe(this.stackId+"-startup",this,"onStartup"),connect.subscribe(this.stackId+"-addChild",this,"onAddChild"),connect.subscribe(this.stackId+"-removeChild",this,"onRemoveChild"),connect.subscribe(this.stackId+"-selectChild",this,"onSelectChild")];var stack=manager.byId(this.stackId);stack&&stack._started&&this.onStartup({children:stack.getChildren(),selected:stack.selectedChildWidget})},destroy:function(){array.forEach(this._subscriptions,connect.unsubscribe),delete this._panes,this.inherited("destroy",arguments)},_handleSelfOnChange:function(val){var pane=this._panes[this._paneIdFromOption(val)];if(pane){var s=manager.byId(this.stackId);pane==s.selectedChildWidget?s._transition(pane):s.selectChild(pane)}}})})