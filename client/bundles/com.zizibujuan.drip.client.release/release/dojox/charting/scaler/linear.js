//>>built
define("dojox/charting/scaler/linear",["dojo/_base/lang","./common"],function(lang,common){function findString(val,text){val=val.toLowerCase();for(var i=text.length-1;i>=0;--i)if(val===text[i])return!0;return!1}var linear=lang.getObject("dojox.charting.scaler.linear",!0),deltaLimit=3,getLabel=common.getNumericLabel,calcTicks=function(min,max,kwArgs,majorTick,minorTick,microTick,span){kwArgs=lang.delegate(kwArgs),majorTick||(kwArgs.fixUpper=="major"&&(kwArgs.fixUpper="minor"),kwArgs.fixLower=="major"&&(kwArgs.fixLower="minor")),minorTick||(kwArgs.fixUpper=="minor"&&(kwArgs.fixUpper="micro"),kwArgs.fixLower=="minor"&&(kwArgs.fixLower="micro")),microTick||(kwArgs.fixUpper=="micro"&&(kwArgs.fixUpper="none"),kwArgs.fixLower=="micro"&&(kwArgs.fixLower="none"));var lowerBound=findString(kwArgs.fixLower,["major"])?Math.floor(kwArgs.min/majorTick)*majorTick:findString(kwArgs.fixLower,["minor"])?Math.floor(kwArgs.min/minorTick)*minorTick:findString(kwArgs.fixLower,["micro"])?Math.floor(kwArgs.min/microTick)*microTick:kwArgs.min,upperBound=findString(kwArgs.fixUpper,["major"])?Math.ceil(kwArgs.max/majorTick)*majorTick:findString(kwArgs.fixUpper,["minor"])?Math.ceil(kwArgs.max/minorTick)*minorTick:findString(kwArgs.fixUpper,["micro"])?Math.ceil(kwArgs.max/microTick)*microTick:kwArgs.max;kwArgs.useMin&&(min=lowerBound),kwArgs.useMax&&(max=upperBound);var majorStart=!majorTick||kwArgs.useMin&&findString(kwArgs.fixLower,["major"])?min:Math.ceil(min/majorTick)*majorTick,minorStart=!minorTick||kwArgs.useMin&&findString(kwArgs.fixLower,["major","minor"])?min:Math.ceil(min/minorTick)*minorTick,microStart=!microTick||kwArgs.useMin&&findString(kwArgs.fixLower,["major","minor","micro"])?min:Math.ceil(min/microTick)*microTick,majorCount=majorTick?(kwArgs.useMax&&findString(kwArgs.fixUpper,["major"])?Math.round((max-majorStart)/majorTick):Math.floor((max-majorStart)/majorTick))+1:0,minorCount=minorTick?(kwArgs.useMax&&findString(kwArgs.fixUpper,["major","minor"])?Math.round((max-minorStart)/minorTick):Math.floor((max-minorStart)/minorTick))+1:0,microCount=microTick?(kwArgs.useMax&&findString(kwArgs.fixUpper,["major","minor","micro"])?Math.round((max-microStart)/microTick):Math.floor((max-microStart)/microTick))+1:0,minorPerMajor=minorTick?Math.round(majorTick/minorTick):0,microPerMinor=microTick?Math.round(minorTick/microTick):0,majorPrecision=majorTick?Math.floor(Math.log(majorTick)/Math.LN10):0,minorPrecision=minorTick?Math.floor(Math.log(minorTick)/Math.LN10):0,scale=span/(max-min);return isFinite(scale)||(scale=1),{bounds:{lower:lowerBound,upper:upperBound,from:min,to:max,scale:scale,span:span},major:{tick:majorTick,start:majorStart,count:majorCount,prec:majorPrecision},minor:{tick:minorTick,start:minorStart,count:minorCount,prec:minorPrecision},micro:{tick:microTick,start:microStart,count:microCount,prec:0},minorPerMajor:minorPerMajor,microPerMinor:microPerMinor,scaler:linear}};return lang.mixin(linear,{buildScaler:function(min,max,span,kwArgs,delta,minorDelta){var h={fixUpper:"none",fixLower:"none",natural:!1};kwArgs&&("fixUpper"in kwArgs&&(h.fixUpper=String(kwArgs.fixUpper)),"fixLower"in kwArgs&&(h.fixLower=String(kwArgs.fixLower)),"natural"in kwArgs&&(h.natural=Boolean(kwArgs.natural))),minorDelta=!minorDelta||minorDelta<deltaLimit?deltaLimit:minorDelta,"min"in kwArgs&&(min=kwArgs.min),"max"in kwArgs&&(max=kwArgs.max),kwArgs.includeZero&&(min>0&&(min=0),max<0&&(max=0)),h.min=min,h.useMin=!0,h.max=max,h.useMax=!0,"from"in kwArgs&&(min=kwArgs.from,h.useMin=!1),"to"in kwArgs&&(max=kwArgs.to,h.useMax=!1);if(max<=min)return calcTicks(min,max,h,0,0,0,span);delta||(delta=max-min);var mag=Math.floor(Math.log(delta)/Math.LN10),major=kwArgs&&"majorTickStep"in kwArgs?kwArgs.majorTickStep:Math.pow(10,mag),minor=0,micro=0,ticks;if(kwArgs&&"minorTickStep"in kwArgs)minor=kwArgs.minorTickStep;else do{minor=major/10;if(!h.natural||minor>.9){ticks=calcTicks(min,max,h,major,minor,0,span);if(ticks.bounds.scale*ticks.minor.tick>minorDelta)break}minor=major/5;if(!h.natural||minor>.9){ticks=calcTicks(min,max,h,major,minor,0,span);if(ticks.bounds.scale*ticks.minor.tick>minorDelta)break}minor=major/2;if(!h.natural||minor>.9){ticks=calcTicks(min,max,h,major,minor,0,span);if(ticks.bounds.scale*ticks.minor.tick>minorDelta)break}return calcTicks(min,max,h,major,0,0,span)}while(!1);if(kwArgs&&"microTickStep"in kwArgs)micro=kwArgs.microTickStep,ticks=calcTicks(min,max,h,major,minor,micro,span);else do{micro=minor/10;if(!h.natural||micro>.9){ticks=calcTicks(min,max,h,major,minor,micro,span);if(ticks.bounds.scale*ticks.micro.tick>deltaLimit)break}micro=minor/5;if(!h.natural||micro>.9){ticks=calcTicks(min,max,h,major,minor,micro,span);if(ticks.bounds.scale*ticks.micro.tick>deltaLimit)break}micro=minor/2;if(!h.natural||micro>.9){ticks=calcTicks(min,max,h,major,minor,micro,span);if(ticks.bounds.scale*ticks.micro.tick>deltaLimit)break}micro=0}while(!1);return micro?ticks:calcTicks(min,max,h,major,minor,0,span)},buildTicks:function(scaler,kwArgs){var step,next,tick,nextMajor=scaler.major.start,nextMinor=scaler.minor.start,nextMicro=scaler.micro.start;if(kwArgs.microTicks&&scaler.micro.tick)step=scaler.micro.tick,next=nextMicro;else if(kwArgs.minorTicks&&scaler.minor.tick)step=scaler.minor.tick,next=nextMinor;else{if(!scaler.major.tick)return null;step=scaler.major.tick,next=nextMajor}var revScale=1/scaler.bounds.scale;if(scaler.bounds.to<=scaler.bounds.from||isNaN(revScale)||!isFinite(revScale)||step<=0||isNaN(step)||!isFinite(step))return null;var majorTicks=[],minorTicks=[],microTicks=[];while(next<=scaler.bounds.to+revScale)Math.abs(nextMajor-next)<step/2?(tick={value:nextMajor},kwArgs.majorLabels&&(tick.label=getLabel(nextMajor,scaler.major.prec,kwArgs)),majorTicks.push(tick),nextMajor+=scaler.major.tick,nextMinor+=scaler.minor.tick,nextMicro+=scaler.micro.tick):Math.abs(nextMinor-next)<step/2?(kwArgs.minorTicks&&(tick={value:nextMinor},kwArgs.minorLabels&&scaler.minMinorStep<=scaler.minor.tick*scaler.bounds.scale&&(tick.label=getLabel(nextMinor,scaler.minor.prec,kwArgs)),minorTicks.push(tick)),nextMinor+=scaler.minor.tick,nextMicro+=scaler.micro.tick):(kwArgs.microTicks&&microTicks.push({value:nextMicro}),nextMicro+=scaler.micro.tick),next+=step;return{major:majorTicks,minor:minorTicks,micro:microTicks}},getTransformerFromModel:function(scaler){var offset=scaler.bounds.from,scale=scaler.bounds.scale;return function(x){return(x-offset)*scale}},getTransformerFromPlot:function(scaler){var offset=scaler.bounds.from,scale=scaler.bounds.scale;return function(x){return x/scale+offset}}})})