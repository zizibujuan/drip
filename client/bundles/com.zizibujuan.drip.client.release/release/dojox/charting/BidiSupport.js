//>>built
define("dojox/charting/BidiSupport",["../main","dojo/_base/lang","dojo/dom-style","dojo/_base/array","dojo/sniff","dojo/dom","dojo/dom-construct","dojox/gfx","dojox/gfx/_gfxBidiSupport","./Chart","./axis2d/common","dojox/string/BidiEngine","dojox/lang/functional","dojo/dom-attr","./_bidiutils"],function(dojox,lang,domStyle,arr,has,dom,domConstruct,g,gBidi,Chart,da,BidiEngine,df,domAttr,utils){function htmlCreateText(r,agumentsArr){agumentsArr[0].htmlElementsRegistry.push([r,agumentsArr[2],agumentsArr[3],agumentsArr[4],agumentsArr[5],agumentsArr[6],agumentsArr[7]])}function validateTextDir(textDir){return/^(ltr|rtl|auto)$/.test(textDir)?textDir:null}var bidiEngine=new BidiEngine,dc=lang.getObject("charting",!0,dojox);lang.extend(Chart,{textDir:"",dir:"",getTextDir:function(text){var textDir=this.textDir=="auto"?bidiEngine.checkContextual(text):this.textDir;return textDir||(textDir=domStyle.get(this.node,"direction")),textDir},postscript:function(node,args){var textDir=args?args.textDir?validateTextDir(args.textDir):"":"";textDir=textDir?textDir:domStyle.get(this.node,"direction"),this.textDir=textDir,this.surface.textDir=textDir,this.htmlElementsRegistry=[],this.truncatedLabelsRegistry=[];var chartDir="ltr";domAttr.has(node,"direction")&&(chartDir=domAttr.get(node,"direction")),this.dir=args?args.dir?args.dir:chartDir:chartDir},setTextDir:function(newTextDir,obj){if(newTextDir==this.textDir)return this;if(validateTextDir(newTextDir)!=null){this.textDir=newTextDir,this.surface.setTextDir(newTextDir),this.truncatedLabelsRegistry&&newTextDir=="auto"&&arr.forEach(this.truncatedLabelsRegistry,function(elem){var tDir=this.getTextDir(elem.label);elem["element"].textDir!=tDir&&elem.element.setShape({textDir:tDir})},this);var axesKeyArr=df.keys(this.axes);if(axesKeyArr.length>0){arr.forEach(axesKeyArr,function(key,index,arr){var axis=this.axes[key];axis.htmlElements[0]&&(axis.dirty=!0,axis.render(this.dim,this.offsets))},this);if(this.title){var forceHtmlLabels=g.renderer=="canvas",labelType=forceHtmlLabels||!has("ie")&&!has("opera")?"html":"gfx",tsize=g.normalizedLength(g.splitFontString(this.titleFont).size);domConstruct.destroy(this.chartTitle),this.chartTitle=null,this.chartTitle=da.createText[labelType](this,this.surface,this.dim.width/2,this.titlePos=="top"?tsize+this.margins.t:this.dim.height-this.margins.b,"middle",this.title,this.titleFont,this.titleFontColor)}}else arr.forEach(this.htmlElementsRegistry,function(elem,index,arr){var tDir=newTextDir=="auto"?this.getTextDir(elem[4]):newTextDir;elem[0].children[0]&&elem[0].children[0].dir!=tDir&&(dom.destroy(elem[0].children[0]),elem[0].children[0]=da.createText.html(this,this.surface,elem[1],elem[2],elem[3],elem[4],elem[5],elem[6]).children[0])},this)}},setDir:function(dir){if(dir=="rtl"||dir=="ltr")this.dir=dir;return this},isRightToLeft:function(){return this.dir=="rtl"},applyMirroring:function(plot,dim,offsets){return this.isRightToLeft()&&utils.reverseMatrix(plot,dim,offsets),domStyle.set(this.node,"direction","ltr"),this},truncateBidi:function(elem,label,labelType){labelType=="gfx"&&(this.truncatedLabelsRegistry.push({element:elem,label:label}),this.textDir=="auto"&&elem.setShape({textDir:this.getTextDir(label)})),labelType=="html"&&this.textDir=="auto"&&(elem.children[0].dir=this.getTextDir(label))}});var extendMethod=function(obj,method,bundleByPrototype,before,after){var old;bundleByPrototype?(old=obj.prototype[method],obj.prototype[method]=function(){var rBefore;before&&(rBefore=before.apply(this,arguments));var r=old.apply(this,rBefore);return after&&(r=after.call(this,r,arguments)),r}):(old=lang.clone(obj[method]),obj[method]=function(){var rBefore;before&&(rBefore=before.apply(this,arguments));var r=old.apply(this,arguments);return after&&after(r,arguments),r})},labelPreprocess=function(elem,chart,label,truncatedLabel,font,elemType){var isChartDirectionRtl=domStyle.get(chart.node,"direction")=="rtl",isBaseTextDirRtl=chart.getTextDir(label)=="rtl";return isBaseTextDirRtl&&!isChartDirectionRtl&&(label="<span dir='rtl'>"+label+"</span>"),!isBaseTextDirRtl&&isChartDirectionRtl&&(label="<span dir='ltr'>"+label+"</span>"),arguments};return dc.axis2d&&dc.axis2d.Default&&extendMethod(dc.axis2d.Default,"labelTooltip",!0,labelPreprocess,null),extendMethod(da.createText,"html",!1,null,htmlCreateText),Chart})