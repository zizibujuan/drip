//>>built
define("dojox/charting/widget/Chart",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/dom-attr","dojo/_base/declare","dojo/query","dijit/_WidgetBase","../Chart","dojox/lang/utils","dojox/lang/functional","dojox/lang/functional/lambda"],function(kernel,lang,arr,domAttr,declare,query,_WidgetBase,Chart,du,df,dfl){var collectParams,collectAxisParams,collectPlotParams,collectActionParams,collectDataParams,notNull=function(o){return o},dc=lang.getObject("dojox.charting");return collectParams=function(node,type,kw){var dp=eval("("+type+".prototype.defaultParams)"),x,attr;for(x in dp){if(x in kw)continue;attr=node.getAttribute(x),kw[x]=du.coerceType(dp[x],attr==null||typeof attr=="undefined"?dp[x]:attr)}var op=eval("("+type+".prototype.optionalParams)");for(x in op){if(x in kw)continue;attr=node.getAttribute(x),attr!=null&&(kw[x]=du.coerceType(op[x],attr))}},collectAxisParams=function(node){var name=node.getAttribute("name"),type=node.getAttribute("type");if(!name)return null;var o={name:name,kwArgs:{}},kw=o.kwArgs;if(type){dc.axis2d[type]&&(type=kernel._scopeName+"x.charting.axis2d."+type);var axis=eval("("+type+")");axis&&(kw.type=axis)}else type=kernel._scopeName+"x.charting.axis2d.Default";collectParams(node,type,kw);if(kw.font||kw.fontColor)kw.tick||(kw.tick={}),kw.font&&(kw.tick.font=kw.font),kw.fontColor&&(kw.tick.fontColor=kw.fontColor);return o},collectPlotParams=function(node){var name=node.getAttribute("name"),type=node.getAttribute("type");if(!name)return null;var o={name:name,kwArgs:{}},kw=o.kwArgs;if(type){dc.plot2d&&dc.plot2d[type]&&(type=kernel._scopeName+"x.charting.plot2d."+type);var plot=eval("("+type+")");plot&&(kw.type=plot)}else type=kernel._scopeName+"x.charting.plot2d.Default";collectParams(node,type,kw);var dp=eval("("+type+".prototype.baseParams)"),x,attr;for(x in dp){if(x in kw)continue;attr=node.getAttribute(x),kw[x]=du.coerceType(dp[x],attr==null||typeof attr=="undefined"?dp[x]:attr)}return o},collectActionParams=function(node){var plot=node.getAttribute("plot"),type=node.getAttribute("type");plot||(plot="default");var o={plot:plot,kwArgs:{}},kw=o.kwArgs;if(!type)return null;dc.action2d[type]&&(type=kernel._scopeName+"x.charting.action2d."+type);var action=eval("("+type+")");return action?(o.action=action,collectParams(node,type,kw),o):null},collectDataParams=function(node){var ga=lang.partial(domAttr.get,node),name=ga("name");if(!name)return null;var o={name:name,kwArgs:{}},kw=o.kwArgs,t;return t=ga("plot"),t!=null&&(kw.plot=t),t=ga("marker"),t!=null&&(kw.marker=t),t=ga("stroke"),t!=null&&(kw.stroke=eval("("+t+")")),t=ga("outline"),t!=null&&(kw.outline=eval("("+t+")")),t=ga("shadow"),t!=null&&(kw.shadow=eval("("+t+")")),t=ga("fill"),t!=null&&(kw.fill=eval("("+t+")")),t=ga("font"),t!=null&&(kw.font=t),t=ga("fontColor"),t!=null&&(kw.fontColor=eval("("+t+")")),t=ga("legend"),t!=null&&(kw.legend=t),t=ga("data"),t!=null?(o.type="data",o.data=t?arr.map(String(t).split(","),Number):[],o):(t=ga("array"),t!=null?(o.type="data",o.data=eval("("+t+")"),o):(t=ga("store"),t!=null?(o.type="store",o.data=eval("("+t+")"),t=ga("field"),o.field=t!=null?t:"value",t=ga("query"),!t||(kw.query=t),t=ga("queryOptions"),!t||(kw.queryOptions=eval("("+t+")")),t=ga("start"),!t||(kw.start=Number(t)),t=ga("count"),!t||(kw.count=Number(t)),t=ga("sort"),!t||(kw.sort=eval("("+t+")")),t=ga("valueFn"),!t||(kw.valueFn=dfl.lambda(t)),o):null))},declare("dojox.charting.widget.Chart",_WidgetBase,{theme:null,margins:null,stroke:undefined,fill:undefined,buildRendering:function(){this.inherited(arguments);var n=this.domNode,axes=query("> .axis",n).map(collectAxisParams).filter(notNull),plots=query("> .plot",n).map(collectPlotParams).filter(notNull),actions=query("> .action",n).map(collectActionParams).filter(notNull),series=query("> .series",n).map(collectDataParams).filter(notNull);n.innerHTML="";var c=this.chart=new Chart(n,{margins:this.margins,stroke:this.stroke,fill:this.fill,textDir:this.textDir});this.theme&&c.setTheme(this.theme),axes.forEach(function(axis){c.addAxis(axis.name,axis.kwArgs)}),plots.forEach(function(plot){c.addPlot(plot.name,plot.kwArgs)}),this.actions=actions.map(function(action){return new action.action(c,action.plot,action.kwArgs)});var render=df.foldl(series,function(render,series){if(series.type=="data")c.addSeries(series.name,series.data,series.kwArgs),render=!0;else{c.addSeries(series.name,[0],series.kwArgs);var kw={};du.updateWithPattern(kw,series.kwArgs,{query:"",queryOptions:null,start:0,count:1},!0),series.kwArgs.sort&&(kw.sort=lang.clone(series.kwArgs.sort)),lang.mixin(kw,{onComplete:function(data){var values;if("valueFn"in series.kwArgs){var fn=series.kwArgs.valueFn;values=arr.map(data,function(x){return fn(series.data.getValue(x,series.field,0))})}else values=arr.map(data,function(x){return series.data.getValue(x,series.field,0)});c.addSeries(series.name,values,series.kwArgs).render()}}),series.data.fetch(kw)}return render},!1);render&&c.render()},destroy:function(){this.chart.destroy(),this.inherited(arguments)},resize:function(box){this.chart.resize(box)}})})