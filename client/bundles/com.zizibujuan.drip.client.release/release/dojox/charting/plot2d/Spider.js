//>>built
define("dojox/charting/plot2d/Spider","dojo/_base/lang,dojo/_base/declare,dojo/_base/connect,dojo/_base/array,dojo/dom-geometry,dojo/_base/fx,dojo/fx,dojo/sniff,./Base,./_PlotEvents,./common,../axis2d/common,dojox/gfx,dojox/gfx/matrix,dojox/gfx/fx,dojox/lang/functional,dojox/lang/utils,dojo/fx/easing".split(","),function(F,R,G,H,M,I,S,T,U,V,N,O,y,W,Z,P,Q,X){return R("dojox.charting.plot2d.Spider",[U,V],{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:-10,labelStyle:"default",htmlLabels:!0,
startAngle:-90,divisions:3,axisColor:"",axisWidth:0,spiderColor:"",spiderWidth:0,seriesWidth:0,seriesFillAlpha:0.2,spiderOrigin:0.16,markerSize:3,spiderType:"polygon",animationType:X.backOut,axisTickFont:"",axisTickFontColor:"",axisFont:"",axisFontColor:""},optionalParams:{radius:0,font:"",fontColor:""},constructor:function(a,b){this.opt=F.clone(this.defaultParams);Q.updateWithObject(this.opt,b);Q.updateWithPattern(this.opt,b,this.optionalParams);this.dyn=[];this.datas={};this.labelKey=[];this.oldSeriePoints=
{};this.animations={}},clear:function(){this.inherited(arguments);this.dyn=[];this.axes=[];this.datas={};this.labelKey=[];this.oldSeriePoints={};this.animations={};return this},setAxis:function(a){if(a){if(void 0!=a.opt.min)this.datas[a.name].min=a.opt.min;if(void 0!=a.opt.max)this.datas[a.name].max=a.opt.max}return this},addSeries:function(a){this.series.push(a);for(var b in a.data){var e=a.data[b],h=this.datas[b];h?(h.vlist.push(e),h.min=Math.min(h.min,e),h.max=Math.max(h.max,e)):(h="__"+b,this.axes.push(h),
this[h]=b,this.datas[b]={min:e,max:e,vlist:[e]})}if(0>=this.labelKey.length)for(b in a.data)this.labelKey.push(b);return this},getSeriesStats:function(){return N.collectSimpleStats(this.series)},render:function(a,b){if(!this.dirty)return this;this.dirty=!1;this.cleanGroup();var e=this.group,h=this.chart.theme;this.resetEvents();if(!this.series||!this.series.length)return this;var d=this.opt,f=h.axis,c=(a.width-b.l-b.r)/2,i=(a.height-b.t-b.b)/2,j=Math.min(c,i),p=d.font||f.majorTick&&f.majorTick.font||
f.tick&&f.tick.font||"normal normal normal 7pt Tahoma",n=d.axisFont||f.tick&&f.tick.titleFont||"normal normal normal 11pt Tahoma",s=d.axisTickFontColor||f.majorTick&&f.majorTick.fontColor||f.tick&&f.tick.fontColor||"silver",B=d.axisFontColor||f.tick&&f.tick.titleFontColor||"black",u=d.axisColor||f.tick&&f.tick.axisColor||"silver",k=d.spiderColor||f.tick&&f.tick.spiderColor||"silver",Y=d.axisWidth||f.stroke&&f.stroke.width||2,v=d.spiderWidth||f.stroke&&f.stroke.width||2,f=d.seriesWidth||f.stroke&&
f.stroke.width||2,o=y.normalizedLength(y.splitFontString(n).size),A=W._degToRad(d.startAngle),K,q,J,r,m,w,t=d.spiderOrigin,z=3<=d.divisions?d.divisions:3,F=d.markerSize,G=d.spiderType,I=d.animationType,g=-10>d.labelOffset?d.labelOffset:-10,l;d.labels&&(j=H.map(this.series,function(a){return a.name},this),j=P.foldl1(P.map(j,function(a){return y._base._getTextBox(a,{font:h.series.font}).w},this),"Math.max(a, b)")/2,j=Math.min(c-2*j,i-o)+g,K=j-g);if("radius"in d)j=d.radius,K=j-g;j/=1.2;c={cx:b.l+c,cy:b.t+
i,r:j};for(i=this.series.length-1;0<=i;i--)if(l=this.series[i],!this.dirty&&!l.dirty)h.skip();else if(l.cleanGroup(),g=l.data,null!==g&&(o=this._getObjectLength(g),!q||0>=q.length))if(q=[],J=[],w=[],this._buildPoints(q,o,c,j,A,!0),this._buildPoints(J,o,c,j*t,A,!0),this._buildPoints(w,o,c,K,A),2<z){r=[];m=[];for(g=0;g<z-2;g++)r[g]=[],this._buildPoints(r[g],o,c,j*(t+(1-t)*(g+1)/(z-1)),A,!0),m[g]=j*(t+(1-t)*(g+1)/(z-1))}o=e.createGroup();u={color:u,width:Y};i={color:k,width:v};for(g=q.length-1;0<=g;--g)k=
q[g],v={x:k.x+0.2*(k.x-c.cx),y:k.y+0.2*(k.y-c.cy)},k={x:k.x+0.2*(k.x-c.cx)/2,y:k.y+0.2*(k.y-c.cy)/2},o.createLine({x1:c.cx,y1:c.cy,x2:v.x,y2:v.y}).setStroke(u),this._drawArrow(o,v,k,u);o=e.createGroup();for(g=w.length-1;0<=g;--g)k=w[g],v=y._base._getTextBox(this.labelKey[g],{font:n}).w||0,u=this.opt.htmlLabels&&"vml"!=y.renderer?"html":"gfx",k=O.createText[u](this.chart,o,!M.isBodyLtr()&&"html"==u?k.x+v-a.width:k.x,k.y,"middle",this.labelKey[g],n,B),this.opt.htmlLabels&&this.htmlElements.push(k);
n=e.createGroup();if("polygon"==G){if(n.createPolyline(q).setStroke(i),n.createPolyline(J).setStroke(i),0<r.length)for(g=r.length-1;0<=g;--g)n.createPolyline(r[g]).setStroke(i)}else if(n.createCircle({cx:c.cx,cy:c.cy,r:j}).setStroke(i),n.createCircle({cx:c.cx,cy:c.cy,r:j*t}).setStroke(i),0<m.length)for(g=m.length-1;0<=g;--g)n.createCircle({cx:c.cx,cy:c.cy,r:m[g]}).setStroke(i);o=this._getObjectLength(this.datas);n=e.createGroup();r=0;for(var C in this.datas){m=this.datas[C];q=m.min;m=m.max;m-=q;B=
A+2*Math.PI*r/o;for(i=0;i<z;i++)w=q+m*i/(z-1),k=this._getCoordinate(c,j*(t+(1-t)*i/(z-1)),B),w=this._getLabel(w),v=y._base._getTextBox(w,{font:p}).w||0,u=this.opt.htmlLabels&&"vml"!=y.renderer?"html":"gfx",this.opt.htmlLabels&&this.htmlElements.push(O.createText[u](this.chart,n,!M.isBodyLtr()&&"html"==u?k.x+v-a.width:k.x,k.y,"start",w,p,s));r++}this.chart.seriesShapes={};for(i=this.series.length-1;0<=i;i--)if(l=this.series[i],g=l.data,null!==g){var x=[],D=[];r=0;for(C in g)m=this.datas[C],q=m.min,
m=m.max,m-=q,p=g[C],B=A+2*Math.PI*r/o,k=this._getCoordinate(c,j*(t+(1-t)*(p-q)/m),B),x.push(k),D.push({sname:l.name,key:C,data:p}),r++;x[x.length]=x[0];D[D.length]=D[0];var p=this._getBoundary(x),s=h.next("spider",[d,l]),L=l.group,E=y.normalizeColor(s.series.fill),s={color:s.series.fill,width:f};E.a=d.seriesFillAlpha;l.dyn={fill:E,stroke:s};s=this._createSeriesEntry(L,this.oldSeriePoints[l.name]||J,x,E,s,j,t,F,I);this.chart.seriesShapes[l.name]=s;this.oldSeriePoints[l.name]=x;this._connectEvents({element:"spider_poly",
index:i,id:"spider_poly_"+l.name,run:l,plot:this,shape:s.poly,parent:L,brect:p,cx:c.cx,cy:c.cy,cr:j,f:E,s:e});this._connectEvents({element:"spider_plot",index:i,id:"spider_plot_"+l.name,run:l,plot:this,shape:l.group});H.forEach(s.circles,function(a,b){this._connectEvents({element:"spider_circle",index:b,id:"spider_circle_"+l.name+b,run:l,plot:this,shape:a,parent:L,tdata:D[b],cx:x[b].x,cy:x[b].y,f:E,s:e})},this)}return this},_createSeriesEntry:function(a,b,e,h,d,f,c,i,j){for(var p=a.createPolyline(b).setFill(h).setStroke(d),
n=[],f=0;f<b.length;f++)c=b[f],c=a.createCircle({cx:c.x,cy:c.y,r:i}).setFill(h).setStroke(d),n.push(c);h=H.map(e,function(a,c){var d=new I.Animation({duration:1E3,easing:j,curve:[b[c].y,a.y]}),e=n[c];G.connect(d,"onAnimate",function(a){var b=p.getShape();b.points[c].y=a;p.setShape(b);b=e.getShape();b.cy=a;e.setShape(b)});return d});e=H.map(e,function(a,c){var d=new I.Animation({duration:1E3,easing:j,curve:[b[c].x,a.x]}),e=n[c];G.connect(d,"onAnimate",function(a){var b=p.getShape();b.points[c].x=a;
p.setShape(b);b=e.getShape();b.cx=a;e.setShape(b)});return d});S.combine(h.concat(e)).play();return{group:a,poly:p,circles:n}},plotEvent:function(a){"spider_plot"==a.element&&"onmouseover"==a.type&&!T("ie")&&a.shape.moveToFront()},tooltipFunc:function(a){return"spider_circle"==a.element?a.tdata.sname+"<br/>"+a.tdata.key+"<br/>"+a.tdata.data:null},_getBoundary:function(a){for(var b=a[0].x,e=a[0].x,h=a[0].y,d=a[0].y,f=0;f<a.length;f++)var c=a[f],b=Math.max(c.x,b),h=Math.max(c.y,h),e=Math.min(c.x,e),
d=Math.min(c.y,d);return{x:e,y:d,width:b-e,height:h-d}},_drawArrow:function(a,b,e,h){var d=Math.sqrt(Math.pow(e.x-b.x,2)+Math.pow(e.y-b.y,2)),f=(e.y-b.y)/d,c=(e.x-b.x)/d;a.createPolyline([b,{x:e.x+d/3*-f,y:e.y+d/3*c},{x:e.x+d/3*f,y:e.y+d/3*-c}]).setFill(h.color).setStroke(h)},_buildPoints:function(a,b,e,h,d,f){for(var c=0;c<b;c++)a.push(this._getCoordinate(e,h,d+2*Math.PI*c/b));f&&a.push(this._getCoordinate(e,h,d+2*Math.PI))},_getCoordinate:function(a,b,e){return{x:a.cx+b*Math.cos(e),y:a.cy+b*Math.sin(e)}},
_getObjectLength:function(a){var b=0;if(F.isObject(a))for(var e in a)b++;return b},_getLabel:function(a){return N.getLabel(a,this.opt.fixed,this.opt.precision)}})});