//>>built
define("dojox/charting/plot2d/Default",["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","./CartesianBase","./_PlotEvents","./common","dojox/lang/functional","dojox/lang/functional/reversed","dojox/lang/utils","dojox/gfx/fx"],function(lang,declare,arr,CartesianBase,_PlotEvents,dc,df,dfr,du,fx){var purgeGroup=dfr.lambda("item.purgeGroup()"),DEFAULT_ANIMATION_LENGTH=1200;return declare("dojox.charting.plot2d.Default",[CartesianBase,_PlotEvents],{defaultParams:{lines:!0,areas:!1,markers:!1,tension:"",animate:!1,enableCache:!1,interpolate:!1},optionalParams:{stroke:{},outline:{},shadow:{},fill:{},styleFunc:null,font:"",fontColor:"",marker:"",markerStroke:{},markerOutline:{},markerShadow:{},markerFill:{},markerFont:"",markerFontColor:""},constructor:function(chart,kwArgs){this.opt=lang.clone(lang.mixin(this.opt,this.defaultParams)),du.updateWithObject(this.opt,kwArgs),du.updateWithPattern(this.opt,kwArgs,this.optionalParams),this.animate=this.opt.animate},createPath:function(run,creator,params){var path;return this.opt.enableCache&&run._pathFreePool.length>0?(path=run._pathFreePool.pop(),path.setShape(params),creator.add(path)):path=creator.createPath(params),this.opt.enableCache&&run._pathUsePool.push(path),path},buildSegments:function(i,indexed){var run=this.series[i],min=indexed?Math.max(0,Math.floor(this._hScaler.bounds.from-1)):0,max=indexed?Math.min(run.data.length,Math.ceil(this._hScaler.bounds.to)):run.data.length,rseg=null,segments=[];for(var j=min;j<max;j++)if(run.data[j]==null||!indexed&&run.data[j].y==null){if(!this.opt.interpolate||indexed)rseg=null}else rseg||(rseg=[],segments.push({index:j,rseg:rseg})),rseg.push(indexed&&run.data[j].hasOwnProperty("y")?run.data[j].y:run.data[j]);return segments},render:function(dim,offsets){if(this.zoom&&!this.isDataDirty())return this.performZoom(dim,offsets);this.resetEvents(),this.dirty=this.isDirty();var s;this.dirty&&(arr.forEach(this.series,purgeGroup),this._eventSeries={},this.cleanGroup(),this.getGroup().setTransform(null),s=this.getGroup(),df.forEachRev(this.series,function(item){item.cleanGroup(s)}));var t=this.chart.theme,stroke,outline,events=this.events();for(var i=this.series.length-1;i>=0;--i){var run=this.series[i];if(!this.dirty&&!run.dirty){t.skip(),this._reconnectEvents(run.name);continue}run.cleanGroup(),this.opt.enableCache&&(run._pathFreePool=(run._pathFreePool?run._pathFreePool:[]).concat(run._pathUsePool?run._pathUsePool:[]),run._pathUsePool=[]);if(!run.data.length){run.dirty=!1,t.skip();continue}var theme=t.next(this.opt.areas?"area":"line",[this.opt,run],!0),lpoly,ht=this._hScaler.scaler.getTransformerFromModel(this._hScaler),vt=this._vScaler.scaler.getTransformerFromModel(this._vScaler),eventSeries=this._eventSeries[run.name]=new Array(run.data.length);s=run.group;var indexed=arr.some(run.data,function(item){return typeof item=="number"||item&&!item.hasOwnProperty("x")}),rsegments=this.buildSegments(i,indexed);for(var seg=0;seg<rsegments.length;seg++){var rsegment=rsegments[seg];indexed?lpoly=arr.map(rsegment.rseg,function(v,i){return{x:ht(i+rsegment.index+1)+offsets.l,y:dim.height-offsets.b-vt(v),data:v}},this):lpoly=arr.map(rsegment.rseg,function(v){return{x:ht(v.x)+offsets.l,y:dim.height-offsets.b-vt(v.y),data:v}},this);if(indexed&&this.opt.interpolate)while(seg<rsegments.length)seg++,rsegment=rsegments[seg],rsegment&&(lpoly=lpoly.concat(arr.map(rsegment.rseg,function(v,i){return{x:ht(i+rsegment.index+1)+offsets.l,y:dim.height-offsets.b-vt(v),data:v}},this)));var lpath=this.opt.tension?dc.curve(lpoly,this.opt.tension):"";if(this.opt.areas&&lpoly.length>1){var fill=this._plotFill(theme.series.fill,dim,offsets),apoly=lang.clone(lpoly);if(this.opt.tension){var apath="L"+apoly[apoly.length-1].x+","+(dim.height-offsets.b)+" L"+apoly[0].x+","+(dim.height-offsets.b)+" L"+apoly[0].x+","+apoly[0].y;run.dyn.fill=s.createPath(lpath+" "+apath).setFill(fill).getFill()}else apoly.push({x:lpoly[lpoly.length-1].x,y:dim.height-offsets.b}),apoly.push({x:lpoly[0].x,y:dim.height-offsets.b}),apoly.push(lpoly[0]),run.dyn.fill=s.createPolyline(apoly).setFill(fill).getFill()}if(this.opt.lines||this.opt.markers)stroke=theme.series.stroke,theme.series.outline&&(outline=run.dyn.outline=dc.makeStroke(theme.series.outline),outline.width=2*outline.width+stroke.width);this.opt.markers&&(run.dyn.marker=theme.symbol);var frontMarkers=null,outlineMarkers=null,shadowMarkers=null;if(stroke&&theme.series.shadow&&lpoly.length>1){var shadow=theme.series.shadow,spoly=arr.map(lpoly,function(c){return{x:c.x+shadow.dx,y:c.y+shadow.dy}});this.opt.lines&&(this.opt.tension?run.dyn.shadow=s.createPath(dc.curve(spoly,this.opt.tension)).setStroke(shadow).getStroke():run.dyn.shadow=s.createPolyline(spoly).setStroke(shadow).getStroke()),this.opt.markers&&theme.marker.shadow&&(shadow=theme.marker.shadow,shadowMarkers=arr.map(spoly,function(c){return this.createPath(run,s,"M"+c.x+" "+c.y+" "+theme.symbol).setStroke(shadow).setFill(shadow.color)},this))}this.opt.lines&&lpoly.length>1&&(outline&&(this.opt.tension?run.dyn.outline=s.createPath(lpath).setStroke(outline).getStroke():run.dyn.outline=s.createPolyline(lpoly).setStroke(outline).getStroke()),this.opt.tension?run.dyn.stroke=s.createPath(lpath).setStroke(stroke).getStroke():run.dyn.stroke=s.createPolyline(lpoly).setStroke(stroke).getStroke());var markerBox=null;if(this.opt.markers){var markerTheme=theme;frontMarkers=new Array(lpoly.length),outlineMarkers=new Array(lpoly.length),outline=null,markerTheme.marker.outline&&(outline=dc.makeStroke(markerTheme.marker.outline),outline.width=2*outline.width+(markerTheme.marker.stroke?markerTheme.marker.stroke.width:0)),arr.forEach(lpoly,function(c,i){if(this.opt.styleFunc||typeof c.data!="number"){var tMixin=typeof c.data!="number"?[c.data]:[];this.opt.styleFunc&&tMixin.push(this.opt.styleFunc(c.data)),markerTheme=t.addMixin(theme,"marker",tMixin,!0)}else markerTheme=t.post(theme,"marker");var path="M"+c.x+" "+c.y+" "+markerTheme.symbol;outline&&(outlineMarkers[i]=this.createPath(run,s,path).setStroke(outline)),frontMarkers[i]=this.createPath(run,s,path).setStroke(markerTheme.marker.stroke).setFill(markerTheme.marker.fill)},this),run.dyn.markerFill=markerTheme.marker.fill,run.dyn.markerStroke=markerTheme.marker.stroke,!markerBox&&this.opt.labels&&(markerBox=frontMarkers[0].getBoundingBox()),events?arr.forEach(frontMarkers,function(s,i){var o={element:"marker",index:i+rsegment.index,run:run,shape:s,outline:outlineMarkers[i]||null,shadow:shadowMarkers&&shadowMarkers[i]||null,cx:lpoly[i].x,cy:lpoly[i].y};indexed?(o.x=i+rsegment.index+1,o.y=run.data[i+rsegment.index]):(o.x=rsegment.rseg[i].x,o.y=run.data[i+rsegment.index].y),this._connectEvents(o),eventSeries[i+rsegment.index]=o},this):delete this._eventSeries[run.name]}if(this.opt.labels){var labelBoxW=markerBox?markerBox.width:2,labelBoxH=markerBox?markerBox.height:2;arr.forEach(lpoly,function(c,i){if(this.opt.styleFunc||typeof c.data!="number"){var tMixin=typeof c.data!="number"?[c.data]:[];this.opt.styleFunc&&tMixin.push(this.opt.styleFunc(c.data)),markerTheme=t.addMixin(theme,"marker",tMixin,!0)}else markerTheme=t.post(theme,"marker");this.createLabel(s,rsegment.rseg[i],{x:c.x-labelBoxW/2,y:c.y-labelBoxH/2,width:labelBoxW,height:labelBoxH},markerTheme)},this)}}run.dirty=!1}this.chart.isRightToLeft&&this.chart.isRightToLeft()&&this.chart.applyMirroring(this.group,dim,offsets);if(this.animate){var plotGroup=this.getGroup();fx.animateTransform(lang.delegate({shape:plotGroup,duration:DEFAULT_ANIMATION_LENGTH,transform:[{name:"translate",start:[0,dim.height-offsets.b],end:[0,0]},{name:"scale",start:[1,0],end:[1,1]},{name:"original"}]},this.animate)).play()}return this.dirty=!1,this}})})