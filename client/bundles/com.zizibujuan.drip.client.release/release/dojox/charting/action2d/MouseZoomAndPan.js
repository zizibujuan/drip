//>>built
define("dojox/charting/action2d/MouseZoomAndPan",["dojo/_base/declare","dojo/_base/window","dojo/_base/array","dojo/_base/event","dojo/_base/connect","dojo/mouse","./ChartAction","dojo/sniff","dojo/dom-prop","dojo/keys"],function(declare,win,arr,eventUtil,connect,mouse,ChartAction,has,domProp,keys){var sUnit=has("mozilla")?3:120,keyTests={none:function(event){return!event.ctrlKey&&!event.altKey&&!event.shiftKey},ctrl:function(event){return event.ctrlKey&&!event.altKey&&!event.shiftKey},alt:function(event){return!event.ctrlKey&&event.altKey&&!event.shiftKey},shift:function(event){return!event.ctrlKey&&!event.altKey&&event.shiftKey}};return declare("dojox.charting.action2d.MouseZoomAndPan",ChartAction,{defaultParams:{axis:"x",scaleFactor:1.2,maxScale:100,enableScroll:!0,enableDoubleClickZoom:!0,enableKeyZoom:!0,keyZoomModifier:"ctrl"},optionalParams:{},constructor:function(chart,plot,kwArgs){this._listeners=[{eventName:mouse.wheel,methodName:"onMouseWheel"}],kwArgs||(kwArgs={}),this.axis=kwArgs.axis?kwArgs.axis:"x",this.scaleFactor=kwArgs.scaleFactor?kwArgs.scaleFactor:1.2,this.maxScale=kwArgs.maxScale?kwArgs.maxScale:100,this.enableScroll=kwArgs.enableScroll!=undefined?kwArgs.enableScroll:!0,this.enableDoubleClickZoom=kwArgs.enableDoubleClickZoom!=undefined?kwArgs.enableDoubleClickZoom:!0,this.enableKeyZoom=kwArgs.enableKeyZoom!=undefined?kwArgs.enableKeyZoom:!0,this.keyZoomModifier=kwArgs.keyZoomModifier?kwArgs.keyZoomModifier:"ctrl",this.enableScroll&&this._listeners.push({eventName:"onmousedown",methodName:"onMouseDown"}),this.enableDoubleClickZoom&&this._listeners.push({eventName:"ondblclick",methodName:"onDoubleClick"}),this.enableKeyZoom&&this._listeners.push({eventName:"keypress",methodName:"onKeyPress"}),this._handles=[],this.connect()},_disconnectHandles:function(){has("ie")&&this.chart.node.releaseCapture(),arr.forEach(this._handles,connect.disconnect),this._handles=[]},connect:function(){this.inherited(arguments),this.enableKeyZoom&&domProp.set(this.chart.node,"tabindex","0")},disconnect:function(){this.inherited(arguments),this.enableKeyZoom&&domProp.set(this.chart.node,"tabindex","-1"),this._disconnectHandles()},onMouseDown:function(event){var chart=this.chart,axis=chart.getAxis(this.axis);axis.vertical?this._startCoord=event.pageY:this._startCoord=event.pageX,this._startOffset=axis.getWindowOffset(),this._isPanning=!0,has("ie")?(this._handles.push(connect.connect(this.chart.node,"onmousemove",this,"onMouseMove")),this._handles.push(connect.connect(this.chart.node,"onmouseup",this,"onMouseUp")),this.chart.node.setCapture()):(this._handles.push(connect.connect(win.doc,"onmousemove",this,"onMouseMove")),this._handles.push(connect.connect(win.doc,"onmouseup",this,"onMouseUp"))),chart.node.focus(),eventUtil.stop(event)},onMouseMove:function(event){if(this._isPanning){var chart=this.chart,axis=chart.getAxis(this.axis),delta=axis.vertical?this._startCoord-event.pageY:event.pageX-this._startCoord,bounds=axis.getScaler().bounds,s=bounds.span/(bounds.upper-bounds.lower),scale=axis.getWindowScale();this.chart.isRightToLeft&&this.chart.isRightToLeft()&&(delta*=-1),chart.setAxisWindow(this.axis,scale,this._startOffset-delta/s/scale),chart.render()}},onMouseUp:function(event){this._isPanning=!1,this._disconnectHandles()},onMouseWheel:function(event){var scroll=event.wheelDelta/sUnit;scroll>-1&&scroll<0?scroll=-1:scroll>0&&scroll<1&&(scroll=1),this._onZoom(scroll,event)},onKeyPress:function(event){keyTests[this.keyZoomModifier](event)&&(event.keyChar=="+"||event.keyCode==keys.NUMPAD_PLUS?this._onZoom(1,event):(event.keyChar=="-"||event.keyCode==keys.NUMPAD_MINUS)&&this._onZoom(-1,event))},onDoubleClick:function(event){var chart=this.chart,axis=chart.getAxis(this.axis),scale=1/this.scaleFactor;if(axis.getWindowScale()==1){var scaler=axis.getScaler(),start=scaler.bounds.from,end=scaler.bounds.to,oldMiddle=(start+end)/2,newMiddle=this.plot.toData({x:event.pageX,y:event.pageY})[this.axis],newStart=scale*(start-oldMiddle)+newMiddle,newEnd=scale*(end-oldMiddle)+newMiddle;chart.zoomIn(this.axis,[newStart,newEnd])}else chart.setAxisWindow(this.axis,1,0),chart.render();eventUtil.stop(event)},_onZoom:function(scroll,event){var scale=scroll<0?Math.abs(scroll)*this.scaleFactor:1/(Math.abs(scroll)*this.scaleFactor),chart=this.chart,axis=chart.getAxis(this.axis),cscale=axis.getWindowScale();if(cscale/scale>this.maxScale)return;var scaler=axis.getScaler(),start=scaler.bounds.from,end=scaler.bounds.to,middle=event.type=="keypress"?(start+end)/2:this.plot.toData({x:event.pageX,y:event.pageY})[this.axis],newStart=scale*(start-middle)+middle,newEnd=scale*(end-middle)+middle;chart.zoomIn(this.axis,[newStart,newEnd]),eventUtil.stop(event)}})})