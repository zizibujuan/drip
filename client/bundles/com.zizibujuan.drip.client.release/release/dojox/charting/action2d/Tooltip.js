//>>built
define("dojox/charting/action2d/Tooltip",["dijit/Tooltip","dojo/_base/lang","dojo/_base/declare","dojo/_base/window","dojo/_base/connect","dojo/dom-style","./PlotAction","dojox/gfx/matrix","dojox/lang/functional","dojox/lang/functional/scan","dojox/lang/functional/fold"],function(Tooltip,lang,declare,win,hub,domStyle,PlotAction,m,df){var DEFAULT_TEXT=function(o,plot){var t=o.run&&o.run.data&&o.run.data[o.index];return t&&typeof t!="number"&&(t.tooltip||t.text)?t.tooltip||t.text:plot.tooltipFunc?plot.tooltipFunc(o):o.y},pi4=Math.PI/4,pi2=Math.PI/2;return declare("dojox.charting.action2d.Tooltip",PlotAction,{defaultParams:{text:DEFAULT_TEXT,mouseOver:!0},optionalParams:{},constructor:function(chart,plot,kwArgs){this.text=kwArgs&&kwArgs.text?kwArgs.text:DEFAULT_TEXT,this.mouseOver=kwArgs&&kwArgs.mouseOver!=undefined?kwArgs.mouseOver:!0,this.connect()},process:function(o){if(o.type==="onplotreset"||o.type==="onmouseout"){Tooltip.hide(this.aroundRect),this.aroundRect=null,o.type==="onplotreset"&&delete this.angles;return}if(!o.shape||this.mouseOver&&o.type!=="onmouseover"||!this.mouseOver&&o.type!=="onclick")return;var aroundRect={type:"rect"},position=["after-centered","before-centered"],shift=this.chart.offsets.l-this.chart.offsets.r,isRTL=this.chart.isRightToLeft?this.chart.isRightToLeft():!1,isColumn=!1;switch(o.element){case"marker":aroundRect.x=isRTL?this.chart.dim.width-o.cx+shift:o.cx,aroundRect.y=o.cy,aroundRect.w=aroundRect.h=1;break;case"circle":aroundRect.x=isRTL?this.chart.dim.width-o.cx-o.cr+shift:o.cx-o.cr,aroundRect.y=o.cy-o.cr,aroundRect.w=aroundRect.h=2*o.cr;break;case"spider_circle":aroundRect.x=o.cx,aroundRect.y=o.cy,aroundRect.w=aroundRect.h=1;break;case"spider_plot":return;case"column":position=["above-centered","below-centered"],isColumn=!0;case"bar":aroundRect=lang.clone(o.shape.getShape()),aroundRect.w=aroundRect.width,aroundRect.h=aroundRect.height,isRTL&&(aroundRect.x=this.chart.dim.width-aroundRect.width-aroundRect.x+shift,isColumn||(position=["before-centered","after-centered"]));break;case"candlestick":aroundRect.x=isRTL?this.chart.dim.width+shift-o.x:o.x,aroundRect.y=o.y,aroundRect.w=o.width,aroundRect.h=o.height;break;default:this.angles||(typeof o.run.data[0]=="number"?this.angles=df.map(df.scanl(o.run.data,"+",0),"* 2 * Math.PI / this",df.foldl(o.run.data,"+",0)):this.angles=df.map(df.scanl(o.run.data,"a + b.y",0),"* 2 * Math.PI / this",df.foldl(o.run.data,"a + b.y",0)));var startAngle=m._degToRad(o.plot.opt.startAngle),angle=(this.angles[o.index]+this.angles[o.index+1])/2+startAngle;aroundRect.x=o.cx+o.cr*Math.cos(angle),aroundRect.y=o.cy+o.cr*Math.sin(angle),aroundRect.w=aroundRect.h=1,startAngle&&(angle<0||angle>2*Math.PI)&&(angle=Math.abs(2*Math.PI-Math.abs(angle))),angle<pi4||(angle<pi2+pi4?position=["below-centered","above-centered"]:angle<Math.PI+pi4?position=["before-centered","after-centered"]:angle<2*Math.PI-pi4&&(position=["above-centered","below-centered"]))}var lt=this.chart.getCoords();aroundRect.x+=lt.x,aroundRect.y+=lt.y,aroundRect.x=Math.round(aroundRect.x),aroundRect.y=Math.round(aroundRect.y),aroundRect.w=Math.ceil(aroundRect.w),aroundRect.h=Math.ceil(aroundRect.h),this.aroundRect=aroundRect;var tooltip=this.text(o,this.plot);if(this.chart.getTextDir)var isChartDirectionRtl=domStyle.get(this.chart.node,"direction")=="rtl",isBaseTextDirRtl=this.chart.getTextDir(tooltip)=="rtl";tooltip&&(isBaseTextDirRtl&&!isChartDirectionRtl?Tooltip.show("<span dir = 'rtl'>"+tooltip+"</span>",this.aroundRect,position):!isBaseTextDirRtl&&isChartDirectionRtl?Tooltip.show("<span dir = 'ltr'>"+tooltip+"</span>",this.aroundRect,position):Tooltip.show(tooltip,this.aroundRect,position)),this.mouseOver||(this._handle=hub.connect(win.doc,"onclick",this,"onClick"))},onClick:function(){this.process({type:"onmouseout"})}})})