//>>built
define("dojox/html/format",["dojo/_base/kernel","./entities","dojo/_base/array","dojo/_base/window","dojo/_base/sniff"],function(lang,Entities,ArrayUtil,Window,has){var dhf=lang.getObject("dojox.html.format",!0);return dhf.prettyPrint=function(html,indentBy,maxLineLength,map,xhtml){var content=[],indentDepth=0,closeTags=[],iTxt="	",textContent="",inlineStyle=[],i,rgxp_fixIEAttrs=/[=]([^"']+?)(\s|>)/g,rgxp_styleMatch=/style=("[^"]*"|'[^']*'|\S*)/gi,rgxp_attrsMatch=/[\w-]+=("[^"]*"|'[^']*'|\S*)/gi;if(indentBy&&indentBy>0&&indentBy<10){iTxt="";for(i=0;i<indentBy;i++)iTxt+=" "}var contentDiv=Window.doc.createElement("div");contentDiv.innerHTML=html;var encode=Entities.encode,decode=Entities.decode,isInlineFormat=function(tag){switch(tag){case"a":case"b":case"strong":case"s":case"strike":case"i":case"u":case"em":case"sup":case"sub":case"span":case"font":case"big":case"cite":case"q":case"small":return!0;default:return!1}},div=contentDiv.ownerDocument.createElement("div"),outerHTML=function(node){var clone=node.cloneNode(!1);div.appendChild(clone);var html=div.innerHTML;return div.innerHTML="",html},sizeIndent=function(){var i,txt="";for(i=0;i<indentDepth;i++)txt+=iTxt;return txt.length},indent=function(){var i;for(i=0;i<indentDepth;i++)content.push(iTxt)},newline=function(){content.push("\n")},processTextNode=function(n){textContent+=encode(n.nodeValue,map)},formatText=function(txt){var i,_iTxt,_lines=txt.split("\n");for(i=0;i<_lines.length;i++)_lines[i]=lang.trim(_lines[i]);txt=_lines.join(" "),txt=lang.trim(txt);if(txt!==""){var lines=[];if(maxLineLength&&maxLineLength>0){var indentSize=sizeIndent(),maxLine=maxLineLength;maxLineLength>indentSize&&(maxLine-=indentSize);while(txt)if(txt.length>maxLineLength){for(i=maxLine;i>0&&txt.charAt(i)!==" ";i--);if(!i)for(i=maxLine;i<txt.length&&txt.charAt(i)!==" ";i++);var line=txt.substring(0,i);line=lang.trim(line),txt=lang.trim(txt.substring(i==txt.length?txt.length:i+1,txt.length));if(line){_iTxt="";for(i=0;i<indentDepth;i++)_iTxt+=iTxt;line=_iTxt+line+"\n"}lines.push(line)}else{_iTxt="";for(i=0;i<indentDepth;i++)_iTxt+=iTxt;txt=_iTxt+txt+"\n",lines.push(txt),txt=null}return lines.join("")}_iTxt="";for(i=0;i<indentDepth;i++)_iTxt+=iTxt;return txt=_iTxt+txt+"\n",txt}return""},processScriptText=function(txt){return txt&&(txt=txt.replace(/&quot;/gi,'"'),txt=txt.replace(/&gt;/gi,">"),txt=txt.replace(/&lt;/gi,"<"),txt=txt.replace(/&amp;/gi,"&")),txt},formatScript=function(txt){if(txt){txt=processScriptText(txt);var i,t,c,_iTxt,indent=0,scriptLines=txt.split("\n"),newLines=[];for(i=0;i<scriptLines.length;i++){var line=scriptLines[i],hasNewlines=line.indexOf("\n")>-1;line=lang.trim(line);if(line){var iLevel=indent;for(c=0;c<line.length;c++){var ch=line.charAt(c);ch==="{"?indent++:ch==="}"&&(indent--,iLevel=indent)}_iTxt="";for(t=0;t<indentDepth+iLevel;t++)_iTxt+=iTxt;newLines.push(_iTxt+line+"\n")}else hasNewlines&&i===0&&newLines.push("\n")}txt=newLines.join("")}return txt},openTag=function(node){var name=node.nodeName.toLowerCase(),nText=lang.trim(outerHTML(node)),tag=nText.substring(0,nText.indexOf(">")+1);tag=tag.replace(rgxp_fixIEAttrs,'="$1"$2'),tag=tag.replace(rgxp_styleMatch,function(match){var sL=match.substring(0,6),style=match.substring(6,match.length),closure=style.charAt(0);style=lang.trim(style.substring(1,style.length-1)),style=style.split(";");var trimmedStyles=[];ArrayUtil.forEach(style,function(s){s=lang.trim(s),s&&(s=s.substring(0,s.indexOf(":")).toLowerCase()+s.substring(s.indexOf(":"),s.length),trimmedStyles.push(s))}),trimmedStyles=trimmedStyles.sort(),style=trimmedStyles.join("; ");var ts=lang.trim(style);return!ts||ts===";"?"":(style+=";",sL+closure+style+closure)});var attrs=[];tag=tag.replace(rgxp_attrsMatch,function(attr){return attrs.push(lang.trim(attr)),""}),attrs=attrs.sort(),tag="<"+name,attrs.length&&(tag+=" "+attrs.join(" ")),nText.indexOf("</")!=-1?(closeTags.push(name),tag+=">"):(xhtml?tag+=" />":tag+=">",closeTags.push(!1));var inline=isInlineFormat(name);inlineStyle.push(inline),textContent&&!inline&&(content.push(formatText(textContent)),textContent=""),inline?textContent+=tag:(indent(),content.push(tag),newline(),indentDepth++)},closeTag=function(){var inline=inlineStyle.pop();textContent&&!inline&&(content.push(formatText(textContent)),textContent="");var ct=closeTags.pop();ct?(ct="</"+ct+">",inline?textContent+=ct:(indentDepth--,indent(),content.push(ct),newline())):indentDepth--},processCommentNode=function(n){var commentText=decode(n.nodeValue,map);indent(),content.push("<!--"),newline(),indentDepth++,content.push(formatText(commentText)),indentDepth--,indent(),content.push("-->"),newline()},processNode=function(node){var children=node.childNodes;if(children){var i;for(i=0;i<children.length;i++){var n=children[i];if(n.nodeType===1){var tg=lang.trim(n.tagName.toLowerCase());if(has("ie")&&n.parentNode!=node)continue;if(tg&&tg.charAt(0)==="/")continue;openTag(n);if(tg==="script")content.push(formatScript(n.innerHTML));else if(tg==="pre"){var preTxt=n.innerHTML;has("mozilla")&&(preTxt=preTxt.replace("<br>","\n"),preTxt=preTxt.replace("<pre>",""),preTxt=preTxt.replace("</pre>","")),preTxt.charAt(preTxt.length-1)!=="\n"&&(preTxt+="\n"),content.push(preTxt)}else processNode(n);closeTag()}else n.nodeType===3||n.nodeType===4?processTextNode(n):n.nodeType===8&&processCommentNode(n)}}};return processNode(contentDiv),textContent&&(content.push(formatText(textContent)),textContent=""),content.join("")},dhf})