//>>built
define("dojox/fx/Timeline",["dojo/_base/lang","dojo/fx/easing","dojo/_base/fx","dojo/dom","./_base","dojo/_base/connect","dojo/_base/html","dojo/_base/array","dojo/_base/Color"],function(lang,easingUtil,baseFx,dom,dojoxFx,connectUtil,htmlUtil,arrayUtil,Color){dojoxFx.animateTimeline=function(options,node){var _curve=new Timeline(options.keys),ani=baseFx.animateProperty({node:dom.byId(node||options.node),duration:options.duration||1e3,properties:_curve._properties,easing:easingUtil.linear,onAnimate:function(v){}});return connectUtil.connect(ani,"onEnd",function(node){var sty=ani.curve.getValue(ani.reversed?0:1);htmlUtil.style(node,sty)}),connectUtil.connect(ani,"beforeBegin",function(){ani.curve&&delete ani.curve,ani.curve=_curve,_curve.ani=ani}),ani};var Timeline=function(keys){this.keys=lang.isArray(keys)?this.flatten(keys):keys};return Timeline.prototype.flatten=function(keys){var getPercent=function(str,idx){return str=="from"?0:str=="to"?1:str===undefined?idx==0?0:idx/(keys.length-1):parseInt(str,10)*.01},p={},o={};return arrayUtil.forEach(keys,function(k,i){var step=getPercent(k.step,i),ease=easingUtil[k.ease]||easingUtil.linear;for(var nm in k){if(nm=="step"||nm=="ease"||nm=="from"||nm=="to")continue;o[nm]||(o[nm]={steps:[],values:[],eases:[],ease:ease},p[nm]={},/#/.test(k[nm])?p[nm].units=o[nm].units="isColor":p[nm].units=o[nm].units=/\D{1,}/.exec(k[nm]).join("")),o[nm].eases.push(easingUtil[k.ease||"linear"]),o[nm].steps.push(step),p[nm].units=="isColor"?o[nm].values.push(new Color(k[nm])):o[nm].values.push(parseInt(/\d{1,}/.exec(k[nm]).join(""))),p[nm].start===undefined?p[nm].start=o[nm].values[o[nm].values.length-1]:p[nm].end=o[nm].values[o[nm].values.length-1]}}),this._properties=p,o},Timeline.prototype.getValue=function(p){p=this.ani._reversed?1-p:p;var o={},self=this,getProp=function(nm,i){return self._properties[nm].units!="isColor"?self.keys[nm].values[i]+self._properties[nm].units:self.keys[nm].values[i].toCss()};for(var nm in this.keys){var k=this.keys[nm];for(var i=0;i<k.steps.length;i++){var step=k.steps[i],ns=k.steps[i+1],next=i<k.steps.length?!0:!1,ease=k.eases[i]||function(n){return n};if(p==step){o[nm]=getProp(nm,i);if(!next||next&&this.ani._reversed)break}else if(p>step){if(next&&p<k.steps[i+1]){var end=k.values[i+1],beg=k.values[i],seg=1/(ns-step)*(p-step);seg=ease(seg);if(beg instanceof Color)o[nm]=Color.blendColors(beg,end,seg).toCss(!1);else{var df=end-beg;o[nm]=beg+seg*df+this._properties[nm].units}break}o[nm]=getProp(nm,i)}else if(next&&!this.ani._reversed||!next&&this.ani._reversed)o[nm]=getProp(nm,i)}}return o},dojoxFx._Timeline=Timeline,dojoxFx})