//>>built
define("dojox/widget/Selection",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Stateful"],function(declare,arr,lang,Stateful){return declare("dojox.widget.Selection",Stateful,{constructor:function(){this.selectedItems=[]},selectionMode:"single",_setSelectionModeAttr:function(value){value!="none"&&value!="single"&&value!="multiple"&&(value="single"),value!=this.selectionMode&&(this.selectionMode=value,value=="none"?this.set("selectedItems",null):value=="single"&&this.set("selectedItem",this.selectedItem))},selectedItem:null,_setSelectedItemAttr:function(value){this.selectedItem!=value&&(this._set("selectedItem",value),this.set("selectedItems",value?[value]:null))},selectedItems:null,_setSelectedItemsAttr:function(value){var oldSelectedItems=this.selectedItems;this.selectedItems=value,this.selectedItem=null,oldSelectedItems!=null&&oldSelectedItems.length>0&&this.updateRenderers(oldSelectedItems,!0),this.selectedItems&&this.selectedItems.length>0&&(this.selectedItem=this.selectedItems[0],this.updateRenderers(this.selectedItems,!0))},_getSelectedItemsAttr:function(){return this.selectedItems==null?[]:this.selectedItems.concat()},isItemSelected:function(item){return this.selectedItems==null||this.selectedItems.length==0?!1:arr.some(this.selectedItems,lang.hitch(this,function(sitem){return this.getIdentity(sitem)==this.getIdentity(item)}))},getIdentity:function(item){},setItemSelected:function(item,value){if(this.selectionMode=="none"||item==null)return;var sel=this.get("selectedItems"),old=this.get("selectedItems");if(this.selectionMode=="single")value?this.set("selectedItem",item):this.isItemSelected(item)&&this.set("selectedItems",null);else if(value){if(this.isItemSelected(item))return;sel==null?sel=[item]:sel.unshift(item),this.set("selectedItems",sel)}else{var res=arr.filter(sel,function(sitem){return sitem.id!=item.id});if(res==null||res.length==sel.length)return;this.set("selectedItems",res)}},selectFromEvent:function(e,item,renderer,dispatch){if(this.selectionMode=="none")return!1;var changed,oldSelectedItem=this.get("selectedItem"),selected=item?this.isItemSelected(item):!1;return item==null?!e.ctrlKey&&this.selectedItem!=null&&(this.set("selectedItem",null),changed=!0):this.selectionMode=="multiple"?e.ctrlKey?(this.setItemSelected(item,!selected),changed=!0):(this.set("selectedItem",item),changed=!0):e.ctrlKey?(this.set("selectedItem",selected?null:item),changed=!0):selected||(this.set("selectedItem",item),changed=!0),dispatch&&changed&&this.dispatchChange(oldSelectedItem,this.get("selectedItem"),renderer,e),changed},dispatchChange:function(oldSelectedItem,newSelectedItem,renderer,triggerEvent){this.onChange({oldValue:oldSelectedItem,newValue:newSelectedItem,renderer:renderer,triggerEvent:triggerEvent})},onChange:function(){}})})