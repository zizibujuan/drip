//>>built
define("dojox/widget/Portlet",["dojo/_base/declare","dojo/_base/kernel","dojo/fx","dijit/TitlePane","./PortletSettings","./PortletDialogSettings"],function(declare,kernel,fx,TitlePane,PortletSettings,PortletDialogSettings){return kernel.experimental("dojox.widget.Portlet"),declare("dojox.widget.Portlet",[TitlePane,dijit._Container],{resizeChildren:!0,closable:!0,_parents:null,_size:null,dragRestriction:!1,buildRendering:function(){this.inherited(arguments),dojo.style(this.domNode,"visibility","hidden")},postCreate:function(){this.inherited(arguments),dojo.addClass(this.domNode,"dojoxPortlet"),dojo.removeClass(this.arrowNode,"dijitArrowNode"),dojo.addClass(this.arrowNode,"dojoxPortletIcon dojoxArrowDown"),dojo.addClass(this.titleBarNode,"dojoxPortletTitle"),dojo.addClass(this.hideNode,"dojoxPortletContentOuter"),dojo.addClass(this.domNode,"dojoxPortlet-"+(this.dragRestriction?"nonmovable":"movable"));var _this=this;if(this.resizeChildren){this.subscribe("/dnd/drop",function(){_this._updateSize()}),this.subscribe("/Portlet/sizechange",function(widget){_this.onSizeChange(widget)}),this.connect(window,"onresize",function(){_this._updateSize()});var doSelectSubscribe=dojo.hitch(this,function(id,lastId){var widget=dijit.byId(id);if(widget.selectChild){var s=this.subscribe(id+"-selectChild",function(child){var n=_this.domNode.parentNode;while(n){if(n==child.domNode){_this.unsubscribe(s),_this._updateSize();break}n=n.parentNode}}),child=dijit.byId(lastId);widget&&child&&_this._parents.push({parent:widget,child:child})}}),lastId;this._parents=[];for(var p=this.domNode.parentNode;p!=null;p=p.parentNode){var id=p.getAttribute?p.getAttribute("widgetId"):null;id&&(doSelectSubscribe(id,lastId),lastId=id)}}this.connect(this.titleBarNode,"onmousedown",function(evt){return dojo.hasClass(evt.target,"dojoxPortletIcon")?(dojo.stopEvent(evt),!1):!0}),this.connect(this._wipeOut,"onEnd",function(){_this._publish()}),this.connect(this._wipeIn,"onEnd",function(){_this._publish()}),this.closable&&(this.closeIcon=this._createIcon("dojoxCloseNode","dojoxCloseNodeHover",dojo.hitch(this,"onClose")),dojo.style(this.closeIcon,"display",""))},startup:function(){if(this._started)return;var children=this.getChildren();this._placeSettingsWidgets(),dojo.forEach(children,function(child){try{!child.started&&!child._started&&child.startup()}catch(e){0}}),this.inherited(arguments),dojo.style(this.domNode,"visibility","visible")},_placeSettingsWidgets:function(){dojo.forEach(this.getChildren(),dojo.hitch(this,function(child){child.portletIconClass&&child.toggle&&!child.get("portlet")&&(this._createIcon(child.portletIconClass,child.portletIconHoverClass,dojo.hitch(child,"toggle")),dojo.place(child.domNode,this.containerNode,"before"),child.set("portlet",this),this._settingsWidget=child)}))},_createIcon:function(clazz,hoverClazz,fn){var icon=dojo.create("div",{"class":"dojoxPortletIcon "+clazz,waiRole:"presentation"});return dojo.place(icon,this.arrowNode,"before"),this.connect(icon,"onclick",fn),hoverClazz&&(this.connect(icon,"onmouseover",function(){dojo.addClass(icon,hoverClazz)}),this.connect(icon,"onmouseout",function(){dojo.removeClass(icon,hoverClazz)})),icon},onClose:function(evt){dojo.style(this.domNode,"display","none")},onSizeChange:function(widget){if(widget==this)return;this._updateSize()},_updateSize:function(){if(!this.open||!this._started||!this.resizeChildren)return;this._timer&&clearTimeout(this._timer),this._timer=setTimeout(dojo.hitch(this,function(){var size={w:dojo.style(this.domNode,"width"),h:dojo.style(this.domNode,"height")};for(var i=0;i<this._parents.length;i++){var p=this._parents[i],sel=p.parent.selectedChildWidget;if(sel&&sel!=p.child)return}if(this._size&&this._size.w==size.w&&this._size.h==size.h)return;this._size=size;var fns=["resize","layout"];this._timer=null;var kids=this.getChildren();dojo.forEach(kids,function(child){for(var i=0;i<fns.length;i++)if(dojo.isFunction(child[fns[i]])){try{child[fns[i]]()}catch(e){0}break}}),this.onUpdateSize()}),100)},onUpdateSize:function(){},_publish:function(){dojo.publish("/Portlet/sizechange",[this])},_onTitleClick:function(evt){evt.target==this.arrowNode&&this.inherited(arguments)},addChild:function(child){this._size=null,this.inherited(arguments),this._started&&(this._placeSettingsWidgets(),this._updateSize()),this._started&&!child.started&&!child._started&&child.startup()},destroyDescendants:function(preserveDom){this.inherited(arguments),this._settingsWidget&&this._settingsWidget.destroyRecursive(preserveDom)},destroy:function(){this._timer&&clearTimeout(this._timer),this.inherited(arguments)},_setCss:function(){this.inherited(arguments),dojo.style(this.arrowNode,"display",this.toggleable?"":"none")}})})