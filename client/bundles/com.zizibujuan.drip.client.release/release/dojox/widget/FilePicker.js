//>>built
define("dojox/widget/FilePicker",["dojo","dijit","dojox","dojo/i18n!dojox/widget/nls/FilePicker","dojo/require!dojox/widget/RollingList,dojo/i18n"],function(dojo,dijit,dojox){dojo.provide("dojox.widget.FilePicker"),dojo.require("dojox.widget.RollingList"),dojo.require("dojo.i18n"),dojo.requireLocalization("dojox.widget","FilePicker"),dojo.declare("dojox.widget._FileInfoPane",[dojox.widget._RollingListPane],{templateString:"",templateString:dojo.cache("dojox.widget","FilePicker/_FileInfoPane.html",'<div class="dojoxFileInfoPane">\n	<table>\n		<tbody>\n			<tr>\n				<td class="dojoxFileInfoLabel dojoxFileInfoNameLabel">${_messages.name}</td>\n				<td class="dojoxFileInfoName" dojoAttachPoint="nameNode"></td>\n			</tr>\n			<tr>\n				<td class="dojoxFileInfoLabel dojoxFileInfoPathLabel">${_messages.path}</td>\n				<td class="dojoxFileInfoPath" dojoAttachPoint="pathNode"></td>\n			</tr>\n			<tr>\n				<td class="dojoxFileInfoLabel dojoxFileInfoSizeLabel">${_messages.size}</td>\n				<td class="dojoxFileInfoSize" dojoAttachPoint="sizeNode"></td>\n			</tr>\n		</tbody>\n	</table>\n	<div dojoAttachPoint="containerNode" style="display:none;"></div>\n</div>'),postMixInProperties:function(){this._messages=dojo.i18n.getLocalization("dojox.widget","FilePicker",this.lang),this.inherited(arguments)},onItems:function(){var store=this.store,item=this.items[0];item?(this.nameNode.innerHTML=store.getLabel(item),this.pathNode.innerHTML=store.getIdentity(item),this.sizeNode.innerHTML=store.getValue(item,"size"),this.parentWidget.scrollIntoView(this),this.inherited(arguments)):this._onError("Load",new Error("No item defined"))}}),dojo.declare("dojox.widget.FilePicker",dojox.widget.RollingList,{className:"dojoxFilePicker",pathSeparator:"",topDir:"",parentAttr:"parentDir",pathAttr:"path",preloadItems:50,selectDirectories:!0,selectFiles:!0,_itemsMatch:function(item1,item2){if(!item1&&!item2)return!0;if(!item1||!item2)return!1;if(item1==item2)return!0;if(this._isIdentity){var iArr=[this.store.getIdentity(item1),this.store.getIdentity(item2)];return dojo.forEach(iArr,function(i,idx){i.lastIndexOf(this.pathSeparator)==i.length-1&&(iArr[idx]=i.substring(0,i.length-1))},this),iArr[0]==iArr[1]}return!1},startup:function(){if(this._started)return;this.inherited(arguments);var conn,child=this.getChildren()[0],setSeparator=dojo.hitch(this,function(){conn&&this.disconnect(conn),delete conn;var item=child.items[0];if(item){var store=this.store,parent=store.getValue(item,this.parentAttr),path=store.getValue(item,this.pathAttr);this.pathSeparator=this.pathSeparator||store.pathSeparator,this.pathSeparator||(this.pathSeparator=path.substring(parent.length,parent.length+1)),this.topDir||(this.topDir=parent,this.topDir.lastIndexOf(this.pathSeparator)!=this.topDir.length-1&&(this.topDir+=this.pathSeparator))}});if(!this.pathSeparator||!this.topDir)child.items?setSeparator():conn=this.connect(child,"onItems",setSeparator)},getChildItems:function(item){var ret=this.inherited(arguments);return!ret&&this.store.getValue(item,"directory")&&(ret=[]),ret},getMenuItemForItem:function(item,parentPane,children){var menuOptions={iconClass:"dojoxDirectoryItemIcon"};if(!this.store.getValue(item,"directory")){menuOptions.iconClass="dojoxFileItemIcon";var l=this.store.getLabel(item),idx=l.lastIndexOf(".");idx>=0&&(menuOptions.iconClass+=" dojoxFileItemIcon_"+l.substring(idx+1)),this.selectFiles||(menuOptions.disabled=!0)}var ret=new dijit.MenuItem(menuOptions);return ret},getPaneForItem:function(item,parentPane,children){var ret=null;return!item||this.store.isItem(item)&&this.store.getValue(item,"directory")?ret=new dojox.widget._RollingListGroupPane({}):this.store.isItem(item)&&!this.store.getValue(item,"directory")&&(ret=new dojox.widget._FileInfoPane({})),ret},_setPathValueAttr:function(path,resetLastExec,onSet){if(!path){this.set("value",null);return}path.lastIndexOf(this.pathSeparator)==path.length-1&&(path=path.substring(0,path.length-1)),this.store.fetchItemByIdentity({identity:path,onItem:function(v){resetLastExec&&(this._lastExecutedValue=v),this.set("value",v),onSet&&onSet()},scope:this})},_getPathValueAttr:function(val){return val||(val=this.value),val&&this.store.isItem(val)?this.store.getValue(val,this.pathAttr):""},_setValue:function(value){delete this._setInProgress;var store=this.store;if(value&&store.isItem(value)){var isDirectory=this.store.getValue(value,"directory");if(isDirectory&&!this.selectDirectories||!isDirectory&&!this.selectFiles)return}else value=null;this._itemsMatch(this.value,value)||(this.value=value,this._onChange(value))}})})