//>>built
define("mathEditor/ContentAssist",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/on","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dijit/popup","dijit/DropDownMenu","dijit/MenuItem","mathEditor/mathContentAssist"],function(declare,array,lang,on,domConstruct,domClass,domStyle,popup,DropDownMenu,MenuItem,mathContentAssist){return declare("mathEditor.ContentAssist",DropDownMenu,{proposals:null,view:null,cacheString:"",opened:!1,postCreate:function(){this.inherited(arguments),on(this.view.editorDiv,"mousedown",lang.hitch(this,function(e){this.opened&&popup.close(this)}))},startup:function(){this.inherited(arguments)},_scheduleOpen:function(target,x,y){view=this.view;var self=this;this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer,popup.open({popup:target,x:x,y:y,onExecute:function(){popup.close(target),view.focus(),self.opened=!1},onCancel:function(){popup.close(target),self.opened=!1,view.focus()},onClose:function(){view.focus(),self.opened=!1}}),this.opened=!0,target.select()},0))},_open:function(){var cursorPosition=this.view.getCursorPosition(),x=cursorPosition.x,y=cursorPosition.y;this._scheduleOpen(this,x,y)},_clear:function(){var children=this.getChildren();array.forEach(children,lang.hitch(this,function(child,index){this.removeChild(child)}))},_setProposals:function(proposals){this._clear(),this.proposals=proposals,array.forEach(proposals,lang.hitch(this,function(jsonObject,index){var menuItem=new MenuItem({label:jsonObject.label,iconClass:jsonObject.iconClass});menuItem.on("click",lang.hitch(this,this._onApplyProposal,jsonObject.map,jsonObject.nodeName)),this.addChild(menuItem)}))},show:function(data){this.opened==0?this.cacheString=data:this.cacheString+=data;var proposals=mathContentAssist.getProposals(this.cacheString);this._setProposals(proposals);if(proposals.length>0){this._open();var result=proposals[0].map;return result}return this.cacheString="",this.opened&&(popup.close(this),this.opened=!1),null},_onApplyProposal:function(data,nodeName,evt){this.apply(data,nodeName,this.cacheString.length,evt)},apply:function(data,nodeName,cacheCount,evt){0},enter:function(evt){this.onItemClick(this.selectedChild,evt)},select:function(){this.selectFirstChild()},selectFirstChild:function(){this.selectChild(this._getFirstSelectableChild())},selectPrev:function(){this.selectChild(this._getNextSelectableChild(this.selectedChild,-1),!0)},selectNext:function(){this.selectChild(this._getNextSelectableChild(this.selectedChild,1))},_getFirstSelectableChild:function(){return this._getNextSelectableChild(null,1)},_getLastFocusableChild:function(){return this._getNextSelectableChild(null,-1)},_getNextSelectableChild:function(child,dir){child&&(child=this._getSiblingOfChild(child,dir));var children=this.getChildren();for(var i=0;i<children.length;i++){child||(child=children[dir>0?0:children.length-1]);if(child.isFocusable())return child;child=this._getSiblingOfChild(child,dir)}return null},selectChild:function(widget,last){if(!widget)return;this.selectedChild&&widget!==this.selectedChild&&this.selectedChild._setSelected(!1),this.selectedChild=widget,widget._setSelected(!0)}})})