//>>built
require({cache:{"mathEditor/Model":function(){define("mathEditor/Model","dojo/_base/declare,dojo/_base/lang,dojo/_base/array,dojo/dom-construct,dojox/xml/parser,mathEditor/string,mathEditor/dataUtil,mathEditor/lang,mathEditor/xmlUtil".split(","),function(f,b,c,e,a,i,j,h,k){return f(null,{path:null,xmlString:null,doc:null,cursorPosition:null,constructor:function(d){this._init();b.mixin(this,d)},_init:function(){this.doc=a.parse("<root><line></line></root>");this.path=[];this.cursorPosition={};this.cursorPosition.node=
this.doc.documentElement.firstChild;this.cursorPosition.offset=0;this.path.push({nodeName:"root"});this.path.push({nodeName:"line",offset:1})},clear:function(){this._init();this.onChange()},loadData:function(){},setData:function(d){var g=d.data,l=d.nodeName;if((d=d.removeCount)&&0<d)for(var a=0;a<d;a++)this.removeLeft();var f=this.doc;if(""!=l&&"mfrac"==l){this._splitNodeIfNeed();g=this.cursorPosition.node;a=1;d="last";!this._isLineNode(g)&&this._isTextNode(g)&&(a=this.path.pop().offset+1,d="after");
this.path.push({nodeName:"math",offset:a});this.path.push({nodeName:"mfrac",offset:1});this.path.push({nodeName:"mrow",offset:1});this.path.push({nodeName:"mn",offset:1});var a=f.createElement("math"),m=k.createEmptyFrac(f);a.appendChild(m.rootNode);e.place(a,g,d);this.cursorPosition.node=m.focusNode;this.cursorPosition.offset=0;this.onChange()}else d=[],b.isString(g)?d=i.splitData(g):b.isArray(g)&&(d=g),c.forEach(d,b.hitch(this,function(d){var g=this.cursorPosition.node;if(h.isNumber(d)){l="mn";
var a=g.nodeName;if("line"==a||"text"==a){var b=this.cursorPosition.offset,a="last",m=1;if(this._isLineNode(g))a="last",m=1;else if(this._isTextNode(g)){this._splitNodeIfNeed();var c=this.path.pop();0<b?(a="after",m=c.offset+1):a="before"}b=f.createElement("math");c=f.createElement(l);b.appendChild(c);e.place(b,g,a);this.cursorPosition.node=c;this.cursorPosition.offset=0;this._insertChar(d);this.path.push({nodeName:"math",offset:m});this.path.push({nodeName:l,offset:1})}else if(h.isMathTokenNode(g)){g=
this.cursorPosition.node;if(g.nodeName!=l)c=f.createElement(l),h.insertNodeAfter(c,g),this.cursorPosition.node=c,this.cursorPosition.offset=0,c=this.path.pop(),this.path.push({nodeName:l,offset:c.offset+1});this._insertChar(d)}}else if(h.isOperator(d))if(this._isLineNode(g))b=f.createElement("math"),g.appendChild(b),c=f.createElement("mo"),b.appendChild(c),this.cursorPosition.node=c,this.cursorPosition.offset=0,this._insertChar(d),this.path.push({nodeName:"math",offset:1}),this.path.push({nodeName:"mo",
offset:1});else if(h.isMathTokenNode(g))g=this.cursorPosition.node,a=f.createElement("mo"),h.insertNodeAfter(a,g),this.cursorPosition.node=a,this.cursorPosition.offset=0,this._insertChar(d),c=this.path.pop(),this.path.push({nodeName:"mo",offset:c.offset+1});else{if(this._isTextNode(g))b=f.createElement("math"),h.insertNodeAfter(b,g),c=f.createElement("mo"),b.appendChild(c),this.cursorPosition.node=c,this.cursorPosition.offset=0,this._insertChar(d),c=this.path.pop(),this.path.push({nodeName:"math",
offset:c.offset+1}),this.path.push({nodeName:"mo",offset:1})}else if(h.isNewLine(d)){d=this._getFocusLine();g=this.doc.createElement("line");h.insertNodeAfter(g,d);this.cursorPosition.node=g;this.cursorPosition.offset=0;for(c=this.path.pop();"line"!=c.nodeName;)c=this.path.pop();this.path.push({nodeName:"line",offset:c.offset+1})}else if(this._isLineNode(g))a=f.createElement("text"),g.appendChild(a),this.cursorPosition.node=a,this.cursorPosition.offset=0,this._insertChar(d),this.path.push({nodeName:"text",
offset:1});else if(this._isTextNode(g))this._insertChar(d);else if(h.isMathTokenNode(g)){do c=this.path.pop();while(c&&"math"!=c.nodeName);a=f.createElement("text");for(b=g;"math"!=b.nodeName;)b=b.parentNode;h.insertNodeAfter(a,b);this.cursorPosition.node=a;this.cursorPosition.offset=0;this._insertChar(d);this.path.push({nodeName:"text",offset:c.offset+1})}})),this.onChange(g)},doDelete:function(){if(""!=this.removeLeft())this.onChange()},removeLeft:function(){var d=this.cursorPosition.offset,g=this.cursorPosition.node,
a=g.textContent;if(0==d){d=g;if("text"!=g.nodeName&&"line"!=g.nodeName){for(;"math"!=d.nodeName;)d=d.parentNode;if(d=d.previousSibling){var g=d.textContent,b=g.length,a=i.insertAtOffset(g,b,"",1),b=b-1;""==a?(d.parentNode.removeChild(d),this.path.pop()):(d.textContent=a,this.cursorPosition.node=d,this.cursorPosition.offset=b);return b=g.charAt(b)}}else if("line"==g.nodeName&&1<this.getLineCount()){d=g.previousSibling;b=d.childNodes.length;if(0==b)this.cursorPosition.node=d,this.cursorPosition.offset=
0,a=this.path.pop(),a.offset--,this.path.push(a),g.parentNode.removeChild(g);else if(d=d.lastChild,"text"==d.nodeName)this.cursorPosition.node=d,this.cursorPosition.offset=d.textContent.length,a=this.path.pop(),a.offset--,this.path.push(a),this.path.push({nodeName:d.nodeName,offset:b}),g.parentNode.removeChild(g);else if("math"==d.nodeName){var c=d.childNodes.length,d=d.lastChild;this.cursorPosition.node=d;this.cursorPosition.offset=d.textContent.length;a=this.path.pop();a.offset--;this.path.push(a);
this.path.push({nodeName:"math",offset:b});this.path.push({nodeName:d.nodeName,offset:c});g.parentNode.removeChild(g)}return"\n"}return""}"mo"==g.nodeName?(b=g.textContent,a=""):(b=a.charAt(d-1),a=i.insertAtOffset(a,d,"",1));if(""==a)if(d=g.previousSibling)"math"==d.nodeName?(c=d.childNodes.length,d=d.lastChild,this.cursorPosition.node=d,this.cursorPosition.offset=d.textContent.length,a=this.path.pop(),this.path.push({nodeName:"math",offset:a.offset-1}),this.path.push({nodeName:d.nodeName,offset:c}),
g.parentNode.removeChild(g)):(this.cursorPosition.node=d,this.cursorPosition.offset=d.textContent.length,g.parentNode.removeChild(g),this.path.push({nodeName:this.cursorPosition.node.nodeName,offset:this.path.pop().offset-1}));else{c=a=g;if("text"!=g.nodeName&&"line"!=g.nodeName)for(;"math"!=c.nodeName;)a=c.parentNode,a.removeChild(c),c=a,this.path.pop();d=c.previousSibling;a=c.parentNode;a.removeChild(c);g=this.path.pop().offset;d?(this.cursorPosition.node=d,this.cursorPosition.offset=d.textContent.length,
this.path.push({nodeName:this.cursorPosition.node.nodeName,offset:g-1})):(this.cursorPosition.node=a,this.cursorPosition.offset=a.childElementCount)}else this.cursorPosition.node.textContent=a,this.cursorPosition.offset-=1;return b},moveLeft:function(){var d=this.cursorPosition.node,a=this.cursorPosition.offset;if("line"==d.nodeName){if(a=d.previousSibling){a=a.lastChild;if("math"==a.nodeName)a=a.lastChild;d=a.textContent;this.cursorPosition.node=a;this.cursorPosition.offset=d.length}}else if(0<a)this.cursorPosition.offset--;
else if(0==a)if(a=d.previousSibling){if("math"==a.nodeName)a=a.lastChild;d=a.textContent;this.cursorPosition.node=a;this.cursorPosition.offset=d.length-1}else if(a=d.parentNode.previousSibling)if("line"==a.nodeName){a=a.lastChild;if("math"==a.nodeName)a=a.lastChild;d=a.textContent;this.cursorPosition.node=a;this.cursorPosition.offset=d.length}else d=a.textContent,this.cursorPosition.node=a,this.cursorPosition.offset=d.length-1},moveRight:function(){},moveUp:function(){},moveDown:function(){},getLineCount:function(){return this.doc.documentElement.childNodes.length},
_splitNodeIfNeed:function(){var a=this.cursorPosition.offset,b=this.cursorPosition.node,c=b.textContent,e=c.length;if(0<a&&a<e)e=c.substring(0,a),a=c.substring(a),c=this.doc.createElement(b.nodeName),b.textContent=e,c.textContent=a,h.insertNodeAfter(c,b)},_getFocusLine:function(){for(var a=this.getFocusNode();a&&"line"!=a.nodeName;)a=a.parentNode;return a},_isNotSameNode:function(a,b){return a==b.nodeName},_isLineNode:function(a){return"line"==a.nodeName},_isTextNode:function(a){return"text"==a.nodeName},
_insertChar:function(a){this.cursorPosition.node.textContent=i.insertAtOffset(this.cursorPosition.node.textContent,this.cursorPosition.offset,a);this.cursorPosition.offset+=1},getXML:function(){return 0==this.doc.firstChild.firstChild.childNodes.length?"":a.innerXML(this.doc)},getPath:function(){var a="";c.forEach(this.path,function(b){a+="/";a+=b.nodeName;b.offset&&(a+="["+b.offset+"]")});return a},getFocusNode:function(){return this.cursorPosition.node},getOffset:function(){return this.cursorPosition.offset},
getLineAt:function(a){return this.doc.documentElement.childNodes[a]},getHTML:function(){return j.xmlDocToHtml(this.doc)},onChange:function(){}})})},"dojox/xml/parser":function(){define("dojox/xml/parser",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/window","dojo/_base/sniff"],function(f){f.getObject("xml.parser",!0,dojox);dojox.xml.parser.parse=function(b,c){var e=f.doc,a,c=c||"text/xml";if(b&&f.trim(b)&&"DOMParser"in f.global){a=(new DOMParser).parseFromString(b,c);e=a.documentElement;
if("parsererror"==e.nodeName&&"http://www.mozilla.org/newlayout/xml/parsererror.xml"==e.namespaceURI){var i=e.getElementsByTagNameNS("http://www.mozilla.org/newlayout/xml/parsererror.xml","sourcetext")[0];if(i)i=i.firstChild.data;throw Error("Error parsing text "+e.firstChild.data+" \n"+i);}return a}if("ActiveXObject"in f.global){e=function(a){return"MSXML"+a+".DOMDocument"};e=["Microsoft.XMLDOM",e(6),e(4),e(3),e(2)];f.some(e,function(b){try{a=new ActiveXObject(b)}catch(c){return!1}return!0});if(b&&
a&&(a.async=!1,a.loadXML(b),e=a.parseError,0!==e.errorCode))throw Error("Line: "+e.line+"\nCol: "+e.linepos+"\nReason: "+e.reason+"\nError Code: "+e.errorCode+"\nSource: "+e.srcText);if(a)return a}else if(e.implementation&&e.implementation.createDocument){if(b&&f.trim(b)&&e.createElement){i=e.createElement("xml");i.innerHTML=b;var j=e.implementation.createDocument("foo","",null);f.forEach(i.childNodes,function(a){j.importNode(a,!0)});return j}return e.implementation.createDocument("","",null)}return null};
dojox.xml.parser.textContent=function(b,c){if(1<arguments.length)return dojox.xml.parser.replaceChildren(b,(b.ownerDocument||f.doc).createTextNode(c)),c;if(void 0!==b.textContent)return b.textContent;var e="";b&&f.forEach(b.childNodes,function(a){switch(a.nodeType){case 1:case 5:e+=dojox.xml.parser.textContent(a);break;case 3:case 2:case 4:e+=a.nodeValue}});return e};dojox.xml.parser.replaceChildren=function(b,c){var e=[];f.isIE&&f.forEach(b.childNodes,function(a){e.push(a)});dojox.xml.parser.removeChildren(b);
f.forEach(e,f.destroy);f.isArray(c)?f.forEach(c,function(a){b.appendChild(a)}):b.appendChild(c)};dojox.xml.parser.removeChildren=function(b){for(var c=b.childNodes.length;b.hasChildNodes();)b.removeChild(b.firstChild);return c};dojox.xml.parser.innerXML=function(b){return b.innerXML?b.innerXML:b.xml?b.xml:"undefined"!=typeof XMLSerializer?(new XMLSerializer).serializeToString(b):null};return dojox.xml.parser})},"mathEditor/string":function(){define([],function(){var f={};f.splitData=function(b){for(var c=
b.length,e=[],a=0,f=!1,j="",h=0,k=0;k<c;k++){var d=b.charAt(k);"&"==d?(h=0,f=!0,j=d):f&&";"==d?(0==h?(e[a]=j,a++,e[a]=d):(j+=d,e[a]=j),a++,f=!1,j=""):f?(j+=d,h++):(e[a]=b.charAt(k),a++)}return e};f.insertAtOffset=function(b,c,e,a){var f=b.length;if(0>c||f<c)return b;a=b.substring(0,c-(a||0));b=b.substring(c);return a+e+b};return f})},"mathEditor/dataUtil":function(){define(["dojox/xml/parser","dojo/_base/array"],function(f,b){var c={};c.xmlDocToHtml=function(c){var a="";b.forEach(c.documentElement.childNodes,
function(c){var e="<div class='drip_line'>";b.forEach(c.childNodes,function(a){"text"==a.nodeName?e+="<span>"+a.textContent+"</span>":"math"==a.nodeName&&(a=f.innerXML(a),e+=a.replace(/&amp;/g,"&"))});e+="</div>";a+=e});return a};c.xmlStringToHtml=function(b){return this.xmlDocToHtml(f.parse(b))};return c})},"mathEditor/lang":function(){define("mathEditor/lang",["dojo/_base/array"],function(f){var b={};b.isNumber=function(b){return!isNaN(parseFloat(b))&&isFinite(b)};b.isOperator=function(b){return"+"==
b||"="==b||"-"==b||"&#xD7;"==b||"&#xF7;"==b?!0:!1};b.isNewLine=function(b){return"\n"===b};b.isTab=function(b){return"\t"===b};b.insertNodeAfter=function(b,e){var a=e.parentNode;a.lastChild==e?a.appendChild(b):a.insertBefore(b,e.nextSibling)};b._fontStyles={fontFamily:1,fontSize:1,fontWeight:1,fontStyle:1,lineHeight:1};b.isMathTokenNode=function(b){return this.isMathTokenName(b.nodeName)};b.isMathTokenName=function(b){var e=!1;f.forEach("mi,mn,mo,mtext,mspace,ms".split(","),function(a){b==a&&(e=!0)});
return e};b.measureTextSize=function(b,e){if(!this.measureNode){var a=document.createElement("div"),f=a.style;f.width=f.height="auto";f.left=f.top="-1000px";f.visibility="hidden";f.position="absolute";f.overflow="visible";f.whiteSpace="nowrap";document.body.appendChild(a);this.measureNode=a}a=this.measureNode;a.innerHTML=e;var f=a.style,j=window.getComputedStyle(b,null),h;for(h in this._fontStyles)f[h]=j[h];return{height:a.offsetHeight,width:a.offsetWidth}};return b})},"mathEditor/xmlUtil":function(){define("mathEditor/xmlUtil",
{createEmptyFrac:function(f){var b=f.createElement("mstyle");b.setAttribute("displaystyle","true");var c=f.createElement("mfrac"),e=f.createElement("mrow"),a=f.createElement("mrow"),i=this._getPlaceHolder(f),f=this._getPlaceHolder(f);b.appendChild(c);c.appendChild(e);c.appendChild(a);e.appendChild(i);a.appendChild(f);return{rootNode:b,focusNode:i}},_getPlaceHolder:function(f){f=f.createElement("mn");f.setAttribute("class","drip_placeholder_box");f.setAttribute("style","border:1px dotted black; padding:1px;background-color: #cccccc;color: #cccccc;");
f.textContent="8";return f}})},"mathEditor/View":function(){define("mathEditor/View","dojo/_base/declare,dojo/_base/lang,dojo/_base/array,dojo/_base/event,dojo/dom,dojo/dom-style,dojo/dom-class,dojo/dom-construct,dojo/dom-geometry,dojo/on,dojo/aspect,mathEditor/Model,mathEditor/layer/Cursor,mathEditor/lang".split(","),function(f,b,c,e,a,i,j,h,k,d,g,l,o,n){return f("mathEditor.View",null,{model:null,editorDiv:null,parentNode:null,textarea:null,readOnly:!1,focused:!1,constructor:function(a){b.mixin(this,
a);var a=this.editorDiv=h.create("div",{style:{"border-radius":"3px",height:"100%",width:"100%",border:"solid 1px #CCC",position:"absolute",cursor:"text"}},this.parentNode),c=this.textLayer=h.create("div",{"class":"drip_layer drip_text"},a);this.cursor=new o({parentEl:a});d(a,"mousedown",b.hitch(this,this._onMouseDownHandler));c.innerHTML=this.model.getHTML();g.after(this.model,"onChange",b.hitch(this,this._onChange))},_onMouseDownHandler:function(a){this._focus();e.stop(a)},_focus:function(){if(!1==
this.focused){this.focused=!0;var a=this.textarea,b=this.cursor;j.add(this.editorDiv,"drip_editor_focus");setTimeout(function(){a.focus();b.show()})}},_onChange:function(){this.textLayer.innerHTML=this.model.getHTML();MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.textLayer]);MathJax.Hub.Queue(b.hitch(this,this.showCursor))},blur:function(){if(!0==this.focused)this.focused=!1,j.remove(this.editorDiv,"drip_editor_focus"),this.cursor.hide()},showCursor:function(){var a=this._getCursorConfig();this.cursor.move(a);
this.textarea&&i.set(this.textarea,{top:a.top+"px",left:a.left+"px"})},moveLeft:function(){this.model.moveLeft();this.showCursor()},_getFocusInfo:function(){var b=this.textLayer,d=null,e=null;c.forEach(this.model.path,function(g){if("root"!=g.nodeName)if("line"==g.nodeName)b=b.childNodes[g.offset-1];else if("text"==g.nodeName||"math"==g.nodeName){if(b=c.filter(b.childNodes,function(a){return"span"==a.nodeName.toLowerCase()})[g.offset-1],"math"==g.nodeName)d=b.nextSibling.MathJax.elementJax.root}else d&&
(d=n.isMathTokenName(g.nodeName)?d.data[0]:d.data[g.offset-1],b=a.byId("MathJax-Span-"+d.spanID),j.contains(b,"mstyle")?"mstyle"!=g&&(d=d.data[g.offset-1],b=a.byId("MathJax-Span-"+d.spanID)):j.contains(b,"mrow")&&(e=b,"mrow"!=g&&(d=d.data[g.offset-1],b=a.byId("MathJax-Span-"+d.spanID))))});return{node:b,offset:this.model.getOffset(),mrowNode:e}},_getCursorConfig:function(){var a=0,b=0,d=0,g=0,a=this._getFocusInfo(),c=a.node,e=a.offset,b=this.getTextLayerPosition();if(a=a.mrowNode)var d=k.position(a),
a=d.y-b.y,d=d.h,f=k.position(c);else f=k.position(c),a=f.y-b.y,d=f.h;b=f.x-b.x;if(1==c.nodeType&&(f=c.childNodes,1==f.length&&3==f[0].nodeType))c.textContent.length==e?b+=c.offsetWidth:(g=c.textContent.substring(0,e),g=n.measureTextSize(c,g).width,b+=g);return{top:a,left:b,height:d,width:g}},getCursorPosition:function(){var a=this.getTextLayerPosition(),b=a.x,a=a.y,d=this.cursor.getCursorConfig(),b=b+d.left,a=a+(d.top+d.height);return{x:b,y:a}},getTextLayerPosition:function(){if(!this.textLayerPosition)this.textLayerPosition=
k.position(this.textLayer);return this.textLayerPosition}})})},"mathEditor/layer/Cursor":function(){define("dojo/_base/declare,dojo/_base/lang,dojo/dom-construct,dojo/dom-class,dojo/dom-style,dojo/dom-geometry".split(","),function(f,b,c){return f("mathEditor.layer.Cursor",null,{parentEl:null,caret:null,isVisible:!1,cursorConfig:{top:0,left:0},constructor:function(e){b.mixin(this,e);e=this.caret=c.create("div",{"class":"drip_cursor"},this.parentEl);e.style.visibility="hidden";this.defaultHeight=e.clientHeight;
this.cursorConfig.height=this.defaultHeight},show:function(){this.isVisible=!0;this.caret.style.visibility="";this._restartTimer()},move:function(b){if(!1!=this.isVisible){this.cursorConfig=b;var a=b.left,c=b.height,f=this.caret.style;f.top=b.top+"px";f.left=a+"px";if(c&&0<c)f.height=c+"px";this.caret.style.visibility="";this._restartTimer()}},getCursorConfig:function(){return this.cursorConfig},hide:function(){this.caret.style.visibility="hidden";this.isVisible=!1;clearInterval(this.intervalId);
this.intervalId=null;clearTimeout(this.timeoutId);this.timeoutId=null},_restartTimer:function(){if(null!=this.intervalId)clearInterval(this.intervalId),this.intervalId=null;var b=this.caret,a=this;this.intervalId=setInterval(function(){b.style.visibility="hidden";a.timeoutId=setTimeout(function(){b.style.visibility=""},400)},1E3)},destroy:function(){null!=this.intervalId&&clearInterval(this.intervalId);c.destroy(this.caret)}})})},"mathEditor/ContentAssist":function(){define("dojo/_base/declare,dojo/_base/array,dojo/_base/lang,dojo/on,dojo/dom-construct,dojo/dom-class,dojo/dom-style,dijit/popup,dijit/DropDownMenu,dijit/MenuItem,mathEditor/mathContentAssist".split(","),
function(f,b,c,e,a,i,j,h,k,d,g){return f("mathEditor.ContentAssist",k,{proposals:null,view:null,cacheString:"",opened:!1,postCreate:function(){this.inherited(arguments);e(this.view.editorDiv,"mousedown",c.hitch(this,function(){this.opened&&h.close(this)}))},startup:function(){this.inherited(arguments)},_scheduleOpen:function(a,b,d){view=this.view;var c=this;if(!this._openTimer)this._openTimer=this.defer(function(){delete this._openTimer;h.open({popup:a,x:b,y:d,onExecute:function(){h.close(a);view.focus();
c.opened=!1},onCancel:function(){h.close(a);c.opened=!1;view.focus()},onClose:function(){view.focus();c.opened=!1}});this.opened=!0;a.select()},0)},_open:function(){var a=this.view.getCursorPosition();this._scheduleOpen(this,a.x,a.y)},_clear:function(){var a=this.getChildren();b.forEach(a,c.hitch(this,function(a){this.removeChild(a)}))},_setProposals:function(a){this._clear();this.proposals=a;b.forEach(a,c.hitch(this,function(a){var b=new d({label:a.label,iconClass:a.iconClass});b.on("click",c.hitch(this,
this._onApplyProposal,a.map,a.nodeName));this.addChild(b)}))},show:function(a){this.cacheString=!1==this.opened?a:this.cacheString+a;a=g.getProposals(this.cacheString);this._setProposals(a);if(0<a.length)return this._open(),a[0].map;this.cacheString="";if(this.opened)h.close(this),this.opened=!1;return null},_onApplyProposal:function(a,b,d){this.apply(a,b,this.cacheString.length,d)},apply:function(){},enter:function(a){this.onItemClick(this.selectedChild,a)},select:function(){this.selectFirstChild()},
selectFirstChild:function(){this.selectChild(this._getFirstSelectableChild())},selectPrev:function(){this.selectChild(this._getNextSelectableChild(this.selectedChild,-1),!0)},selectNext:function(){this.selectChild(this._getNextSelectableChild(this.selectedChild,1))},_getFirstSelectableChild:function(){return this._getNextSelectableChild(null,1)},_getLastFocusableChild:function(){return this._getNextSelectableChild(null,-1)},_getNextSelectableChild:function(a,b){a&&(a=this._getSiblingOfChild(a,b));
for(var d=this.getChildren(),c=0;c<d.length;c++){a||(a=d[0<b?0:d.length-1]);if(a.isFocusable())return a;a=this._getSiblingOfChild(a,b)}return null},selectChild:function(a){if(a)this.selectedChild&&a!==this.selectedChild&&this.selectedChild._setSelected(!1),this.selectedChild=a,a._setSelected(!0)}})})},"dijit/DropDownMenu":function(){require({cache:{"url:dijit/templates/Menu.html":'<table class="dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role="menu" tabIndex="${tabIndex}"\n\t   data-dojo-attach-event="onkeydown:_onKeyDown" cellspacing="0">\n\t<tbody class="dijitReset" data-dojo-attach-point="containerNode"></tbody>\n</table>\n'}});
define("dijit/DropDownMenu",["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_OnDijitClickMixin","./_MenuBase"],function(f,b,c,e,a){return f("dijit.DropDownMenu",[a,e],{templateString:c,baseClass:"dijitMenu",postCreate:function(){this.inherited(arguments);var a=this.isLeftToRight();this._openSubMenuKey=a?b.RIGHT_ARROW:b.LEFT_ARROW;this._closeSubMenuKey=a?b.LEFT_ARROW:b.RIGHT_ARROW;this.connectKeyNavHandlers([b.UP_ARROW],[b.DOWN_ARROW])},_onKeyDown:function(a){if(!a.ctrlKey&&
!a.altKey)switch(a.keyCode){case this._openSubMenuKey:this._moveToPopup(a);a.stopPropagation();a.preventDefault();break;case this._closeSubMenuKey:if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else a.stopPropagation(),a.preventDefault()}}})})},"url:dijit/templates/Menu.html":'<table class="dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role="menu" tabIndex="${tabIndex}"\n\t   data-dojo-attach-event="onkeydown:_onKeyDown" cellspacing="0">\n\t<tbody class="dijitReset" data-dojo-attach-point="containerNode"></tbody>\n</table>\n',
"dijit/_MenuBase":function(){define("dijit/_MenuBase","dojo/_base/array,dojo/_base/declare,dojo/dom,dojo/dom-attr,dojo/dom-class,dojo/_base/lang,dojo/mouse,dojo/on,dojo/window,./a11yclick,./popup,./registry,./_Widget,./_CssStateMixin,./_KeyNavContainer,./_TemplatedMixin".split(","),function(f,b,c,e,a,i,j,h,k,d,g,l,o,n,m,q){return b("dijit._MenuBase",[o,q,m,n],{parentMenu:null,popupDelay:500,autoFocus:!1,childSelector:function(a){var b=l.byNode(a);return a.parentNode==this.containerNode&&b&&b.focus},
postCreate:function(){var a=this,b="string"==typeof this.childSelector?this.childSelector:i.hitch(this,"childSelector");this.own(h(this.containerNode,h.selector(b,j.enter),function(){a.onItemHover(l.byNode(this))}),h(this.containerNode,h.selector(b,j.leave),function(){a.onItemUnhover(l.byNode(this))}),h(this.containerNode,h.selector(b,d),function(b){a.onItemClick(l.byNode(this),b);b.stopPropagation();b.preventDefault()}));this.inherited(arguments)},onKeyboardSearch:function(a,b,d,c){this.inherited(arguments);
if(a&&(-1==c||a.popup&&1==c))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){if(this.currentPopup&&this.currentPopup._pendingClose_timer){var a=
this.currentPopup.parentMenu;a.focusedChild&&a.focusedChild._setSelected(!1);a.focusedChild=this.currentPopup.from_item;a.focusedChild._setSelected(!0);this._stopPendingCloseTimer(this.currentPopup)}},onItemHover:function(a){if(this.isActive&&(this.focusChild(a),a.popup&&!a.disabled&&!this.hover_timer))this.hover_timer=this.defer(i.hitch(this,"_openPopup",a),this.popupDelay);this.focusedChild&&this.focusChild(a);this._hoveredChild=a;a._set("hovering",!0)},_onChildBlur:function(a){this._stopPopupTimer();
a._setSelected(!1);var b=a.popup;if(b)this._stopPendingCloseTimer(b),b._pendingClose_timer=this.defer(function(){b._pendingClose_timer=null;if(b.parentMenu)b.parentMenu.currentPopup=null;g.close(b)},this.popupDelay)},onItemUnhover:function(a){this.isActive&&this._stopPopupTimer();if(this._hoveredChild==a)this._hoveredChild=null;a._set("hovering",!1)},_stopPopupTimer:function(){if(this.hover_timer)this.hover_timer=this.hover_timer.remove()},_stopPendingCloseTimer:function(a){if(a._pendingClose_timer)a._pendingClose_timer=
a._pendingClose_timer.remove()},_stopFocusTimer:function(){if(this._focus_timer)this._focus_timer=this._focus_timer.remove()},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){"undefined"==typeof this.isShowingNow&&this._markActive();this.focusChild(a);if(a.disabled)return!1;a.popup?this._openPopup(a,/^key/.test(b.type)):(this.onExecute(),a._onClick?a._onClick(b):a.onClick(b))},_openPopup:function(a,b){this._stopPopupTimer();var d=a.popup;if(!d.isShowingNow){this.currentPopup&&
(this._stopPendingCloseTimer(this.currentPopup),g.close(this.currentPopup));d.parentMenu=this;d.from_item=a;var c=this;g.open({parent:this,popup:d,around:a.domNode,orient:this._orient||["after","before"],onCancel:function(){c.focusChild(a);c._cleanUp();a._setSelected(!0);c.focusedChild=a},onExecute:i.hitch(this,"_cleanUp")});this.currentPopup=d;d.connect(d.domNode,"onmouseenter",i.hitch(c,"_onPopupHover"))}if(b&&d.focus)d._focus_timer=this.defer(i.hitch(d,function(){this._focus_timer=null;this.focus()}))},
_markActive:function(){this.isActive=!0;a.replace(this.domNode,"dijitMenuActive","dijitMenuPassive")},onOpen:function(){this.isShowingNow=!0;this._markActive()},_markInactive:function(){this.isActive=!1;a.replace(this.domNode,"dijitMenuPassive","dijitMenuActive")},onClose:function(){this._stopFocusTimer();this._markInactive();this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();if(this.currentPopup)0<=f.indexOf(this._focusManager.activeStack,this.id)&&(e.set(this.focusedChild.focusNode,
"tabIndex",this.tabIndex),this.focusedChild.focusNode.focus()),g.close(this.currentPopup),this.currentPopup=null;this.focusedChild&&(this.focusedChild._setSelected(!1),this.onItemUnhover(this.focusedChild));e.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex","-1"),this._set("focusedChild",null))},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild)},_onBlur:function(){this._cleanUp();this.inherited(arguments)},
_cleanUp:function(){this._closeChild();"undefined"==typeof this.isShowingNow&&this._markInactive()}})})},"dijit/_KeyNavContainer":function(){define("dijit/_KeyNavContainer","dojo/_base/array,dojo/_base/declare,dojo/dom-attr,dojo/_base/kernel,dojo/keys,dojo/_base/lang,./registry,./_Container,./_FocusMixin,./_KeyNavMixin".split(","),function(f,b,c,e,a,i,j,h,k,d){return b("dijit._KeyNavContainer",[k,h,d],{connectKeyNavHandlers:function(b,d){var c=this._keyNavCodes={},e=i.hitch(this,"focusPrev"),k=i.hitch(this,
"focusNext");f.forEach(b,function(a){c[a]=e});f.forEach(d,function(a){c[a]=k});c[a.HOME]=i.hitch(this,"focusFirstChild");c[a.END]=i.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){e.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);f.forEach(this.getChildren(),i.hitch(this,"_startupChild"))},addChild:function(a,b){this.inherited(arguments);this._startupChild(a)},_startupChild:function(a){a.set("tabIndex","-1")},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,
1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},_getNextFocusableChild:function(a,b){a&&(a=this._getSiblingOfChild(a,b));for(var d=this.getChildren(),
c=0;c<d.length;c++){a||(a=d[0<b?0:d.length-1]);if(a.isFocusable())return a;a=this._getSiblingOfChild(a,b)}return null},childSelector:function(a){return(a=j.byNode(a))&&a.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dijit/_KeyNavMixin","dojo/_base/array,dojo/_base/declare,dojo/dom-attr,dojo/keys,dojo/_base/lang,dojo/on,dijit/registry,dijit/_FocusMixin".split(","),function(f,b,c,e,a,i,j,h){return b("dijit._KeyNavMixin",h,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);
c.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var b=this._keyNavCodes={};b[e.HOME]=a.hitch(this,"focusFirstChild");b[e.END]=a.hitch(this,"focusLastChild");b[this.isLeftToRight()?e.LEFT_ARROW:e.RIGHT_ARROW]=a.hitch(this,"_onLeftArrow");b[this.isLeftToRight()?e.RIGHT_ARROW:e.LEFT_ARROW]=a.hitch(this,"_onRightArrow");b[e.UP_ARROW]=a.hitch(this,"_onUpArrow");b[e.DOWN_ARROW]=a.hitch(this,"_onDownArrow")}var d=this,b="string"==typeof this.childSelector?this.childSelector:a.hitch(this,
"childSelector");this.own(i(this.domNode,"keypress",a.hitch(this,"_onContainerKeypress")),i(this.domNode,"keydown",a.hitch(this,"_onContainerKeydown")),i(this.domNode,"focus",a.hitch(this,"_onContainerFocus")),i(this.containerNode,i.selector(b,"focusin"),function(a){d._onChildFocus(j.getEnclosingWidget(this),a)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},focusFirstChild:function(){},focusLastChild:function(){},
focusChild:function(a,b){a&&(this.focusedChild&&a!==this.focusedChild&&this._onChildBlur(this.focusedChild),a.set("tabIndex",this.tabIndex),a.focus(b?"end":"start"))},_onContainerFocus:function(a){a.target!==this.domNode||this.focusedChild||this.focusFirstChild()},_onFocus:function(){c.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(a){c.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex","-1"),this._set("focusedChild",null));
this.inherited(arguments)},_onChildFocus:function(a){if(a&&a!=this.focusedChild)this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),a.set("tabIndex",this.tabIndex),this.lastFocused=a,this._set("focusedChild",a)},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(a){a&&this.focusChild(a)},_keyboardSearchCompare:function(a,b){var c=a.domNode,c=(a.label||(c.focusNode?c.focusNode.label:"")||c.innerText||c.textContent||"").replace(/^\s+/,"").substr(0,
b.length).toLowerCase();return b.length&&c==b?-1:0},_onContainerKeydown:function(a){var b=this._keyNavCodes[a.keyCode];if(b)b(a,this.focusedChild),a.stopPropagation(),a.preventDefault(),this._searchString=""},_onContainerKeypress:function(b){if(!(32>=b.charCode||b.ctrlKey||b.altKey)){var c=null,e,f=0,h=a.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=i;var a=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;e=this._searchString.substr(0,a);this._searchTimer=
this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var b=this.focusedChild||null;if(1==a||!b)if(b=this._getNextFocusableChild(b,1),!b)return;a=b;do{var h=this._keyboardSearchCompare(b,e);h&&0==f++&&(c=b);if(-1==h){f=-1;break}b=this._getNextFocusableChild(b,1)}while(b!=a)}),i=String.fromCharCode(b.charCode).toLowerCase();h();this.onKeyboardSearch(c,b,e,f)}},_onChildBlur:function(){},_getNextFocusableChild:function(){return null}})})},"dijit/MenuItem":function(){require({cache:{"url:dijit/templates/MenuItem.html":'<tr class="dijitReset dijitMenuItem" data-dojo-attach-point="focusNode" role="menuitem" tabIndex="-1">\n\t<td class="dijitReset dijitMenuItemIconCell" role="presentation">\n\t\t<img src="${_blankGif}" alt="" class="dijitIcon dijitMenuItemIcon" data-dojo-attach-point="iconNode"/>\n\t</td>\n\t<td class="dijitReset dijitMenuItemLabel" colspan="2" data-dojo-attach-point="containerNode,textDirNode"></td>\n\t<td class="dijitReset dijitMenuItemAccelKey" style="display: none" data-dojo-attach-point="accelKeyNode"></td>\n\t<td class="dijitReset dijitMenuArrowCell" role="presentation">\n\t\t<div data-dojo-attach-point="arrowWrapper" style="visibility: hidden">\n\t\t\t<img src="${_blankGif}" alt="" class="dijitMenuExpand"/>\n\t\t\t<span class="dijitMenuExpandA11y">+</span>\n\t\t</div>\n\t</td>\n</tr>\n'}});
define("dijit/MenuItem","dojo/_base/declare,dojo/dom,dojo/dom-attr,dojo/dom-class,dojo/_base/kernel,dojo/sniff,dojo/_base/lang,./_Widget,./_TemplatedMixin,./_Contained,./_CssStateMixin,dojo/text!./templates/MenuItem.html".split(","),function(f,b,c,e,a,i,j,h,k,d,g,l){j=f("dijit.MenuItem"+(i("dojo-bidi")?"_NoBidi":""),[h,k,d,g],{templateString:l,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",a);var b="",c;c=a.search(/{\S}/);if(0<=c){var b=a.charAt(c+1),d=a.substr(0,c),
a=a.substr(c+3);c=d+b+a;a=d+'<span class="dijitMenuItemShortcutKey">'+b+"</span>"+a}else c=a;this.domNode.setAttribute("aria-label",c+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){a&&!("label"in this.params)&&this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);c.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&
c.set(this.accelKeyNode,"id",this.id+"_accel");b.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==i("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(a){}},_onFocus:function(){this._setSelected(!0);this.getParent()._onItemFocus(this);this.inherited(arguments)},_setSelected:function(a){e.toggle(this.domNode,"dijitMenuItemSelected",a)},setLabel:function(b){a.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",
b)},setDisabled:function(b){a.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",b)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){if(this.accelKeyNode)this.accelKeyNode.style.display=a?"":"none",this.accelKeyNode.innerHTML=a,c.set(this.containerNode,"colSpan",a?"1":"2");this._set("accelKey",a)}});i("dojo-bidi")&&(j=f("dijit.MenuItem",
j,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return j})},"dijit/_Contained":function(){define("dijit/_Contained",["dojo/_base/declare","./registry"],function(f,b){return f("dijit._Contained",null,{_getSibling:function(c){var e=this.domNode;do e=e[c+"Sibling"];while(e&&1!=e.nodeType);return e&&b.byNode(e)},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},
getIndexInParent:function(){var b=this.getParent();return!b||!b.getIndexOfChild?-1:b.getIndexOfChild(this)}})})},"url:dijit/templates/MenuItem.html":'<tr class="dijitReset dijitMenuItem" data-dojo-attach-point="focusNode" role="menuitem" tabIndex="-1">\n\t<td class="dijitReset dijitMenuItemIconCell" role="presentation">\n\t\t<img src="${_blankGif}" alt="" class="dijitIcon dijitMenuItemIcon" data-dojo-attach-point="iconNode"/>\n\t</td>\n\t<td class="dijitReset dijitMenuItemLabel" colspan="2" data-dojo-attach-point="containerNode,textDirNode"></td>\n\t<td class="dijitReset dijitMenuItemAccelKey" style="display: none" data-dojo-attach-point="accelKeyNode"></td>\n\t<td class="dijitReset dijitMenuArrowCell" role="presentation">\n\t\t<div data-dojo-attach-point="arrowWrapper" style="visibility: hidden">\n\t\t\t<img src="${_blankGif}" alt="" class="dijitMenuExpand"/>\n\t\t\t<span class="dijitMenuExpandA11y">+</span>\n\t\t</div>\n\t</td>\n</tr>\n',
"mathEditor/mathContentAssist":function(){define(["dojo/_base/array"],function(f){return{keywords:[{input:"/",map:"&#xF7;",nodeName:"mo",freq:0,label:"\u9664\u53f7",iconClass:"drip_equation_icon drip_division"},{input:"/",map:"/",nodeName:"text",freq:0,label:"/",iconClass:""},{input:"/",map:"",nodeName:"mfrac",freq:0,label:"\u5206\u6570",iconClass:"drip_equation_icon drip_frac"},{input:"*",map:"&#xD7;",nodeName:"mo",freq:0,label:"\u4e58\u53f7",iconClass:"drip_equation_icon drip_multiplication"},{input:"*",
map:"*",nodeName:"text",freq:0,label:"*",iconClass:""}],getProposals:function(b){return f.filter(this.keywords,function(c){return 0==c.input.indexOf(b)})}}})}}});
define("mathEditor/Editor","dojo/_base/declare,dojo/_base/lang,dojo/_base/event,dijit/_WidgetBase,dojo/on,dojo/sniff,dojo/keys,dojo/aspect,dojo/dom-construct,dojo/dom-style,dojo/dom-class,mathEditor/Model,mathEditor/View,mathEditor/ContentAssist".split(","),function(f,b,c,e,a,i,j,h,k,d,g,l,o,n){return f("mathEditor.Editor",[e],{model:null,view:null,textarea:null,value:"",_getValueAttr:function(){return this.model.getXML()},_setValueAttr:function(a){this.model.clear();a&&""!=a&&this.model.setData({data:a})},
postCreate:function(){this.inherited(arguments);d.set(this.domNode,{position:"relative"});var e=this.textarea=k.create("textarea",{style:{position:"absolute"}},this.domNode);g.add(e,"drip_text_input");e.wrap="off";e.autocorrect="off";e.autocapitalize="off";e.spellcheck=!1;var f=this.model=new l;this.view=new o({model:this.model,parentNode:this.domNode,textarea:this.textarea});var r=this.contentAssist=new n({view:this.view});h.after(r,"apply",function(a,b,c){f.setData({data:a,nodeName:b,removeCount:c});
setTimeout(function(){e.value=""})},!0);if(i("chrome"))a(e,"textInput",b.hitch(this,function(a){this._onTextInput(a.data)}));else{var p=!1;a(e,"input",b.hitch(this,function(){if(!p)inputData=e.value,""!=inputData&&this._onTextInput(inputData)}));a(e,"compositionstart",b.hitch(this,function(){p=!0}));a(e,"compositionend",b.hitch(this,function(){p=!1}))}a(e,"blur",b.hitch(this,function(){this.view.blur()}));a(e,"keydown",b.hitch(this,function(a){a.keyCode===j.LEFT_ARROW?(this.model.moveLeft(),this.view.showCursor()):
a.keyCode===j.RIGHT_ARROW?this.model.moveRight():a.keyCode===j.UP_ARROW?this.contentAssist.opened?this.contentAssist.selectPrev():this.model.moveUp():a.keyCode===j.DOWN_ARROW?this.contentAssist.opened?this.contentAssist.selectNext():this.model.moveDown():a.keyCode===j.BACKSPACE?this.model.doDelete():a.altKey&&191===a.keyCode?(this.contentAssist.open(),c.stop(a)):a.keyCode===j.ENTER&&(this.contentAssist.opened?this.contentAssist.enter(a):this.model.setData({data:"\n"}),c.stop(a))}))},_onTextInput:function(a){var b=
this.contentAssist.show(a);null!=b&&(a=b);this.model.setData({data:a});var c=this.textarea;setTimeout(function(){c.value=""})}})});