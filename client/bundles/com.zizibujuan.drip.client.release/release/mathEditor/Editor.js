//>>built
require({cache:{"mathEditor/Model":function(){define("mathEditor/Model","dojo/_base/declare,dojo/_base/lang,dojo/_base/array,dojo/dom-construct,dojox/xml/parser,mathEditor/string,mathEditor/dataUtil,mathEditor/lang,mathEditor/xmlUtil".split(","),function(a,d,f,c,b,g,j,k,l){return a(null,{path:null,xmlString:null,doc:null,anchor:null,constructor:function(e){this._init();d.mixin(this,e)},_init:function(){this.doc=b.parse("<root><line></line></root>");this.path=[];this.anchor={};this.anchor.node=this.doc.documentElement.firstChild;
this.anchor.offset=0;this.path.push({nodeName:"root"});this.path.push({nodeName:"line",offset:1})},clear:function(){this._init();this.onChange()},loadData:function(){},setData:function(e){var i=e.data,h=e.nodeName;if((e=e.removeCount)&&0<e)for(var a=0;a<e;a++)this.removeLeft();var b=this.doc,e=this.anchor.node,a=this.anchor.offset;if(h&&""!=h){var m=1,o="last";this._isTextNode(e)&&(m=this.path.pop().offset+1,o="after");if("mfrac"==h)this._isLineNode(e)||this._isTextNode(e)?(this.path.push({nodeName:"math",
offset:m}),this.path.push({nodeName:"mfrac",offset:1}),this.path.push({nodeName:"mrow",offset:1}),this.path.push({nodeName:"mn",offset:1}),h=b.createElement("math"),a=l.createEmptyFrac(b),h.appendChild(a.rootNode),c.place(h,e,o)):(this.path.pop(),this.path.push({nodeName:"mfrac",offset:m}),this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),i=e.parentNode,o=m-1,a=l.createFracWithNumerator(b,e),c.place(a.rootNode,i,o)),this.anchor.node=a.focusNode,this.anchor.offset=
0;else if("msup"==h)this._isLineNode(e)||this._isTextNode(e)?(this.path.push({nodeName:"math",offset:m}),this.path.push({nodeName:"msup",offset:1}),this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),h=b.createElement("math"),a=l.createEmptyMsup(b),h.appendChild(a.rootNode),c.place(h,e,o)):(this.path.pop(),this.path.push({nodeName:"msup",offset:1}),this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),i=e.parentNode,a=l.createMsupWithBase(b,
e),c.place(a.rootNode,i,0)),this.anchor.node=a.focusNode,this.anchor.offset=0;else if("msub"==h)this._isLineNode(e)||this._isTextNode(e)?(this.path.push({nodeName:"math",offset:m}),this.path.push({nodeName:"msub",offset:1}),this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),h=b.createElement("math"),a=l.createEmptyMsub(b),h.appendChild(a.rootNode),c.place(h,e,o)):(this.path.pop(),this.path.push({nodeName:"msub",offset:1}),this.path.push({nodeName:"mrow",offset:2}),
this.path.push({nodeName:"mn",offset:1}),i=e.parentNode,a=l.createMsubWithBase(b,e),c.place(a.rootNode,i,0)),this.anchor.node=a.focusNode,this.anchor.offset=0;else if("msqrt"==h)this._isLineNode(e)||this._isTextNode(e)?(this.path.push({nodeName:"math",offset:m}),this.path.push({nodeName:"msqrt",offset:1}),this.path.push({nodeName:"mrow",offset:1}),this.path.push({nodeName:"mn",offset:1}),h=b.createElement("math"),m=l.createEmptyMsqrt(b),h.appendChild(m.rootNode),c.place(h,e,o)):(this.path.pop(),this.path.push({nodeName:"msqrt",
offset:a+1}),this.path.push({nodeName:"mrow",offset:1}),this.path.push({nodeName:"mn",offset:1}),i=e.parentNode,m=l.createEmptyMsqrt(b),c.place(m.rootNode,i,a)),this.anchor.node=m.focusNode,this.anchor.offset=0;else if("mroot"==h)this._isLineNode(e)||this._isTextNode(e)?(this.path.push({nodeName:"math",offset:m}),this.path.push({nodeName:"mroot",offset:1}),this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),h=b.createElement("math"),m=l.createEmptyMroot(b),h.appendChild(m.rootNode),
c.place(h,e,o)):(this.path.pop(),this.path.push({nodeName:"mroot",offset:a+1}),this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),i=e.parentNode,m=l.createEmptyMroot(b),c.place(m.rootNode,i,a)),this.anchor.node=m.focusNode,this.anchor.offset=0;else if("mi"==h&&/sin|cos|tan|cot/.test(i)&&(this._isLineNode(e)||this._isTextNode(e))){this.path.push({nodeName:"math",offset:a+1});this.path.push({nodeName:"mrow",offset:3});this.path.push({nodeName:"mn",offset:1});var h=b.createElement("math"),
n=b.createElement("mi"),j=b.createElement("mo"),o=b.createElement("mrow"),m=l.getPlaceHolder(b);n.textContent=i;j.textContent="&#x2061;";o.appendChild(m);h.appendChild(n);h.appendChild(j);h.appendChild(o);c.place(h,e,a);this.anchor.node=m;this.anchor.offset=0}this.onChange()}else if(k.isFenced(i)){if(this._isLineNode(e)||this._isTextNode(e))this.path.push({nodeName:"math",offset:a+1}),this.path.push({nodeName:"mfenced",offset:1}),this.path.push({nodeName:"mrow",offset:1}),this.path.push({nodeName:"mn",
offset:1}),h=b.createElement("math"),n=b.createElement("mfenced"),o={"{":{left:"{",right:"}"},"[":{left:"[",right:"]"},"|":{left:"|",right:"|"}},"("!=i&&(n.setAttribute("open",o[i].left),n.setAttribute("close",o[i].right)),o=b.createElement("mrow"),m=l.getPlaceHolder(b),h.appendChild(n),n.appendChild(o),o.appendChild(m),c.place(h,e,a),this.anchor.node=m,this.anchor.offset=0;this.onChange()}else e=[],d.isString(i)?e=g.splitData(i):d.isArray(i)&&(e=i),f.forEach(e,d.hitch(this,function(e){var a=this.anchor.node;
if(k.isNumber(e)){var i="mn",d=a.nodeName;if("line"==d||"text"==d){var d=this.anchor.offset,h="last",m=1;if(this._isLineNode(a))h="last",m=1;else if(this._isTextNode(a)){this._splitNodeIfNeed();var f=this.path.pop();0<d?(h="after",m=f.offset+1):h="before"}var n=b.createElement("math"),g=b.createElement(i);n.appendChild(g);c.place(n,a,h);this.anchor.node=g;this.anchor.offset=0;this._insertChar(e);this.path.push({nodeName:"math",offset:m});this.path.push({nodeName:i,offset:1})}else if(k.isMathTokenNode(a)){a=
this.anchor.node;l.isPlaceHolder(a)&&l.removePlaceHolder(a);if(a.nodeName!=i)d=b.createElement(i),k.insertNodeAfter(d,a),this.anchor.node=d,this.anchor.offset=0,f=this.path.pop(),this.path.push({nodeName:i,offset:f.offset+1});this._insertChar(e)}}else if(k.isOperator(e)){var i="mo";this._isLineNode(a)?(n=b.createElement("math"),g=b.createElement(i),n.appendChild(g),this._updateAnchor(g,0),this._insertChar(e),this.path.push({nodeName:"math",offset:1}),this.path.push({nodeName:i,offset:1}),c.place(n,
a,d)):k.isMathTokenNode(a)?"="==e&&"mo"==a.nodeName&&"="==a.textContent?a.textContent+="=":"="==e&&"mo"==a.nodeName&&"!"==a.textContent?a.textContent+="=":(g=b.createElement(i),this._updateAnchor(g,0),this._insertChar(e),f=this.path.pop(),this.path.push({nodeName:i,offset:f.offset+1}),k.insertNodeAfter(g,a)):this._isTextNode(a)&&(n=b.createElement("math"),g=b.createElement(i),n.appendChild(g),this._updateAnchor(g,0),this._insertChar(e),f=this.path.pop(),this.path.push({nodeName:"math",offset:f.offset+
1}),this.path.push({nodeName:i,offset:1}),k.insertNodeAfter(n,a))}else if(k.isNewLine(e)){e=this._getFocusLine();a=this.doc.createElement("line");k.insertNodeAfter(a,e);this.anchor.node=a;this.anchor.offset=0;for(f=this.path.pop();"line"!=f.nodeName;)f=this.path.pop();this.path.push({nodeName:"line",offset:f.offset+1})}else if(this._isLineNode(a))h=d,i="text",g=b.createElement(i),this._updateAnchor(g,0),this.path.push({nodeName:i,offset:1}),this._insertChar(e),c.place(g,a,h);else if(this._isTextNode(a))this._insertChar(e);
else if(k.isMathTokenNode(a)){do f=this.path.pop();while(f&&"math"!=f.nodeName);i=b.createElement("text");for(n=a;"math"!=n.nodeName;)n=n.parentNode;k.insertNodeAfter(i,n);this.anchor.node=i;this.anchor.offset=0;this._insertChar(e);this.path.push({nodeName:"text",offset:f.offset+1})}})),this.onChange(i)},_updateAnchor:function(e,a){this.anchor.node=e;this.anchor.offset=a},doDelete:function(){if(""!=this.removeLeft())this.onChange()},removeLeft:function(){var e=this.anchor.offset,a=this.anchor.node,
b=a.textContent;if(0==e){e=a;if("text"!=a.nodeName&&"line"!=a.nodeName){for(;"math"!=e.nodeName;)e=e.parentNode;if(e=e.previousSibling){var a=e.textContent,c=a.length,b=g.insertAtOffset(a,c,"",1),c=c-1;""==b?(e.parentNode.removeChild(e),this.path.pop()):(e.textContent=b,this.anchor.node=e,this.anchor.offset=c);return c=a.charAt(c)}}else if("line"==a.nodeName&&1<this.getLineCount()){e=a.previousSibling;c=e.childNodes.length;if(0==c)this.anchor.node=e,this.anchor.offset=0,b=this.path.pop(),b.offset--,
this.path.push(b),a.parentNode.removeChild(a);else if(e=e.lastChild,"text"==e.nodeName)this.anchor.node=e,this.anchor.offset=e.textContent.length,b=this.path.pop(),b.offset--,this.path.push(b),this.path.push({nodeName:e.nodeName,offset:c}),a.parentNode.removeChild(a);else if("math"==e.nodeName){var d=e.childNodes.length,e=e.lastChild;this.anchor.node=e;this.anchor.offset=e.textContent.length;b=this.path.pop();b.offset--;this.path.push(b);this.path.push({nodeName:"math",offset:c});this.path.push({nodeName:e.nodeName,
offset:d});a.parentNode.removeChild(a)}return"\n"}return""}"mo"==a.nodeName?(c=a.textContent,b=""):(c=b.charAt(e-1),b=g.insertAtOffset(b,e,"",1));if(""==b)if(e=a.previousSibling)"math"==e.nodeName?(d=e.childNodes.length,e=e.lastChild,this.anchor.node=e,this.anchor.offset=e.textContent.length,b=this.path.pop(),this.path.push({nodeName:"math",offset:b.offset-1}),this.path.push({nodeName:e.nodeName,offset:d}),a.parentNode.removeChild(a)):(this.anchor.node=e,this.anchor.offset=e.textContent.length,a.parentNode.removeChild(a),
this.path.push({nodeName:this.anchor.node.nodeName,offset:this.path.pop().offset-1}));else{d=b=a;if("text"!=a.nodeName&&"line"!=a.nodeName)for(;"math"!=d.nodeName;)b=d.parentNode,b.removeChild(d),d=b,this.path.pop();e=d.previousSibling;b=d.parentNode;b.removeChild(d);a=this.path.pop().offset;e?(this.anchor.node=e,this.anchor.offset=e.textContent.length,this.path.push({nodeName:this.anchor.node.nodeName,offset:a-1})):(this.anchor.node=b,this.anchor.offset=b.childElementCount)}else this.anchor.node.textContent=
b,this.anchor.offset-=1;return c},moveLeft:function(){var a=this.anchor.node,b=this.anchor.offset;if("line"==a.nodeName){if(b=a.previousSibling){b=b.lastChild;if("math"==b.nodeName)b=b.lastChild;a=b.textContent;this.anchor.node=b;this.anchor.offset=a.length}}else if(0<b)this.anchor.offset--;else if(0==b)if(b=a.previousSibling){if("math"==b.nodeName)b=b.lastChild;a=b.textContent;this.anchor.node=b;this.anchor.offset=a.length-1}else if(b=a.parentNode.previousSibling)if("line"==b.nodeName){b=b.lastChild;
if("math"==b.nodeName)b=b.lastChild;a=b.textContent;this.anchor.node=b;this.anchor.offset=a.length}else a=b.textContent,this.anchor.node=b,this.anchor.offset=a.length-1},moveRight:function(){},moveUp:function(){},moveDown:function(){},getLineCount:function(){return this.doc.documentElement.childNodes.length},_splitNodeIfNeed:function(){var a=this.anchor.offset,b=this.anchor.node,c=b.textContent,d=c.length;if(0<a&&a<d)d=c.substring(0,a),a=c.substring(a),c=this.doc.createElement(b.nodeName),b.textContent=
d,c.textContent=a,k.insertNodeAfter(c,b)},_getFocusLine:function(){for(var a=this.getFocusNode();a&&"line"!=a.nodeName;)a=a.parentNode;return a},_isNotSameNode:function(a,b){return a==b.nodeName},_isLineNode:function(a){return"line"==a.nodeName},_isTextNode:function(a){return"text"==a.nodeName},_insertChar:function(a){var b=this.anchor.node,c=this.anchor.offset,a=g.insertAtOffset(b.textContent,c,a);b.textContent=a;this._updateAnchor(b,c+1)},getXML:function(){return 0==this.doc.firstChild.firstChild.childNodes.length?
"":b.innerXML(this.doc)},isEmpty:function(){return""==this.getXML()},getPath:function(){var a="";f.forEach(this.path,function(b){a+="/";a+=b.nodeName;b.offset&&(a+="["+b.offset+"]")});return a},getFocusNode:function(){return this.anchor.node},getOffset:function(){return this.anchor.offset},getLineAt:function(a){return this.doc.documentElement.childNodes[a]},getHTML:function(){return j.xmlDocToHtml(this.doc)},onChange:function(){}})})},"dojox/xml/parser":function(){define("dojox/xml/parser",["dojo/_base/kernel",
"dojo/_base/lang","dojo/_base/array","dojo/_base/window","dojo/_base/sniff"],function(a){a.getObject("xml.parser",!0,dojox);dojox.xml.parser.parse=function(d,f){var c=a.doc,b,f=f||"text/xml";if(d&&a.trim(d)&&"DOMParser"in a.global){b=(new DOMParser).parseFromString(d,f);c=b.documentElement;if("parsererror"==c.nodeName&&"http://www.mozilla.org/newlayout/xml/parsererror.xml"==c.namespaceURI){var g=c.getElementsByTagNameNS("http://www.mozilla.org/newlayout/xml/parsererror.xml","sourcetext")[0];if(g)g=
g.firstChild.data;throw Error("Error parsing text "+c.firstChild.data+" \n"+g);}return b}if("ActiveXObject"in a.global){c=function(a){return"MSXML"+a+".DOMDocument"};c=["Microsoft.XMLDOM",c(6),c(4),c(3),c(2)];a.some(c,function(a){try{b=new ActiveXObject(a)}catch(c){return!1}return!0});if(d&&b&&(b.async=!1,b.loadXML(d),c=b.parseError,0!==c.errorCode))throw Error("Line: "+c.line+"\nCol: "+c.linepos+"\nReason: "+c.reason+"\nError Code: "+c.errorCode+"\nSource: "+c.srcText);if(b)return b}else if(c.implementation&&
c.implementation.createDocument){if(d&&a.trim(d)&&c.createElement){g=c.createElement("xml");g.innerHTML=d;var j=c.implementation.createDocument("foo","",null);a.forEach(g.childNodes,function(a){j.importNode(a,!0)});return j}return c.implementation.createDocument("","",null)}return null};dojox.xml.parser.textContent=function(d,f){if(1<arguments.length)return dojox.xml.parser.replaceChildren(d,(d.ownerDocument||a.doc).createTextNode(f)),f;if(void 0!==d.textContent)return d.textContent;var c="";d&&a.forEach(d.childNodes,
function(a){switch(a.nodeType){case 1:case 5:c+=dojox.xml.parser.textContent(a);break;case 3:case 2:case 4:c+=a.nodeValue}});return c};dojox.xml.parser.replaceChildren=function(d,f){var c=[];a.isIE&&a.forEach(d.childNodes,function(a){c.push(a)});dojox.xml.parser.removeChildren(d);a.forEach(c,a.destroy);a.isArray(f)?a.forEach(f,function(a){d.appendChild(a)}):d.appendChild(f)};dojox.xml.parser.removeChildren=function(a){for(var f=a.childNodes.length;a.hasChildNodes();)a.removeChild(a.firstChild);return f};
dojox.xml.parser.innerXML=function(a){return a.innerXML?a.innerXML:a.xml?a.xml:"undefined"!=typeof XMLSerializer?(new XMLSerializer).serializeToString(a):null};return dojox.xml.parser})},"mathEditor/string":function(){define([],function(){var a={};a.splitData=function(a){for(var f=a.length,c=[],b=0,g=!1,j="",k=0,l=0;l<f;l++){var e=a.charAt(l);"="==e&&"="==a.charAt(l+1)?(c[b]="==",b++,l++):"!"==e&&"="==a.charAt(l+1)?(c[b]="!=",b++,l++):"&"==e?(k=0,g=!0,j=e):g&&";"==e?(0==k?(c[b]=j,b++,c[b]=e):(j+=
e,c[b]=j),b++,g=!1,j=""):g?(j+=e,k++):(c[b]=a.charAt(l),b++)}return c};a.insertAtOffset=function(a,f,c,b){var g=a.length;if(0>f||g<f)return a;b=a.substring(0,f-(b||0));a=a.substring(f);return b+c+a};return a})},"mathEditor/dataUtil":function(){define(["dojox/xml/parser","dojo/_base/array"],function(a,d){var f={};f.xmlDocToHtml=function(c){var b="";d.forEach(c.documentElement.childNodes,function(c){var f="<div class='drip_line'>";d.forEach(c.childNodes,function(b){"text"==b.nodeName?f+="<span>"+b.textContent+
"</span>":"math"==b.nodeName&&(b=a.innerXML(b),f+=b.replace(/&amp;/g,"&"))});f+="</div>";b+=f});return b};f.xmlStringToHtml=function(c){return this.xmlDocToHtml(a.parse(c))};return f})},"mathEditor/lang":function(){define("mathEditor/lang",["dojo/_base/array"],function(a){var d={};d.isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)};d.isOperator=function(a){return/\+|-|=|==|<|>|!|!=|&#xD7;|&#xF7;|&#x2A7E;|&#x226B;|&#x2A7D;|&#x226A;|&#x2260;|&#x2248;/.test(a)?!0:!1};d.isNewLine=function(a){return"\n"===
a};d.isTab=function(a){return"\t"===a};d.isFenced=function(a){return/\(|\[|\{|\|/.test(a)};d.insertNodeAfter=function(a,c){var b=c.parentNode;b.lastChild==c?b.appendChild(a):b.insertBefore(a,c.nextSibling)};d._fontStyles={fontFamily:1,fontSize:1,fontWeight:1,fontStyle:1,lineHeight:1};d.isMathTokenNode=function(a){return this.isMathTokenName(a.nodeName)};d.isMathTokenName=function(d){var c=!1;a.forEach("mi,mn,mo,mtext,mspace,ms".split(","),function(a){d==a&&(c=!0)});return c};d.measureTextSize=function(a,
c){if(!this.measureNode){var b=document.createElement("div"),d=b.style;d.width=d.height="auto";d.left=d.top="-1000px";d.visibility="hidden";d.position="absolute";d.overflow="visible";d.whiteSpace="nowrap";document.body.appendChild(b);this.measureNode=b}b=this.measureNode;b.innerHTML=c;var d=b.style,j=window.getComputedStyle(a,null),k;for(k in this._fontStyles)d[k]=j[k];return{height:b.offsetHeight,width:b.offsetWidth}};return d})},"mathEditor/xmlUtil":function(){define("mathEditor/xmlUtil",{createEmptyFrac:function(a){var d=
a.createElement("mstyle");d.setAttribute("displaystyle","true");var f=a.createElement("mfrac"),c=a.createElement("mrow"),b=a.createElement("mrow"),g=this.getPlaceHolder(a),a=this.getPlaceHolder(a);d.appendChild(f);f.appendChild(c);f.appendChild(b);c.appendChild(g);b.appendChild(a);return{rootNode:d,focusNode:g}},createFracWithNumerator:function(a,d){var f=a.createElement("mstyle");f.setAttribute("displaystyle","true");var c=a.createElement("mfrac"),b=a.createElement("mrow"),g=a.createElement("mrow"),
j=this.getPlaceHolder(a);f.appendChild(c);c.appendChild(b);c.appendChild(g);b.appendChild(d);g.appendChild(j);return{rootNode:f,focusNode:j}},createEmptyMsup:function(a){var d=a.createElement("msup"),f=a.createElement("mrow"),c=a.createElement("mrow"),b=this.getPlaceHolder(a),a=this.getPlaceHolder(a);d.appendChild(f);d.appendChild(c);f.appendChild(b);c.appendChild(a);return{rootNode:d,focusNode:a}},createMsupWithBase:function(a,d){var f=a.createElement("msup"),c=a.createElement("mrow"),b=a.createElement("mrow"),
g=this.getPlaceHolder(a);f.appendChild(c);f.appendChild(b);c.appendChild(d);b.appendChild(g);return{rootNode:f,focusNode:g}},createEmptyMsub:function(a){var d=a.createElement("msub"),f=a.createElement("mrow"),c=a.createElement("mrow"),b=this.getPlaceHolder(a),a=this.getPlaceHolder(a);d.appendChild(f);d.appendChild(c);f.appendChild(b);c.appendChild(a);return{rootNode:d,focusNode:a}},createMsubWithBase:function(a,d){var f=a.createElement("msub"),c=a.createElement("mrow"),b=a.createElement("mrow"),g=
this.getPlaceHolder(a);f.appendChild(c);f.appendChild(b);c.appendChild(d);b.appendChild(g);return{rootNode:f,focusNode:g}},createEmptyMsqrt:function(a){var d=a.createElement("msqrt"),f=a.createElement("mrow"),a=this.getPlaceHolder(a);d.appendChild(f);f.appendChild(a);return{rootNode:d,focusNode:a}},createEmptyMroot:function(a){var d=a.createElement("mroot"),f=a.createElement("mrow"),c=a.createElement("mrow"),b=this.getPlaceHolder(a),a=this.getPlaceHolder(a);d.appendChild(f);d.appendChild(c);f.appendChild(b);
c.appendChild(a);return{rootNode:d,focusNode:a}},createTrigonometric:function(){},isPlaceHolder:function(a){return"drip_placeholder_box"===a.getAttribute("class")},removePlaceHolder:function(a){a.removeAttribute("class");a.removeAttribute("style");a.textContent=""},getPlaceHolder:function(a){a=a.createElement("mn");a.setAttribute("class","drip_placeholder_box");a.setAttribute("style","border:1px dotted black; padding:1px;background-color: #cccccc;color: #cccccc;");a.textContent="8";return a}})},"mathEditor/View":function(){define("mathEditor/View",
"dojo/_base/declare,dojo/_base/lang,dojo/_base/array,dojo/_base/event,dojo/dom,dojo/dom-style,dojo/dom-class,dojo/dom-construct,dojo/dom-geometry,dojo/on,dojo/aspect,mathEditor/Model,mathEditor/layer/Cursor,mathEditor/lang".split(","),function(a,d,f,c,b,g,j,k,l,e,i,h,q,p){return a("mathEditor.View",null,{model:null,editorDiv:null,parentNode:null,textarea:null,readOnly:!1,focused:!1,constructor:function(a){d.mixin(this,a);var a=this.editorDiv=k.create("div",{style:{"border-radius":"3px",height:"100%",
width:"100%",border:"solid 1px #CCC",position:"absolute",cursor:"text"}},this.parentNode),b=this.textLayer=k.create("div",{"class":"drip_layer drip_text"},a);this.cursor=new q({parentEl:a});e(a,"mousedown",d.hitch(this,this._onMouseDownHandler));b.innerHTML=this.model.getHTML();i.after(this.model,"onChange",d.hitch(this,this._onChange))},_onMouseDownHandler:function(a){this._focus();c.stop(a)},_focus:function(){if(!1==this.focused){this.focused=!0;var a=this.textarea,b=this.cursor;j.add(this.editorDiv,
"drip_editor_focus");setTimeout(function(){a.focus();b.show()},0)}},focus:function(){this._focus()},_onChange:function(){this.model.getHTML();this.textLayer.innerHTML=this.model.getHTML();MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.textLayer]);MathJax.Hub.Queue(d.hitch(this,this.showCursor))},blur:function(){if(!0==this.focused)this.focused=!1,j.remove(this.editorDiv,"drip_editor_focus"),this.cursor.hide()},showCursor:function(){var a=this._getCursorConfig();this.cursor.move(a);this.textarea&&g.set(this.textarea,
{top:a.top+"px",left:a.left+"px"})},moveLeft:function(){this.model.moveLeft();this.showCursor()},_getFocusInfo:function(){var a=this.textLayer,c=null,e=null;f.forEach(this.model.path,function(d){if("root"!=d.nodeName)if("line"==d.nodeName)a=a.childNodes[d.offset-1];else if("text"==d.nodeName||"math"==d.nodeName){if(a=f.filter(a.childNodes,function(a){return"span"==a.nodeName.toLowerCase()})[d.offset-1],"math"==d.nodeName)c=a.nextSibling.MathJax.elementJax.root,c=c.data[0]}else if(c){var l=b.byId("MathJax-Span-"+
c.spanID);if(j.contains(l,"mrow"))if("mrow"!=d.nodeName){var h=b.byId("MathJax-Span-"+c.data[0].spanID);j.contains(h,"mstyle")?"mstyle"!=d.nodeName&&(c=c.data[0],c=c.data[0],c=c.data[d.offset-1],l=b.byId("MathJax-Span-"+c.spanID)):(e=l,c=c.data[d.offset-1],l=b.byId("MathJax-Span-"+c.spanID))}else{debugger;e=l;c=c.data[d.offset-1]}else c=p.isMathTokenName(d.nodeName)?c.data[0]:c.data[d.offset-1];a=b.byId("MathJax-Span-"+c.spanID)}});return{node:a,offset:this.model.getOffset(),mrowNode:e}},_getCursorConfig:function(){var a=
0,b=0,c=0,d=0,a=this._getFocusInfo(),e=a.node,f=a.offset,b=this.getTextLayerPosition();if(a=a.mrowNode)var c=l.position(a),a=c.y-b.y,c=c.h,h=l.position(e);else h=l.position(e),a=h.y-b.y,c=h.h;b=h.x-b.x;if(1==e.nodeType&&(h=e.childNodes,1==h.length&&3==h[0].nodeType))if(e.textContent.length==f)b+=e.offsetWidth;else{d=0;f=e.textContent.substring(0,f);if(""!=f)d=p.measureTextSize(e,f).width;b+=d}return{top:a,left:b,height:c,width:d}},getCursorPosition:function(){var a=this.getTextLayerPosition(),b=a.x,
a=a.y,c=this.cursor.getCursorConfig(),b=b+c.left,a=a+(c.top+c.height);return{x:b,y:a}},getTextLayerPosition:function(){if(!this.textLayerPosition)this.textLayerPosition=l.position(this.textLayer);return this.textLayerPosition}})})},"mathEditor/layer/Cursor":function(){define("dojo/_base/declare,dojo/_base/lang,dojo/dom-construct,dojo/dom-class,dojo/dom-style,dojo/dom-geometry".split(","),function(a,d,f){return a("mathEditor.layer.Cursor",null,{parentEl:null,caret:null,isVisible:!1,cursorConfig:{top:0,
left:0},constructor:function(a){d.mixin(this,a);a=this.caret=f.create("div",{"class":"drip_cursor"},this.parentEl);a.style.visibility="hidden";this.defaultHeight=a.clientHeight;this.cursorConfig.height=this.defaultHeight},show:function(){this.isVisible=!0;this.caret.style.visibility="";this._restartTimer()},move:function(a){this.cursorConfig=a;var b=a.left,d=a.height,f=this.caret.style;f.top=a.top+"px";f.left=b+"px";if(d&&0<d)f.height=d+"px";if(!1!=this.isVisible)this.caret.style.visibility="",this._restartTimer()},
getCursorConfig:function(){return this.cursorConfig},hide:function(){this.caret.style.visibility="hidden";this.isVisible=!1;clearInterval(this.intervalId);this.intervalId=null;clearTimeout(this.timeoutId);this.timeoutId=null},_restartTimer:function(){if(null!=this.intervalId)clearInterval(this.intervalId),this.intervalId=null;var a=this.caret,b=this;this.intervalId=setInterval(function(){a.style.visibility="hidden";b.timeoutId=setTimeout(function(){a.style.visibility=""},400)},1E3)},destroy:function(){null!=
this.intervalId&&clearInterval(this.intervalId);f.destroy(this.caret)}})})},"mathEditor/ContentAssist":function(){define("dojo/_base/declare,dojo/_base/array,dojo/_base/lang,dojo/on,dojo/dom-construct,dojo/dom-class,dojo/dom-style,dijit/popup,dijit/DropDownMenu,dijit/MenuItem,mathEditor/mathContentAssist".split(","),function(a,d,f,c,b,g,j,k,l,e,i){return a("mathEditor.ContentAssist",l,{proposals:null,view:null,cacheString:"",opened:!1,postCreate:function(){this.inherited(arguments);c(this.view.editorDiv,
"mousedown",f.hitch(this,function(){this.opened&&k.close(this)}))},startup:function(){this.inherited(arguments)},_scheduleOpen:function(a,b,c){view=this.view;var d=this;if(!this._openTimer)this._openTimer=this.defer(function(){this._openTimer.remove();delete this._openTimer;k.open({popup:a,x:b,y:c,onExecute:function(){k.close(a);view.focus();d.opened=!1},onCancel:function(){k.close(a);d.opened=!1;view.focus()},onClose:function(){view.focus();d.opened=!1}});this.opened=!0;a.select()},0)},_open:function(){var a=
this.view.getCursorPosition();this._scheduleOpen(this,a.x,a.y);this.opened=!0},_clear:function(){var a=this.getChildren();d.forEach(a,f.hitch(this,function(a){this.removeChild(a)}))},_setProposals:function(a){this._clear();this.proposals=a;d.forEach(a,f.hitch(this,function(a){var b=new e({label:a.label+" ( \\"+a.input+" )",iconClass:a.iconClass});b.on("click",f.hitch(this,this._onApplyProposal,a.map,a.nodeName));this.addChild(b)}))},show:function(a){if(!1==this.opened)this.cacheString=a;else{var b=
i.getProposals(this.cacheString+a);this.cacheString=0==b.length?a:this.cacheString+a}b=i.getProposals(this.cacheString);this._setProposals(b);if(0<b.length)return this._open(),b[0].map;this.cacheString="";if(this.opened)k.close(this),this.opened=!1;return null},_onApplyProposal:function(a,b,c){this.apply(a,b,this.cacheString.length,c)},apply:function(){},enter:function(a){this.onItemClick(this.selectedChild,a)},select:function(){this.selectFirstChild()},selectFirstChild:function(){this.selectChild(this._getFirstSelectableChild())},
selectPrev:function(){this.selectChild(this._getNextSelectableChild(this.selectedChild,-1),!0)},selectNext:function(){this.selectChild(this._getNextSelectableChild(this.selectedChild,1))},_getFirstSelectableChild:function(){return this._getNextSelectableChild(null,1)},_getLastFocusableChild:function(){return this._getNextSelectableChild(null,-1)},_getNextSelectableChild:function(a,b){a&&(a=this._getSiblingOfChild(a,b));for(var c=this.getChildren(),d=0;d<c.length;d++){a||(a=c[0<b?0:c.length-1]);if(a.isFocusable())return a;
a=this._getSiblingOfChild(a,b)}return null},selectChild:function(a){if(a)this.selectedChild&&a!==this.selectedChild&&this.selectedChild._setSelected(!1),this.selectedChild=a,a._setSelected(!0)}})})},"dijit/DropDownMenu":function(){require({cache:{"url:dijit/templates/Menu.html":'<table class="dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role="menu" tabIndex="${tabIndex}"\n\t   data-dojo-attach-event="onkeydown:_onKeyDown" cellspacing="0">\n\t<tbody class="dijitReset" data-dojo-attach-point="containerNode"></tbody>\n</table>\n'}});
define("dijit/DropDownMenu",["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_OnDijitClickMixin","./_MenuBase"],function(a,d,f,c,b){return a("dijit.DropDownMenu",[b,c],{templateString:f,baseClass:"dijitMenu",postCreate:function(){this.inherited(arguments);var a=this.isLeftToRight();this._openSubMenuKey=a?d.RIGHT_ARROW:d.LEFT_ARROW;this._closeSubMenuKey=a?d.LEFT_ARROW:d.RIGHT_ARROW;this.connectKeyNavHandlers([d.UP_ARROW],[d.DOWN_ARROW])},_onKeyDown:function(a){if(!a.ctrlKey&&
!a.altKey)switch(a.keyCode){case this._openSubMenuKey:this._moveToPopup(a);a.stopPropagation();a.preventDefault();break;case this._closeSubMenuKey:if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else a.stopPropagation(),a.preventDefault()}}})})},"url:dijit/templates/Menu.html":'<table class="dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role="menu" tabIndex="${tabIndex}"\n\t   data-dojo-attach-event="onkeydown:_onKeyDown" cellspacing="0">\n\t<tbody class="dijitReset" data-dojo-attach-point="containerNode"></tbody>\n</table>\n',
"dijit/_MenuBase":function(){define("dijit/_MenuBase","dojo/_base/array,dojo/_base/declare,dojo/dom,dojo/dom-attr,dojo/dom-class,dojo/_base/lang,dojo/mouse,dojo/on,dojo/window,./a11yclick,./popup,./registry,./_Widget,./_CssStateMixin,./_KeyNavContainer,./_TemplatedMixin".split(","),function(a,d,f,c,b,g,j,k,l,e,i,h,q,p,m,o){return d("dijit._MenuBase",[q,o,m,p],{parentMenu:null,popupDelay:500,autoFocus:!1,childSelector:function(a){var b=h.byNode(a);return a.parentNode==this.containerNode&&b&&b.focus},
postCreate:function(){var a=this,b="string"==typeof this.childSelector?this.childSelector:g.hitch(this,"childSelector");this.own(k(this.containerNode,k.selector(b,j.enter),function(){a.onItemHover(h.byNode(this))}),k(this.containerNode,k.selector(b,j.leave),function(){a.onItemUnhover(h.byNode(this))}),k(this.containerNode,k.selector(b,e),function(b){a.onItemClick(h.byNode(this),b);b.stopPropagation();b.preventDefault()}));this.inherited(arguments)},onKeyboardSearch:function(a,b,c,d){this.inherited(arguments);
if(a&&(-1==d||a.popup&&1==d))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){if(this.currentPopup&&this.currentPopup._pendingClose_timer){var a=
this.currentPopup.parentMenu;a.focusedChild&&a.focusedChild._setSelected(!1);a.focusedChild=this.currentPopup.from_item;a.focusedChild._setSelected(!0);this._stopPendingCloseTimer(this.currentPopup)}},onItemHover:function(a){if(this.isActive&&(this.focusChild(a),a.popup&&!a.disabled&&!this.hover_timer))this.hover_timer=this.defer(g.hitch(this,"_openPopup",a),this.popupDelay);this.focusedChild&&this.focusChild(a);this._hoveredChild=a;a._set("hovering",!0)},_onChildBlur:function(a){this._stopPopupTimer();
a._setSelected(!1);var b=a.popup;if(b)this._stopPendingCloseTimer(b),b._pendingClose_timer=this.defer(function(){b._pendingClose_timer=null;if(b.parentMenu)b.parentMenu.currentPopup=null;i.close(b)},this.popupDelay)},onItemUnhover:function(a){this.isActive&&this._stopPopupTimer();if(this._hoveredChild==a)this._hoveredChild=null;a._set("hovering",!1)},_stopPopupTimer:function(){if(this.hover_timer)this.hover_timer=this.hover_timer.remove()},_stopPendingCloseTimer:function(a){if(a._pendingClose_timer)a._pendingClose_timer=
a._pendingClose_timer.remove()},_stopFocusTimer:function(){if(this._focus_timer)this._focus_timer=this._focus_timer.remove()},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){"undefined"==typeof this.isShowingNow&&this._markActive();this.focusChild(a);if(a.disabled)return!1;a.popup?this._openPopup(a,/^key/.test(b.type)):(this.onExecute(),a._onClick?a._onClick(b):a.onClick(b))},_openPopup:function(a,b){this._stopPopupTimer();var c=a.popup;if(!c.isShowingNow){this.currentPopup&&
(this._stopPendingCloseTimer(this.currentPopup),i.close(this.currentPopup));c.parentMenu=this;c.from_item=a;var d=this;i.open({parent:this,popup:c,around:a.domNode,orient:this._orient||["after","before"],onCancel:function(){d.focusChild(a);d._cleanUp();a._setSelected(!0);d.focusedChild=a},onExecute:g.hitch(this,"_cleanUp")});this.currentPopup=c;c.connect(c.domNode,"onmouseenter",g.hitch(d,"_onPopupHover"))}if(b&&c.focus)c._focus_timer=this.defer(g.hitch(c,function(){this._focus_timer=null;this.focus()}))},
_markActive:function(){this.isActive=!0;b.replace(this.domNode,"dijitMenuActive","dijitMenuPassive")},onOpen:function(){this.isShowingNow=!0;this._markActive()},_markInactive:function(){this.isActive=!1;b.replace(this.domNode,"dijitMenuPassive","dijitMenuActive")},onClose:function(){this._stopFocusTimer();this._markInactive();this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();if(this.currentPopup)0<=a.indexOf(this._focusManager.activeStack,this.id)&&(c.set(this.focusedChild.focusNode,
"tabIndex",this.tabIndex),this.focusedChild.focusNode.focus()),i.close(this.currentPopup),this.currentPopup=null;this.focusedChild&&(this.focusedChild._setSelected(!1),this.onItemUnhover(this.focusedChild));c.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex","-1"),this._set("focusedChild",null))},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild)},_onBlur:function(){this._cleanUp();this.inherited(arguments)},
_cleanUp:function(){this._closeChild();"undefined"==typeof this.isShowingNow&&this._markInactive()}})})},"dijit/_KeyNavContainer":function(){define("dijit/_KeyNavContainer","dojo/_base/array,dojo/_base/declare,dojo/dom-attr,dojo/_base/kernel,dojo/keys,dojo/_base/lang,./registry,./_Container,./_FocusMixin,./_KeyNavMixin".split(","),function(a,d,f,c,b,g,j,k,l,e){return d("dijit._KeyNavContainer",[l,e,k],{connectKeyNavHandlers:function(c,d){var e=this._keyNavCodes={},f=g.hitch(this,"focusPrev"),l=g.hitch(this,
"focusNext");a.forEach(c,function(a){e[a]=f});a.forEach(d,function(a){e[a]=l});e[b.HOME]=g.hitch(this,"focusFirstChild");e[b.END]=g.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){c.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);a.forEach(this.getChildren(),g.hitch(this,"_startupChild"))},addChild:function(a,b){this.inherited(arguments);this._startupChild(a)},_startupChild:function(a){a.set("tabIndex","-1")},_getFirst:function(){var a=
this.getChildren();return a.length?a[0]:null},_getLast:function(){var a=this.getChildren();return a.length?a[a.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(a){return(a=j.byNode(a))&&a.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dijit/_KeyNavMixin","dojo/_base/array,dojo/_base/declare,dojo/dom-attr,dojo/keys,dojo/_base/lang,dojo/on,dijit/registry,dijit/_FocusMixin".split(","),
function(a,d,f,c,b,g,j,k){return d("dijit._KeyNavMixin",k,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);f.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var a=this._keyNavCodes={};a[c.HOME]=b.hitch(this,"focusFirstChild");a[c.END]=b.hitch(this,"focusLastChild");a[this.isLeftToRight()?c.LEFT_ARROW:c.RIGHT_ARROW]=b.hitch(this,"_onLeftArrow");a[this.isLeftToRight()?c.RIGHT_ARROW:c.LEFT_ARROW]=b.hitch(this,"_onRightArrow");a[c.UP_ARROW]=b.hitch(this,
"_onUpArrow");a[c.DOWN_ARROW]=b.hitch(this,"_onDownArrow")}var d=this,a="string"==typeof this.childSelector?this.childSelector:b.hitch(this,"childSelector");this.own(g(this.domNode,"keypress",b.hitch(this,"_onContainerKeypress")),g(this.domNode,"keydown",b.hitch(this,"_onContainerKeydown")),g(this.domNode,"focus",b.hitch(this,"_onContainerFocus")),g(this.containerNode,g.selector(a,"focusin"),function(a){d._onChildFocus(j.getEnclosingWidget(this),a)}))},_onLeftArrow:function(){},_onRightArrow:function(){},
_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(a,b){a&&(this.focusedChild&&a!==this.focusedChild&&this._onChildBlur(this.focusedChild),
a.set("tabIndex",this.tabIndex),a.focus(b?"end":"start"))},_onContainerFocus:function(a){a.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){f.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(a){f.set(this.domNode,"tabIndex",this.tabIndex);if(this.focusedChild)this.focusedChild.set("tabIndex","-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null);this.inherited(arguments)},_onChildFocus:function(a){if(a&&a!=this.focusedChild)this.focusedChild&&
!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),a.set("tabIndex",this.tabIndex),this.lastFocused=a,this._set("focusedChild",a)},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(a){a&&this.focusChild(a)},_keyboardSearchCompare:function(a,b){var c=a.domNode,c=(a.label||(c.focusNode?c.focusNode.label:"")||c.innerText||c.textContent||"").replace(/^\s+/,"").substr(0,b.length).toLowerCase();return b.length&&c==b?-1:0},_onContainerKeydown:function(a){var b=this._keyNavCodes[a.keyCode];
b?(b(a,this.focusedChild),a.stopPropagation(),a.preventDefault(),this._searchString=""):a.keyCode==c.SPACE&&this._searchTimer&&!a.ctrlKey&&!a.altKey&&!a.metaKey&&(a.stopImmediatePropagation(),a.preventDefault(),g.emit(this.domNode,"keypress",{charCode:c.SPACE,cancelable:!0,bubbles:!0}))},_onContainerKeypress:function(a){if(!(32>a.charCode||a.ctrlKey||a.altKey)){var c=null,d,f=0,g=b.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=j;var a=/^(.)\1*$/.test(this._searchString)?
1:this._searchString.length;d=this._searchString.substr(0,a);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var b=this.focusedChild||null;if(1==a||!b)if(b=this._getNextFocusableChild(b,1),!b)return;a=b;do{var g=this._keyboardSearchCompare(b,d);g&&0==f++&&(c=b);if(-1==g){f=-1;break}b=this._getNextFocusableChild(b,1)}while(b!=a)}),j=String.fromCharCode(a.charCode).toLowerCase();a.preventDefault();a.stopPropagation();g();this.onKeyboardSearch(c,
a,d,f)}},_onChildBlur:function(){},_getNextFocusableChild:function(a,b){var c=a;do{if(a)a=this._getNext(a,b);else if(a=this[0<b?"_getFirst":"_getLast"](),!a)break;if(null!=a&&a!=c&&a.isFocusable())return a}while(a!=c);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(a,b){if(a)for(a=a.domNode;a;)if((a=a[0>b?"previousSibling":"nextSibling"])&&"getAttribute"in a){var c=j.byNode(a);if(c)return c}return null}})})},"dijit/MenuItem":function(){require({cache:{"url:dijit/templates/MenuItem.html":'<tr class="dijitReset dijitMenuItem" data-dojo-attach-point="focusNode" role="menuitem" tabIndex="-1">\n\t<td class="dijitReset dijitMenuItemIconCell" role="presentation">\n\t\t<img src="${_blankGif}" alt="" class="dijitIcon dijitMenuItemIcon" data-dojo-attach-point="iconNode"/>\n\t</td>\n\t<td class="dijitReset dijitMenuItemLabel" colspan="2" data-dojo-attach-point="containerNode,textDirNode"></td>\n\t<td class="dijitReset dijitMenuItemAccelKey" style="display: none" data-dojo-attach-point="accelKeyNode"></td>\n\t<td class="dijitReset dijitMenuArrowCell" role="presentation">\n\t\t<div data-dojo-attach-point="arrowWrapper" style="visibility: hidden">\n\t\t\t<img src="${_blankGif}" alt="" class="dijitMenuExpand"/>\n\t\t\t<span class="dijitMenuExpandA11y">+</span>\n\t\t</div>\n\t</td>\n</tr>\n'}});
define("dijit/MenuItem","dojo/_base/declare,dojo/dom,dojo/dom-attr,dojo/dom-class,dojo/_base/kernel,dojo/sniff,dojo/_base/lang,./_Widget,./_TemplatedMixin,./_Contained,./_CssStateMixin,dojo/text!./templates/MenuItem.html".split(","),function(a,d,f,c,b,g,j,k,l,e,i,h){j=a("dijit.MenuItem"+(g("dojo-bidi")?"_NoBidi":""),[k,l,e,i],{templateString:h,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",a);var b="",c;c=a.search(/{\S}/);if(0<=c){var b=a.charAt(c+1),d=a.substr(0,c),
a=a.substr(c+3);c=d+b+a;a=d+'<span class="dijitMenuItemShortcutKey">'+b+"</span>"+a}else c=a;this.domNode.setAttribute("aria-label",c+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){a&&!("label"in this.params)&&this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);f.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&
f.set(this.accelKeyNode,"id",this.id+"_accel");d.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==g("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(a){}},_onFocus:function(){this._setSelected(!0);this.getParent()._onItemFocus(this);this.inherited(arguments)},_setSelected:function(a){c.toggle(this.domNode,"dijitMenuItemSelected",a)},setLabel:function(a){b.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",
a)},setDisabled:function(a){b.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){if(this.accelKeyNode)this.accelKeyNode.style.display=a?"":"none",this.accelKeyNode.innerHTML=a,f.set(this.containerNode,"colSpan",a?"1":"2");this._set("accelKey",a)}});g("dojo-bidi")&&(j=a("dijit.MenuItem",
j,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return j})},"dijit/_Contained":function(){define("dijit/_Contained",["dojo/_base/declare","./registry"],function(a,d){return a("dijit._Contained",null,{_getSibling:function(a){var c=this.domNode;do c=c[a+"Sibling"];while(c&&1!=c.nodeType);return c&&d.byNode(c)},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},
getIndexInParent:function(){var a=this.getParent();return!a||!a.getIndexOfChild?-1:a.getIndexOfChild(this)}})})},"url:dijit/templates/MenuItem.html":'<tr class="dijitReset dijitMenuItem" data-dojo-attach-point="focusNode" role="menuitem" tabIndex="-1">\n\t<td class="dijitReset dijitMenuItemIconCell" role="presentation">\n\t\t<img src="${_blankGif}" alt="" class="dijitIcon dijitMenuItemIcon" data-dojo-attach-point="iconNode"/>\n\t</td>\n\t<td class="dijitReset dijitMenuItemLabel" colspan="2" data-dojo-attach-point="containerNode,textDirNode"></td>\n\t<td class="dijitReset dijitMenuItemAccelKey" style="display: none" data-dojo-attach-point="accelKeyNode"></td>\n\t<td class="dijitReset dijitMenuArrowCell" role="presentation">\n\t\t<div data-dojo-attach-point="arrowWrapper" style="visibility: hidden">\n\t\t\t<img src="${_blankGif}" alt="" class="dijitMenuExpand"/>\n\t\t\t<span class="dijitMenuExpandA11y">+</span>\n\t\t</div>\n\t</td>\n</tr>\n',
"mathEditor/mathContentAssist":function(){define(["dojo/_base/array"],function(a){return{keywords:[{input:"/",map:"&#xF7;",nodeName:"mo",freq:0,label:"\u9664\u53f7",iconClass:"drip_equation_icon drip_division"},{input:"/",map:"/",nodeName:"text",freq:0,label:"/",iconClass:""},{input:"/",map:"",nodeName:"mfrac",freq:0,label:"\u5206\u6570",iconClass:"drip_equation_icon drip_frac"},{input:"*",map:"&#xD7;",nodeName:"mo",freq:0,label:"\u4e58\u53f7",iconClass:"drip_equation_icon drip_multiplication"},{input:"*",
map:"*",nodeName:"text",freq:0,label:"*",iconClass:""},{input:"^",map:"^",nodeName:"text",freq:0,label:"^",iconClass:""},{input:"^",map:"",nodeName:"msup",freq:0,label:"\u4e0a\u6807",iconClass:"drip_equation_icon drip_sup"},{input:"_",map:"_",nodeName:"text",freq:0,label:"_",iconClass:""},{input:"_",map:"",nodeName:"msub",freq:0,label:"\u4e0b\u6807",iconClass:"drip_equation_icon drip_sub"},{input:"sqrt",map:"",nodeName:"msqrt",freq:0,label:"\u5e73\u65b9\u6839",iconClass:"drip_equation_icon drip_sqrt"},
{input:"sqrt",map:"",nodeName:"mroot",freq:0,label:"\u5f00\u6839\u53f7",iconClass:"drip_equation_icon drip_root"},{input:"sin",map:"sin",nodeName:"mi",freq:0,label:"sin",iconClass:""},{input:"cos",map:"cos",nodeName:"mi",freq:0,label:"cos",iconClass:""},{input:"tan",map:"tan",nodeName:"mi",freq:0,label:"tan",iconClass:""},{input:"cot",map:"cot",nodeName:"mi",freq:0,label:"cot",iconClass:""}],getProposals:function(d){return a.filter(this.keywords,function(a){return 0==a.input.indexOf(d)})}}})}}});
define("mathEditor/Editor","dojo/_base/declare,dojo/_base/lang,dojo/_base/event,dijit/_WidgetBase,dojo/on,dojo/sniff,dojo/keys,dojo/aspect,dojo/dom-construct,dojo/dom-style,dojo/dom-class,mathEditor/Model,mathEditor/View,mathEditor/ContentAssist".split(","),function(a,d,f,c,b,g,j,k,l,e,i,h,q,p){return a("mathEditor.Editor",[c],{model:null,view:null,textarea:null,value:"",_getValueAttr:function(){return this.model.getXML()},_setValueAttr:function(a){this.model.clear();a&&""!=a&&this.model.setData({data:a})},
postCreate:function(){this.inherited(arguments);e.set(this.domNode,{position:"relative"});var a=this.textarea=l.create("textarea",{style:{position:"absolute"}},this.domNode);i.add(a,"drip_text_input");a.wrap="off";a.autocorrect="off";a.autocapitalize="off";a.spellcheck=!1;var c=this.model=new h;this.view=new q({model:this.model,parentNode:this.domNode,textarea:this.textarea});var n=this.contentAssist=new p({view:this.view});k.after(n,"apply",function(b,d,e){c.setData({data:b,nodeName:d,removeCount:e});
setTimeout(function(){a.value=""})},!0);if(g("chrome"))b(a,"textInput",d.hitch(this,function(a){this._onTextInput(a.data)}));else{var r=!1;b(a,"input",d.hitch(this,function(){if(!r)inputData=a.value,""!=inputData&&this._onTextInput(inputData)}));b(a,"compositionstart",d.hitch(this,function(){r=!0}));b(a,"compositionend",d.hitch(this,function(){r=!1}))}b(a,"blur",d.hitch(this,function(){this.view.blur()}));b(a,"keydown",d.hitch(this,function(a){a.keyCode===j.LEFT_ARROW?(this.model.moveLeft(),this.view.showCursor()):
a.keyCode===j.RIGHT_ARROW?this.model.moveRight():a.keyCode===j.UP_ARROW?this.contentAssist.opened?this.contentAssist.selectPrev():this.model.moveUp():a.keyCode===j.DOWN_ARROW?this.contentAssist.opened?this.contentAssist.selectNext():this.model.moveDown():a.keyCode===j.BACKSPACE?this.model.doDelete():a.altKey&&191===a.keyCode?(this.contentAssist.open(),f.stop(a)):a.keyCode===j.ENTER?(this.contentAssist.opened?this.contentAssist.enter(a):this.model.setData({data:"\n"}),f.stop(a)):a.keyCode==j.TAB&&
(this.model.setData({data:"\t"}),f.stop(a))}))},_onTextInput:function(a){var b=this.contentAssist.show(a);null!=b&&(a=b);this.model.setData({data:a});var c=this.textarea;setTimeout(function(){c.value=""})}})});