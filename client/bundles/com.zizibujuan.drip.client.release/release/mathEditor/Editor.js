//>>built
require({cache:{"mathEditor/dom":function(){define({scrollbarWidth:function(){var l=document,g=l.createElement("div");g.style.width="100%";g.style.minWidth="0px";g.style.height="200px";g.style.display="block";var n=l.createElement("div"),h=n.style;h.position="absolute";h.left="-10000px";h.overflow="hidden";h.width="200px";h.minWidth="0px";h.height="150px";h.display="block";n.appendChild(g);l=l.documentElement;l.appendChild(n);var d=g.offsetWidth;h.overflow="scroll";g=g.offsetWidth;d==g&&(g=n.clientWidth);
l.removeChild(n);return d-g}})},"mathEditor/Model":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojox/xml/parser mathEditor/string mathEditor/dataUtil mathEditor/lang mathEditor/xmlUtil".split(" "),function(l,g,n,h,d,p,m,e,k){var q=e.STRING_FUNCTION_APPLICATION;return l(null,{path:null,xmlString:null,doc:null,mode:"text",anchor:null,constructor:function(a){this._init();g.mixin(this,a)},_init:function(a){if(!a||""==a)a="\x3croot\x3e\x3cline\x3e\x3c/line\x3e\x3c/root\x3e";
this.doc=d.parse(a);this.path=[];this.anchor={};this.mode="text";this.path.push({nodeName:"root"});this.path.push({nodeName:"line",offset:1});a=this.doc.documentElement.firstChild;0==e.getChildLength(a)?this.anchor.node=a:(a=a.firstChild,this.anchor.node=a,this.path.push({nodeName:a.nodeName,offset:1}));this.anchor.offset=0},clear:function(){this._init();this.onChanged()},loadData:function(a){this._init(a);this.onChanged()},isTextMode:function(){return"text"===this.mode},isMathMLMode:function(){return"mathml"===
this.mode},switchMode:function(){this.isTextMode()?this.toMathMLMode():this.isMathMLMode()&&this.toTextMode()},toTextMode:function(){this.mode="text";var a=this.anchor.node.nodeName;"line"!=a&&"text"!=a&&(this.anchor=this.mathMLToTextMode(this.anchor))},toMathMLMode:function(){this.mode="mathml";var a=this.anchor.node.nodeName;if("line"==a||"text"==a)this.anchor=this.textToMathMLMode(this.anchor,"math")},mathMLToTextMode:function(a){var b=a.node;a=a.offset;if("math"===b.nodeName&&0==b.childNodes.length){var c=
b.parentNode,f=null;if(1==c.childNodes.length)this.path.pop(),f=c,a=0;else if(b.previousSibling){var e=b.previousSibling,f=e;a=this._isTokenNode(e.nodeName)?this._getTextLength(e):1;this._movePathToPreviousSibling(e)}else if(b.nextSibling){var e=this.path.pop(),d=b.nextSibling,f=d;a=0;e.nodeName=d.nodeName;this.path.push(e)}c.removeChild(b);return{node:f,offset:a}}for(;"math"!=b.nodeName;)b=b.parentNode,this.path.pop();return{node:b,offset:1}},textToMathMLMode:function(a,b){var c=a.node,f=a.offset,
r=this.doc;if(this._isLineNode(c))r=r.createElement("math"),c.appendChild(r),this.path.push({nodeName:"math",offset:1}),c=r,f=2;else if(this._isTextNode(c)){this._splitNodeIfNeed(b);var r=r.createElement("math"),d=0,d=this.path.pop();0<f?(d=d.offset+1,e.insertNodeAfter(r,c)):(d=d.offset,e.insertNodeBefore(r,c));this.path.push({nodeName:"math",offset:d});c=r;f=2}return{node:c,offset:f}},_split:function(a){return a.split(/\r\n|\r|\n/)},_splitNodeByNewLine:function(a,b,c,f){var d=null,k=null,g=this.doc,
h=e.getText(a).length;0==b?(d=a.previousSibling,!d||"text"!=d.nodeName?(d=g.createElement("text"),e.setText(d,c),e.insertNodeBefore(d,a)):e.appendTextEnd(d,c),k=a,f&&""!=f&&e.appendTextStart(k,f)):b==h?(b=a.nextSibling,!b||"text"!=b.nodeName?(d=a,e.appendTextEnd(d,c),0<f.length&&(k=g.createElement("text"),e.setText(k,f),e.insertNodeAfter(k,a))):(e.appendTextEnd(a,c),d=a,k=b,e.appendTextStart(k,f))):0<b&&b<h&&(h=e.getText(a),e.setText(a,h.substring(0,b)+c),d=a,k=g.createElement("text"),e.setText(k,
f+h.substring(b)),e.insertNodeAfter(k,a));return{beforeNode:d,afterNode:k}},insertText:function(a,b){if(!b||0==b.length)return a;var c=a.node,f=a.offset,d=this.doc,k=this._split(b);if(1==k.length){var g=k[0];if(this._isLineNode(c)){var h="text",m=d.createElement(h);c.appendChild(m);c=m;this.path.push({nodeName:h,offset:1})}var l=e.getText(c),l=p.insertAtOffset(l,f,g);e.setText(c,l);f+=g.length;return{node:c,offset:f}}var q=k.splice(0,1)[0],g=k.splice(k.length-1,k.length)[0],s=null,l=s=m=null,t=0;
this._isLineNode(c)?l=this.path.pop():this._isTextNode(c)&&(this.path.pop(),l=this.path.pop());0==q.length?this._isLineNode(c)?g&&""!=g&&(m=d.createElement("text"),e.setText(m,g),c.appendChild(m)):(c=this._splitNodeByNewLine(c,f,q,g),s=c.beforeNode,m=c.afterNode):0<q.length&&(this._isLineNode(c)?(h="text",m=d.createElement(h),e.setText(m,q),c.appendChild(m),s=m,m=m.nextSibling,g&&""!=g&&(m||(m=d.createElement("text"),e.insertNodeAfter(m,s)),e.appendTextStart(m,g))):(c=this._splitNodeByNewLine(c,f,
q,g),s=c.beforeNode,m=c.afterNode));var t=k.length+1,h="line",u=this._getFocusLine();0<k.length&&n.forEach(k,function(a){var b=d.createElement(h);e.setText(b,a);e.insertNodeAfter(b,u);u=b});h="line";s=d.createElement(h);e.insertNodeAfter(s,u);if(m){c=m;do s.appendChild(c);while(c=c.nextSibling)}m?(this.path.push({nodeName:"line",offset:l.offset+t}),this.path.push({nodeName:"text",offset:1}),c=m,f=g.length):(this.path.push({nodeName:"line",offset:l.offset+t}),c=s,f=0);return{node:c,offset:f}},findTrigonometric:function(a,
b){for(var c=[],f=[],d=a.node,k=d;k&&("mi"==k.nodeName&&1==e.getText(k).length)&&!(c.unshift(e.getText(k)),k=d.previousSibling,2==c.length););if(2==c.length){if(d=c.join("")+b,e.isTrigonometric(d))return{functionName:d,preMis:c,nextMis:f}}else if(1==c.length){if((d=d.nextSibling)&&"mi"==d.nodeName&&1==e.getText(d).length)if(d=e.getText(d),d=c[0]+b+d,e.isTrigonometric(d))return{functionName:d,preMis:c,nextMis:f}}else if(0==c.length){d=d.nextSibling;for(f=[];d&&("mi"==d.nodeName&&1==e.getText(d).length)&&
!(f.push(e.getText(d)),d=d.nextSibling,2==f.length););if(2==f.length&&(d=b+f.join(""),e.isTrigonometric(d)))return{functionName:d,preMis:c,nextMis:f}}return null},removeExistTrigonometricPart:function(a,b){var c=a.node,f=a.offset,d=b.preMis.length;2==d?((f=c.previousSibling.previousSibling)?(d=this.path.pop(),d.offset-=2,this.path.push(d)):(f=c.parentNode,this.path.pop()),c.parentNode.removeChild(c.previousSibling),c.parentNode.removeChild(c),c=f,f=e.isMathLayoutNode(c)?2:"mi"==c.nodeName||"mo"==
c.nodeName?1:e.getText(c).length):1==d?(f=c.previousSibling,c.parentNode.removeChild(c.nextSibling),c.parentNode.removeChild(c),d=this.path.pop(),d.offset--,this.path.push(d),c=f,f="mi"==c.nodeName||"mo"==c.nodeName?1:e.getText(c).length):0==d&&(c.parentNode.removeChild(c.nextSibling),c.parentNode.removeChild(c.nextSibling),f="mi"==c.nodeName||"mo"==c.nodeName?1:e.getText(c).length);return{node:c,offset:f}},insertMi:function(a,b,c){var f=a.node;a=a.offset;var d=this.doc;if("math"===f.nodeName||"mrow"===
f.nodeName||e.isMathLayoutNode(f)){if(0===a)return this._insertNewTokenNodeBefore(c,b,f);if(1===a)return this._insertNewTokenNodeAfter(c,b,f);if(2===a)return a=d.createElement(c),e.setText(a,b),f.appendChild(a),this.path.push({nodeName:c,offset:1}),{node:a,offset:1}}if(0==a)return this._insertNewTokenNodeBefore(c,b,f);a!=this._getTextLength(f)&&this._splitNodeIfNeed(c);return this._insertNewTokenNodeAfter(c,b,f)},insertMo:function(a,b,c){var f=a.node;a=a.offset;var d=this.doc;if("math"===f.nodeName||
"msqrt"===f.nodeName)a=d.createElement(c),e.setText(a,b),f.appendChild(a),this.path.push({nodeName:c,offset:1}),f=a,a=1;else if("\x3d"==b&&"mo"==f.nodeName&&"\x3d"==e.getText(f))e.appendTextEnd(f,"\x3d");else if("\x3d"==b&&"mo"==f.nodeName&&"!"==e.getText(f))e.appendTextEnd(f,"\x3d");else{if(0==a)return this._insertNewTokenNodeBefore(c,b,f);"mn"===f.nodeName&&(0<a&&a<this._getTextLength(f))&&this._splitNodeIfNeed(c);a=d.createElement(c);e.setText(a,b);b=f.parentNode;this._isMstyleAndHasOneChild(b)?
e.insertNodeAfter(a,b):e.insertNodeAfter(a,f);f=a;a=1;b=this.path.pop();this.path.push({nodeName:c,offset:b.offset+1})}return{node:f,offset:a}},_isMstyleAndHasOneChild:function(a){return"mstyle"===a.nodeName&&1===e.getChildLength(a)},insertMn:function(a,b,c){var f=a.node;a=a.offset;var d=this.doc;if("math"===f.nodeName||"mrow"===f.nodeName||e.isMathLayoutNode(f)){if(0===a){if((d=f.previousSibling)&&"mn"===d.nodeName)e.appendTextEnd(d,b);else return this._insertNewTokenNodeBefore(c,b,f);return{node:f,
offset:a}}if(1===a){if((c=f.nextSibling)&&"mn"===c.nodeName)e.appendTextStart(c,b);else return this._insertNewTokenNodeAfter("mn",b,f);return{node:f,offset:a}}if(2===a)return d=d.createElement(c),e.setText(d,b),f.appendChild(d),this.path.push({nodeName:c,offset:1}),a=b.length,{node:d,offset:a}}if("mn"===f.nodeName)return c=e.getText(f),e.setText(f,p.insertAtOffset(c,a,b)),a+=b.length,{node:f,offset:a};if(0==a)if((d=f.previousSibling)&&"mn"===d.nodeName)e.appendTextEnd(d,b);else return this._insertNewTokenNodeBefore(c,
b,f);else if((c=f.nextSibling)&&"mn"===c.nodeName)e.appendTextStart(c,b);else return this._insertNewTokenNodeAfter("mn",b,f);return{node:f,offset:a}},_insertNewTokenNodeAfter:function(a,b,c){var f=this.doc.createElement(a);e.setText(f,b);var d=c.parentNode;this._isMstyleAndHasOneChild(d)?e.insertNodeAfter(f,d):e.insertNodeAfter(f,c);c=this.path.pop();this.path.push({nodeName:a,offset:c.offset+1});node=f;offset="mn"===a?b.length:1;return{node:node,offset:offset}},_insertNewTokenNodeBefore:function(a,
b,c){a=this.doc.createElement(a);e.setText(a,b);b=c.parentNode;this._isMstyleAndHasOneChild(b)?e.insertNodeBefore(a,b):e.insertNodeBefore(a,c);c=this.path.pop();c.offset++;this.path.push(c);return this.anchor},insertFenced:function(a,b,c){var f=a.node,d=a.offset;a=this.doc;if("math"==f.nodeName)return this.path.push({nodeName:c,offset:1}),this.path.push({nodeName:"mrow",offset:1}),this.path.push({nodeName:"mn",offset:1}),b=k.createEmptyMfenced(a,b),f.appendChild(b.rootNode),f=b.focusNode,{node:f,
offset:0};if(this._isMathMLNodeEnd(f,d))return d=this.path.pop(),d.offset++,d.nodeName=c,this.path.push(d),this.path.push({nodeName:"mrow",offset:1}),this.path.push({nodeName:"mn",offset:1}),b=k.createEmptyMfenced(a,b),c=f.parentNode,this._isMstyleAndHasOneChild(c)?e.insertNodeAfter(b.rootNode,c):e.insertNodeAfter(b.rootNode,f),f=b.focusNode,{node:f,offset:0};if(this._isMathMLNodeStart(f,d))return d=this.path.pop(),d.nodeName=c,this.path.push(d),this.path.push({nodeName:"mrow",offset:1}),this.path.push({nodeName:"mn",
offset:1}),b=k.createEmptyMfenced(a,b),c=f.parentNode,this._isMstyleAndHasOneChild(c)?e.insertNodeBefore(b.rootNode,c):e.insertNodeBefore(b.rootNode,f),f=b.focusNode,{node:f,offset:0}},insertTrigonometric:function(a,b,c){a=a.node;var f=this.doc;if("math"===a.nodeName){this.path.push({nodeName:"mrow",offset:3});this.path.push({nodeName:"mn",offset:1});c=f.createElement(c);var d=f.createElement("mo"),g=f.createElement("mrow"),f=k.getPlaceHolder(f);e.setText(c,b);e.setText(d,q);g.appendChild(f);a.appendChild(c);
a.appendChild(d);a.appendChild(g)}else d=this.path.pop(),this.path.push({nodeName:"mrow",offset:d.offset+3}),this.path.push({nodeName:"mn",offset:1}),c=f.createElement(c),d=f.createElement("mo"),g=f.createElement("mrow"),f=k.getPlaceHolder(f),e.setText(c,b),e.setText(d,q),g.appendChild(f),e.insertNodeAfter(c,a),e.insertNodeAfter(d,c),e.insertNodeAfter(g,d);return{node:f,offset:0}},insertInferredMfrac:function(a,b,c){a=a.node;var f=this.doc;"math"===a.nodeName?(this.path.push({nodeName:"mfrac",offset:1}),
this.path.push({nodeName:"mrow",offset:1}),this.path.push({nodeName:"mn",offset:1}),f=k.createEmptyFrac(f),a.appendChild(f.rootNode)):(b="last",this.path.pop(),this.path.push({nodeName:"mfrac",offset:1}),this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),c=a.parentNode,b=0,f=k.createFracWithNumerator(f,a),h.place(f.rootNode,c,b));a=f.focusNode;return{node:a,offset:0}},insertMfrac:function(a,b,c){b=a.node;var f=a.offset;a=this.doc;c=b.nodeName;if("math"===c&&2===f)return this.path.push({nodeName:"mfrac",
offset:1}),this.path.push({nodeName:"mrow",offset:1}),this.path.push({nodeName:"mn",offset:1}),c=k.createEmptyFrac(a),b.appendChild(c.rootNode),b=c.focusNode,{node:b,offset:0};if(this._isMathMLNodeEnd(b,f))return c=this.path.pop(),c.offset++,c.nodeName="mfrac",this.path.push(c),this.path.push({nodeName:"mrow",offset:1}),this.path.push({nodeName:"mn",offset:1}),c=k.createEmptyFrac(a),a=b.parentNode,this._isMstyleAndHasOneChild(a)?e.insertNodeAfter(c.rootNode,a):e.insertNodeAfter(c.rootNode,b),b=c.focusNode,
{node:b,offset:0};if(this._isMathMLNodeStart(b,f))return c=this.path.pop(),c.nodeName="mfrac",this.path.push(c),this.path.push({nodeName:"mrow",offset:1}),this.path.push({nodeName:"mn",offset:1}),c=k.createEmptyFrac(a),a=b.parentNode,this._isMstyleAndHasOneChild(a)?e.insertNodeBefore(c.rootNode,a):e.insertNodeBefore(c.rootNode,b),b=c.focusNode,{node:b,offset:0}},insertMsqrt:function(a,b,c){b=a.node;c=a.offset;a=this.doc;if("math"===b.nodeName||"msqrt"===b.nodeName||"mrow"===b.nodeName)return this.path.push({nodeName:"msqrt",
offset:1}),this.path.push({nodeName:"mn",offset:1}),a=k.createEmptyMsqrt(a),b.appendChild(a.rootNode),b=a.focusNode,{node:b,offset:0};if(this._isMathMLNodeEnd(b,c))return c=this.path.pop(),c.offset++,c.nodeName="msqrt",this.path.push(c),this.path.push({nodeName:"mn",offset:1}),a=k.createEmptyMsqrt(a),c=b.parentNode,this._isMstyleAndHasOneChild(c)?e.insertNodeAfter(a.rootNode,c):e.insertNodeAfter(a.rootNode,b),b=a.focusNode,{node:b,offset:0};if(this._isMathMLNodeStart(b,c))return c=this.path.pop(),
c.nodeName="msqrt",this.path.push(c),this.path.push({nodeName:"mn",offset:1}),a=k.createEmptyMsqrt(a),c=b.parentNode,this._isMstyleAndHasOneChild(c)?e.insertNodeBefore(a.rootNode,c):e.insertNodeBefore(a.rootNode,b),b=a.focusNode,{node:b,offset:0}},insertMroot:function(a,b,c){b=a.node;c=a.offset;a=this.doc;if("math"===b.nodeName)return this.path.push({nodeName:"mroot",offset:1}),this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),a=k.createEmptyMroot(a),b.appendChild(a.rootNode),
b=a.focusNode,{node:b,offset:0};if(this._isMathMLNodeEnd(b,c))return c=this.path.pop(),c.offset++,c.nodeName="mroot",this.path.push(c),this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),a=k.createEmptyMroot(a),c=b.parentNode,this._isMstyleAndHasOneChild(c)?e.insertNodeAfter(a.rootNode,c):e.insertNodeAfter(a.rootNode,b),b=a.focusNode,{node:b,offset:0};if(this._isMathMLNodeStart(b,c))return c=this.path.pop(),c.nodeName="mroot",this.path.push(c),this.path.push({nodeName:"mrow",
offset:2}),this.path.push({nodeName:"mn",offset:1}),a=k.createEmptyMroot(a),c=b.parentNode,this._isMstyleAndHasOneChild(c)?e.insertNodeBefore(a.rootNode,c):e.insertNodeBefore(a.rootNode,b),b=a.focusNode,{node:b,offset:0}},insertScripting:function(a,b,c){b=a.node;var f=a.offset;a=this.doc;if("math"===b.nodeName)return this.path.push({nodeName:c,offset:1}),this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),c=k.createEmptyScripting(a,c),b.appendChild(c.rootNode),b=c.focusNode,
{node:b,offset:0};if(0==f){if(f=b.previousSibling){var d=this.path.pop(),d=d.offset;return this._createScriptingAfter(f,d-1,c)}d=this.path.pop();d=d.offset;this.path.push({nodeName:c,offset:d});this.path.push({nodeName:"mrow",offset:2});this.path.push({nodeName:"mn",offset:1});c=k.createEmptyScripting(a,c);e.insertNodeBefore(c.rootNode,b);b=c.focusNode;return{node:b,offset:0}}d=this.path.pop();d=d.offset;return this._createScriptingAfter(b,d,c)},_createScriptingAfter:function(a,b,c){var f=this.doc;
"mo"===a.nodeName?(this.path.push({nodeName:c,offset:b+1}),this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),c=k.createEmptyScripting(f,c),e.insertNodeAfter(c.rootNode,a)):(this.path.push({nodeName:c,offset:b}),this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),a.previousSibling?(b=a.previousSibling,c=k.createScriptingWithBase(f,a,c),e.insertNodeAfter(c.rootNode,b)):a.nextSibling?(b=a.nextSibling,c=k.createScriptingWithBase(f,a,c),
e.insertNodeBefore(c.rootNode,b)):(b=a.parentNode,c=k.createScriptingWithBase(f,a,c),b.appendChild(c.rootNode)));a=c.focusNode;return{node:a,offset:0}},_splitNodeIfNeed:function(a){var b=this.anchor.offset,c=this.anchor.node;if(this._isTokenNode(c.nodeName)&&c.nodeName!=a){var f=e.getText(c);a=f.length;0<b&&b<a&&(a=f.substring(0,b),b=f.substring(b),f=this.doc.createElement(c.nodeName),e.setText(c,a),e.setText(f,b),e.insertNodeAfter(f,c))}},onChanging:function(a){},onChanged:function(a){},setData:function(a){var b=
a.data,c=a.nodeName,f=a.removeCount;if(f&&0<f)for(var d=0;d<f;d++)this.removeLeft();if(this.isTextMode()){var f=this.anchor.node,g=this.anchor.offset;if("math"===f.nodeName)if(0===g)c=f.previousSibling,g=this.path.pop(),!c||"text"!=c.nodeName?(c=this.doc,c=c.createElement("text"),e.insertNodeBefore(c,f)):g.offset--,g.nodeName=c.nodeName,this.path.push(g),"text"===c.nodeName&&(this.anchor.node=c,this.anchor.offset=e.getText(c).length);else if(1===g){c=f.nextSibling;if(!c||"text"!=c.nodeName)c=this.doc,
c=c.createElement("text"),e.insertNodeAfter(c,f);"text"===c.nodeName&&(this._movePathToNextSibling(c),this.anchor.node=c,this.anchor.offset=0)}this.anchor=this.insertText(this.anchor,b);this.onChanged(b)}else if(this.isMathMLMode()&&!e.isNewLine(b)){f={"^":"msup",_:"msub"};f[b]&&(c=f[b],b="");var f=this.anchor.node,h=d=!1;a=a.isCommandString;c?e.isGreekLetter(b)?d=!0:e.isTrigonometric(b)&&(h=!0):e.isLetter(b)?c="mi":e.isNumber(b)?c="mn":e.isOperator(b)?c="mo":e.isFenced(b)&&(c="mfenced");if("text"==
f.nodeName||"line"==f.nodeName)this.anchor=this.textToMathMLMode(this.anchor,c);f=this.anchor.node;g=this.anchor.offset;k.isPlaceHolder(f)&&(this.path.pop(),this.anchor.node=f.parentNode,this.anchor.offset=2,k.removePlaceHolder(f));var m={};m.data=b;this.onChanging(m);m=!1;if((this._isSupBaseMrow(f.parentNode)||this._isSubBaseMrow(f.parentNode))&&!("mn"===c&&"mn"===f.nodeName))0===g?(this.path.pop(),this.path.pop(),this.anchor.node=f.parentNode.parentNode,this.anchor.offset=0):("mo"===c?(this.anchor.node=
f.parentNode,this.anchor.offset=2,g=f.parentNode.parentNode,e.insertNodeBefore(f,g),f=this.doc.createElement("mo"),e.setText(f,b),e.insertNodeBefore(f,g),m=!0,this.path.pop(),this.path.pop(),g=this.path.pop(),g.offset+=2):(this.anchor.node=f.parentNode,this.anchor.offset=2,g=f.parentNode.parentNode,e.insertNodeBefore(f,g),this.path.pop(),this.path.pop(),g=this.path.pop(),g.offset++),this.path.push(g),this.path.push({nodeName:"mrow",offset:1}));if(m)f=this.anchor.node,c=k.getPlaceHolder(this.doc),
f.appendChild(c),this.path.push({nodeName:c.nodeName,offset:1}),this.anchor.node=c,this.anchor.offset=0;else if("mi"===c)a?this.anchor=this.insertMi(this.anchor,b,c):d?this.anchor=this.insertMi(this.anchor,b,c):h?this.anchor=this.insertTrigonometric(this.anchor,b,c):(f=this.findTrigonometric(this.anchor,b,c))?(this.anchor=this.removeExistTrigonometricPart(this.anchor,f),this.anchor=this.insertTrigonometric(this.anchor,f.functionName,c)):this.anchor=this.insertMi(this.anchor,b,c);else if("mn"===c)this.anchor=
this.insertMn(this.anchor,b,c);else if("mo"===c)this.anchor=this.insertMo(this.anchor,b,c);else if("mfenced"===c)this._splitNodeIfNeed(c),this.anchor=this.insertFenced(this.anchor,b,c);else if("mfrac"===c)this._splitNodeIfNeed(c),this.anchor=this.insertMfrac(this.anchor,b,c);else if("msqrt"===c)this._splitNodeIfNeed(c),this.anchor=this.insertMsqrt(this.anchor,b,c);else if("mroot"===c)this._splitNodeIfNeed(c),this.anchor=this.insertMroot(this.anchor,b,c);else if("msub"===c||"msup"==c)this._splitNodeIfNeed(c),
this.anchor=this.insertScripting(this.anchor,b,c);this.onChanged(b)}},_updateAnchor:function(a,b){this.anchor.node=a;this.anchor.offset=b},_removeEmptyDenominator:function(a){this.path.pop();this.path.pop();var b=this.path.pop();a=a.parentNode.previousSibling;var c=a.lastChild;"mstyle"==c.nodeName&&(c=c.lastChild);b.nodeName=c.nodeName;this.path.push(b);this.anchor.node=c;this._isTokenNode(c.nodeName)?this.anchor.offset=this._getTextLength(c):this.anchor.offset=1;b=a.parentNode;this._isMstyleAndHasOneChild(b.parentNode)&&
(b=b.parentNode);for(var c=a.childNodes.length,f=b.parentNode,d=0;d<c;d++)f.insertBefore(a.firstChild,b);f.removeChild(b)},_removeEmptyNumerator:function(a){this.path.pop();this.path.pop();var b=this.path.pop();a=a.parentNode.nextSibling;var c=a.firstChild;"mstyle"==c.nodeName&&(c=c.firstChild);b.nodeName=c.nodeName;this.path.push(b);this.anchor.node=c;this.anchor.offset=0;b=a.childNodes.length;c=a.parentNode;this._isMstyleAndHasOneChild(c.parentNode)&&(c=c.parentNode);for(var f=c.parentNode,d=0;d<
b;d++)f.insertBefore(a.firstChild,c);f.removeChild(c)},_removeEmptyRootBase:function(a){this.path.pop();this.path.pop();var b=this.path.pop();a=a.parentNode.nextSibling;var c=a.lastChild;b.nodeName=c.nodeName;this.path.push(b);this.anchor.node=c;this._isTokenNode(c.nodeName)?this.anchor.offset=this._getTextLength(c):this.anchor.offset=1;for(var b=a.childNodes.length,c=a.parentNode,f=c.parentNode,d=0;d<b;d++)f.insertBefore(a.firstChild,c);f.removeChild(c)},_removeEmptyRootIndex:function(a){this.path.pop();
this.path.pop();var b=this.path.pop();a=a.parentNode.previousSibling;var c=a.firstChild;b.nodeName=c.nodeName;this.path.push(b);this.anchor.node=c;this.anchor.offset=0;for(var b=a.childNodes.length,c=a.parentNode,f=c.parentNode,d=0;d<b;d++)f.insertBefore(a.firstChild,c);f.removeChild(c)},_removeLeftMathLayoutNode:function(a){this._isMstyleAndHasOneChild(a.parentNode)&&(a=a.parentNode);if(1==a.parentNode.childNodes.length){this._moveToTopLeft(a);var b=a.parentNode;b.removeChild(a);"math"===b.nodeName&&
0===e.getChildLength(b)&&(this.anchor.offset=2)}else if(a.previousSibling)b=a.previousSibling,"mstyle"===b.nodeName&&(b=b.lastChild),this._moveToPreviousSiblingEnd(b),a.parentNode.removeChild(a);else if(a.nextSibling){b=a.nextSibling;"mstyle"===b.nodeName&&(b=b.firstChild);var c=this.path.pop();c.nodeName=b.nodeName;this.path.push(c);this.anchor.node=b;this.anchor.offset=0;a.parentNode.removeChild(a)}},_removeRightMathLayoutNode:function(a){this._isMstyleAndHasOneChild(a.parentNode)&&(a=a.parentNode);
if(1==a.parentNode.childNodes.length){this._moveToTopLeft(a);var b=a.parentNode;b.removeChild(a);"math"===b.nodeName&&0===e.getChildLength(b)&&(this.anchor.offset=2)}else if(a.nextSibling){b=a.nextSibling;"mstyle"===b.nodeName&&(b=b.firstChild);var c=this.path.pop();c.nodeName=b.nodeName;this.path.push(c);this.anchor.node=b;this.anchor.offset=0;a.parentNode.removeChild(a)}else a.previousSibling&&(b=a.previousSibling,"mstyle"===b.nodeName&&(b=b.lastChild),this._moveToPreviousSiblingEnd(b),a.parentNode.removeChild(a))},
_replaceNodeWithPlaceHolder:function(a){var b=this.path.pop(),c=k.getPlaceHolder(this.doc);b.nodeName=c.nodeName;this.path.push(b);this.anchor.node=c;this.anchor.offset=0;a.parentNode.insertBefore(c,a);a.parentNode.removeChild(a)},_canRemoveLeftNode:function(a,b){var c=!1;this._isTokenNode(a.nodeName)?1==this._getTextLength(a)&&1==b&&(c=!0):1==b&&(c=!0);return c},_canRemoveRightNode:function(a,b){var c=!1;this._isTokenNode(a.nodeName)?1==this._getTextLength(a)&&0==b&&(c=!0):0==b&&(c=!0);return c},
_isSoleChildInMrow:function(a){return"mrow"===a.parentNode.nodeName&&1===e.getChildLength(a.parentNode)},_isSoleChildInMsqrt:function(a){return"msqrt"===a.parentNode.nodeName&&1===e.getChildLength(a.parentNode)},removeRight:function(){var a=this.anchor.offset,b=this.anchor.node,c=this._isLineEnd(this.anchor);if(c)if(a=c.nextSibling)if(0==a.childNodes.length)a.parentNode.removeChild(a);else if(0==c.childNodes.length)this._moveLineStart(a),c.parentNode.removeChild(c);else{this._moveLineEnd(c);"text"===
c.lastChild.nodeName&&"text"===a.firstChild.nodeName&&(e.appendTextEnd(c.lastChild,e.getText(a.firstChild)),a.removeChild(a.firstChild));for(var b=a.childNodes.length,f=0;f<b;f++)c.appendChild(a.firstChild);a.parentNode.removeChild(a)}else this._moveLineEnd(c);else if(this._isEmptyDenominator(b))this._removeEmptyDenominator(b);else if(this._isEmptyNumerator(b))this._removeEmptyNumerator(b);else if(this._isEmptySqrtBase(b))this.path.pop(),this._removeRightMathLayoutNode(b.parentNode);else if(this._isEmptyRootBase(b))this._removeEmptyRootBase(b);
else if(this._isEmptyRootIndex(b))this._removeEmptyRootIndex(b);else if((this._isSoleChildInMrow(b)||this._isSoleChildInMsqrt(b))&&this._canRemoveRightNode(b,a))this._replaceNodeWithPlaceHolder(b);else if(this._isTokenNode(b.nodeName))if(c=this._getTextLength(b),c==a)if(k.isPlaceHolder(b))a=b.parentNode,this.anchor.node=a,this.anchor.offset=0,this.path.pop(),a.removeChild(b),"math"===a.nodeName&&0==e.getChildLength(a)&&(this.anchor.offset=2);else{if(a=b.nextSibling)b=this._getTextLength(a),1==b?a.parentNode.removeChild(a):
(c=e.getText(a),e.setText(a,c.substring(1,b)))}else if(0==a)if(1==c){if(a=b.nextSibling)return c=this.path.pop(),c.nodeName=a.nodeName,this.path.push(c),this.anchor.node=a,this.anchor.offset=0,b.parentNode.removeChild(b),e.getText(b);if(a=b.previousSibling)this._moveToPreviousSiblingEnd(a),b.parentNode.removeChild(b);else return this.path.pop(),this.anchor.node=b.parentNode,"math"===b.parentNode.nodeName&&1===e.getChildLength(b.parentNode)?this.anchor.offset=2:this.anchor.offset=0,f=null,this._isTokenNode(b.nodeName)&&
(f=e.getText(b)),b.parentNode.removeChild(b),f}else return c=e.getText(b),f=c.charAt(a),a=p.insertAtOffset(c,a+1,"",1),e.setText(b,a),f;else return c=e.getText(b),f=c.charAt(a),a=p.insertAtOffset(c,a+1,"",1),e.setText(b,a),f;else e.isMathLayoutNode(b)&&this._removeRightMathLayoutNode(b)},removeLeft:function(){var a=this.anchor.offset,b=this.anchor.node,c=this._isLineStart(this.anchor);if(c)if(a=c.previousSibling){this._movePathToPreviousSibling(a);this._moveLineEnd(a);if(0<c.childNodes.length){"text"===
a.lastChild.nodeName&&"text"===c.firstChild.nodeName&&(e.appendTextEnd(a.lastChild,e.getText(c.firstChild)),c.removeChild(c.firstChild));for(var b=c.childNodes.length,f=0;f<b;f++)a.appendChild(c.firstChild)}c.parentNode.removeChild(c)}else this._moveLineStart(c);else if(this._isEmptyDenominator(b))this._removeEmptyDenominator(b);else if(this._isEmptyNumerator(b))this._removeEmptyNumerator(b);else if(this._isEmptySqrtBase(b))this.path.pop(),this._removeLeftMathLayoutNode(b.parentNode);else if(this._isEmptyRootBase(b))this._removeEmptyRootBase(b);
else if(this._isEmptyRootIndex(b))this._removeEmptyRootIndex(b);else if((this._isSoleChildInMrow(b)||this._isSoleChildInMsqrt(b))&&this._canRemoveLeftNode(b,a))this._replaceNodeWithPlaceHolder(b);else if(this._isTokenNode(b.nodeName))if(c=this._getTextLength(b),0==a)if(k.isPlaceHolder(b))this.anchor.node=b.parentNode,this.anchor.offset=0,this.path.pop(),a=b.parentNode,a.removeChild(b),"math"===a.nodeName&&0==e.getChildLength(a)&&(this.anchor.offset=2);else{if(a=b.previousSibling)b=this._getTextLength(a),
1==b?(b=this.path.pop(),b.offset--,this.path.push(b),a.parentNode.removeChild(a)):(c=e.getText(a),e.setText(a,c.substring(0,b-1)))}else{if(1<c)return c=e.getText(b),f=c.charAt(a-1),newText=p.insertAtOffset(c,a,"",1),e.setText(b,newText),this.anchor.offset--,f;if(1==c){if(a=b.previousSibling)return this._isMstyleAndHasOneChild(a)&&(a=a.firstChild),this.anchor.node=a,this._movePathToPreviousSibling(a),this._isTokenNode(a.nodeName)?this.anchor.offset=this._getTextLength(a):this.anchor.offset=1,b.parentNode.removeChild(b),
e.getText(b);this.path.pop();a=b.parentNode;this.anchor.node=a;"math"===a.nodeName&&1===e.getChildLength(a)?this.anchor.offset=2:this.anchor.offset=0;a.removeChild(b);return e.getText(b)}}else if(e.isMathLayoutNode(b))if(0===a){if(this._isMstyleAndHasOneChild(b.parentNode)&&(b=b.parentNode),(a=b.previousSibling)&&this._isTokenNode(a.nodeName))b=this._getTextLength(a),1==b?(b=this.path.pop(),b.offset--,this.path.push(b),a.parentNode.removeChild(a)):(c=e.getText(a),e.setText(a,c.substring(0,b-1)))}else 1===
a&&this._removeLeftMathLayoutNode(b)},_isTokenNode:function(a){return e.isMathTokenName(a)||"text"===a},_isEmptyDenominator:function(a){return k.isPlaceHolder(a)&&this._isDenominatorMrow(a.parentNode)},_isEmptyNumerator:function(a){return k.isPlaceHolder(a)&&this._isNumeratorMrow(a.parentNode)},_isEmptySqrtBase:function(a){return k.isPlaceHolder(a)&&this._isSqrt(a.parentNode)},_isEmptyRootBase:function(a){return k.isPlaceHolder(a)&&this._isRootBaseMrow(a.parentNode)},_isEmptyRootIndex:function(a){return k.isPlaceHolder(a)&&
this._isRootIndexMrow(a.parentNode)},_isDenominatorMrow:function(a){return a&&"mrow"===a.nodeName&&"mfrac"===a.parentNode.nodeName&&a.previousSibling},_isNumeratorMrow:function(a){return a&&"mrow"===a.nodeName&&"mfrac"===a.parentNode.nodeName&&a.nextSibling},_isSqrt:function(a){return"msqrt"===a.nodeName},_isRootIndexMrow:function(a){return a&&"mrow"===a.nodeName&&"mroot"===a.parentNode.nodeName&&a.previousSibling},_isRootBaseMrow:function(a){return a&&"mrow"===a.nodeName&&"mroot"===a.parentNode.nodeName&&
a.nextSibling},_isSupSuperscriptMrow:function(a){return a&&"mrow"===a.nodeName&&"msup"===a.parentNode.nodeName&&a.previousSibling},_isSubSubscriptMrow:function(a){return a&&"mrow"===a.nodeName&&"msub"===a.parentNode.nodeName&&a.previousSibling},_isSupBaseMrow:function(a){return a&&"mrow"===a.nodeName&&"msup"===a.parentNode.nodeName&&a.nextSibling},_isSubBaseMrow:function(a){return a&&"mrow"===a.nodeName&&"msub"===a.parentNode.nodeName&&a.nextSibling},_isLastFenceChildMrow:function(a){return a&&"mrow"===
a.nodeName&&"mfenced"===a.parentNode.nodeName&&null==a.nextSibling},_isFirstChildFenceChildMrow:function(a){return a&&"mrow"===a.nodeName&&"mfenced"===a.parentNode.nodeName&&null==a.previousSibling},_getTextLength:function(a){var b=0;if(k.isPlaceHolder(a))return 0;var c=a.nodeName;if("mn"===c||"text"===c)b=e.getText(a).length;else if("mo"===c||"mi"===c)b=1;return b},_isLineNode:function(a){return"line"===a.nodeName},_isLineStart:function(a){var b=a.node;a=a.offset;var c=b.nodeName;return"line"===
c?b:"text"===c&&0===a&&!b.previousSibling||"math"===c&&0===a&&!b.previousSibling?(this.path.pop(),b.parentNode):!1},_isLineEnd:function(a){var b=a.node;a=a.offset;var c=b.nodeName;return"line"===c?b:"text"===c&&a===e.getText(b).length&&!b.nextSibling||"math"===c&&1===a&&!b.nextSibling?(this.path.pop(),b.parentNode):!1},_isMathMLNodeEnd:function(a,b){return e.isMathTokenNode(a)&&this._getTextLength(a)===b||e.isMathLayoutNode(a)&&1===b},_isMathMLNodeStart:function(a,b){return 0!=b?!1:e.isMathTokenNode(a)||
e.isMathLayoutNode(a)},_movePathToNextSibling:function(a){var b=this.path.pop();b.offset++;b.nodeName=a.nodeName;this.path.push(b)},_movePathToPreviousSibling:function(a){var b=this.path.pop();b.offset--;b.nodeName=a.nodeName;this.path.push(b)},_moveLineStart:function(a){if(0===a.childNodes.length)this.anchor.node=a,this.anchor.offset=0;else{a=a.firstChild;var b=a.nodeName;"text"===b?(this.anchor.node=a,this.anchor.offset=0,this.path.push({nodeName:b,offset:1})):"math"===b&&(this.anchor.node=a,this.anchor.offset=
0,this.path.push({nodeName:b,offset:1}))}},_moveLineEnd:function(a){var b=a.childNodes.length;if(0===b)this.anchor.node=a,this.anchor.offset=0;else{a=a.lastChild;var c=a.nodeName;"text"===c?(this.anchor.node=a,this.anchor.offset=e.getText(a).length,this.path.push({nodeName:c,offset:b})):"math"===c&&(this.anchor.node=a,this.anchor.offset=1,this.path.push({nodeName:c,offset:b}))}},_moveToTopRight:function(a){this.path.pop();this.anchor.node=a.parentNode;this.anchor.offset=1},_moveToTopLeft:function(a){this.path.pop();
this.anchor.node=a.parentNode;this.anchor.offset=0},_moveInNodeStart:function(a){a=a.firstChild;"mstyle"===a.nodeName&&(a=a.firstChild);this.path.push({nodeName:a.nodeName,offset:1});this.anchor.node=a;this.anchor.offset=0},_moveInNodeEnd:function(a){var b=a.lastChild;"mstyle"===b.nodeName&&(b=b.lastChild);this.path.push({nodeName:b.nodeName,offset:a.childNodes.length});this.anchor.node=b;this._isTokenNode(b.nodeName)?this.anchor.offset=this._getTextLength(b):this.anchor.offset=1},_moveToPreviousSiblingEnd:function(a){this._movePathToPreviousSibling(a);
this.anchor.node=a;this._isTokenNode(a.nodeName)?this.anchor.offset=this._getTextLength(a):this.anchor.offset=1},_moveToNextSiblingStart:function(a){this._movePathToNextSibling(a);this.anchor.node=a;this.anchor.offset=0},_moveLeftToDenominatorEnd:function(a){a=a.lastChild;this.path.push({nodeName:a.nodeName,offset:2});var b=a.lastChild,c=1;this._isTokenNode(b.nodeName)?c=this._getTextLength(b):"mstyle"===b.nodeName&&(b=b.lastChild);this.path.push({nodeName:b.nodeName,offset:e.getChildLength(a)});
this.anchor.node=b;this.anchor.offset=c},_moveLeftDenominatorToNumerator:function(a){a=a.previousSibling;this._movePathToPreviousSibling(a);var b=a.lastChild;this._isTokenNode(b.nodeName)?(this.path.push({nodeName:b.nodeName,offset:a.childNodes.length}),this.anchor.node=b,this.anchor.offset=this._getTextLength(b)):("mstyle"===b.nodeName&&(b=b.lastChild),this.path.push({nodeName:b.nodeName,offset:b.parentNode.childNodes.length}),this.anchor.node=b,this.anchor.offset=1)},_moveRightToNumeratorStart:function(a){a=
a.firstChild;this.path.push({nodeName:a.nodeName,offset:1});a=a.firstChild;!this._isTokenNode(a.nodeName)&&"mstyle"===a.nodeName&&(a=a.firstChild);this.path.push({nodeName:a.nodeName,offset:1});this.anchor.node=a;this.anchor.offset=0},_moveRightNumeratorToDenominator:function(a){a=a.nextSibling;this._movePathToNextSibling(a);a=a.firstChild;!this._isTokenNode(a.nodeName)&&"mstyle"===a.nodeName&&(a=a.firstChild);this.path.push({nodeName:a.nodeName,offset:1});this.anchor.node=a;this.anchor.offset=0},
_moveRightMrootIndexToBase:function(a){a=a.previousSibling;this._movePathToPreviousSibling(a);a=a.firstChild;this.path.push({nodeName:a.nodeName,offset:1});this.anchor.node=a;this.anchor.offset=0},_moveLeftMrootBaseToIndex:function(a){var b=a.nextSibling;this._movePathToNextSibling(a);a=b.lastChild;this.path.push({nodeName:a.nodeName,offset:b.childNodes.length});this.anchor.node=a;this._isTokenNode(a.nodeName)?this.anchor.offset=this._getTextLength(a):this.anchor.offset=1},_moveLeftMsupSuperscriptToBase:function(a){a=
a.previousSibling;this._movePathToPreviousSibling(a);var b=a.lastChild;this.path.push({nodeName:b.nodeName,offset:a.childNodes.length});this.anchor.node=b;this._isTokenNode(b.nodeName)?this.anchor.offset=this._getTextLength(b):this.anchor.offset=1},_moveLeftMsubSubscriptToBase:function(a){this._moveLeftMsupSuperscriptToBase(a)},_moveRightMsupBaseToSuperscript:function(a){a=a.nextSibling;this._movePathToNextSibling(a);a=a.firstChild;this.path.push({nodeName:a.nodeName,offset:1});this.anchor.node=a;
this.anchor.offset=0},_moveRightMsubBaseToSubscript:function(a){this._moveRightMsupBaseToSuperscript(a)},_canMoveRightWithInToken:function(a){var b=a.node;if(k.isPlaceHolder(b))return!1;a=a.offset;return this._isTokenNode(b.nodeName)&&0<=a&&a<e.getText(b).length?!0:!1},_canMoveLeftWithInToken:function(a){var b=a.node;if(k.isPlaceHolder(b))return!1;a=a.offset;return this._isTokenNode(b.nodeName)&&0<a&&a<=e.getText(b).length?!0:!1},_moveRightToMsqrtBaseStart:function(a){a=a.firstChild;this.path.push({nodeName:a.nodeName,
offset:1});this.anchor.node=a;this.anchor.offset=0},_moveLeftToMsqrtBaseEnd:function(a){a=a.lastChild;this.path.push({nodeName:a.nodeName,offset:a.childNodes.length});this.anchor.node=a;this._isTokenNode(a.nodeName)?this.anchor.offset=this._getTextLength(a):this.anchor.offset=1},_moveLeftToMrootBaseEnd:function(a){a=a.firstChild;this.path.push({nodeName:a.nodeName,offset:1});var b=a.lastChild;this.path.push({nodeName:b.nodeName,offset:e.getChildLength(a)});this.anchor.node=b;this._isTokenNode(b.nodeName)?
this.anchor.offset=this._getTextLength(b):this.anchor.offset=1},_moveRightToMrootIndexStart:function(a){a=a.lastChild;this.path.push({nodeName:a.nodeName,offset:2});a=a.firstChild;this.path.push({nodeName:a.nodeName,offset:1});this.anchor.node=a;this.anchor.offset=0},_moveLeftToMsupSuperscriptEnd:function(a){a=a.lastChild;this.path.push({nodeName:a.nodeName,offset:2});var b=a.lastChild;this.path.push({nodeName:b.nodeName,offset:a.childNodes.length});this.anchor.node=b;this._isTokenNode(b.nodeName)?
this.anchor.offset=this._getTextLength(b):this.anchor.offset=1},_moveLeftToMsubSuperscriptEnd:function(a){this._moveLeftToMsupSuperscriptEnd(a)},_moveRightToMsupBaseStart:function(a){a=a.firstChild;this.path.push({nodeName:a.nodeName,offset:1});a=a.firstChild;this.path.push({nodeName:a.nodeName,offset:1});this.anchor.node=a;this.anchor.offset=0},_moveRightToMfencedInnerStart:function(a){a=a.firstChild;this.path.push({nodeName:a.nodeName,offset:1});a=a.firstChild;this.path.push({nodeName:a.nodeName,
offset:1});this.anchor.node=a;this.anchor.offset=0},_moveLeftToMfencedInnerEnd:function(a){a=a.lastChild;this.path.push({nodeName:a.nodeName,offset:1});var b=a.lastChild;this.path.push({nodeName:b.nodeName,offset:a.childNodes.length});this.anchor.node=b;this._isTokenNode(b.nodeName)?this.anchor.offset=this._getTextLength(b):this.anchor.offset=1},moveLeft:function(){var a=this.anchor.node,b=this.anchor.offset,c=this._isLineStart(this.anchor);if(c){var f=c.previousSibling;f?(this._movePathToPreviousSibling(f),
this._moveLineEnd(f)):this._moveLineStart(c)}else if(this._canMoveLeftWithInToken(this.anchor))this.anchor.offset--;else if(c=a.nodeName,"math"===c)if(1===b)a.lastChild?this._moveInNodeEnd(a):this.anchor.offset=2,this.mode="mathml";else if(2===b)this.anchor.offset=0,this.mode="text";else{if(0===b&&(f=a.previousSibling)&&"text"===f.nodeName)this._movePathToPreviousSibling(f),this.anchor.node=f,this.anchor.offset=e.getText(f).length-1,this.mode="text"}else if((f=a.previousSibling)&&"text"===a.nodeName&&
"math"===f.nodeName)this._movePathToPreviousSibling(f),0<e.getChildLength(f)?this._moveInNodeEnd(f):(this.anchor.node=f,this.anchor.offset=2),this.mode="mathml";else if("mfrac"===c&&1===b)b=a.lastChild,"mrow"===b.nodeName&&(this.path.push({nodeName:b.nodeName,offset:a.childNodes.length}),b=b.lastChild,"mstyle"===b.nodeName&&(b=b.lastChild),this.path.push({nodeName:b.nodeName,offset:b.parentNode.childNodes.length})),this.anchor.node=b,this._isTokenNode(b.nodeName)&&(this.anchor.offset=this._getTextLength(b));
else if("msqrt"===c&&1===b)this._moveLeftToMsqrtBaseEnd(a);else if("mroot"===c&&1===b)this._moveLeftToMrootBaseEnd(a);else if("msup"===c&&1===b)this._moveLeftToMsupSuperscriptEnd(a);else if("msub"===c&&1===b)this._moveLeftToMsubSuperscriptEnd(a);else if("mfenced"===c&&1===b)this._moveLeftToMfencedInnerEnd(a);else if(this._isTokenNode(c)&&0===b)if(f=a.previousSibling)"mstyle"===f.nodeName&&(f=f.lastChild),this._movePathToPreviousSibling(f),"msqrt"===f.nodeName?this._moveLeftToMsqrtBaseEnd(f):"mroot"===
f.nodeName?this._moveLeftToMrootBaseEnd(f):"msup"===f.nodeName?this._moveLeftToMsupSuperscriptEnd(f):"msub"===f.nodeName?this._moveLeftToMsubSuperscriptEnd(f):"mfenced"===f.nodeName?this._moveLeftToMfencedInnerEnd(f):"mfrac"===f.nodeName?this._moveLeftToDenominatorEnd(f):(this.anchor.node=f,a=this._getTextLength(f),this.anchor.offset=0<a?a-1:0);else{this.path.pop();if((a=a.parentNode)&&"mstyle"===a.nodeName)a=a.parentNode;this._isDenominatorMrow(a)?this._moveLeftDenominatorToNumerator(a):this._isNumeratorMrow(a)?
(this.path.pop(),this.anchor.node=a.parentNode):this._isSqrt(a)?(this.anchor.node=a,this.anchor.offset=0):this._isRootBaseMrow(a)?this._moveLeftMrootBaseToIndex(a):this._isRootIndexMrow(a)?this._moveToTopLeft(a):this._isSupSuperscriptMrow(a)?this._moveLeftMsupSuperscriptToBase(a):this._isSubSubscriptMrow(a)?this._moveLeftMsubSubscriptToBase(a):this._isSupBaseMrow(a)||this._isSubBaseMrow(a)?this._moveToTopLeft(a):this._isFirstChildFenceChildMrow(a)?this._moveToTopLeft(a):a&&(this.anchor.node=a,"math"===
a.nodeName&&(this.mode="text"))}else if(("mfrac"===c||"msqrt"===c||"mroot"===c||"msup"===c||"msub"===c||"mfenced"===c)&&0===b)"mstyle"===a.parentNode.nodeName&&(a=a.parentNode),(f=a.previousSibling)?("mstyle"===f.nodeName&&(f=f.lastChild),this._movePathToPreviousSibling(f),"msqrt"===f.nodeName?this._moveLeftToMsqrtBaseEnd(f):"mroot"===f.nodeName?this._moveLeftToMrootBaseEnd(f):"msup"===f.nodeName?this._moveLeftToMsupSuperscriptEnd(f):"msub"===f.nodeName?this._moveLeftToMsubSuperscriptEnd(f):"mfenced"===
f.nodeName?this._moveLeftToMfencedInnerEnd(f):"mfrac"===f.nodeName?this._moveLeftToDenominatorEnd(f):(this.anchor.node=f,a=this._getTextLength(f),this.anchor.offset=0<a?a-1:0)):(this.path.pop(),a=a.parentNode,"mstyle"===a.nodeName&&(a=a.parentNode),this._isDenominatorMrow(a)?this._moveLeftDenominatorToNumerator(a):this._isNumeratorMrow(a)?(this.path.pop(),this.anchor.node=a.parentNode):this._isSqrt(a)?(this.anchor.node=a,this.anchor.offset=0):this._isRootBaseMrow(a)?this._moveLeftMrootBaseToIndex(a):
this._isRootIndexMrow(a)?this._moveToTopLeft(a):this._isSupSuperscriptMrow(a)?this._moveLeftMsupSuperscriptToBase(a):this._isSubSubscriptMrow(a)?this._moveLeftMsubSubscriptToBase(a):this._isSupBaseMrow(a)||this._isSubBaseMrow(a)?this._moveToTopLeft(a):this._isFirstChildFenceChildMrow(a)?this._moveToTopLeft(a):a&&(this.anchor.node=a,"math"===a.nodeName&&(this.mode="text")))},moveRight:function(){var a=this._isLineEnd(this.anchor);if(a){var b=a.nextSibling;b?(this._movePathToNextSibling(b),this._moveLineStart(b)):
this._moveLineEnd(a)}else if(this._canMoveRightWithInToken(this.anchor))this.anchor.offset++;else{var a=this.anchor.node,c=this.anchor.offset,f=a.nodeName;if("math"===f)if(0==c)a.firstChild?this._moveInNodeStart(a):this.anchor.offset=2,this.mode="mathml";else if(2==c)this.anchor.offset=1,this.mode="text";else{if(1==c&&(b=a.nextSibling)&&"text"===b.nodeName)this._movePathToNextSibling(b),this.anchor.node=b,this.anchor.offset=1,this.mode="text"}else if((b=a.nextSibling)&&"text"===a.nodeName&&"math"===
b.nodeName)this._movePathToNextSibling(b),0<e.getChildLength(b)?this._moveInNodeStart(b):(this.anchor.node=b,this.anchor.offset=2),this.mode="mathml";else if("mfrac"===f&&0===c)b=a.firstChild,"mrow"===b.nodeName&&(this.path.push({nodeName:b.nodeName,offset:1}),b=b.firstChild,"mstyle"===b.nodeName&&(b=b.firstChild),this.path.push({nodeName:b.nodeName,offset:1})),this.anchor.node=b;else if("msqrt"===f&&0===c)this._moveRightToMsqrtBaseStart(a);else if("mroot"===f&&0===c)this._moveRightToMrootIndexStart(a);
else if("msup"===f&&0===c)this._moveRightToMsupBaseStart(a);else if("mfenced"===f&&0===c)this._moveRightToMfencedInnerStart(a);else if(("msqrt"===f||"mfrac"===f||"mroot"===f||"msup"===f||"mfenced"===f)&&1===c)"mstyle"===a.parentNode.nodeName&&(a=a.parentNode),(b=a.nextSibling)?("mstyle"===b.nodeName&&(b=b.firstChild),this._movePathToNextSibling(b),"msqrt"===b.nodeName?this._moveRightToMsqrtBaseStart(b):"mroot"===b.nodeName?this._moveRightToMrootIndexStart(b):"msup"===b.nodeName?this._moveRightToMsupBaseStart(b):
"mfenced"===b.nodeName?this._moveRightToMfencedInnerStart(b):"mfrac"===b.nodeName?this._moveRightToNumeratorStart(b):(this.anchor.node=b,0<this._getTextLength(b)?this.anchor.offset=1:this.anchor.offset=0)):(this.path.pop(),b=a.parentNode,"mstyle"===b.nodeName&&(b=b.parentNode),this._isNumeratorMrow(b)?this._moveRightNumeratorToDenominator(b):this._isDenominatorMrow(b)?this._moveToTopRight(b):this._isSqrt(b)?(this.anchor.node=b,this.anchor.offset=1):this._isRootIndexMrow(b)?this._moveRightMrootIndexToBase(b):
this._isRootBaseMrow(b)?this._moveToTopRight(b):this._isSupBaseMrow(b)?this._moveRightMsupBaseToSuperscript(b):this._isSubBaseMrow(b)?this._moveRightMsubBaseToSubscript(b):this._isSupSuperscriptMrow(b)?this._moveToTopRight(b):this._isSubSubscriptMrow(b)?this._moveToTopRight(b):this._isLastFenceChildMrow(b)?this._moveToTopRight(b):b&&(this.anchor.node=b,"math"===b.nodeName&&(this.mode="text")));else if(this._isTokenNode(f)&&c===this._getTextLength(a))if(b=a.nextSibling)"mstyle"===b.nodeName&&(b=b.firstChild),
this._movePathToNextSibling(b),"msqrt"===b.nodeName?this._moveRightToMsqrtBaseStart(b):"mroot"===b.nodeName?this._moveRightToMrootIndexStart(b):"msup"===b.nodeName?this._moveRightToMsupBaseStart(b):"mfenced"===b.nodeName?this._moveRightToMfencedInnerStart(b):"mfrac"===b.nodeName?this._moveRightToNumeratorStart(b):(this.anchor.node=b,this.anchor.offset=1);else{this.path.pop();if((b=a.parentNode)&&"mstyle"===b.nodeName)b=b.parentNode;this._isNumeratorMrow(b)?this._moveRightNumeratorToDenominator(b):
this._isDenominatorMrow(b)?this._moveToTopRight(b):this._isSqrt(b)?(this.anchor.node=b,this.anchor.offset=1):this._isRootIndexMrow(b)?this._moveRightMrootIndexToBase(b):this._isRootBaseMrow(b)?this._moveToTopRight(b):this._isSupBaseMrow(b)?this._moveRightMsupBaseToSuperscript(b):this._isSubBaseMrow(b)?this._moveRightMsubBaseToSubscript(b):this._isSupSuperscriptMrow(b)?this._moveToTopRight(b):this._isSubSubscriptMrow(b)?this._moveToTopRight(b):this._isLastFenceChildMrow(b)?this._moveToTopRight(b):
b&&(this.anchor.node=b,this.anchor.offset=1,"math"===b.nodeName&&(this.mode="text"))}}},moveUp:function(){},moveDown:function(){},_getFocusLine:function(){for(var a=this.getFocusNode();a&&"line"!=a.nodeName;)a=a.parentNode;return a},_isNotSameNode:function(a,b){return a==b.nodeName},_isLineNode:function(a){return"line"==a.nodeName},_isTextNode:function(a){return"text"==a.nodeName},_insertChar:function(a){var b=this.anchor.node,c=this.anchor.offset,f=e.getText(b);a=p.insertAtOffset(f,c,a);e.setText(b,
a);this._updateAnchor(b,c+1)},getXML:function(){return 0==this.doc.firstChild.firstChild.childNodes.length?"":d.innerXML(this.doc)},isEmpty:function(){return""==this.getXML()},getPath:function(){var a="";n.forEach(this.path,function(b,c){a+="/";a+=b.nodeName;b.offset&&(a+="["+b.offset+"]")});return a},getFocusNode:function(){return this.anchor.node},getOffset:function(){return this.anchor.offset},getLines:function(){return this.doc.documentElement.childNodes},getLineAt:function(a){return this.getLines()[a]},
getLineCount:function(){return this.getLines().length},getHTML:function(){return m.xmlDocToHtml(this.doc)}})})},"dojox/xml/parser":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/window","dojo/_base/sniff"],function(l){l.getObject("xml.parser",!0,dojox);dojox.xml.parser.parse=function(g,n){var h=l.doc,d;n=n||"text/xml";if(g&&l.trim(g)&&"DOMParser"in l.global){d=(new DOMParser).parseFromString(g,n);h=d.documentElement;if("parsererror"==h.nodeName&&"http://www.mozilla.org/newlayout/xml/parsererror.xml"==
h.namespaceURI){var p=h.getElementsByTagNameNS("http://www.mozilla.org/newlayout/xml/parsererror.xml","sourcetext")[0];p&&(p=p.firstChild.data);throw Error("Error parsing text "+h.firstChild.data+" \n"+p);}return d}if("ActiveXObject"in l.global){h=function(d){return"MSXML"+d+".DOMDocument"};h=["Microsoft.XMLDOM",h(6),h(4),h(3),h(2)];l.some(h,function(e){try{d=new ActiveXObject(e)}catch(g){return!1}return!0});if(g&&d&&(d.async=!1,d.loadXML(g),h=d.parseError,0!==h.errorCode))throw Error("Line: "+h.line+
"\nCol: "+h.linepos+"\nReason: "+h.reason+"\nError Code: "+h.errorCode+"\nSource: "+h.srcText);if(d)return d}else if(h.implementation&&h.implementation.createDocument){if(g&&l.trim(g)&&h.createElement){p=h.createElement("xml");p.innerHTML=g;var m=h.implementation.createDocument("foo","",null);l.forEach(p.childNodes,function(d){m.importNode(d,!0)});return m}return h.implementation.createDocument("","",null)}return null};dojox.xml.parser.textContent=function(g,n){if(1<arguments.length)return dojox.xml.parser.replaceChildren(g,
(g.ownerDocument||l.doc).createTextNode(n)),n;if(void 0!==g.textContent)return g.textContent;var h="";g&&l.forEach(g.childNodes,function(d){switch(d.nodeType){case 1:case 5:h+=dojox.xml.parser.textContent(d);break;case 3:case 2:case 4:h+=d.nodeValue}});return h};dojox.xml.parser.replaceChildren=function(g,n){var h=[];l.isIE&&l.forEach(g.childNodes,function(d){h.push(d)});dojox.xml.parser.removeChildren(g);l.forEach(h,l.destroy);l.isArray(n)?l.forEach(n,function(d){g.appendChild(d)}):g.appendChild(n)};
dojox.xml.parser.removeChildren=function(g){for(var n=g.childNodes.length;g.hasChildNodes();)g.removeChild(g.firstChild);return n};dojox.xml.parser.innerXML=function(g){return g.innerXML?g.innerXML:g.xml?g.xml:"undefined"!=typeof XMLSerializer?(new XMLSerializer).serializeToString(g):null};return dojox.xml.parser})},"mathEditor/string":function(){define([],function(){var l={},g=["\x3d\x3d","!\x3d"];l.splitData=function(n){for(var h=n.length,d=[],p=0,m=!1,e="",k=0,l=0;l<h;l++){var a;a:{a=n;for(var b=
l,c=a.charAt(b),f=0;f<g.length;f++){var r=g[f];if(2==r.length){var v=r.charAt(0),w=r.charAt(1);if(c==v&&w==a.charAt(b+1)){a=r;break a}}else throw"\u6ca1\u6709\u4e3a\u957f\u5ea6\u4e3a"+r+"\u7684\u64cd\u4f5c\u7b26\u5b9a\u4e49\u5904\u7406\u903b\u8f91";}a=null}a?(d[p]=a,p++,l+=a.length):(a=n.charAt(l),"\x26"==a?(k=0,m=!0,e=a):m&&";"==a?(0==k?(d[p]=e,p++,d[p]=a):(e+=a,d[p]=e),p++,m=!1,e=""):m?(e+=a,k++):(d[p]=n.charAt(l),p++))}return d};l.insertAtOffset=function(g,h,d,p){var m=g.length;if(0>h||m<h)return g;
p=g.substring(0,h-(p||0));g=g.substring(h);return p+d+g};return l})},"mathEditor/dataUtil":function(){define(["dojox/xml/parser","dojo/_base/array","./lang"],function(l,g,n){return{xmlDocToHtml:function(h){var d="";g.forEach(h.documentElement.childNodes,function(h,m){var e="\x3cdiv class\x3d'drip_line'\x3e";g.forEach(h.childNodes,function(d,g){if("text"==d.nodeName)e+="\x3cspan\x3e"+n.getText(d)+"\x3c/span\x3e";else if("math"==d.nodeName){e+='\x3cspan class\x3d"drip_math"\x3e';if(0==d.childNodes.length)e+=
"\x3cmath\x3e\x3cmtext\x3e\u8bf7\u5728\u8fd9\u91cc\u8f93\u5165\u516c\u5f0f\x3c/mtext\x3e\x3c/math\x3e";else{var a=l.innerXML(d);e+=a.replace(/&amp;/g,"\x26")}e+="\x3c/span\x3e"}});e+="\x3c/div\x3e";d+=e});return d},xmlStringToHtml:function(g){g=l.parse(g);return this.xmlDocToHtml(g)}}})},"mathEditor/lang":function(){define(["dojo/_base/array"],function(l){var g={mfrac:1,mroot:1,msqrt:1,msub:1,msup:1},n={mi:1,mn:1,mo:1,mtext:1,mspace:1,ms:1},h={math:1,mstyle:1,msqrt:1};return{STRING_FUNCTION_APPLICATION:"\x26#x2061;",
isNumber:function(d){return!isNaN(parseFloat(d))&&isFinite(d)},isLetter:function(d){return 1==d.length&&/[a-zA-Z]/.test(d)},isOperator:function(d){return/\+|-|\*|\/|=|==|<|>|!|!=|&#xD7;|&#xF7;|&#x2A7E;|&#x226B;|&#x2A7D;|&#x226A;|&#x2260;|&#x2248;/.test(d)?!0:!1},isTrigonometric:function(d){return/sin|cos|tan|cot|sec|csc/.test(d)},isGreekLetter:function(d){d="0"+d.substring(2,d.length-1);d=parseInt(d);return 913<=d&&937>=d||945<=d&&969>=d},isNewLine:function(d){return"\r\n"==d||"\r"==d||"\n"==d},isTab:function(d){return"\t"===
d},isFenced:function(d){return/\(|\[|\{|\|/.test(d)},isFunctionApplication:function(d){return"mo"===d.nodeName&&this.getText(d)===this.STRING_FUNCTION_APPLICATION},insertNodeAfter:function(d,g){var h=g.parentNode;h.lastChild==g?h.appendChild(d):h.insertBefore(d,g.nextSibling)},insertNodeBefore:function(d,g){g.parentNode.insertBefore(d,g)},_fontStyles:{fontFamily:1,fontSize:1,fontWeight:1,fontStyle:1,lineHeight:1},isMathTokenNode:function(d){return this.isMathTokenName(d.nodeName)},isMathLayoutNode:function(d){return this._isMathLayoutNodeName(d.nodeName)},
_isMathLayoutNodeName:function(d){return 1===g[d]},isMathTokenName:function(d){return 1===n[d]},containsInferredMrow:function(d){return 1===h[d]},measureTextSize:function(d,g){if(!this.measureNode){var h=document.createElement("div"),e=h.style;e.width=e.height="auto";e.left=e.top="-1000px";e.visibility="hidden";e.position="absolute";e.overflow="visible";e.whiteSpace="nowrap";document.body.appendChild(h);this.measureNode=h}h=this.measureNode;h.innerHTML=g;var e=h.style,k=window.getComputedStyle(d,
null),n;for(n in this._fontStyles)e[n]=k[n];return{height:h.offsetHeight,width:h.offsetWidth}},getChildLength:function(d){return d.childElementCount?d.childElementCount:d.childNodes.length},getText:function(d){if(d.textContent)return d.textContent;d=d.firstChild;return null==d?"":3===d.nodeType?d.nodeValue:""},setText:function(d,g){d.textContent?d.textContent=g:1==d.nodeType&&(d.firstChild&&d.removeChild(d.firstChild),d.appendChild(d.ownerDocument.createTextNode(g)))},appendTextEnd:function(d,g){d.textContent?
d.textContent+=g:1==d.nodeType&&(d.firstChild&&(g=d.firstChild.nodeValue+g,d.removeChild(d.firstChild)),d.appendChild(d.ownerDocument.createTextNode(g)))},appendTextStart:function(d,g){d.textContent?d.textContent=g+d.textContent:1==d.nodeType&&(d.firstChild&&(g+=d.firstChild.nodeValue,d.removeChild(d.firstChild)),d.appendChild(d.ownerDocument.createTextNode(g)))}}})},"mathEditor/xmlUtil":function(){define(["./lang"],function(l){return{createEmptyFrac:function(g){var n=g.createElement("mstyle");n.setAttribute("displaystyle",
"true");var h=g.createElement("mfrac"),d=g.createElement("mrow"),l=g.createElement("mrow"),m=this.getPlaceHolder(g);g=this.getPlaceHolder(g);n.appendChild(h);h.appendChild(d);h.appendChild(l);d.appendChild(m);l.appendChild(g);return{rootNode:n,focusNode:m}},createFracWithNumerator:function(g,n){var h=g.createElement("mstyle");h.setAttribute("displaystyle","true");var d=g.createElement("mfrac"),l=g.createElement("mrow"),m=g.createElement("mrow"),e=this.getPlaceHolder(g);h.appendChild(d);d.appendChild(l);
d.appendChild(m);l.appendChild(n);m.appendChild(e);return{rootNode:h,focusNode:e}},createScriptingWithBase:function(g,n,h){h=g.createElement(h);var d=g.createElement("mrow"),l=g.createElement("mrow");g=this.getPlaceHolder(g);h.appendChild(d);h.appendChild(l);d.appendChild(n);l.appendChild(g);return{rootNode:h,focusNode:g}},createEmptyScripting:function(g,n){var h=g.createElement(n),d=g.createElement("mrow"),l=g.createElement("mrow"),m=this.getPlaceHolder(g),e=this.getPlaceHolder(g);h.appendChild(d);
h.appendChild(l);d.appendChild(m);l.appendChild(e);return{rootNode:h,focusNode:e}},createEmptyMsqrt:function(g){var n=g.createElement("msqrt");g=this.getPlaceHolder(g);n.appendChild(g);return{rootNode:n,focusNode:g}},createEmptyMroot:function(g){var n=g.createElement("mroot"),h=g.createElement("mrow"),d=g.createElement("mrow"),l=this.getPlaceHolder(g);g=this.getPlaceHolder(g);n.appendChild(h);n.appendChild(d);h.appendChild(l);d.appendChild(g);return{rootNode:n,focusNode:g}},createEmptyMfenced:function(g,
n){var h=g.createElement("mfenced"),d={"{":{left:"{",right:"}"},"[":{left:"[",right:"]"},"|":{left:"|",right:"|"}};"("!=n&&(h.setAttribute("open",d[n].left),h.setAttribute("close",d[n].right));var d=g.createElement("mrow"),l=this.getPlaceHolder(g);h.appendChild(d);d.appendChild(l);return{rootNode:h,focusNode:l}},createTrigonometric:function(g,l,h){},isPlaceHolder:function(g){return"drip_placeholder_box"===g.getAttribute("class")},removePlaceHolder:function(g){g.parentNode&&g.parentNode.removeChild(g)},
getPlaceHolder:function(g){g=g.createElement("mn");g.setAttribute("class","drip_placeholder_box");g.setAttribute("style","border:1px dotted black; padding:1px;background-color: #cccccc;color: #cccccc;");l.setText(g,8);return g}}})},"mathEditor/MathJaxView":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/event dojo/_base/window dojo/dom dojo/dom-style dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/on dojo/aspect mathEditor/Model mathEditor/layer/Cursor mathEditor/lang mathEditor/dom".split(" "),
function(l,g,n,h,d,p,m,e,k,q,a,b,c,f,r,v){return l("mathEditor.MathJaxView",null,{model:null,contentDiv:null,parentNode:null,textarea:null,readOnly:!1,mathBound:null,focused:!1,hScrollBarAlwaysVisible:!1,paddingTop:0,paddingRight:0,borderWidth:0,editorWidth:0,constructor:function(c){g.mixin(this,c);c={position:"absolute",height:"100%",width:this.editorWidth+"px"};this.hScrollBarAlwaysVisible?c["overflow-x"]="scroll":(c["overflow-x"]="auto",c["overflow-y"]="visible");c=this.scrollerDiv=k.create("div",
{style:c,"class":"scroller"},this.parentNode);c=this.contentDiv=k.create("div",{style:{position:"absolute",cursor:"text"},"class":"content"},c);var d=this.textLayer=k.create("div",{"class":"drip_layer drip_text"},c);this.cursor=new f({parentEl:c});a(this.parentNode,"mousedown",g.hitch(this,this._onMouseDownHandler));d.innerHTML=this.model.getHTML();b.after(this.model,"onChanged",g.hitch(this,this._onModelChanged))},resize:function(a){this.borderWidth=a;a=this.contentDiv;var b=this.scrollerDiv,c=this.textLayer;
this.minHeight=a.clientHeight;this.minWidth=b.clientWidth;m.set(a,{width:b.clientWidth-this.paddingRight+"px",height:b.clientHeight-this.paddingTop+"px",paddingTop:this.paddingTop+"px",paddingRight:this.paddingRight+"px"});m.set(c,"width",b.clientWidth-this.paddingRight+"px")},_onMouseDownHandler:function(a){this.focus();h.stop(a)},focus:function(){if(!1==this.focused){this.focused=!0;var a=this.textarea,b=this.cursor;e.add(this.parentNode,"drip_editor_focus");setTimeout(function(){a.focus();b.show()},
0)}},blur:function(){!0==this.focused&&(this.focused=!1,e.remove(this.parentNode,"drip_editor_focus"),this.cursor.hide())},switchInputMode:function(){this.model.switchMode();this.model.onChanged()},_onModelChanged:function(){this.asyncRender();this.asyncShowCursor()},asyncRender:function(){this.textLayer.innerHTML=this.model.getHTML();this._asyncExecute(["Typeset",MathJax.Hub,this.textLayer])},_asyncExecute:function(a){MathJax.Hub.Queue(a)},asyncShowCursor:function(){this._asyncExecute(g.hitch(this,
this.showCursor))},showCursor:function(){this._autoHeight();this._scrollToLeft();var a=this._getFocusInfo(),b=this._getCursorConfig(a);this.cursor.move(b);this.textarea&&m.set(this.textarea,{top:b.top+"px",left:b.left+"px"});if(this.model.isMathMLMode()){var b=q.position(a.mathNodeContainer),a=this._getMathBound(),b={left:b.x+"px",top:b.y+"px",width:b.w+"px",height:b.h+"px"},c=this.model.getFocusNode();"math"===c.nodeName&&0===r.getChildLength(c)?b["background-color"]="rgb(204, 203, 203)":b["background-color"]=
"";m.set(a,b)}else a=this._getMathBound(),m.set(a,{left:"-10000px"})},_autoHeight:function(){var a=this.contentDiv,b=this.scrollerDiv;if(a.scrollHeight>a.clientHeight){var c=a.scrollHeight+"px";m.set(this.parentNode,"height",a.scrollHeight+"px");m.set(b,"height",c);m.set(a,"height",a.scrollHeight-this.paddingTop+"px");b.clientHeight<a.clientHeight&&(m.set(b,{height:a.scrollHeight+this.scrollbarWidth+"px"}),m.set(b,{height:a.scrollHeight+"px"}))}else if(!(a.clientHeight<=this.minHeight)){for(var c=
this.textLayer.childNodes,f=c.length,d=0,e=0;e<f;e++)d+=c[e].clientHeight;a.clientHeight>d&&(c=d+this.scrollbarWidth+1+"px",m.set(a,"height",d+"px"),m.set(b,"height",c),m.set(this.parentNode,"height",c))}},_scrollToLeft:function(){var a=this.contentDiv,b=this.scrollerDiv;if(0<a.scrollWidth-a.clientWidth)b.scrollLeft+=a.scrollWidth-a.clientWidth+4,m.set(a,"width",a.scrollWidth+"px"),m.set(b,"height",a.scrollHeight+this.scrollbarWidth+"px");else if(!(a.scrollWidth<=this.minWidth)){for(var c=this.textLayer.childNodes,
f=c.length,d=this.minWidth,e=0,e=null,g=0;g<f;g++)0<r.getChildLength(c[g])&&(e=c[g].lastChild,e=e.offsetLeft+e.offsetWidth,e>d&&(d=e));m.set(a,"width",d+"px");b.scrollLeft=a.scrollWidth-this.minWidth}},_getMathBound:function(){if(this.mathBound)return this.mathBound;this.mathBound=k.create("div",null,d.body());m.set(this.mathBound,{position:"absolute",border:"solid 1px green","z-index":"-1"});return this.mathBound},moveLeft:function(){this.model.moveLeft();this.showCursor()},_getFocusInfo:function(){var a=
this.textLayer,b=null,c=null,f=null;n.forEach(this.model.path,function(c,d){if("root"!=c.nodeName)if("line"==c.nodeName)a=a.childNodes[c.offset-1];else if("text"==c.nodeName){var e=a.childNodes;a=e[c.offset-1]}else"math"==c.nodeName?(e=a.childNodes,f=e[c.offset-1],b=f.lastChild.MathJax.elementJax.root,b=b.data[0]):b&&(b=b.data[c.offset-1],b.displaystyle&&(b=b.data[0],b=b.data[0]),r.containsInferredMrow(c.nodeName)&&(b=b.data[0]))});b&&(a=p.byId("MathJax-Span-"+b.spanID));var d=this.model.getOffset(),
c=this.model.getFocusNode();"mo"==this.model.getFocusNode().nodeName&&0!=d&&(d=r.getText(c).length);c=null;"mrow"===a.parentNode.className&&(c=a.parentNode);return{node:a,offset:d,mrowNode:c,mathNodeContainer:f}},_getCursorConfig:function(a){var b=0,c=0,f=0,d=0,e=a.node,g=a.offset,k=null,c=this.getTextLayerPosition();(b=a.mrowNode)?(f=q.position(b),b=f.y-c.y+this.paddingTop,f=f.h,k=q.position(e)):(k=q.position(e),b=k.y-c.y+this.paddingTop,f=k.h);c=k.x-c.x;1==e.nodeType&&(a=e.childNodes,1==a.length&&
3==a[0].nodeType?(k=r.getText(e),k.length==g?c+=e.offsetWidth:(d=0,g=k.substring(0,g),""!=g&&(d=m.get(e,"padding-left"),c+=Math.floor(d),d=r.measureTextSize(e,g).width),c+=d)):0!=g&&(c+=k.w));c+=this.scrollerDiv.scrollLeft;return{top:b,left:c,height:f,width:d}},getCursorPosition:function(){var a=this.getTextLayerPosition(),b=a.x,a=a.y,c=this.cursor.getCursorConfig(),b=b+c.left,a=a+(c.top+c.height);return{x:b,y:a}},getTextLayerPosition:function(){this.textLayerPosition||(this.textLayerPosition=q.position(this.textLayer));
return this.textLayerPosition}})})},"mathEditor/layer/Cursor":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/dom-style dojo/dom-geometry".split(" "),function(l,g,n,h,d,p){return l("mathEditor.layer.Cursor",null,{parentEl:null,caret:null,isVisible:!1,cursorConfig:{top:0,left:0},constructor:function(d){g.mixin(this,d);d=this.caret=n.create("div",{"class":"drip_cursor"},this.parentEl);d.style.visibility="hidden";this.defaultHeight=d.clientHeight;this.cursorConfig.height=
this.defaultHeight},show:function(){this.isVisible=!0;this.caret.style.visibility="";this._restartTimer()},move:function(d){this.cursorConfig=d;var e=d.left,g=d.height,h=this.caret.style;h.top=d.top+"px";h.left=e+"px";g&&0<g&&(h.height=g+"px");!1!=this.isVisible&&(this.caret.style.visibility="",this._restartTimer())},getCursorConfig:function(){return this.cursorConfig},hide:function(){this.caret.style.visibility="hidden";this.isVisible=!1;clearInterval(this.intervalId);this.intervalId=null;clearTimeout(this.timeoutId);
this.timeoutId=null},_restartTimer:function(){null!=this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null);var d=this.caret,e=this;this.intervalId=setInterval(function(){d.style.visibility="hidden";e.timeoutId=setTimeout(function(){d.style.visibility=""},400)},1E3)},destroy:function(){null!=this.intervalId&&clearInterval(this.intervalId);n.destroy(this.caret)}})})},"mathEditor/TextInput":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/event dojo/dom-construct dojo/dom-class dojo/has dojo/sniff dojo/on dojo/keys".split(" "),
function(l,g,n,h,d,p,m,e,k){return l("mathEditor.TextInput",null,{parentNode:null,host:null,textarea:null,_inComposition:!1,constructor:function(l){g.mixin(this,l);k.EQUAL=m("chrome")||m("ie")?187:61;var a=this.textarea=h.create("textarea",{style:{position:"absolute"}},this.parentNode),b=this.host;d.add(a,"drip_text_input");a.wrap="off";a.autocorrect="off";a.autocapitalize="off";a.spellcheck=!1;e(a,"keydown",g.hitch(this,function(a){a.keyCode===k.LEFT_ARROW?b.navigateLeft():a.keyCode===k.RIGHT_ARROW?
b.navigateRight():a.keyCode===k.UP_ARROW?b.navigateUp():a.keyCode===k.DOWN_ARROW?b.navigateDown():a.keyCode===k.BACKSPACE?b.removeLeft():a.keyCode===k.DELETE?b.removeRight():a.altKey&&191===a.keyCode||(a.altKey&&a.keyCode===k.EQUAL?(b.switchInputMode(),n.stop(a)):a.keyCode===k.ENTER?(b.inputEnter(a),n.stop(a)):a.keyCode==k.TAB&&(b.inputTab(),n.stop(a)))}));e(a,"blur",g.hitch(this,function(a){b.onBlur()}));e(a,"focus",g.hitch(this,function(a){b.onFocus()}));m("chrome")?e(a,"textInput",g.hitch(this,
function(a){b.onTextInput(a.data)})):9>=p("ie")?require(["mathEditor/IEInputEvent"],function(c){(new c({target:a})).on(function(c){a.value="";b.onTextInput(c)});e(a,"blur",g.hitch(this,function(a){b.onBlur()}));e(a,"focus",g.hitch(this,function(a){b.onFocus()}))}):9<p("ie")?(e(a,"textinput",g.hitch(this,function(a){this._onInput(a)})),e(a,"compositionstart",g.hitch(this,function(a){this._inComposition=!0})),e(a,"compositionend",g.hitch(this,function(a){this._inComposition=!1}))):(e(a,"input",g.hitch(this,
function(a){this._onInput(a)})),e(a,"compositionstart",g.hitch(this,function(a){this._inComposition=!0})),e(a,"compositionend",g.hitch(this,function(a){this._inComposition=!1})))},_onCompositionStart:function(){},_onCompositionUpdate:function(){},_onCompositionEnd:function(){},_onInput:function(d){this._inComposition||(inputData=this.textarea.value,""!=inputData&&(this.host.onTextInput(inputData),this.resetValue()))},resetValue:function(){var d=this.textarea;setTimeout(function(){d.value=""},0)},
getElement:function(){return this.textarea}})})},"mathEditor/ContentAssist":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/on dojo/aspect dojo/dom-construct dojo/dom-class dojo/dom-style dijit/popup dijit/DropDownMenu dijit/MenuItem mathEditor/mathContentAssist".split(" "),function(l,g,n,h,d,p,m,e,k,q,a,b){return l("mathEditor.ContentAssist",q,{proposals:null,view:null,cacheString:"",opened:!1,postCreate:function(){this.inherited(arguments);this.state=2;h(this.view.contentDiv,
"mousedown",n.hitch(this,function(a){this.opened&&k.close(this)}));d.after(this.view.model,"onChanging",n.hitch(this,this._onModelChanging),!0)},_onModelChanging:function(a){var b=a.data;if(!(null==b||""==b)&&1!==this.state)b=this.show(b),a.newData=b},startup:function(){this.inherited(arguments)},_scheduleOpen:function(a,b,d){view=this.view;var e=this;this._openTimer||(this._openTimer=this.defer(function(){this._openTimer.remove();delete this._openTimer;k.open({popup:a,x:b,y:d,onExecute:function(){k.close(a);
view.focus();e.opened=!1},onCancel:function(){k.close(a);e.opened=!1;view.focus()},onClose:function(){view.focus();e.opened=!1}});this.opened=!0;a.select()},0))},_open:function(){var a=this.view.getCursorPosition();this._scheduleOpen(this,a.x,a.y);this.opened=!0},_clear:function(){var a=this.getChildren();g.forEach(a,n.hitch(this,function(a,b){this.removeChild(a)}))},_setProposals:function(b){this._clear();this.proposals=b;g.forEach(b,n.hitch(this,function(b,c){var d=new a({label:b.label+" ( \\"+
b.input+" )",iconClass:b.iconClass});d.on("click",n.hitch(this,this._onApplyProposal,b.map,b.nodeName));this.addChild(d)}))},show:function(a){if(!1==this.opened)this.cacheString=a;else{var d=b.getProposals(this.cacheString+a);this.cacheString=0==d.length?a:this.cacheString+a}d=b.getProposals(this.cacheString);this._setProposals(d);if(0<d.length){this._open();var e=d[0].map,g=d[0].single;if(!e||""===e||!g)e=a;return{data:e,nodeName:d[0].nodeName}}this.cacheString="";this.opened&&(k.close(this),this.opened=
!1);return null},_onApplyProposal:function(a,b,d){this.apply(a,b,this.cacheString.length,d)},apply:function(a,b,d,e){this.state=1;this.view.model.setData({data:a,nodeName:b,removeCount:d});this.state=2},enter:function(a){this.onItemClick(this.selectedChild,a)},select:function(){this.selectFirstChild()},selectFirstChild:function(){this.selectChild(this._getFirstSelectableChild())},selectPrev:function(){this.selectChild(this._getNextSelectableChild(this.selectedChild,-1),!0)},selectNext:function(){this.selectChild(this._getNextSelectableChild(this.selectedChild,
1))},_getFirstSelectableChild:function(){return this._getNextSelectableChild(null,1)},_getLastFocusableChild:function(){return this._getNextSelectableChild(null,-1)},_getNextSelectableChild:function(a,b){a&&(a=this._getSiblingOfChild(a,b));for(var d=this.getChildren(),e=0;e<d.length;e++){a||(a=d[0<b?0:d.length-1]);if(a.isFocusable())return a;a=this._getSiblingOfChild(a,b)}return null},selectChild:function(a,b){a&&(this.selectedChild&&a!==this.selectedChild&&this.selectedChild._setSelected(!1),this.selectedChild=
a,a._setSelected(!0))}})})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(l,g,n,h){return l("dijit.DropDownMenu",h,{templateString:n,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(d){this._moveToPopup(d);d.stopPropagation();d.preventDefault()},_onLeftArrow:function(){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();
else this.onCancel(!1);else evt.stopPropagation(),evt.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(l,g,n,h,d,p,m,e,k,q,a,b,c,f,r){return g("dijit._MenuBase",[b,r,f,c],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),
this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){d.toggle(this.domNode,"dijitMenuActive",a);d.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,childSelector:function(b){var c=a.byNode(b);return b.parentNode==this.containerNode&&c&&c.focus},postCreate:function(){var b=this,c="string"==typeof this.childSelector?this.childSelector:
p.hitch(this,"childSelector");this.own(e(this.containerNode,e.selector(c,m.enter),function(){b.onItemHover(a.byNode(this))}),e(this.containerNode,e.selector(c,m.leave),function(){b.onItemUnhover(a.byNode(this))}),e(this.containerNode,e.selector(c,q),function(c){b.onItemClick(a.byNode(this),c);c.stopPropagation()}),e(this.containerNode,e.selector(c,"focusin"),function(){b._onItemFocus(a.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(a,b,c,d){this.inherited(arguments);if(a&&(-1==
d||a.popup&&1==d))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},
onItemHover:function(a){this.activated?(this.set("selected",a),a.popup&&(!a.disabled&&!this.hover_timer)&&(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,{type:"click"})},this.passivePopupDelay));this._hoveredChild=a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==
a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&
(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;if(a.popup){this.set("selected",a);this.set("activated",!0);var c=/^key/.test(b._origType||b.type)||0==b.clientX&&0==b.clientY;this._openItemPopup(a,c)}else this.onExecute(),a._onClick?a._onClick(b):a.onClick(b)},_openItemPopup:function(a,
b){if(a!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var c=a.popup;c.parentMenu=this;this.own(this._mouseoverHandle=e.once(c.domNode,"mouseover",p.hitch(this,"_onPopupHover")));var d=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){b&&d.focusChild(a);d._cleanUp()},onExecute:p.hitch(this,"_cleanUp",!0),onClose:function(){d._mouseoverHandle&&(d._mouseoverHandle.remove(),
delete d._mouseoverHandle)}},b);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(h.set(this.selected.focusNode,"tabIndex",this.tabIndex),this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&
this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),function(l,
g,n,h,d,p,m,e,k,q){return g("dijit._KeyNavContainer",[k,q,e],{connectKeyNavHandlers:function(a,b){var c=this._keyNavCodes={},f=p.hitch(this,"focusPrev"),e=p.hitch(this,"focusNext");l.forEach(a,function(a){c[a]=f});l.forEach(b,function(a){c[a]=e});c[d.HOME]=p.hitch(this,"focusFirstChild");c[d.END]=p.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){h.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);l.forEach(this.getChildren(),
p.hitch(this,"_startupChild"))},addChild:function(a,b){this.inherited(arguments);this._startupChild(a)},_startupChild:function(a){a.set("tabIndex","-1")},_getFirst:function(){var a=this.getChildren();return a.length?a[0]:null},_getLast:function(){var a=this.getChildren();return a.length?a[a.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(a){return(a=
m.byNode(a))&&a.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(l,g,n,h,d,p,m,e){return g("dijit._KeyNavMixin",e,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);n.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var e=this._keyNavCodes={};e[h.HOME]=d.hitch(this,"focusFirstChild");e[h.END]=d.hitch(this,
"focusLastChild");e[this.isLeftToRight()?h.LEFT_ARROW:h.RIGHT_ARROW]=d.hitch(this,"_onLeftArrow");e[this.isLeftToRight()?h.RIGHT_ARROW:h.LEFT_ARROW]=d.hitch(this,"_onRightArrow");e[h.UP_ARROW]=d.hitch(this,"_onUpArrow");e[h.DOWN_ARROW]=d.hitch(this,"_onDownArrow")}var g=this,e="string"==typeof this.childSelector?this.childSelector:d.hitch(this,"childSelector");this.own(p(this.domNode,"keypress",d.hitch(this,"_onContainerKeypress")),p(this.domNode,"keydown",d.hitch(this,"_onContainerKeydown")),p(this.domNode,
"focus",d.hitch(this,"_onContainerFocus")),p(this.containerNode,p.selector(e,"focusin"),function(a){g._onChildFocus(m.getEnclosingWidget(this),a)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(d,e){d&&(this.focusedChild&&d!==this.focusedChild&&this._onChildBlur(this.focusedChild),d.set("tabIndex",this.tabIndex),d.focus(e?"end":"start"))},_onContainerFocus:function(d){d.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){n.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(d){n.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(d){d&&d!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),d.set("tabIndex",this.tabIndex),this.lastFocused=d,this._set("focusedChild",d))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(d,e,a,b){d&&this.focusChild(d)},_keyboardSearchCompare:function(d,e){var a=d.domNode,a=(d.label||(a.focusNode?
a.focusNode.label:"")||a.innerText||a.textContent||"").replace(/^\s+/,"").substr(0,e.length).toLowerCase();return e.length&&a==e?-1:0},_onContainerKeydown:function(d){var e=this._keyNavCodes[d.keyCode];e?(e(d,this.focusedChild),d.stopPropagation(),d.preventDefault(),this._searchString=""):d.keyCode==h.SPACE&&(this._searchTimer&&!d.ctrlKey&&!d.altKey&&!d.metaKey)&&(d.stopImmediatePropagation(),d.preventDefault(),this._keyboardSearch(d," "))},_onContainerKeypress:function(d){d.charCode<h.SPACE||(d.ctrlKey||
d.altKey||d.metaKey||d.charCode==h.SPACE&&this._searchTimer)||(d.preventDefault(),d.stopPropagation(),this._keyboardSearch(d,String.fromCharCode(d.charCode).toLowerCase()))},_keyboardSearch:function(e,g){var a=null,b,c=0;d.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=g;var d=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;b=this._searchString.substr(0,d);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},
this.multiCharSearchDuration);var e=this.focusedChild||null;if(1==d||!e)if(e=this._getNextFocusableChild(e,1),!e)return;d=e;do{var h=this._keyboardSearchCompare(e,b);h&&0==c++&&(a=e);if(-1==h){c=-1;break}e=this._getNextFocusableChild(e,1)}while(e!=d)})();this.onKeyboardSearch(a,e,b,c)},_onChildBlur:function(){},_getNextFocusableChild:function(d,e){var a=d;do{if(d)d=this._getNext(d,e);else if(d=this[0<e?"_getFirst":"_getLast"](),!d)break;if(null!=d&&d!=a&&d.isFocusable())return d}while(d!=a);return null},
_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(d,e){if(d)for(d=d.domNode;d;)if((d=d[0>e?"previousSibling":"nextSibling"])&&"getAttribute"in d){var a=m.byNode(d);if(a)return a}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),function(l,g,n,h,d,p,m,e,k,
q,a,b){m=l("dijit.MenuItem"+(p("dojo-bidi")?"_NoBidi":""),[e,k,q,a],{templateString:b,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",a);var b="",d;d=a.search(/{\S}/);if(0<=d){var b=a.charAt(d+1),e=a.substr(0,d);a=a.substr(d+3);d=e+b+a;a=e+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+b+"\x3c/span\x3e"+a}else d=a;this.domNode.setAttribute("aria-label",d+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",
type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){a&&!("label"in this.params)&&this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);n.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&n.set(this.accelKeyNode,"id",this.id+"_accel");g.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==p("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(a){}},_setSelected:function(a){h.toggle(this.domNode,"dijitMenuItemSelected",
a)},setLabel:function(a){d.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){d.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){this.accelKeyNode&&(this.accelKeyNode.style.display=a?"":"none",
this.accelKeyNode.innerHTML=a,n.set(this.containerNode,"colSpan",a?"1":"2"));this._set("accelKey",a)}});p("dojo-bidi")&&(m=l("dijit.MenuItem",m,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return m})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(l,g){return l("dijit._Contained",null,{_getSibling:function(l){var h=this.domNode;do h=h[l+"Sibling"];while(h&&1!=h.nodeType);return h&&g.byNode(h)},
getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var g=this.getParent();return!g||!g.getIndexOfChild?-1:g.getIndexOfChild(this)}})})},"mathEditor/mathContentAssist":function(){define(["dojo/_base/array"],function(l){return{keywords:[{input:"/",map:"\x26#xF7;",nodeName:"mo",freq:0,label:"\u9664\u53f7",iconClass:"drip_equation_icon drip_division",single:!0},{input:"/",map:"",nodeName:"mfrac",freq:0,
label:"\u5206\u6570",iconClass:"drip_equation_icon drip_frac"},{input:"fs",map:"",nodeName:"mfrac",freq:0,label:"\u5206\u6570",iconClass:"drip_equation_icon drip_frac"},{input:"*",map:"\x26#xD7;",nodeName:"mo",freq:0,label:"\u4e58\u53f7",iconClass:"drip_equation_icon drip_multiplication"},{input:"sqrt",map:"",nodeName:"msqrt",freq:0,label:"\u5e73\u65b9\u6839",iconClass:"drip_equation_icon drip_sqrt"},{input:"sqrt",map:"",nodeName:"mroot",freq:0,label:"\u5f00\u6839\u53f7",iconClass:"drip_equation_icon drip_root"},
{input:"sin",map:"sin",nodeName:"mi",freq:0,label:"sin",iconClass:""},{input:"cos",map:"cos",nodeName:"mi",freq:0,label:"cos",iconClass:""},{input:"tan",map:"tan",nodeName:"mi",freq:0,label:"tan",iconClass:""},{input:"cot",map:"cot",nodeName:"mi",freq:0,label:"cot",iconClass:""},{input:"alpha",map:"\x26#x3B1;",nodeName:"mi",freq:0,label:"\u963f\u5c14\u6cd5",iconClass:"drip_equation_icon drip_alpha"},{input:"beta",map:"\x26#x3B2;",nodeName:"mi",freq:0,label:"\u8d1d\u5854",iconClass:"drip_equation_icon drip_beta"},
{input:"gamma",map:"\x26#x3B3;",nodeName:"mi",freq:0,label:"\u4f3d\u739b",iconClass:"drip_equation_icon drip_gamma"},{input:"delta",map:"\x26#x3B4;",nodeName:"mi",freq:0,label:"\u5fb7\u5c14\u5854",iconClass:"drip_equation_icon drip_delta"},{input:"epsilon",map:"\x26#x3B5;",nodeName:"mi",freq:0,label:"\u827e\u666e\u897f\u9f99",iconClass:"drip_equation_icon drip_epsilon"},{input:"zeta",map:"\x26#x3B6;",nodeName:"mi",freq:0,label:"\u6377\u5854",iconClass:"drip_equation_icon drip_zeta"},{input:"eta",
map:"\x26#x3B7;",nodeName:"mi",freq:0,label:"\u4f9d\u5854",iconClass:"drip_equation_icon drip_eta"},{input:"theta",map:"\x26#x3B8;",nodeName:"mi",freq:0,label:"\u897f\u5854",iconClass:"drip_equation_icon drip_theta"},{input:"iota",map:"\x26#x3B9;",nodeName:"mi",freq:0,label:"\u827e\u6b27\u5854",iconClass:"drip_equation_icon drip_iota"},{input:"kappa",map:"\x26#x3BA;",nodeName:"mi",freq:0,label:"\u5580\u5e15",iconClass:"drip_equation_icon drip_kappa"},{input:"lambda",map:"\x26#x3BB;",nodeName:"mi",
freq:0,label:"\u62c9\u59c6\u8fbe",iconClass:"drip_equation_icon drip_lambda"},{input:"mu",map:"\x26#x3BC;",nodeName:"mi",freq:0,label:"\u7f2a",iconClass:"drip_equation_icon drip_mu"},{input:"nu",map:"\x26#x3BD;",nodeName:"mi",freq:0,label:"\u62d7",iconClass:"drip_equation_icon drip_nu"},{input:"xi",map:"\x26#x3BE;",nodeName:"mi",freq:0,label:"\u514b\u897f",iconClass:"drip_equation_icon drip_xi"},{input:"omicron",map:"\x26#x3BF;",nodeName:"mi",freq:0,label:"\u6b27\u9ea6\u514b\u8f6e",iconClass:"drip_equation_icon drip_omicron"},
{input:"pi",map:"\x26#x3C0;",nodeName:"mi",freq:0,label:"\u6d3e",iconClass:"drip_equation_icon drip_pi"},{input:"rho",map:"\x26#x3C1;",nodeName:"mi",freq:0,label:"\u67d4",iconClass:"drip_equation_icon drip_rho"},{input:"sigma",map:"\x26#x3C3;",nodeName:"mi",freq:0,label:"\u897f\u683c\u739b",iconClass:"drip_equation_icon drip_sigma"},{input:"tau",map:"\x26#x3C4;",nodeName:"mi",freq:0,label:"\u5957",iconClass:"drip_equation_icon drip_tau"},{input:"upsilon",map:"\x26#x3C5;",nodeName:"mi",freq:0,label:"\u5b87\u666e\u897f\u9f99",
iconClass:"drip_equation_icon drip_upsilon"},{input:"phi",map:"\x26#x3C6;",nodeName:"mi",freq:0,label:"\u670d\u827e",iconClass:"drip_equation_icon drip_phi"},{input:"chi",map:"\x26#x3C7;",nodeName:"mi",freq:0,label:"\u5668",iconClass:"drip_equation_icon drip_chi"},{input:"psi",map:"\x26#x3C8;",nodeName:"mi",freq:0,label:"\u666e\u8d5b",iconClass:"drip_equation_icon drip_psi"},{input:"omega",map:"\x26#x3C9;",nodeName:"mi",freq:0,label:"\u6b27\u7c73\u4f3d",iconClass:"drip_equation_icon drip_omega"},
{input:"delta",map:"\x26#x394;",nodeName:"mi",freq:0,label:"\u5fb7\u5c14\u5854(\u5927\u5199)",iconClass:"drip_equation_icon drip_delta_upper"}],getProposals:function(g){return l.filter(this.keywords,function(l,h,d){return 0==l.input.indexOf(g)})}}})},"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\n\t   cellspacing\x3d"0"\x3e\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\n\x3c/table\x3e\n',
"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\n\t\x3c/td\x3e\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\x3e\x3c/td\x3e\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\n\t\t\x3c/span\x3e\n\t\x3c/td\x3e\n\x3c/tr\x3e\n'}});
define("mathEditor/Editor","dojo/_base/declare dojo/_base/lang dijit/_WidgetBase dojo/aspect dojo/dom-class dojo/dom-style mathEditor/dom mathEditor/Model mathEditor/MathJaxView mathEditor/TextInput mathEditor/ContentAssist".split(" "),function(l,g,n,h,d,p,m,e,k,q,a){return l("mathEditor.Editor",[n],{model:null,view:null,rows:2,width:100,minLineHeight:15,hScrollBarAlwaysVisible:!1,paddingTop:2,paddingRight:4,value:"",_getValueAttr:function(){return this.model.getXML()},_setValueAttr:function(a){this.model.clear();
a&&""!=a&&this.model.setData({data:a})},postCreate:function(){this.inherited(arguments);var b=this.domNode;d.add(b,"drip_editor");var c=new q({parentNode:b,host:this});this.model=new e;var f=this.scrollbarWidth=m.scrollbarWidth(),g=this._computeEditorHeight(),l=this._computeEditorWidth();p.set(b,{height:g+"px",width:l+"px"});b=this.view=new k({model:this.model,parentNode:b,textarea:c.getElement(),paddingTop:this.paddingTop,paddingRight:this.paddingRight,editorWidth:l,hScrollBarAlwaysVisible:this.hScrollBarAlwaysVisible,
scrollbarWidth:f});b=this.contentAssist=new a({view:b});h.after(b,"apply",function(a,b,d,e){c.resetValue()},!0)},startup:function(){this.inherited(arguments);var a=this.borderWidth=p.get(this.domNode,"border-width");this.view.resize(a)},_computeEditorHeight:function(){var a=this.rows;1>a&&(a=1);a*=this.minLineHeight;a+=this.paddingTop;!0==this.hScrollBarAlwaysVisible&&(a+=this.scrollbarWidth);return a},_computeEditorWidth:function(){return this.width+this.paddingRight},onBlur:function(){this.view.blur()},
onFocus:function(){this.view.focus()},navigateLeft:function(){this.model.moveLeft();this.view.showCursor()},navigateRight:function(){this.model.moveRight();this.view.showCursor()},navigateUp:function(){this.contentAssist.opened?this.contentAssist.selectPrev():this.model.moveUp()},navigateDown:function(){this.contentAssist.opened?this.contentAssist.selectNext():this.model.moveDown()},removeLeft:function(){if(""!=this.model.removeLeft())this.model.onChanged()},removeRight:function(){if(""!=this.model.removeRight())this.model.onChanged()},
inputEnter:function(a){this.contentAssist.opened?this.contentAssist.enter(a):this.model.setData({data:"\n"})},inputTab:function(){this.model.setData({data:"\t"})},switchInputMode:function(){this.model.toMathMLMode();this.model.onChanged()},onTextInput:function(a){this.model.setData({data:a})},destroy:function(){this.inherited(arguments)}})});
//@ sourceMappingURL=Editor.js.map