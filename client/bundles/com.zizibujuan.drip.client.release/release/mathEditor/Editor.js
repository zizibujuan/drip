//>>built
require({cache:{"mathEditor/Model":function(){define("mathEditor/Model","dojo/_base/declare,dojo/_base/lang,dojo/_base/array,dojo/dom-construct,dojox/xml/parser,mathEditor/string,mathEditor/dataUtil,mathEditor/lang,mathEditor/xmlUtil".split(","),function(c,a,h,d,f,i,j,k,m){return c(null,{path:null,xmlString:null,doc:null,cursorPosition:null,constructor:function(b){this._init();a.mixin(this,b)},_init:function(){this.doc=f.parse("<root><line></line></root>");this.path=[];this.cursorPosition={};this.cursorPosition.node=
this.doc.documentElement.firstChild;this.cursorPosition.offset=0;this.path.push({nodeName:"root"});this.path.push({nodeName:"line",offset:1})},clear:function(){this._init();this.onChange()},loadData:function(){},setData:function(b){var e=b.data,f=b.nodeName;if((b=b.removeCount)&&0<b)for(var g=0;g<b;g++)this.removeLeft();var c=this.doc;if(f&&""!=f){if("mfrac"==f){this._splitNodeIfNeed();var e=this.cursorPosition.node,l=1,b="last";if(this._isTextNode(e))b=this.path.pop().offset,l=b+1,b="after";this._isLineNode(e)||
this._isTextNode(e)?(this.path.push({nodeName:"math",offset:l}),this.path.push({nodeName:"mfrac",offset:1}),this.path.push({nodeName:"mrow",offset:1}),this.path.push({nodeName:"mn",offset:1}),g=c.createElement("math"),l=m.createEmptyFrac(c),g.appendChild(l.rootNode),d.place(g,e,b)):(this.path.pop(),this.path.push({nodeName:"mfrac",offset:l}),this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),g=e.parentNode,b=l-1,l=m.createFracWithNumerator(c,e),d.place(l.rootNode,
g,b));this.cursorPosition.node=l.focusNode;this.cursorPosition.offset=0;this.onChange();return}if("msup"==f){this._splitNodeIfNeed();e=this.cursorPosition.node;l=1;b="last";if(this._isTextNode(e))b=this.path.pop().offset,l=b+1,b="after";this._isLineNode(e)||this._isTextNode(e)?(this.path.push({nodeName:"math",offset:l}),this.path.push({nodeName:"msup",offset:1}),this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),g=c.createElement("math"),l=m.createEmptyMsup(c),g.appendChild(l.rootNode),
d.place(g,e,b)):(this.path.pop(),this.path.push({nodeName:"msup",offset:1}),this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),g=e.parentNode,l=m.createMsupWithBase(c,e),d.place(l.rootNode,g,0));this.cursorPosition.node=l.focusNode;this.cursorPosition.offset=0;this.onChange();return}}b=[];a.isString(e)?b=i.splitData(e):a.isArray(e)&&(b=e);h.forEach(b,a.hitch(this,function(b){var e=this.cursorPosition.node;if(k.isNumber(b)){f="mn";var a=e.nodeName;if("line"==a||"text"==
a){var l=this.cursorPosition.offset,a="last",h=1;if(this._isLineNode(e))a="last",h=1;else if(this._isTextNode(e)){this._splitNodeIfNeed();var g=this.path.pop();0<l?(a="after",h=g.offset+1):a="before"}l=c.createElement("math");g=c.createElement(f);l.appendChild(g);d.place(l,e,a);this.cursorPosition.node=g;this.cursorPosition.offset=0;this._insertChar(b);this.path.push({nodeName:"math",offset:h});this.path.push({nodeName:f,offset:1})}else if(k.isMathTokenNode(e)){e=this.cursorPosition.node;m.isPlaceHolder(e)&&
m.removePlaceHolder(e);if(e.nodeName!=f)g=c.createElement(f),k.insertNodeAfter(g,e),this.cursorPosition.node=g,this.cursorPosition.offset=0,g=this.path.pop(),this.path.push({nodeName:f,offset:g.offset+1});this._insertChar(b)}}else if(k.isOperator(b))if(this._isLineNode(e))l=c.createElement("math"),e.appendChild(l),g=c.createElement("mo"),l.appendChild(g),this.cursorPosition.node=g,this.cursorPosition.offset=0,this._insertChar(b),this.path.push({nodeName:"math",offset:1}),this.path.push({nodeName:"mo",
offset:1});else if(k.isMathTokenNode(e))e=this.cursorPosition.node,a=c.createElement("mo"),k.insertNodeAfter(a,e),this.cursorPosition.node=a,this.cursorPosition.offset=0,this._insertChar(b),g=this.path.pop(),this.path.push({nodeName:"mo",offset:g.offset+1});else{if(this._isTextNode(e))l=c.createElement("math"),k.insertNodeAfter(l,e),g=c.createElement("mo"),l.appendChild(g),this.cursorPosition.node=g,this.cursorPosition.offset=0,this._insertChar(b),g=this.path.pop(),this.path.push({nodeName:"math",
offset:g.offset+1}),this.path.push({nodeName:"mo",offset:1})}else if(k.isNewLine(b)){b=this._getFocusLine();e=this.doc.createElement("line");k.insertNodeAfter(e,b);this.cursorPosition.node=e;this.cursorPosition.offset=0;for(g=this.path.pop();"line"!=g.nodeName;)g=this.path.pop();this.path.push({nodeName:"line",offset:g.offset+1})}else if(this._isLineNode(e))a=c.createElement("text"),e.appendChild(a),this.cursorPosition.node=a,this.cursorPosition.offset=0,this._insertChar(b),this.path.push({nodeName:"text",
offset:1});else if(this._isTextNode(e))this._insertChar(b);else if(k.isMathTokenNode(e)){do g=this.path.pop();while(g&&"math"!=g.nodeName);a=c.createElement("text");for(l=e;"math"!=l.nodeName;)l=l.parentNode;k.insertNodeAfter(a,l);this.cursorPosition.node=a;this.cursorPosition.offset=0;this._insertChar(b);this.path.push({nodeName:"text",offset:g.offset+1})}}));this.onChange(e)},doDelete:function(){if(""!=this.removeLeft())this.onChange()},removeLeft:function(){var b=this.cursorPosition.offset,e=this.cursorPosition.node,
a=e.textContent;if(0==b){b=e;if("text"!=e.nodeName&&"line"!=e.nodeName){for(;"math"!=b.nodeName;)b=b.parentNode;if(b=b.previousSibling){var e=b.textContent,g=e.length,a=i.insertAtOffset(e,g,"",1),g=g-1;""==a?(b.parentNode.removeChild(b),this.path.pop()):(b.textContent=a,this.cursorPosition.node=b,this.cursorPosition.offset=g);return g=e.charAt(g)}}else if("line"==e.nodeName&&1<this.getLineCount()){b=e.previousSibling;g=b.childNodes.length;if(0==g)this.cursorPosition.node=b,this.cursorPosition.offset=
0,a=this.path.pop(),a.offset--,this.path.push(a),e.parentNode.removeChild(e);else if(b=b.lastChild,"text"==b.nodeName)this.cursorPosition.node=b,this.cursorPosition.offset=b.textContent.length,a=this.path.pop(),a.offset--,this.path.push(a),this.path.push({nodeName:b.nodeName,offset:g}),e.parentNode.removeChild(e);else if("math"==b.nodeName){var d=b.childNodes.length,b=b.lastChild;this.cursorPosition.node=b;this.cursorPosition.offset=b.textContent.length;a=this.path.pop();a.offset--;this.path.push(a);
this.path.push({nodeName:"math",offset:g});this.path.push({nodeName:b.nodeName,offset:d});e.parentNode.removeChild(e)}return"\n"}return""}"mo"==e.nodeName?(g=e.textContent,a=""):(g=a.charAt(b-1),a=i.insertAtOffset(a,b,"",1));if(""==a)if(b=e.previousSibling)"math"==b.nodeName?(d=b.childNodes.length,b=b.lastChild,this.cursorPosition.node=b,this.cursorPosition.offset=b.textContent.length,a=this.path.pop(),this.path.push({nodeName:"math",offset:a.offset-1}),this.path.push({nodeName:b.nodeName,offset:d}),
e.parentNode.removeChild(e)):(this.cursorPosition.node=b,this.cursorPosition.offset=b.textContent.length,e.parentNode.removeChild(e),this.path.push({nodeName:this.cursorPosition.node.nodeName,offset:this.path.pop().offset-1}));else{d=a=e;if("text"!=e.nodeName&&"line"!=e.nodeName)for(;"math"!=d.nodeName;)a=d.parentNode,a.removeChild(d),d=a,this.path.pop();b=d.previousSibling;a=d.parentNode;a.removeChild(d);e=this.path.pop().offset;b?(this.cursorPosition.node=b,this.cursorPosition.offset=b.textContent.length,
this.path.push({nodeName:this.cursorPosition.node.nodeName,offset:e-1})):(this.cursorPosition.node=a,this.cursorPosition.offset=a.childElementCount)}else this.cursorPosition.node.textContent=a,this.cursorPosition.offset-=1;return g},moveLeft:function(){var b=this.cursorPosition.node,e=this.cursorPosition.offset;if("line"==b.nodeName){if(e=b.previousSibling){e=e.lastChild;if("math"==e.nodeName)e=e.lastChild;b=e.textContent;this.cursorPosition.node=e;this.cursorPosition.offset=b.length}}else if(0<e)this.cursorPosition.offset--;
else if(0==e)if(e=b.previousSibling){if("math"==e.nodeName)e=e.lastChild;b=e.textContent;this.cursorPosition.node=e;this.cursorPosition.offset=b.length-1}else if(e=b.parentNode.previousSibling)if("line"==e.nodeName){e=e.lastChild;if("math"==e.nodeName)e=e.lastChild;b=e.textContent;this.cursorPosition.node=e;this.cursorPosition.offset=b.length}else b=e.textContent,this.cursorPosition.node=e,this.cursorPosition.offset=b.length-1},moveRight:function(){},moveUp:function(){},moveDown:function(){},getLineCount:function(){return this.doc.documentElement.childNodes.length},
_splitNodeIfNeed:function(){var b=this.cursorPosition.offset,e=this.cursorPosition.node,a=e.textContent,d=a.length;if(0<b&&b<d)d=a.substring(0,b),b=a.substring(b),a=this.doc.createElement(e.nodeName),e.textContent=d,a.textContent=b,k.insertNodeAfter(a,e)},_getFocusLine:function(){for(var b=this.getFocusNode();b&&"line"!=b.nodeName;)b=b.parentNode;return b},_isNotSameNode:function(b,e){return b==e.nodeName},_isLineNode:function(b){return"line"==b.nodeName},_isTextNode:function(b){return"text"==b.nodeName},
_insertChar:function(b){this.cursorPosition.node.textContent=i.insertAtOffset(this.cursorPosition.node.textContent,this.cursorPosition.offset,b);this.cursorPosition.offset+=1},getXML:function(){return 0==this.doc.firstChild.firstChild.childNodes.length?"":f.innerXML(this.doc)},getPath:function(){var b="";h.forEach(this.path,function(e){b+="/";b+=e.nodeName;e.offset&&(b+="["+e.offset+"]")});return b},getFocusNode:function(){return this.cursorPosition.node},getOffset:function(){return this.cursorPosition.offset},
getLineAt:function(b){return this.doc.documentElement.childNodes[b]},getHTML:function(){return j.xmlDocToHtml(this.doc)},onChange:function(){}})})},"dojox/xml/parser":function(){define("dojox/xml/parser",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/window","dojo/_base/sniff"],function(c){c.getObject("xml.parser",!0,dojox);dojox.xml.parser.parse=function(a,h){var d=c.doc,f,h=h||"text/xml";if(a&&c.trim(a)&&"DOMParser"in c.global){f=(new DOMParser).parseFromString(a,h);d=f.documentElement;
if("parsererror"==d.nodeName&&"http://www.mozilla.org/newlayout/xml/parsererror.xml"==d.namespaceURI){var i=d.getElementsByTagNameNS("http://www.mozilla.org/newlayout/xml/parsererror.xml","sourcetext")[0];if(i)i=i.firstChild.data;throw Error("Error parsing text "+d.firstChild.data+" \n"+i);}return f}if("ActiveXObject"in c.global){d=function(a){return"MSXML"+a+".DOMDocument"};d=["Microsoft.XMLDOM",d(6),d(4),d(3),d(2)];c.some(d,function(a){try{f=new ActiveXObject(a)}catch(d){return!1}return!0});if(a&&
f&&(f.async=!1,f.loadXML(a),d=f.parseError,0!==d.errorCode))throw Error("Line: "+d.line+"\nCol: "+d.linepos+"\nReason: "+d.reason+"\nError Code: "+d.errorCode+"\nSource: "+d.srcText);if(f)return f}else if(d.implementation&&d.implementation.createDocument){if(a&&c.trim(a)&&d.createElement){i=d.createElement("xml");i.innerHTML=a;var j=d.implementation.createDocument("foo","",null);c.forEach(i.childNodes,function(a){j.importNode(a,!0)});return j}return d.implementation.createDocument("","",null)}return null};
dojox.xml.parser.textContent=function(a,h){if(1<arguments.length)return dojox.xml.parser.replaceChildren(a,(a.ownerDocument||c.doc).createTextNode(h)),h;if(void 0!==a.textContent)return a.textContent;var d="";a&&c.forEach(a.childNodes,function(a){switch(a.nodeType){case 1:case 5:d+=dojox.xml.parser.textContent(a);break;case 3:case 2:case 4:d+=a.nodeValue}});return d};dojox.xml.parser.replaceChildren=function(a,h){var d=[];c.isIE&&c.forEach(a.childNodes,function(a){d.push(a)});dojox.xml.parser.removeChildren(a);
c.forEach(d,c.destroy);c.isArray(h)?c.forEach(h,function(d){a.appendChild(d)}):a.appendChild(h)};dojox.xml.parser.removeChildren=function(a){for(var c=a.childNodes.length;a.hasChildNodes();)a.removeChild(a.firstChild);return c};dojox.xml.parser.innerXML=function(a){return a.innerXML?a.innerXML:a.xml?a.xml:"undefined"!=typeof XMLSerializer?(new XMLSerializer).serializeToString(a):null};return dojox.xml.parser})},"mathEditor/string":function(){define([],function(){var c={};c.splitData=function(a){for(var c=
a.length,d=[],f=0,i=!1,j="",k=0,m=0;m<c;m++){var b=a.charAt(m);"&"==b?(k=0,i=!0,j=b):i&&";"==b?(0==k?(d[f]=j,f++,d[f]=b):(j+=b,d[f]=j),f++,i=!1,j=""):i?(j+=b,k++):(d[f]=a.charAt(m),f++)}return d};c.insertAtOffset=function(a,c,d,f){var i=a.length;if(0>c||i<c)return a;f=a.substring(0,c-(f||0));a=a.substring(c);return f+d+a};return c})},"mathEditor/dataUtil":function(){define(["dojox/xml/parser","dojo/_base/array"],function(c,a){var h={};h.xmlDocToHtml=function(d){var f="";a.forEach(d.documentElement.childNodes,
function(d){var h="<div class='drip_line'>";a.forEach(d.childNodes,function(a){"text"==a.nodeName?h+="<span>"+a.textContent+"</span>":"math"==a.nodeName&&(a=c.innerXML(a),h+=a.replace(/&amp;/g,"&"))});h+="</div>";f+=h});return f};h.xmlStringToHtml=function(a){return this.xmlDocToHtml(c.parse(a))};return h})},"mathEditor/lang":function(){define("mathEditor/lang",["dojo/_base/array"],function(c){var a={};a.isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)};a.isOperator=function(a){return"+"==
a||"="==a||"-"==a||"&#xD7;"==a||"&#xF7;"==a?!0:!1};a.isNewLine=function(a){return"\n"===a};a.isTab=function(a){return"\t"===a};a.insertNodeAfter=function(a,d){var c=d.parentNode;c.lastChild==d?c.appendChild(a):c.insertBefore(a,d.nextSibling)};a._fontStyles={fontFamily:1,fontSize:1,fontWeight:1,fontStyle:1,lineHeight:1};a.isMathTokenNode=function(a){return this.isMathTokenName(a.nodeName)};a.isMathTokenName=function(a){var d=!1;c.forEach("mi,mn,mo,mtext,mspace,ms".split(","),function(c){a==c&&(d=!0)});
return d};a.measureTextSize=function(a,d){if(!this.measureNode){var c=document.createElement("div"),i=c.style;i.width=i.height="auto";i.left=i.top="-1000px";i.visibility="hidden";i.position="absolute";i.overflow="visible";i.whiteSpace="nowrap";document.body.appendChild(c);this.measureNode=c}c=this.measureNode;c.innerHTML=d;var i=c.style,j=window.getComputedStyle(a,null),k;for(k in this._fontStyles)i[k]=j[k];return{height:c.offsetHeight,width:c.offsetWidth}};return a})},"mathEditor/xmlUtil":function(){define("mathEditor/xmlUtil",
{createEmptyFrac:function(c){var a=c.createElement("mstyle");a.setAttribute("displaystyle","true");var h=c.createElement("mfrac"),d=c.createElement("mrow"),f=c.createElement("mrow"),i=this._getPlaceHolder(c),c=this._getPlaceHolder(c);a.appendChild(h);h.appendChild(d);h.appendChild(f);d.appendChild(i);f.appendChild(c);return{rootNode:a,focusNode:i}},createFracWithNumerator:function(c,a){var h=c.createElement("mstyle");h.setAttribute("displaystyle","true");var d=c.createElement("mfrac"),f=c.createElement("mrow"),
i=c.createElement("mrow"),j=this._getPlaceHolder(c);h.appendChild(d);d.appendChild(f);d.appendChild(i);f.appendChild(a);i.appendChild(j);return{rootNode:h,focusNode:j}},createEmptyMsup:function(c){var a=c.createElement("msup"),h=c.createElement("mrow"),d=c.createElement("mrow"),f=this._getPlaceHolder(c),c=this._getPlaceHolder(c);a.appendChild(h);a.appendChild(d);h.appendChild(f);d.appendChild(c);return{rootNode:a,focusNode:c}},createMsupWithBase:function(c,a){var h=c.createElement("msup"),d=c.createElement("mrow"),
f=c.createElement("mrow"),i=this._getPlaceHolder(c);h.appendChild(d);h.appendChild(f);d.appendChild(a);f.appendChild(i);return{rootNode:h,focusNode:i}},isPlaceHolder:function(c){return"drip_placeholder_box"===c.getAttribute("class")},removePlaceHolder:function(c){c.removeAttribute("class");c.removeAttribute("style");c.textContent=""},_getPlaceHolder:function(c){c=c.createElement("mn");c.setAttribute("class","drip_placeholder_box");c.setAttribute("style","border:1px dotted black; padding:1px;background-color: #cccccc;color: #cccccc;");
c.textContent="8";return c}})},"mathEditor/View":function(){define("mathEditor/View","dojo/_base/declare,dojo/_base/lang,dojo/_base/array,dojo/_base/event,dojo/dom,dojo/dom-style,dojo/dom-class,dojo/dom-construct,dojo/dom-geometry,dojo/on,dojo/aspect,mathEditor/Model,mathEditor/layer/Cursor,mathEditor/lang".split(","),function(c,a,h,d,f,i,j,k,m,b,e,n,g,o){return c("mathEditor.View",null,{model:null,editorDiv:null,parentNode:null,textarea:null,readOnly:!1,focused:!1,constructor:function(d){a.mixin(this,
d);var d=this.editorDiv=k.create("div",{style:{"border-radius":"3px",height:"100%",width:"100%",border:"solid 1px #CCC",position:"absolute",cursor:"text"}},this.parentNode),c=this.textLayer=k.create("div",{"class":"drip_layer drip_text"},d);this.cursor=new g({parentEl:d});b(d,"mousedown",a.hitch(this,this._onMouseDownHandler));c.innerHTML=this.model.getHTML();e.after(this.model,"onChange",a.hitch(this,this._onChange))},_onMouseDownHandler:function(a){this._focus();d.stop(a)},_focus:function(){if(!1==
this.focused){this.focused=!0;var a=this.textarea,b=this.cursor;j.add(this.editorDiv,"drip_editor_focus");setTimeout(function(){a.focus();b.show()},0)}},focus:function(){this._focus()},_onChange:function(){this.model.getHTML();this.textLayer.innerHTML=this.model.getHTML();MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.textLayer]);MathJax.Hub.Queue(a.hitch(this,this.showCursor))},blur:function(){if(!0==this.focused)this.focused=!1,j.remove(this.editorDiv,"drip_editor_focus"),this.cursor.hide()},showCursor:function(){var a=
this._getCursorConfig();this.cursor.move(a);this.textarea&&i.set(this.textarea,{top:a.top+"px",left:a.left+"px"})},moveLeft:function(){this.model.moveLeft();this.showCursor()},_getFocusInfo:function(){var a=this.textLayer,b=null,e=null;h.forEach(this.model.path,function(d){if("root"!=d.nodeName)if("line"==d.nodeName)a=a.childNodes[d.offset-1];else if("text"==d.nodeName||"math"==d.nodeName){if(a=h.filter(a.childNodes,function(a){return"span"==a.nodeName.toLowerCase()})[d.offset-1],"math"==d.nodeName)b=
a.nextSibling.MathJax.elementJax.root,b=b.data[0]}else if(b){var c=f.byId("MathJax-Span-"+b.spanID);if(j.contains(c,"mrow"))if("mrow"!=d.nodeName){var g=f.byId("MathJax-Span-"+b.data[0].spanID);j.contains(g,"mstyle")?"mstyle"!=d.nodeName&&(b=b.data[0],b=b.data[0],b=b.data[d.offset-1],c=f.byId("MathJax-Span-"+b.spanID)):(e=c,b=b.data[d.offset-1],c=f.byId("MathJax-Span-"+b.spanID))}else{debugger;e=c;b=b.data[d.offset-1]}else b=o.isMathTokenName(d.nodeName)?b.data[0]:b.data[d.offset-1];a=f.byId("MathJax-Span-"+
b.spanID)}});return{node:a,offset:this.model.getOffset(),mrowNode:e}},_getCursorConfig:function(){var a=0,b=0,e=0,d=0,a=this._getFocusInfo(),c=a.node,g=a.offset,b=this.getTextLayerPosition();if(a=a.mrowNode)var e=m.position(a),a=e.y-b.y,e=e.h,f=m.position(c);else f=m.position(c),a=f.y-b.y,e=f.h;b=f.x-b.x;if(1==c.nodeType&&(f=c.childNodes,1==f.length&&3==f[0].nodeType))if(c.textContent.length==g)b+=c.offsetWidth;else{d=0;g=c.textContent.substring(0,g);if(""!=g)d=o.measureTextSize(c,g).width;b+=d}return{top:a,
left:b,height:e,width:d}},getCursorPosition:function(){var a=this.getTextLayerPosition(),b=a.x,a=a.y,e=this.cursor.getCursorConfig(),b=b+e.left,a=a+(e.top+e.height);return{x:b,y:a}},getTextLayerPosition:function(){if(!this.textLayerPosition)this.textLayerPosition=m.position(this.textLayer);return this.textLayerPosition}})})},"mathEditor/layer/Cursor":function(){define("dojo/_base/declare,dojo/_base/lang,dojo/dom-construct,dojo/dom-class,dojo/dom-style,dojo/dom-geometry".split(","),function(c,a,h){return c("mathEditor.layer.Cursor",
null,{parentEl:null,caret:null,isVisible:!1,cursorConfig:{top:0,left:0},constructor:function(d){a.mixin(this,d);d=this.caret=h.create("div",{"class":"drip_cursor"},this.parentEl);d.style.visibility="hidden";this.defaultHeight=d.clientHeight;this.cursorConfig.height=this.defaultHeight},show:function(){this.isVisible=!0;this.caret.style.visibility="";this._restartTimer()},move:function(a){this.cursorConfig=a;var c=a.left,i=a.height,h=this.caret.style;h.top=a.top+"px";h.left=c+"px";if(i&&0<i)h.height=
i+"px";if(!1!=this.isVisible)this.caret.style.visibility="",this._restartTimer()},getCursorConfig:function(){return this.cursorConfig},hide:function(){this.caret.style.visibility="hidden";this.isVisible=!1;clearInterval(this.intervalId);this.intervalId=null;clearTimeout(this.timeoutId);this.timeoutId=null},_restartTimer:function(){if(null!=this.intervalId)clearInterval(this.intervalId),this.intervalId=null;var a=this.caret,c=this;this.intervalId=setInterval(function(){a.style.visibility="hidden";
c.timeoutId=setTimeout(function(){a.style.visibility=""},400)},1E3)},destroy:function(){null!=this.intervalId&&clearInterval(this.intervalId);h.destroy(this.caret)}})})},"mathEditor/ContentAssist":function(){define("dojo/_base/declare,dojo/_base/array,dojo/_base/lang,dojo/on,dojo/dom-construct,dojo/dom-class,dojo/dom-style,dijit/popup,dijit/DropDownMenu,dijit/MenuItem,mathEditor/mathContentAssist".split(","),function(c,a,h,d,f,i,j,k,m,b,e){return c("mathEditor.ContentAssist",m,{proposals:null,view:null,
cacheString:"",opened:!1,postCreate:function(){this.inherited(arguments);d(this.view.editorDiv,"mousedown",h.hitch(this,function(){this.opened&&k.close(this)}))},startup:function(){this.inherited(arguments)},_scheduleOpen:function(a,b,e){view=this.view;var c=this;if(!this._openTimer)this._openTimer=this.defer(function(){this._openTimer.remove();delete this._openTimer;k.open({popup:a,x:b,y:e,onExecute:function(){k.close(a);view.focus();c.opened=!1},onCancel:function(){k.close(a);c.opened=!1;view.focus()},
onClose:function(){view.focus();c.opened=!1}});this.opened=!0;a.select()},0)},_open:function(){var a=this.view.getCursorPosition();this._scheduleOpen(this,a.x,a.y);this.opened=!0},_clear:function(){var b=this.getChildren();a.forEach(b,h.hitch(this,function(a){this.removeChild(a)}))},_setProposals:function(e){this._clear();this.proposals=e;a.forEach(e,h.hitch(this,function(a){var e=new b({label:a.label,iconClass:a.iconClass});e.on("click",h.hitch(this,this._onApplyProposal,a.map,a.nodeName));this.addChild(e)}))},
show:function(a){if(!1==this.opened)this.cacheString=a;else{var b=e.getProposals(this.cacheString+a);this.cacheString=0==b.length?a:this.cacheString+a}b=e.getProposals(this.cacheString);this._setProposals(b);if(0<b.length)return this._open(),b[0].map;this.cacheString="";if(this.opened)k.close(this),this.opened=!1;return null},_onApplyProposal:function(a,b,e){this.apply(a,b,this.cacheString.length,e)},apply:function(){},enter:function(a){this.onItemClick(this.selectedChild,a)},select:function(){this.selectFirstChild()},
selectFirstChild:function(){this.selectChild(this._getFirstSelectableChild())},selectPrev:function(){this.selectChild(this._getNextSelectableChild(this.selectedChild,-1),!0)},selectNext:function(){this.selectChild(this._getNextSelectableChild(this.selectedChild,1))},_getFirstSelectableChild:function(){return this._getNextSelectableChild(null,1)},_getLastFocusableChild:function(){return this._getNextSelectableChild(null,-1)},_getNextSelectableChild:function(a,b){a&&(a=this._getSiblingOfChild(a,b));
for(var e=this.getChildren(),c=0;c<e.length;c++){a||(a=e[0<b?0:e.length-1]);if(a.isFocusable())return a;a=this._getSiblingOfChild(a,b)}return null},selectChild:function(a){if(a)this.selectedChild&&a!==this.selectedChild&&this.selectedChild._setSelected(!1),this.selectedChild=a,a._setSelected(!0)}})})},"dijit/DropDownMenu":function(){require({cache:{"url:dijit/templates/Menu.html":'<table class="dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role="menu" tabIndex="${tabIndex}"\n\t   data-dojo-attach-event="onkeydown:_onKeyDown" cellspacing="0">\n\t<tbody class="dijitReset" data-dojo-attach-point="containerNode"></tbody>\n</table>\n'}});
define("dijit/DropDownMenu",["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_OnDijitClickMixin","./_MenuBase"],function(c,a,h,d,f){return c("dijit.DropDownMenu",[f,d],{templateString:h,baseClass:"dijitMenu",postCreate:function(){this.inherited(arguments);var c=this.isLeftToRight();this._openSubMenuKey=c?a.RIGHT_ARROW:a.LEFT_ARROW;this._closeSubMenuKey=c?a.LEFT_ARROW:a.RIGHT_ARROW;this.connectKeyNavHandlers([a.UP_ARROW],[a.DOWN_ARROW])},_onKeyDown:function(a){if(!a.ctrlKey&&
!a.altKey)switch(a.keyCode){case this._openSubMenuKey:this._moveToPopup(a);a.stopPropagation();a.preventDefault();break;case this._closeSubMenuKey:if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else a.stopPropagation(),a.preventDefault()}}})})},"url:dijit/templates/Menu.html":'<table class="dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role="menu" tabIndex="${tabIndex}"\n\t   data-dojo-attach-event="onkeydown:_onKeyDown" cellspacing="0">\n\t<tbody class="dijitReset" data-dojo-attach-point="containerNode"></tbody>\n</table>\n',
"dijit/_MenuBase":function(){define("dijit/_MenuBase","dojo/_base/array,dojo/_base/declare,dojo/dom,dojo/dom-attr,dojo/dom-class,dojo/_base/lang,dojo/mouse,dojo/on,dojo/window,./a11yclick,./popup,./registry,./_Widget,./_CssStateMixin,./_KeyNavContainer,./_TemplatedMixin".split(","),function(c,a,h,d,f,i,j,k,m,b,e,n,g,o,l,q){return a("dijit._MenuBase",[g,q,l,o],{parentMenu:null,popupDelay:500,autoFocus:!1,childSelector:function(a){var b=n.byNode(a);return a.parentNode==this.containerNode&&b&&b.focus},
postCreate:function(){var a=this,e="string"==typeof this.childSelector?this.childSelector:i.hitch(this,"childSelector");this.own(k(this.containerNode,k.selector(e,j.enter),function(){a.onItemHover(n.byNode(this))}),k(this.containerNode,k.selector(e,j.leave),function(){a.onItemUnhover(n.byNode(this))}),k(this.containerNode,k.selector(e,b),function(b){a.onItemClick(n.byNode(this),b);b.stopPropagation();b.preventDefault()}));this.inherited(arguments)},onKeyboardSearch:function(a,b,e,c){this.inherited(arguments);
if(a&&(-1==c||a.popup&&1==c))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){if(this.currentPopup&&this.currentPopup._pendingClose_timer){var a=
this.currentPopup.parentMenu;a.focusedChild&&a.focusedChild._setSelected(!1);a.focusedChild=this.currentPopup.from_item;a.focusedChild._setSelected(!0);this._stopPendingCloseTimer(this.currentPopup)}},onItemHover:function(a){if(this.isActive&&(this.focusChild(a),a.popup&&!a.disabled&&!this.hover_timer))this.hover_timer=this.defer(i.hitch(this,"_openPopup",a),this.popupDelay);this.focusedChild&&this.focusChild(a);this._hoveredChild=a;a._set("hovering",!0)},_onChildBlur:function(a){this._stopPopupTimer();
a._setSelected(!1);var b=a.popup;if(b)this._stopPendingCloseTimer(b),b._pendingClose_timer=this.defer(function(){b._pendingClose_timer=null;if(b.parentMenu)b.parentMenu.currentPopup=null;e.close(b)},this.popupDelay)},onItemUnhover:function(a){this.isActive&&this._stopPopupTimer();if(this._hoveredChild==a)this._hoveredChild=null;a._set("hovering",!1)},_stopPopupTimer:function(){if(this.hover_timer)this.hover_timer=this.hover_timer.remove()},_stopPendingCloseTimer:function(a){if(a._pendingClose_timer)a._pendingClose_timer=
a._pendingClose_timer.remove()},_stopFocusTimer:function(){if(this._focus_timer)this._focus_timer=this._focus_timer.remove()},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){"undefined"==typeof this.isShowingNow&&this._markActive();this.focusChild(a);if(a.disabled)return!1;a.popup?this._openPopup(a,/^key/.test(b.type)):(this.onExecute(),a._onClick?a._onClick(b):a.onClick(b))},_openPopup:function(a,b){this._stopPopupTimer();var c=a.popup;if(!c.isShowingNow){this.currentPopup&&
(this._stopPendingCloseTimer(this.currentPopup),e.close(this.currentPopup));c.parentMenu=this;c.from_item=a;var d=this;e.open({parent:this,popup:c,around:a.domNode,orient:this._orient||["after","before"],onCancel:function(){d.focusChild(a);d._cleanUp();a._setSelected(!0);d.focusedChild=a},onExecute:i.hitch(this,"_cleanUp")});this.currentPopup=c;c.connect(c.domNode,"onmouseenter",i.hitch(d,"_onPopupHover"))}if(b&&c.focus)c._focus_timer=this.defer(i.hitch(c,function(){this._focus_timer=null;this.focus()}))},
_markActive:function(){this.isActive=!0;f.replace(this.domNode,"dijitMenuActive","dijitMenuPassive")},onOpen:function(){this.isShowingNow=!0;this._markActive()},_markInactive:function(){this.isActive=!1;f.replace(this.domNode,"dijitMenuPassive","dijitMenuActive")},onClose:function(){this._stopFocusTimer();this._markInactive();this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();if(this.currentPopup)0<=c.indexOf(this._focusManager.activeStack,this.id)&&(d.set(this.focusedChild.focusNode,
"tabIndex",this.tabIndex),this.focusedChild.focusNode.focus()),e.close(this.currentPopup),this.currentPopup=null;this.focusedChild&&(this.focusedChild._setSelected(!1),this.onItemUnhover(this.focusedChild));d.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex","-1"),this._set("focusedChild",null))},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild)},_onBlur:function(){this._cleanUp();this.inherited(arguments)},
_cleanUp:function(){this._closeChild();"undefined"==typeof this.isShowingNow&&this._markInactive()}})})},"dijit/_KeyNavContainer":function(){define("dijit/_KeyNavContainer","dojo/_base/array,dojo/_base/declare,dojo/dom-attr,dojo/_base/kernel,dojo/keys,dojo/_base/lang,./registry,./_Container,./_FocusMixin,./_KeyNavMixin".split(","),function(c,a,h,d,f,i,j,k,m,b){return a("dijit._KeyNavContainer",[m,b,k],{connectKeyNavHandlers:function(a,b){var d=this._keyNavCodes={},m=i.hitch(this,"focusPrev"),h=i.hitch(this,
"focusNext");c.forEach(a,function(a){d[a]=m});c.forEach(b,function(a){d[a]=h});d[f.HOME]=i.hitch(this,"focusFirstChild");d[f.END]=i.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){d.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);c.forEach(this.getChildren(),i.hitch(this,"_startupChild"))},addChild:function(a,b){this.inherited(arguments);this._startupChild(a)},_startupChild:function(a){a.set("tabIndex","-1")},_getFirst:function(){var a=
this.getChildren();return a.length?a[0]:null},_getLast:function(){var a=this.getChildren();return a.length?a[a.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(a){return(a=j.byNode(a))&&a.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dijit/_KeyNavMixin","dojo/_base/array,dojo/_base/declare,dojo/dom-attr,dojo/keys,dojo/_base/lang,dojo/on,dijit/registry,dijit/_FocusMixin".split(","),
function(c,a,h,d,f,i,j,k){return a("dijit._KeyNavMixin",k,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);h.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var a=this._keyNavCodes={};a[d.HOME]=f.hitch(this,"focusFirstChild");a[d.END]=f.hitch(this,"focusLastChild");a[this.isLeftToRight()?d.LEFT_ARROW:d.RIGHT_ARROW]=f.hitch(this,"_onLeftArrow");a[this.isLeftToRight()?d.RIGHT_ARROW:d.LEFT_ARROW]=f.hitch(this,"_onRightArrow");a[d.UP_ARROW]=f.hitch(this,
"_onUpArrow");a[d.DOWN_ARROW]=f.hitch(this,"_onDownArrow")}var b=this,a="string"==typeof this.childSelector?this.childSelector:f.hitch(this,"childSelector");this.own(i(this.domNode,"keypress",f.hitch(this,"_onContainerKeypress")),i(this.domNode,"keydown",f.hitch(this,"_onContainerKeydown")),i(this.domNode,"focus",f.hitch(this,"_onContainerFocus")),i(this.containerNode,i.selector(a,"focusin"),function(a){b._onChildFocus(j.getEnclosingWidget(this),a)}))},_onLeftArrow:function(){},_onRightArrow:function(){},
_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(a,b){a&&(this.focusedChild&&a!==this.focusedChild&&this._onChildBlur(this.focusedChild),
a.set("tabIndex",this.tabIndex),a.focus(b?"end":"start"))},_onContainerFocus:function(a){a.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){h.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(a){h.set(this.domNode,"tabIndex",this.tabIndex);if(this.focusedChild)this.focusedChild.set("tabIndex","-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null);this.inherited(arguments)},_onChildFocus:function(a){if(a&&a!=this.focusedChild)this.focusedChild&&
!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),a.set("tabIndex",this.tabIndex),this.lastFocused=a,this._set("focusedChild",a)},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(a){a&&this.focusChild(a)},_keyboardSearchCompare:function(a,b){var c=a.domNode,c=(a.label||(c.focusNode?c.focusNode.label:"")||c.innerText||c.textContent||"").replace(/^\s+/,"").substr(0,b.length).toLowerCase();return b.length&&c==b?-1:0},_onContainerKeydown:function(a){var b=this._keyNavCodes[a.keyCode];
if(b)b(a,this.focusedChild),a.stopPropagation(),a.preventDefault(),this._searchString=""},_onContainerKeypress:function(a){if(!(32>=a.charCode||a.ctrlKey||a.altKey)){var b=null,c,d=0,g=f.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=h;var a=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;c=this._searchString.substr(0,a);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var g=
this.focusedChild||null;if(1==a||!g)if(g=this._getNextFocusableChild(g,1),!g)return;a=g;do{var f=this._keyboardSearchCompare(g,c);f&&0==d++&&(b=g);if(-1==f){d=-1;break}g=this._getNextFocusableChild(g,1)}while(g!=a)}),h=String.fromCharCode(a.charCode).toLowerCase();g();this.onKeyboardSearch(b,a,c,d)}},_onChildBlur:function(){},_getNextFocusableChild:function(a,b){var c=a;do{if(a)a=this._getNext(a,b);else if(a=this[0<b?"_getFirst":"_getLast"](),!a)break;if(null!=a&&a!=c&&a.isFocusable())return a}while(a!=
c);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(a,b){if(a)for(a=a.domNode;a;)if((a=a[0>b?"previousSibling":"nextSibling"])&&"getAttribute"in a){var c=j.byNode(a);if(c)return c}return null}})})},"dijit/MenuItem":function(){require({cache:{"url:dijit/templates/MenuItem.html":'<tr class="dijitReset dijitMenuItem" data-dojo-attach-point="focusNode" role="menuitem" tabIndex="-1">\n\t<td class="dijitReset dijitMenuItemIconCell" role="presentation">\n\t\t<img src="${_blankGif}" alt="" class="dijitIcon dijitMenuItemIcon" data-dojo-attach-point="iconNode"/>\n\t</td>\n\t<td class="dijitReset dijitMenuItemLabel" colspan="2" data-dojo-attach-point="containerNode,textDirNode"></td>\n\t<td class="dijitReset dijitMenuItemAccelKey" style="display: none" data-dojo-attach-point="accelKeyNode"></td>\n\t<td class="dijitReset dijitMenuArrowCell" role="presentation">\n\t\t<div data-dojo-attach-point="arrowWrapper" style="visibility: hidden">\n\t\t\t<img src="${_blankGif}" alt="" class="dijitMenuExpand"/>\n\t\t\t<span class="dijitMenuExpandA11y">+</span>\n\t\t</div>\n\t</td>\n</tr>\n'}});
define("dijit/MenuItem","dojo/_base/declare,dojo/dom,dojo/dom-attr,dojo/dom-class,dojo/_base/kernel,dojo/sniff,dojo/_base/lang,./_Widget,./_TemplatedMixin,./_Contained,./_CssStateMixin,dojo/text!./templates/MenuItem.html".split(","),function(c,a,h,d,f,i,j,k,m,b,e,n){j=c("dijit.MenuItem"+(i("dojo-bidi")?"_NoBidi":""),[k,m,b,e],{templateString:n,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",a);var b="",c;c=a.search(/{\S}/);if(0<=c){var b=a.charAt(c+1),d=a.substr(0,c),
a=a.substr(c+3);c=d+b+a;a=d+'<span class="dijitMenuItemShortcutKey">'+b+"</span>"+a}else c=a;this.domNode.setAttribute("aria-label",c+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){a&&!("label"in this.params)&&this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);h.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&
h.set(this.accelKeyNode,"id",this.id+"_accel");a.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==i("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(a){}},_onFocus:function(){this._setSelected(!0);this.getParent()._onItemFocus(this);this.inherited(arguments)},_setSelected:function(a){d.toggle(this.domNode,"dijitMenuItemSelected",a)},setLabel:function(a){f.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",
a)},setDisabled:function(a){f.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){if(this.accelKeyNode)this.accelKeyNode.style.display=a?"":"none",this.accelKeyNode.innerHTML=a,h.set(this.containerNode,"colSpan",a?"1":"2");this._set("accelKey",a)}});i("dojo-bidi")&&(j=c("dijit.MenuItem",
j,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return j})},"dijit/_Contained":function(){define("dijit/_Contained",["dojo/_base/declare","./registry"],function(c,a){return c("dijit._Contained",null,{_getSibling:function(c){var d=this.domNode;do d=d[c+"Sibling"];while(d&&1!=d.nodeType);return d&&a.byNode(d)},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},
getIndexInParent:function(){var a=this.getParent();return!a||!a.getIndexOfChild?-1:a.getIndexOfChild(this)}})})},"url:dijit/templates/MenuItem.html":'<tr class="dijitReset dijitMenuItem" data-dojo-attach-point="focusNode" role="menuitem" tabIndex="-1">\n\t<td class="dijitReset dijitMenuItemIconCell" role="presentation">\n\t\t<img src="${_blankGif}" alt="" class="dijitIcon dijitMenuItemIcon" data-dojo-attach-point="iconNode"/>\n\t</td>\n\t<td class="dijitReset dijitMenuItemLabel" colspan="2" data-dojo-attach-point="containerNode,textDirNode"></td>\n\t<td class="dijitReset dijitMenuItemAccelKey" style="display: none" data-dojo-attach-point="accelKeyNode"></td>\n\t<td class="dijitReset dijitMenuArrowCell" role="presentation">\n\t\t<div data-dojo-attach-point="arrowWrapper" style="visibility: hidden">\n\t\t\t<img src="${_blankGif}" alt="" class="dijitMenuExpand"/>\n\t\t\t<span class="dijitMenuExpandA11y">+</span>\n\t\t</div>\n\t</td>\n</tr>\n',
"mathEditor/mathContentAssist":function(){define(["dojo/_base/array"],function(c){return{keywords:[{input:"/",map:"&#xF7;",nodeName:"mo",freq:0,label:"\u9664\u53f7",iconClass:"drip_equation_icon drip_division"},{input:"/",map:"/",nodeName:"text",freq:0,label:"/",iconClass:""},{input:"/",map:"",nodeName:"mfrac",freq:0,label:"\u5206\u6570",iconClass:"drip_equation_icon drip_frac"},{input:"*",map:"&#xD7;",nodeName:"mo",freq:0,label:"\u4e58\u53f7",iconClass:"drip_equation_icon drip_multiplication"},{input:"*",
map:"*",nodeName:"text",freq:0,label:"*",iconClass:""},{input:"^",map:"^",nodeName:"text",freq:0,label:"^",iconClass:""},{input:"^",map:"",nodeName:"msup",freq:0,label:"\u4e0a\u6807",iconClass:"drip_equation_icon drip_sup"}],getProposals:function(a){return c.filter(this.keywords,function(c){return 0==c.input.indexOf(a)})}}})}}});
define("mathEditor/Editor","dojo/_base/declare,dojo/_base/lang,dojo/_base/event,dijit/_WidgetBase,dojo/on,dojo/sniff,dojo/keys,dojo/aspect,dojo/dom-construct,dojo/dom-style,dojo/dom-class,mathEditor/Model,mathEditor/View,mathEditor/ContentAssist".split(","),function(c,a,h,d,f,i,j,k,m,b,e,n,g,o){return c("mathEditor.Editor",[d],{model:null,view:null,textarea:null,value:"",_getValueAttr:function(){return this.model.getXML()},_setValueAttr:function(a){this.model.clear();a&&""!=a&&this.model.setData({data:a})},
postCreate:function(){this.inherited(arguments);b.set(this.domNode,{position:"relative"});var c=this.textarea=m.create("textarea",{style:{position:"absolute"}},this.domNode);e.add(c,"drip_text_input");c.wrap="off";c.autocorrect="off";c.autocapitalize="off";c.spellcheck=!1;var d=this.model=new n;this.view=new g({model:this.model,parentNode:this.domNode,textarea:this.textarea});var r=this.contentAssist=new o({view:this.view});k.after(r,"apply",function(a,b,e){d.setData({data:a,nodeName:b,removeCount:e});
setTimeout(function(){c.value=""})},!0);if(i("chrome"))f(c,"textInput",a.hitch(this,function(a){this._onTextInput(a.data)}));else{var p=!1;f(c,"input",a.hitch(this,function(){if(!p)inputData=c.value,""!=inputData&&this._onTextInput(inputData)}));f(c,"compositionstart",a.hitch(this,function(){p=!0}));f(c,"compositionend",a.hitch(this,function(){p=!1}))}f(c,"blur",a.hitch(this,function(){this.view.blur()}));f(c,"keydown",a.hitch(this,function(a){a.keyCode===j.LEFT_ARROW?(this.model.moveLeft(),this.view.showCursor()):
a.keyCode===j.RIGHT_ARROW?this.model.moveRight():a.keyCode===j.UP_ARROW?this.contentAssist.opened?this.contentAssist.selectPrev():this.model.moveUp():a.keyCode===j.DOWN_ARROW?this.contentAssist.opened?this.contentAssist.selectNext():this.model.moveDown():a.keyCode===j.BACKSPACE?this.model.doDelete():a.altKey&&191===a.keyCode?(this.contentAssist.open(),h.stop(a)):a.keyCode===j.ENTER&&(this.contentAssist.opened?this.contentAssist.enter(a):this.model.setData({data:"\n"}),h.stop(a))}))},_onTextInput:function(a){var b=
this.contentAssist.show(a);null!=b&&(a=b);this.model.setData({data:a});var c=this.textarea;setTimeout(function(){c.value=""})}})});