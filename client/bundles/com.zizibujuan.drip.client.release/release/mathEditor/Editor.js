//>>built
require({cache:{"mathEditor/Model":function(){define("mathEditor/Model","dojo/_base/declare,dojo/_base/lang,dojo/_base/array,dojo/dom-construct,dojox/xml/parser,mathEditor/string,mathEditor/dataUtil,mathEditor/lang,mathEditor/xmlUtil".split(","),function(b,g,i,e,j,k,m,l,n){return b(null,{path:null,xmlString:null,doc:null,mode:"text",anchor:null,constructor:function(d){this._init();g.mixin(this,d)},_isTextMode:function(){return"text"===this.mode},_isMathMLMode:function(){return"mathml"===this.mode},
_toTextMode:function(){this.mode="text"},_toMathMLMode:function(){this.mode="mathml"},_init:function(){this.doc=j.parse("<root><line></line></root>");this.path=[];this.anchor={};this._updateAnchor(this.doc.documentElement.firstChild,0);this._toTextMode();this.path.push({nodeName:"root"});this.path.push({nodeName:"line",offset:1})},clear:function(){this._init();this.onChange()},loadData:function(){},_split:function(d){return d.split(/\r\n|\r|\n/)},insertText:function(d,a){if(!a||0==a.length)return d;
var c=d.node,f=d.offset,h=this._split(a),e=h.splice(0,1)[0],g=h.splice(h.length-1,h.length)[0],o=this.doc;if(this._isLineNode(c)){var b="text",f=o.createElement(b);c.appendChild(f);c=f;f=0;this.path.push({nodeName:b,offset:0})}if(0<e.length){c.textContent=k.insertAtOffset(c.textContent,f,e);f+=e.length;e=this.path.pop();if(0==e.offset)e.offset=1;this.path.push(e)}if(null!=g){var b="line",n=this._getFocusLine();0<h.length&&i.forEach(h,function(c){var a=o.createElement(b);a.textContent=c;l.insertNodeAfter(a,
n);n=a});b="line";c=o.createElement(b);l.insertNodeAfter(c,n);0==g.length?(f=0,this.path.pop(),e=this.path.pop(),this.path.push({nodeName:b,offset:e.offset+1})):(b="text",f=o.createElement(b),f.textContent=g,c.appendChild(f),c=f,f=g.length,this.path.pop(),e=this.path.pop(),e.offset++,this.path.push(e),this.path.push({nodeName:b,offset:1}))}return{node:c,offset:f}},findTrigonometric:function(d,a){for(var c=[],f=[],h=d.node,e=h;e&&"mi"==e.nodeName&&1==e.textContent.length&&!(c.unshift(e.textContent),
e=h.previousSibling,2==c.length););if(2==c.length){if(h=c.join("")+a,l.isTrigonometric(h))return{functionName:h,preMis:c,nextMis:f}}else if(1==c.length){if((h=h.nextSibling)&&"mi"==h.nodeName&&1==h.textContent.length)if(h=c[0]+a+h.textContent,l.isTrigonometric(h))return{functionName:h,preMis:c,nextMis:f}}else if(0==c.length){h=h.nextSibling;for(f=[];h&&"mi"==h.nodeName&&1==h.textContent.length&&!(f.push(h.textContent),h=h.nextSibling,2==f.length););if(2==f.length&&(h=a+f.join(""),l.isTrigonometric(h)))return{functionName:h,
preMis:c,nextMis:f}}return null},removeExistTrigonometricPart:function(d,a){var c=d.node,f=d.offset,h=a.preMis.length;2==h?(f=c.previousSibling.previousSibling,c.parentNode.removeChild(c.previousSibling),c.parentNode.removeChild(c),c=this.path.pop(),c.offset-=2,this.path.push(c),c=f,f="mi"==c.nodeName||"mo"==c.nodeName?1:c.textContent.length):1==h?(f=c.previousSibling,c.parentNode.removeChild(c.nextSibling),c.parentNode.removeChild(c),c=this.path.pop(),c.offset--,this.path.push(c),c=f,f="mi"==c.nodeName||
"mo"==c.nodeName?1:c.textContent.length):0==h&&(c.parentNode.removeChild(c.nextSibling),c.parentNode.removeChild(c.nextSibling),f="mi"==c.nodeName||"mo"==c.nodeName?1:c.textContent.length);return{node:c,offset:f}},insertMi:function(d,a){var c=d.node,f=d.offset,h=this.doc;this._isLineNode(c)?(this.path.push({nodeName:"math",offset:1}),this.path.push({nodeName:"mi",offset:1}),f=h.createElement("math"),h=h.createElement("mi"),h.textContent=a,f.appendChild(h),c.appendChild(f)):(h=h.createElement("mi"),
h.textContent=a,0==f?(f=this.path.pop(),this.path.push({nodeName:"mi",offset:f.offset}),l.insertNodeBefore(h,c)):1==f&&(f=this.path.pop(),this.path.push({nodeName:"mi",offset:f.offset+1}),l.insertNodeAfter(h,c)));return{node:h,offset:1}},insertMn:function(d,a){var c=d.node,f=d.offset,h=this.doc;if(this._isLineNode(c))f=h.createElement("math"),h=h.createElement("mn"),h.textContent=a,f.appendChild(h),c.appendChild(f),this.path.push({nodeName:"math",offset:1}),this.path.push({nodeName:"mn",offset:1}),
c=h,f=a.length;else if(!this._isTextNode(c))c.textContent=k.insertAtOffset(c.textContent,f,a),f+=a.length;return{node:c,offset:f}},insertMo:function(d,a){var c=d.node,f=d.offset,h=this.doc;this._isLineNode(c)?(f=h.createElement("math"),h=h.createElement("mo"),h.textContent=a,f.appendChild(h),c.appendChild(f),c=h,f=1,this.path.push({nodeName:"math",offset:1}),this.path.push({nodeName:"mo",offset:1})):this._isTextNode(c)?(f=h.createElement("math"),h=h.createElement("mo"),h.textContent=a,f.appendChild(h),
l.insertNodeAfter(f,c),c=h,f=1,h=this.path.pop(),this.path.push({nodeName:"math",offset:h.offset+1}),this.path.push({nodeName:"mo",offset:1})):"="==a&&"mo"==c.nodeName&&"="==c.textContent?c.textContent+="=":"="==a&&"mo"==c.nodeName&&"!"==c.textContent?c.textContent+="=":(h=h.createElement("mo"),h.textContent=a,l.insertNodeAfter(h,c),c=h,f=1,h=this.path.pop(),this.path.push({nodeName:"mo",offset:h.offset+1}));return{node:c,offset:f}},insertFenced:function(d,a){var c=d.node,f=d.offset,h=this.doc;if(this._isLineNode(c)||
this._isTextNode(c)){this.path.push({nodeName:"math",offset:f+1});this.path.push({nodeName:"mfenced",offset:1});this.path.push({nodeName:"mrow",offset:1});this.path.push({nodeName:"mn",offset:1});var i=h.createElement("math"),b=h.createElement("mfenced"),g={"{":{left:"{",right:"}"},"[":{left:"[",right:"]"},"|":{left:"|",right:"|"}};"("!=a&&(b.setAttribute("open",g[a].left),b.setAttribute("close",g[a].right));g=h.createElement("mrow");h=n.getPlaceHolder(h);i.appendChild(b);b.appendChild(g);g.appendChild(h);
e.place(i,c,f);c=h;f=0}return{node:c,offset:f}},insertTrigonometric:function(d,a,c){var f=d.node,d=d.offset,h=this.doc;if(this._isLineNode(f)||this._isTextNode(f)){this.path.push({nodeName:"math",offset:d+1});this.path.push({nodeName:"mrow",offset:3});this.path.push({nodeName:"mn",offset:1});var i=h.createElement("math"),c=h.createElement(c),b=h.createElement("mo"),g=h.createElement("mrow"),h=n.getPlaceHolder(h);c.textContent=a;b.textContent="&#x2061;";g.appendChild(h);i.appendChild(c);i.appendChild(b);
i.appendChild(g);e.place(i,f,d)}else this.path.push({nodeName:"mrow",offset:this.path.pop().offset+3}),this.path.push({nodeName:"mn",offset:1}),c=h.createElement(c),b=h.createElement("mo"),g=h.createElement("mrow"),h=n.getPlaceHolder(h),c.textContent=a,b.textContent="&#x2061;",g.appendChild(h),l.insertNodeAfter(c,f),l.insertNodeAfter(b,c),l.insertNodeAfter(g,b);return{node:h,offset:0}},insertMfrac:function(d){var a=d.node,d=d.offset,c=this.doc,f=1,d="last";this._isTextNode(a)&&(f=this.path.pop().offset+
1,d="after");if(this._isLineNode(a)||this._isTextNode(a)){this.path.push({nodeName:"math",offset:f});this.path.push({nodeName:"mfrac",offset:1});this.path.push({nodeName:"mrow",offset:1});this.path.push({nodeName:"mn",offset:1});var h=c.createElement("math"),c=n.createEmptyFrac(c);h.appendChild(c.rootNode);e.place(h,a,d)}else this.path.pop(),this.path.push({nodeName:"mfrac",offset:f}),this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),h=a.parentNode,d=f-1,c=n.createFracWithNumerator(c,
a),e.place(c.rootNode,h,d);a=c.focusNode;return{node:a,offset:0}},insertMsqrt:function(d){var a=d.node,d=d.offset,c=this.doc,f=1,h="last";this._isTextNode(a)&&(f=this.path.pop().offset+1,h="after");this._isLineNode(a)||this._isTextNode(a)?(this.path.push({nodeName:"math",offset:f}),this.path.push({nodeName:"msqrt",offset:1}),this.path.push({nodeName:"mrow",offset:1}),this.path.push({nodeName:"mn",offset:1}),d=c.createElement("math"),c=n.createEmptyMsqrt(c),d.appendChild(c.rootNode),e.place(d,a,h)):
(this.path.pop(),this.path.push({nodeName:"msqrt",offset:d+1}),this.path.push({nodeName:"mrow",offset:1}),this.path.push({nodeName:"mn",offset:1}),a=a.parentNode,c=n.createEmptyMsqrt(c),e.place(c.rootNode,a,d));a=c.focusNode;return{node:a,offset:0}},insertMroot:function(d){var a=d.node,d=d.offset,c=this.doc,f=1,h="last";this._isTextNode(a)&&(f=this.path.pop().offset+1,h="after");this._isLineNode(a)||this._isTextNode(a)?(this.path.push({nodeName:"math",offset:f}),this.path.push({nodeName:"mroot",offset:1}),
this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),d=c.createElement("math"),c=n.createEmptyMroot(c),d.appendChild(c.rootNode),e.place(d,a,h)):(this.path.pop(),this.path.push({nodeName:"mroot",offset:d+1}),this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),a=a.parentNode,c=n.createEmptyMroot(c),e.place(c.rootNode,a,d));a=c.focusNode;return{node:a,offset:0}},insertScripting:function(d,a,c){var a=d.node,d=d.offset,d=this.doc,f=1,h="last";
this._isTextNode(a)&&(f=this.path.pop().offset+1,h="after");this._isLineNode(a)||this._isTextNode(a)?(this.path.push({nodeName:"math",offset:f}),this.path.push({nodeName:c,offset:1}),this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),f=d.createElement("math"),c=n.createEmptyScripting(d,c),f.appendChild(c.rootNode),e.place(f,a,h)):(this.path.pop(),this.path.push({nodeName:c,offset:1}),this.path.push({nodeName:"mrow",offset:2}),this.path.push({nodeName:"mn",offset:1}),
h=a.parentNode,c=n.createScriptingWithBase(d,a,c),e.place(c.rootNode,h,0));a=c.focusNode;return{node:a,offset:0}},_splitNodeIfNeed:function(d){var a=this.anchor.offset,c=this.anchor.node;if(c.nodeName!=d){var f=c.textContent,d=f.length;if(0<a&&a<d)d=f.substring(0,a),a=f.substring(a),f=this.doc.createElement(c.nodeName),c.textContent=d,f.textContent=a,l.insertNodeAfter(f,c)}},setData:function(d){var a=d.data,c=d.nodeName;if((d=d.removeCount)&&0<d)for(var f=0;f<d;f++)this.removeLeft();if(this._isTextMode())this.anchor=
this.insertText(this.anchor,a),this.onChange(a);else{if(this._isMathMLMode()){if(l.isLetter(a)){(d=this.findTrigonometric(this.anchor,a))?(this.anchor=this.removeExistTrigonometricPart(this.anchor,d),this.anchor=this.insertTrigonometric(this.anchor,d.functionName,c||"mi")):this.anchor=this.insertMi(this.anchor,a);this.onChange(a);return}if(l.isNumber(a)){d=this.anchor.node;n.isPlaceHolder(d)&&n.removePlaceHolder(d);this.anchor=this.insertMn(this.anchor,a);this.onChange(a);return}if(l.isOperator(a)){this.anchor=
this.insertMo(this.anchor,a);this.onChange(a);return}if(l.isTrigonometric(a)){this.anchor=this.insertTrigonometric(this.anchor,a,c);this.onChange(a);return}if(l.isGreekLetter(a)){this.anchor=this.insertMi(this.anchor,a);this.onChange(a);return}if(l.isFenced(a)){this.anchor=this.insertFenced(this.anchor,a);this.onChange(a);return}if("mfrac"===c){this._splitNodeIfNeed(c);this.anchor=this.insertMfrac(this.anchor,a,c);this.onChange(a);return}if("msqrt"===c){this._splitNodeIfNeed(c);this.anchor=this.insertMsqrt(this.anchor,
a,c);this.onChange(a);return}if("mroot"===c){this._splitNodeIfNeed(c);this.anchor=this.insertMroot(this.anchor,a,c);this.onChange(a);return}if("msub"===c||"msup"==c){this._splitNodeIfNeed(c);this.anchor=this.insertScripting(this.anchor,a,c);this.onChange(a);return}}var h=this.doc,d=this.anchor.node,f=this.anchor.offset;if(c&&""!=c){this._isTextNode(d)&&this.path.pop();if("mfrac"!=c&&"msup"!=c&&"msub"!=c&&"msqrt"!=c&&"mroot"!=c&&"mi"==c&&l.isTrigonometric(a)&&(this._isLineNode(d)||this._isTextNode(d))){this.path.push({nodeName:"math",
offset:f+1});this.path.push({nodeName:"mrow",offset:3});this.path.push({nodeName:"mn",offset:1});var c=h.createElement("math"),b=h.createElement("mi"),j=h.createElement("mo"),o=h.createElement("mrow"),m=n.getPlaceHolder(h);b.textContent=a;j.textContent="&#x2061;";o.appendChild(m);c.appendChild(b);c.appendChild(j);c.appendChild(o);e.place(c,d,f);this._updateAnchor(m,0)}this.onChange()}else if(l.isFenced(a)){if(this._isLineNode(d)||this._isTextNode(d))this.path.push({nodeName:"math",offset:f+1}),this.path.push({nodeName:"mfenced",
offset:1}),this.path.push({nodeName:"mrow",offset:1}),this.path.push({nodeName:"mn",offset:1}),c=h.createElement("math"),b=h.createElement("mfenced"),o={"{":{left:"{",right:"}"},"[":{left:"[",right:"]"},"|":{left:"|",right:"|"}},"("!=a&&(b.setAttribute("open",o[a].left),b.setAttribute("close",o[a].right)),o=h.createElement("mrow"),m=n.getPlaceHolder(h),c.appendChild(b),b.appendChild(o),o.appendChild(m),e.place(c,d,f),this.anchor.node=m,this.anchor.offset=0;this.onChange()}else d=[],g.isString(a)?
d=k.splitData(a):g.isArray(a)&&(d=a),i.forEach(d,g.hitch(this,function(c){var a=this.anchor.node;if(l.isNumber(c)){var d="mn",f=a.nodeName;if("line"==f||"text"==f){var f=this.anchor.offset,b="last",i=1;if(this._isLineNode(a))b="last",i=1;else if(this._isTextNode(a)){this._splitNodeIfNeed();var g=this.path.pop();0<f?(b="after",i=g.offset+1):b="before"}var j=h.createElement("math"),o=h.createElement(d);j.appendChild(o);e.place(j,a,b);this.anchor.node=o;this.anchor.offset=0;this._insertChar(c);this.path.push({nodeName:"math",
offset:i});this.path.push({nodeName:d,offset:1})}else if(l.isMathTokenNode(a)){a=this.anchor.node;n.isPlaceHolder(a)&&n.removePlaceHolder(a);if(a.nodeName!=d)f=h.createElement(d),l.insertNodeAfter(f,a),this.anchor.node=f,this.anchor.offset=0,g=this.path.pop(),this.path.push({nodeName:d,offset:g.offset+1});this._insertChar(c)}}else if(l.isOperator(c)){var d="mo";this._isLineNode(a)?(j=h.createElement("math"),o=h.createElement(d),j.appendChild(o),this._updateAnchor(o,0),this._insertChar(c),this.path.push({nodeName:"math",
offset:1}),this.path.push({nodeName:d,offset:1}),e.place(j,a,f)):l.isMathTokenNode(a)?"="==c&&"mo"==a.nodeName&&"="==a.textContent?a.textContent+="=":"="==c&&"mo"==a.nodeName&&"!"==a.textContent?a.textContent+="=":(o=h.createElement(d),this._updateAnchor(o,0),this._insertChar(c),g=this.path.pop(),this.path.push({nodeName:d,offset:g.offset+1}),l.insertNodeAfter(o,a)):this._isTextNode(a)&&(j=h.createElement("math"),o=h.createElement(d),j.appendChild(o),this._updateAnchor(o,0),this._insertChar(c),g=
this.path.pop(),this.path.push({nodeName:"math",offset:g.offset+1}),this.path.push({nodeName:d,offset:1}),l.insertNodeAfter(j,a))}else if(this._isLineNode(a))b=f,d="text",o=h.createElement(d),this._updateAnchor(o,0),this.path.push({nodeName:d,offset:1}),this._insertChar(c),e.place(o,a,b);else if(this._isTextNode(a))this._insertChar(c);else if(l.isMathTokenNode(a)){do g=this.path.pop();while(g&&"math"!=g.nodeName);d=h.createElement("text");for(j=a;"math"!=j.nodeName;)j=j.parentNode;l.insertNodeAfter(d,
j);this.anchor.node=d;this.anchor.offset=0;this._insertChar(c);this.path.push({nodeName:"text",offset:g.offset+1})}})),this.onChange(a)}},_updateAnchor:function(d,a){this.anchor.node=d;this.anchor.offset=a},doDelete:function(){if(""!=this.removeLeft())this.onChange()},removeLeft:function(){var d=this.anchor.offset,a=this.anchor.node,c=a.textContent;if(0==d){d=a;if("text"!=a.nodeName&&"line"!=a.nodeName){for(;"math"!=d.nodeName;)d=d.parentNode;if(d=d.previousSibling){var a=d.textContent,f=a.length,
c=k.insertAtOffset(a,f,"",1),f=f-1;""==c?(d.parentNode.removeChild(d),this.path.pop()):(d.textContent=c,this.anchor.node=d,this.anchor.offset=f);return f=a.charAt(f)}}else if("line"==a.nodeName&&1<this.getLineCount()){d=a.previousSibling;f=d.childNodes.length;if(0==f)this.anchor.node=d,this.anchor.offset=0,c=this.path.pop(),c.offset--,this.path.push(c),a.parentNode.removeChild(a);else if(d=d.lastChild,"text"==d.nodeName)this.anchor.node=d,this.anchor.offset=d.textContent.length,c=this.path.pop(),
c.offset--,this.path.push(c),this.path.push({nodeName:d.nodeName,offset:f}),a.parentNode.removeChild(a);else if("math"==d.nodeName){var h=d.childNodes.length,d=d.lastChild;this.anchor.node=d;this.anchor.offset=d.textContent.length;c=this.path.pop();c.offset--;this.path.push(c);this.path.push({nodeName:"math",offset:f});this.path.push({nodeName:d.nodeName,offset:h});a.parentNode.removeChild(a)}return"\n"}return""}"mo"==a.nodeName?(f=a.textContent,c=""):(f=c.charAt(d-1),c=k.insertAtOffset(c,d,"",1));
if(""==c)if(d=a.previousSibling)"math"==d.nodeName?(h=d.childNodes.length,d=d.lastChild,this.anchor.node=d,this.anchor.offset=d.textContent.length,c=this.path.pop(),this.path.push({nodeName:"math",offset:c.offset-1}),this.path.push({nodeName:d.nodeName,offset:h}),a.parentNode.removeChild(a)):(this.anchor.node=d,this.anchor.offset=d.textContent.length,a.parentNode.removeChild(a),this.path.push({nodeName:this.anchor.node.nodeName,offset:this.path.pop().offset-1}));else{h=c=a;if("text"!=a.nodeName&&
"line"!=a.nodeName)for(;"math"!=h.nodeName;)c=h.parentNode,c.removeChild(h),h=c,this.path.pop();d=h.previousSibling;c=h.parentNode;c.removeChild(h);a=this.path.pop().offset;d?(this.anchor.node=d,this.anchor.offset=d.textContent.length,this.path.push({nodeName:this.anchor.node.nodeName,offset:a-1})):(this.anchor.node=c,this.anchor.offset=c.childElementCount)}else this.anchor.node.textContent=c,this.anchor.offset-=1;return f},moveLeft:function(){var d=this.anchor.node,a=this.anchor.offset;if("line"==
d.nodeName){if(a=d.previousSibling){a=a.lastChild;if("math"==a.nodeName)a=a.lastChild;d=a.textContent;this.anchor.node=a;this.anchor.offset=d.length}}else if(0<a)this.anchor.offset--;else if(0==a)if(a=d.previousSibling){if("math"==a.nodeName)a=a.lastChild;d=a.textContent;this.anchor.node=a;this.anchor.offset=d.length-1}else if(a=d.parentNode.previousSibling)if("line"==a.nodeName){a=a.lastChild;if("math"==a.nodeName)a=a.lastChild;d=a.textContent;this.anchor.node=a;this.anchor.offset=d.length}else d=
a.textContent,this.anchor.node=a,this.anchor.offset=d.length-1},moveRight:function(){},moveUp:function(){},moveDown:function(){},getLineCount:function(){return this.doc.documentElement.childNodes.length},_getFocusLine:function(){for(var d=this.getFocusNode();d&&"line"!=d.nodeName;)d=d.parentNode;return d},_isNotSameNode:function(d,a){return d==a.nodeName},_isLineNode:function(d){return"line"==d.nodeName},_isTextNode:function(d){return"text"==d.nodeName},_insertChar:function(d){var a=this.anchor.node,
c=this.anchor.offset,d=k.insertAtOffset(a.textContent,c,d);a.textContent=d;this._updateAnchor(a,c+1)},getXML:function(){return 0==this.doc.firstChild.firstChild.childNodes.length?"":j.innerXML(this.doc)},isEmpty:function(){return""==this.getXML()},getPath:function(){var d="";i.forEach(this.path,function(a){d+="/";d+=a.nodeName;a.offset&&(d+="["+a.offset+"]")});return d},getFocusNode:function(){return this.anchor.node},getOffset:function(){return this.anchor.offset},getLineAt:function(d){return this.getLines()[d]},
getLines:function(){return this.doc.documentElement.childNodes},getHTML:function(){return m.xmlDocToHtml(this.doc)},onChange:function(){}})})},"dojox/xml/parser":function(){define("dojox/xml/parser",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/window","dojo/_base/sniff"],function(b){b.getObject("xml.parser",!0,dojox);dojox.xml.parser.parse=function(g,i){var e=b.doc,j,i=i||"text/xml";if(g&&b.trim(g)&&"DOMParser"in b.global){j=(new DOMParser).parseFromString(g,i);e=j.documentElement;
if("parsererror"==e.nodeName&&"http://www.mozilla.org/newlayout/xml/parsererror.xml"==e.namespaceURI){var k=e.getElementsByTagNameNS("http://www.mozilla.org/newlayout/xml/parsererror.xml","sourcetext")[0];if(k)k=k.firstChild.data;throw Error("Error parsing text "+e.firstChild.data+" \n"+k);}return j}if("ActiveXObject"in b.global){e=function(e){return"MSXML"+e+".DOMDocument"};e=["Microsoft.XMLDOM",e(6),e(4),e(3),e(2)];b.some(e,function(e){try{j=new ActiveXObject(e)}catch(b){return!1}return!0});if(g&&
j&&(j.async=!1,j.loadXML(g),e=j.parseError,0!==e.errorCode))throw Error("Line: "+e.line+"\nCol: "+e.linepos+"\nReason: "+e.reason+"\nError Code: "+e.errorCode+"\nSource: "+e.srcText);if(j)return j}else if(e.implementation&&e.implementation.createDocument){if(g&&b.trim(g)&&e.createElement){k=e.createElement("xml");k.innerHTML=g;var m=e.implementation.createDocument("foo","",null);b.forEach(k.childNodes,function(e){m.importNode(e,!0)});return m}return e.implementation.createDocument("","",null)}return null};
dojox.xml.parser.textContent=function(g,i){if(1<arguments.length)return dojox.xml.parser.replaceChildren(g,(g.ownerDocument||b.doc).createTextNode(i)),i;if(void 0!==g.textContent)return g.textContent;var e="";g&&b.forEach(g.childNodes,function(b){switch(b.nodeType){case 1:case 5:e+=dojox.xml.parser.textContent(b);break;case 3:case 2:case 4:e+=b.nodeValue}});return e};dojox.xml.parser.replaceChildren=function(g,i){var e=[];b.isIE&&b.forEach(g.childNodes,function(b){e.push(b)});dojox.xml.parser.removeChildren(g);
b.forEach(e,b.destroy);b.isArray(i)?b.forEach(i,function(e){g.appendChild(e)}):g.appendChild(i)};dojox.xml.parser.removeChildren=function(b){for(var i=b.childNodes.length;b.hasChildNodes();)b.removeChild(b.firstChild);return i};dojox.xml.parser.innerXML=function(b){return b.innerXML?b.innerXML:b.xml?b.xml:"undefined"!=typeof XMLSerializer?(new XMLSerializer).serializeToString(b):null};return dojox.xml.parser})},"mathEditor/string":function(){define([],function(){var b={},g=["==","!="];b.splitData=
function(b){for(var e=b.length,j=[],k=0,m=!1,l="",n=0,d=0;d<e;d++){var a;a:{a=b;for(var c=d,f=a.charAt(c),h=0;h<g.length;h++){var p=g[h];if(2==p.length){var q=p.charAt(0),o=p.charAt(1);if(f==q&&o==a.charAt(c+1)){a=p;break a}}else throw"\u6ca1\u6709\u4e3a\u957f\u5ea6\u4e3a"+p+"\u7684\u64cd\u4f5c\u7b26\u5b9a\u4e49\u5904\u7406\u903b\u8f91";}a=null}a?(j[k]=a,k++,d+=a.length):(a=b.charAt(d),"&"==a?(n=0,m=!0,l=a):m&&";"==a?(0==n?(j[k]=l,k++,j[k]=a):(l+=a,j[k]=l),k++,m=!1,l=""):m?(l+=a,n++):(j[k]=b.charAt(d),
k++))}return j};b.insertAtOffset=function(b,e,g,k){var m=b.length;if(0>e||m<e)return b;k=b.substring(0,e-(k||0));b=b.substring(e);return k+g+b};return b})},"mathEditor/dataUtil":function(){define(["dojox/xml/parser","dojo/_base/array"],function(b,g){var i={};i.xmlDocToHtml=function(e){var i="";g.forEach(e.documentElement.childNodes,function(e){var m="<div class='drip_line'>";g.forEach(e.childNodes,function(e){"text"==e.nodeName?m+="<span>"+e.textContent+"</span>":"math"==e.nodeName&&(e=b.innerXML(e),
m+=e.replace(/&amp;/g,"&"))});m+="</div>";i+=m});return i};i.xmlStringToHtml=function(e){return this.xmlDocToHtml(b.parse(e))};return i})},"mathEditor/lang":function(){define("mathEditor/lang",["dojo/_base/array"],function(b){var g={};g.isNumber=function(b){return!isNaN(parseFloat(b))&&isFinite(b)};g.isLetter=function(b){return 1==b.length&&/[a-zA-Z]/.test(b)};g.isOperator=function(b){return/\+|-|=|==|<|>|!|!=|&#xD7;|&#xF7;|&#x2A7E;|&#x226B;|&#x2A7D;|&#x226A;|&#x2260;|&#x2248;/.test(b)?!0:!1};g.isTrigonometric=
function(b){return/sin|cos|tan|cot|sec|csc/.test(b)};g.isGreekLetter=function(b){b="0"+b.substring(2,b.length-1);b=parseInt(b);return 913<=b&&937>=b||945<=b&&969>=b};g.isNewLine=function(b){return"\r\n"==b||"\r"==b||"\n"==b};g.isTab=function(b){return"\t"===b};g.isFenced=function(b){return/\(|\[|\{|\|/.test(b)};g.insertNodeAfter=function(b,e){var g=e.parentNode;g.lastChild==e?g.appendChild(b):g.insertBefore(b,e.nextSibling)};g.insertNodeBefore=function(b,e){e.parentNode.insertBefore(b,e)};g._fontStyles=
{fontFamily:1,fontSize:1,fontWeight:1,fontStyle:1,lineHeight:1};g.isMathTokenNode=function(b){return this.isMathTokenName(b.nodeName)};g.isMathTokenName=function(g){var e=!1;b.forEach("mi,mn,mo,mtext,mspace,ms".split(","),function(b){g==b&&(e=!0)});return e};g.measureTextSize=function(b,e){if(!this.measureNode){var g=document.createElement("div"),k=g.style;k.width=k.height="auto";k.left=k.top="-1000px";k.visibility="hidden";k.position="absolute";k.overflow="visible";k.whiteSpace="nowrap";document.body.appendChild(g);
this.measureNode=g}g=this.measureNode;g.innerHTML=e;var k=g.style,m=window.getComputedStyle(b,null),l;for(l in this._fontStyles)k[l]=m[l];return{height:g.offsetHeight,width:g.offsetWidth}};return g})},"mathEditor/xmlUtil":function(){define("mathEditor/xmlUtil",{createEmptyFrac:function(b){var g=b.createElement("mstyle");g.setAttribute("displaystyle","true");var i=b.createElement("mfrac"),e=b.createElement("mrow"),j=b.createElement("mrow"),k=this.getPlaceHolder(b),b=this.getPlaceHolder(b);g.appendChild(i);
i.appendChild(e);i.appendChild(j);e.appendChild(k);j.appendChild(b);return{rootNode:g,focusNode:k}},createFracWithNumerator:function(b,g){var i=b.createElement("mstyle");i.setAttribute("displaystyle","true");var e=b.createElement("mfrac"),j=b.createElement("mrow"),k=b.createElement("mrow"),m=this.getPlaceHolder(b);i.appendChild(e);e.appendChild(j);e.appendChild(k);j.appendChild(g);k.appendChild(m);return{rootNode:i,focusNode:m}},createScriptingWithBase:function(b,g,i){var i=b.createElement(i),e=b.createElement("mrow"),
j=b.createElement("mrow"),b=this.getPlaceHolder(b);i.appendChild(e);i.appendChild(j);e.appendChild(g);j.appendChild(b);return{rootNode:i,focusNode:b}},createEmptyScripting:function(b,g){var i=b.createElement(g),e=b.createElement("mrow"),j=b.createElement("mrow"),k=this.getPlaceHolder(b),m=this.getPlaceHolder(b);i.appendChild(e);i.appendChild(j);e.appendChild(k);j.appendChild(m);return{rootNode:i,focusNode:m}},createEmptyMsqrt:function(b){var g=b.createElement("msqrt"),i=b.createElement("mrow"),b=
this.getPlaceHolder(b);g.appendChild(i);i.appendChild(b);return{rootNode:g,focusNode:b}},createEmptyMroot:function(b){var g=b.createElement("mroot"),i=b.createElement("mrow"),e=b.createElement("mrow"),j=this.getPlaceHolder(b),b=this.getPlaceHolder(b);g.appendChild(i);g.appendChild(e);i.appendChild(j);e.appendChild(b);return{rootNode:g,focusNode:b}},createTrigonometric:function(){},isPlaceHolder:function(b){return"drip_placeholder_box"===b.getAttribute("class")},removePlaceHolder:function(b){b.removeAttribute("class");
b.removeAttribute("style");b.textContent=""},getPlaceHolder:function(b){b=b.createElement("mn");b.setAttribute("class","drip_placeholder_box");b.setAttribute("style","border:1px dotted black; padding:1px;background-color: #cccccc;color: #cccccc;");b.textContent="8";return b}})},"mathEditor/View":function(){define("mathEditor/View","dojo/_base/declare,dojo/_base/lang,dojo/_base/array,dojo/_base/event,dojo/dom,dojo/dom-style,dojo/dom-class,dojo/dom-construct,dojo/dom-geometry,dojo/on,dojo/aspect,mathEditor/Model,mathEditor/layer/Cursor,mathEditor/lang".split(","),
function(b,g,i,e,j,k,m,l,n,d,a,c,f,h){return b("mathEditor.View",null,{model:null,editorDiv:null,parentNode:null,textarea:null,readOnly:!1,focused:!1,constructor:function(c){g.mixin(this,c);var c=this.editorDiv=l.create("div",{style:{"border-radius":"3px",height:"100%",width:"100%",border:"solid 1px #CCC",position:"absolute",cursor:"text"}},this.parentNode),b=this.textLayer=l.create("div",{"class":"drip_layer drip_text"},c);this.cursor=new f({parentEl:c});d(c,"mousedown",g.hitch(this,this._onMouseDownHandler));
b.innerHTML=this.model.getHTML();a.after(this.model,"onChange",g.hitch(this,this._onChange))},_onMouseDownHandler:function(c){this._focus();e.stop(c)},_focus:function(){if(!1==this.focused){this.focused=!0;var c=this.textarea,a=this.cursor;m.add(this.editorDiv,"drip_editor_focus");setTimeout(function(){c.focus();a.show()},0)}},focus:function(){this._focus()},_onChange:function(){this.model.getHTML();this.textLayer.innerHTML=this.model.getHTML();MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.textLayer]);
MathJax.Hub.Queue(g.hitch(this,this.showCursor))},blur:function(){if(!0==this.focused)this.focused=!1,m.remove(this.editorDiv,"drip_editor_focus"),this.cursor.hide()},showCursor:function(){var c=this._getCursorConfig();this.cursor.move(c);this.textarea&&k.set(this.textarea,{top:c.top+"px",left:c.left+"px"})},moveLeft:function(){this.model.moveLeft();this.showCursor()},_getFocusInfo:function(){var c=this.textLayer,a=null,d=null;i.forEach(this.model.path,function(b){if("root"!=b.nodeName)if("line"==
b.nodeName)c=c.childNodes[b.offset-1];else if("text"==b.nodeName||"math"==b.nodeName){if(c=i.filter(c.childNodes,function(a){return"span"==a.nodeName.toLowerCase()})[b.offset-1],"math"==b.nodeName)a=c.nextSibling.MathJax.elementJax.root,a=a.data[0]}else if(a){var f=j.byId("MathJax-Span-"+a.spanID);if(m.contains(f,"mrow"))if("mrow"!=b.nodeName){var e=j.byId("MathJax-Span-"+a.data[0].spanID);m.contains(e,"mstyle")?"mstyle"!=b.nodeName&&(a=a.data[0],a=a.data[0],a=a.data[b.offset-1],f=j.byId("MathJax-Span-"+
a.spanID)):(d=f,a=a.data[b.offset-1],f=j.byId("MathJax-Span-"+a.spanID))}else{debugger;d=f;a=a.data[b.offset-1]}else a=h.isMathTokenName(b.nodeName)?a.data[0]:a.data[b.offset-1];c=j.byId("MathJax-Span-"+a.spanID)}});var b=this.model.getOffset(),f=this.model.getFocusNode();if("mo"==this.model.getFocusNode().nodeName)b=f.textContent.length;return{node:c,offset:b,mrowNode:d}},_getCursorConfig:function(){var a=0,c=0,d=0,b=0,a=this._getFocusInfo(),f=a.node,e=a.offset,c=this.getTextLayerPosition();if(a=
a.mrowNode)var d=n.position(a),a=d.y-c.y,d=d.h,g=n.position(f);else g=n.position(f),a=g.y-c.y,d=g.h;c=g.x-c.x;if(1==f.nodeType&&(g=f.childNodes,1==g.length&&3==g[0].nodeType))if(f.textContent.length==e)c+=f.offsetWidth;else{b=0;e=f.textContent.substring(0,e);if(""!=e)b=h.measureTextSize(f,e).width;c+=b}return{top:a,left:c,height:d,width:b}},getCursorPosition:function(){var a=this.getTextLayerPosition(),c=a.x,a=a.y,d=this.cursor.getCursorConfig(),c=c+d.left,a=a+(d.top+d.height);return{x:c,y:a}},getTextLayerPosition:function(){if(!this.textLayerPosition)this.textLayerPosition=
n.position(this.textLayer);return this.textLayerPosition}})})},"mathEditor/layer/Cursor":function(){define("dojo/_base/declare,dojo/_base/lang,dojo/dom-construct,dojo/dom-class,dojo/dom-style,dojo/dom-geometry".split(","),function(b,g,i){return b("mathEditor.layer.Cursor",null,{parentEl:null,caret:null,isVisible:!1,cursorConfig:{top:0,left:0},constructor:function(b){g.mixin(this,b);b=this.caret=i.create("div",{"class":"drip_cursor"},this.parentEl);b.style.visibility="hidden";this.defaultHeight=b.clientHeight;
this.cursorConfig.height=this.defaultHeight},show:function(){this.isVisible=!0;this.caret.style.visibility="";this._restartTimer()},move:function(b){this.cursorConfig=b;var g=b.left,i=b.height,m=this.caret.style;m.top=b.top+"px";m.left=g+"px";if(i&&0<i)m.height=i+"px";if(!1!=this.isVisible)this.caret.style.visibility="",this._restartTimer()},getCursorConfig:function(){return this.cursorConfig},hide:function(){this.caret.style.visibility="hidden";this.isVisible=!1;clearInterval(this.intervalId);this.intervalId=
null;clearTimeout(this.timeoutId);this.timeoutId=null},_restartTimer:function(){if(null!=this.intervalId)clearInterval(this.intervalId),this.intervalId=null;var b=this.caret,g=this;this.intervalId=setInterval(function(){b.style.visibility="hidden";g.timeoutId=setTimeout(function(){b.style.visibility=""},400)},1E3)},destroy:function(){null!=this.intervalId&&clearInterval(this.intervalId);i.destroy(this.caret)}})})},"mathEditor/ContentAssist":function(){define("dojo/_base/declare,dojo/_base/array,dojo/_base/lang,dojo/on,dojo/dom-construct,dojo/dom-class,dojo/dom-style,dijit/popup,dijit/DropDownMenu,dijit/MenuItem,mathEditor/mathContentAssist".split(","),
function(b,g,i,e,j,k,m,l,n,d,a){return b("mathEditor.ContentAssist",n,{proposals:null,view:null,cacheString:"",opened:!1,postCreate:function(){this.inherited(arguments);e(this.view.editorDiv,"mousedown",i.hitch(this,function(){this.opened&&l.close(this)}))},startup:function(){this.inherited(arguments)},_scheduleOpen:function(a,d,b){view=this.view;var e=this;if(!this._openTimer)this._openTimer=this.defer(function(){this._openTimer.remove();delete this._openTimer;l.open({popup:a,x:d,y:b,onExecute:function(){l.close(a);
view.focus();e.opened=!1},onCancel:function(){l.close(a);e.opened=!1;view.focus()},onClose:function(){view.focus();e.opened=!1}});this.opened=!0;a.select()},0)},_open:function(){var a=this.view.getCursorPosition();this._scheduleOpen(this,a.x,a.y);this.opened=!0},_clear:function(){var a=this.getChildren();g.forEach(a,i.hitch(this,function(a){this.removeChild(a)}))},_setProposals:function(a){this._clear();this.proposals=a;g.forEach(a,i.hitch(this,function(a){var c=new d({label:a.label+" ( \\"+a.input+
" )",iconClass:a.iconClass});c.on("click",i.hitch(this,this._onApplyProposal,a.map,a.nodeName));this.addChild(c)}))},show:function(c){if(!1==this.opened)this.cacheString=c;else{var d=a.getProposals(this.cacheString+c);this.cacheString=0==d.length?c:this.cacheString+c}d=a.getProposals(this.cacheString);this._setProposals(d);if(0<d.length)return this._open(),d[0].map;this.cacheString="";if(this.opened)l.close(this),this.opened=!1;return null},_onApplyProposal:function(a,d,b){this.apply(a,d,this.cacheString.length,
b)},apply:function(){},enter:function(a){this.onItemClick(this.selectedChild,a)},select:function(){this.selectFirstChild()},selectFirstChild:function(){this.selectChild(this._getFirstSelectableChild())},selectPrev:function(){this.selectChild(this._getNextSelectableChild(this.selectedChild,-1),!0)},selectNext:function(){this.selectChild(this._getNextSelectableChild(this.selectedChild,1))},_getFirstSelectableChild:function(){return this._getNextSelectableChild(null,1)},_getLastFocusableChild:function(){return this._getNextSelectableChild(null,
-1)},_getNextSelectableChild:function(a,d){a&&(a=this._getSiblingOfChild(a,d));for(var b=this.getChildren(),e=0;e<b.length;e++){a||(a=b[0<d?0:b.length-1]);if(a.isFocusable())return a;a=this._getSiblingOfChild(a,d)}return null},selectChild:function(a){if(a)this.selectedChild&&a!==this.selectedChild&&this.selectedChild._setSelected(!1),this.selectedChild=a,a._setSelected(!0)}})})},"dijit/DropDownMenu":function(){require({cache:{"url:dijit/templates/Menu.html":'<table class="dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role="menu" tabIndex="${tabIndex}"\n\t   data-dojo-attach-event="onkeydown:_onKeyDown" cellspacing="0">\n\t<tbody class="dijitReset" data-dojo-attach-point="containerNode"></tbody>\n</table>\n'}});
define("dijit/DropDownMenu",["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_OnDijitClickMixin","./_MenuBase"],function(b,g,i,e,j){return b("dijit.DropDownMenu",[j,e],{templateString:i,baseClass:"dijitMenu",postCreate:function(){this.inherited(arguments);var b=this.isLeftToRight();this._openSubMenuKey=b?g.RIGHT_ARROW:g.LEFT_ARROW;this._closeSubMenuKey=b?g.LEFT_ARROW:g.RIGHT_ARROW;this.connectKeyNavHandlers([g.UP_ARROW],[g.DOWN_ARROW])},_onKeyDown:function(b){if(!b.ctrlKey&&
!b.altKey)switch(b.keyCode){case this._openSubMenuKey:this._moveToPopup(b);b.stopPropagation();b.preventDefault();break;case this._closeSubMenuKey:if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else b.stopPropagation(),b.preventDefault()}}})})},"url:dijit/templates/Menu.html":'<table class="dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role="menu" tabIndex="${tabIndex}"\n\t   data-dojo-attach-event="onkeydown:_onKeyDown" cellspacing="0">\n\t<tbody class="dijitReset" data-dojo-attach-point="containerNode"></tbody>\n</table>\n',
"dijit/_MenuBase":function(){define("dijit/_MenuBase","dojo/_base/array,dojo/_base/declare,dojo/dom,dojo/dom-attr,dojo/dom-class,dojo/_base/lang,dojo/mouse,dojo/on,dojo/window,./a11yclick,./popup,./registry,./_Widget,./_CssStateMixin,./_KeyNavContainer,./_TemplatedMixin".split(","),function(b,g,i,e,j,k,m,l,n,d,a,c,f,h,p,q){return g("dijit._MenuBase",[f,q,p,h],{parentMenu:null,popupDelay:500,autoFocus:!1,childSelector:function(a){var b=c.byNode(a);return a.parentNode==this.containerNode&&b&&b.focus},
postCreate:function(){var a=this,b="string"==typeof this.childSelector?this.childSelector:k.hitch(this,"childSelector");this.own(l(this.containerNode,l.selector(b,m.enter),function(){a.onItemHover(c.byNode(this))}),l(this.containerNode,l.selector(b,m.leave),function(){a.onItemUnhover(c.byNode(this))}),l(this.containerNode,l.selector(b,d),function(b){a.onItemClick(c.byNode(this),b);b.stopPropagation();b.preventDefault()}));this.inherited(arguments)},onKeyboardSearch:function(a,c,b,d){this.inherited(arguments);
if(a&&(-1==d||a.popup&&1==d))this.onItemClick(a,c)},_keyboardSearchCompare:function(a,c){return a.shortcutKey?c==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){if(this.currentPopup&&this.currentPopup._pendingClose_timer){var a=
this.currentPopup.parentMenu;a.focusedChild&&a.focusedChild._setSelected(!1);a.focusedChild=this.currentPopup.from_item;a.focusedChild._setSelected(!0);this._stopPendingCloseTimer(this.currentPopup)}},onItemHover:function(a){if(this.isActive&&(this.focusChild(a),a.popup&&!a.disabled&&!this.hover_timer))this.hover_timer=this.defer(k.hitch(this,"_openPopup",a),this.popupDelay);this.focusedChild&&this.focusChild(a);this._hoveredChild=a;a._set("hovering",!0)},_onChildBlur:function(c){this._stopPopupTimer();
c._setSelected(!1);var b=c.popup;if(b)this._stopPendingCloseTimer(b),b._pendingClose_timer=this.defer(function(){b._pendingClose_timer=null;if(b.parentMenu)b.parentMenu.currentPopup=null;a.close(b)},this.popupDelay)},onItemUnhover:function(a){this.isActive&&this._stopPopupTimer();if(this._hoveredChild==a)this._hoveredChild=null;a._set("hovering",!1)},_stopPopupTimer:function(){if(this.hover_timer)this.hover_timer=this.hover_timer.remove()},_stopPendingCloseTimer:function(a){if(a._pendingClose_timer)a._pendingClose_timer=
a._pendingClose_timer.remove()},_stopFocusTimer:function(){if(this._focus_timer)this._focus_timer=this._focus_timer.remove()},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,c){"undefined"==typeof this.isShowingNow&&this._markActive();this.focusChild(a);if(a.disabled)return!1;a.popup?this._openPopup(a,/^key/.test(c.type)):(this.onExecute(),a._onClick?a._onClick(c):a.onClick(c))},_openPopup:function(c,b){this._stopPopupTimer();var d=c.popup;if(!d.isShowingNow){this.currentPopup&&
(this._stopPendingCloseTimer(this.currentPopup),a.close(this.currentPopup));d.parentMenu=this;d.from_item=c;var f=this;a.open({parent:this,popup:d,around:c.domNode,orient:this._orient||["after","before"],onCancel:function(){f.focusChild(c);f._cleanUp();c._setSelected(!0);f.focusedChild=c},onExecute:k.hitch(this,"_cleanUp")});this.currentPopup=d;this.currentPopupParent=c;d.own(l(d.domNode,"mouseenter",k.hitch(f,"_onPopupHover")))}if(b&&d.focus)d._focus_timer=this.defer(k.hitch(d,function(){this._focus_timer=
null;this.focus()}))},_markActive:function(){this.isActive=!0;j.replace(this.domNode,"dijitMenuActive","dijitMenuPassive")},onOpen:function(){this.isShowingNow=!0;this._markActive()},_markInactive:function(){this.isActive=!1;j.replace(this.domNode,"dijitMenuPassive","dijitMenuActive")},onClose:function(){this._stopFocusTimer();this._markInactive();this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();if(this.currentPopup)this.focused&&(e.set(this.currentPopupParent.focusNode,
"tabIndex",this.tabIndex),this.currentPopupParent.focusNode.focus()),a.close(this.currentPopup),this.currentPopup=this.currentPopupParent=null;this.focusedChild&&(this.focusedChild._setSelected(!1),this.onItemUnhover(this.focusedChild));e.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex","-1"),this._set("focusedChild",null))},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild)},_onBlur:function(){this._cleanUp();
this.inherited(arguments)},_cleanUp:function(){this._closeChild();"undefined"==typeof this.isShowingNow&&this._markInactive()}})})},"dijit/_KeyNavContainer":function(){define("dijit/_KeyNavContainer","dojo/_base/array,dojo/_base/declare,dojo/dom-attr,dojo/_base/kernel,dojo/keys,dojo/_base/lang,./registry,./_Container,./_FocusMixin,./_KeyNavMixin".split(","),function(b,g,i,e,j,k,m,l,n,d){return g("dijit._KeyNavContainer",[n,d,l],{connectKeyNavHandlers:function(a,c){var d=this._keyNavCodes={},e=k.hitch(this,
"focusPrev"),g=k.hitch(this,"focusNext");b.forEach(a,function(a){d[a]=e});b.forEach(c,function(a){d[a]=g});d[j.HOME]=k.hitch(this,"focusFirstChild");d[j.END]=k.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){e.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);b.forEach(this.getChildren(),k.hitch(this,"_startupChild"))},addChild:function(a,c){this.inherited(arguments);this._startupChild(a)},_startupChild:function(a){a.set("tabIndex",
"-1")},_getFirst:function(){var a=this.getChildren();return a.length?a[0]:null},_getLast:function(){var a=this.getChildren();return a.length?a[a.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(a){return(a=m.byNode(a))&&a.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dijit/_KeyNavMixin","dojo/_base/array,dojo/_base/declare,dojo/dom-attr,dojo/keys,dojo/_base/lang,dojo/on,dijit/registry,dijit/_FocusMixin".split(","),
function(b,g,i,e,j,k,m,l){return g("dijit._KeyNavMixin",l,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);i.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var b=this._keyNavCodes={};b[e.HOME]=j.hitch(this,"focusFirstChild");b[e.END]=j.hitch(this,"focusLastChild");b[this.isLeftToRight()?e.LEFT_ARROW:e.RIGHT_ARROW]=j.hitch(this,"_onLeftArrow");b[this.isLeftToRight()?e.RIGHT_ARROW:e.LEFT_ARROW]=j.hitch(this,"_onRightArrow");b[e.UP_ARROW]=j.hitch(this,
"_onUpArrow");b[e.DOWN_ARROW]=j.hitch(this,"_onDownArrow")}var d=this,b="string"==typeof this.childSelector?this.childSelector:j.hitch(this,"childSelector");this.own(k(this.domNode,"keypress",j.hitch(this,"_onContainerKeypress")),k(this.domNode,"keydown",j.hitch(this,"_onContainerKeydown")),k(this.domNode,"focus",j.hitch(this,"_onContainerFocus")),k(this.containerNode,k.selector(b,"focusin"),function(a){d._onChildFocus(m.getEnclosingWidget(this),a)}))},_onLeftArrow:function(){},_onRightArrow:function(){},
_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(b,d){b&&(this.focusedChild&&b!==this.focusedChild&&this._onChildBlur(this.focusedChild),
b.set("tabIndex",this.tabIndex),b.focus(d?"end":"start"))},_onContainerFocus:function(b){b.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){i.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(b){i.set(this.domNode,"tabIndex",this.tabIndex);if(this.focusedChild)this.focusedChild.set("tabIndex","-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null);this.inherited(arguments)},_onChildFocus:function(b){if(b&&b!=this.focusedChild)this.focusedChild&&
!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),b.set("tabIndex",this.tabIndex),this.lastFocused=b,this._set("focusedChild",b)},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(b){b&&this.focusChild(b)},_keyboardSearchCompare:function(b,d){var a=b.domNode,a=(b.label||(a.focusNode?a.focusNode.label:"")||a.innerText||a.textContent||"").replace(/^\s+/,"").substr(0,d.length).toLowerCase();return d.length&&a==d?-1:0},_onContainerKeydown:function(b){var d=this._keyNavCodes[b.keyCode];
d?(d(b,this.focusedChild),b.stopPropagation(),b.preventDefault(),this._searchString=""):b.keyCode==e.SPACE&&this._searchTimer&&!b.ctrlKey&&!b.altKey&&!b.metaKey&&(b.stopImmediatePropagation(),b.preventDefault(),k.emit(this.domNode,"keypress",{charCode:e.SPACE,cancelable:!0,bubbles:!0}))},_onContainerKeypress:function(b){if(!(32>b.charCode||b.ctrlKey||b.altKey)){var d=null,a,c=0,f=j.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=e;var b=/^(.)\1*$/.test(this._searchString)?
1:this._searchString.length;a=this._searchString.substr(0,b);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var f=this.focusedChild||null;if(1==b||!f)if(f=this._getNextFocusableChild(f,1),!f)return;b=f;do{var g=this._keyboardSearchCompare(f,a);g&&0==c++&&(d=f);if(-1==g){c=-1;break}f=this._getNextFocusableChild(f,1)}while(f!=b)}),e=String.fromCharCode(b.charCode).toLowerCase();b.preventDefault();b.stopPropagation();f();this.onKeyboardSearch(d,
b,a,c)}},_onChildBlur:function(){},_getNextFocusableChild:function(b,d){var a=b;do{if(b)b=this._getNext(b,d);else if(b=this[0<d?"_getFirst":"_getLast"](),!b)break;if(null!=b&&b!=a&&b.isFocusable())return b}while(b!=a);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(b,d){if(b)for(b=b.domNode;b;)if((b=b[0>d?"previousSibling":"nextSibling"])&&"getAttribute"in b){var a=m.byNode(b);if(a)return a}return null}})})},"dijit/MenuItem":function(){require({cache:{"url:dijit/templates/MenuItem.html":'<tr class="dijitReset dijitMenuItem" data-dojo-attach-point="focusNode" role="menuitem" tabIndex="-1">\n\t<td class="dijitReset dijitMenuItemIconCell" role="presentation">\n\t\t<img src="${_blankGif}" alt="" class="dijitIcon dijitMenuItemIcon" data-dojo-attach-point="iconNode"/>\n\t</td>\n\t<td class="dijitReset dijitMenuItemLabel" colspan="2" data-dojo-attach-point="containerNode,textDirNode"></td>\n\t<td class="dijitReset dijitMenuItemAccelKey" style="display: none" data-dojo-attach-point="accelKeyNode"></td>\n\t<td class="dijitReset dijitMenuArrowCell" role="presentation">\n\t\t<div data-dojo-attach-point="arrowWrapper" style="visibility: hidden">\n\t\t\t<img src="${_blankGif}" alt="" class="dijitMenuExpand"/>\n\t\t\t<span class="dijitMenuExpandA11y">+</span>\n\t\t</div>\n\t</td>\n</tr>\n'}});
define("dijit/MenuItem","dojo/_base/declare,dojo/dom,dojo/dom-attr,dojo/dom-class,dojo/_base/kernel,dojo/sniff,dojo/_base/lang,./_Widget,./_TemplatedMixin,./_Contained,./_CssStateMixin,dojo/text!./templates/MenuItem.html".split(","),function(b,g,i,e,j,k,m,l,n,d,a,c){m=b("dijit.MenuItem"+(k("dojo-bidi")?"_NoBidi":""),[l,n,d,a],{templateString:c,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",a);var b="",c;c=a.search(/{\S}/);if(0<=c){var b=a.charAt(c+1),d=a.substr(0,c),
a=a.substr(c+3);c=d+b+a;a=d+'<span class="dijitMenuItemShortcutKey">'+b+"</span>"+a}else c=a;this.domNode.setAttribute("aria-label",c+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){a&&!("label"in this.params)&&this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);i.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&
i.set(this.accelKeyNode,"id",this.id+"_accel");g.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==k("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(a){}},_onFocus:function(){this._setSelected(!0);this.getParent()._onItemFocus(this);this.inherited(arguments)},_setSelected:function(a){e.toggle(this.domNode,"dijitMenuItemSelected",a)},setLabel:function(a){j.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",
a)},setDisabled:function(a){j.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){if(this.accelKeyNode)this.accelKeyNode.style.display=a?"":"none",this.accelKeyNode.innerHTML=a,i.set(this.containerNode,"colSpan",a?"1":"2");this._set("accelKey",a)}});k("dojo-bidi")&&(m=b("dijit.MenuItem",
m,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return m})},"dijit/_Contained":function(){define("dijit/_Contained",["dojo/_base/declare","./registry"],function(b,g){return b("dijit._Contained",null,{_getSibling:function(b){var e=this.domNode;do e=e[b+"Sibling"];while(e&&1!=e.nodeType);return e&&g.byNode(e)},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},
getIndexInParent:function(){var b=this.getParent();return!b||!b.getIndexOfChild?-1:b.getIndexOfChild(this)}})})},"url:dijit/templates/MenuItem.html":'<tr class="dijitReset dijitMenuItem" data-dojo-attach-point="focusNode" role="menuitem" tabIndex="-1">\n\t<td class="dijitReset dijitMenuItemIconCell" role="presentation">\n\t\t<img src="${_blankGif}" alt="" class="dijitIcon dijitMenuItemIcon" data-dojo-attach-point="iconNode"/>\n\t</td>\n\t<td class="dijitReset dijitMenuItemLabel" colspan="2" data-dojo-attach-point="containerNode,textDirNode"></td>\n\t<td class="dijitReset dijitMenuItemAccelKey" style="display: none" data-dojo-attach-point="accelKeyNode"></td>\n\t<td class="dijitReset dijitMenuArrowCell" role="presentation">\n\t\t<div data-dojo-attach-point="arrowWrapper" style="visibility: hidden">\n\t\t\t<img src="${_blankGif}" alt="" class="dijitMenuExpand"/>\n\t\t\t<span class="dijitMenuExpandA11y">+</span>\n\t\t</div>\n\t</td>\n</tr>\n',
"mathEditor/mathContentAssist":function(){define(["dojo/_base/array"],function(b){return{keywords:[{input:"/",map:"&#xF7;",nodeName:"mo",freq:0,label:"\u9664\u53f7",iconClass:"drip_equation_icon drip_division"},{input:"/",map:"/",nodeName:"text",freq:0,label:"/",iconClass:""},{input:"/",map:"",nodeName:"mfrac",freq:0,label:"\u5206\u6570",iconClass:"drip_equation_icon drip_frac"},{input:"*",map:"&#xD7;",nodeName:"mo",freq:0,label:"\u4e58\u53f7",iconClass:"drip_equation_icon drip_multiplication"},{input:"*",
map:"*",nodeName:"text",freq:0,label:"*",iconClass:""},{input:"^",map:"^",nodeName:"text",freq:0,label:"^",iconClass:""},{input:"^",map:"",nodeName:"msup",freq:0,label:"\u4e0a\u6807",iconClass:"drip_equation_icon drip_sup"},{input:"_",map:"_",nodeName:"text",freq:0,label:"_",iconClass:""},{input:"_",map:"",nodeName:"msub",freq:0,label:"\u4e0b\u6807",iconClass:"drip_equation_icon drip_sub"},{input:"sqrt",map:"",nodeName:"msqrt",freq:0,label:"\u5e73\u65b9\u6839",iconClass:"drip_equation_icon drip_sqrt"},
{input:"sqrt",map:"",nodeName:"mroot",freq:0,label:"\u5f00\u6839\u53f7",iconClass:"drip_equation_icon drip_root"},{input:"sin",map:"sin",nodeName:"mi",freq:0,label:"sin",iconClass:""},{input:"cos",map:"cos",nodeName:"mi",freq:0,label:"cos",iconClass:""},{input:"tan",map:"tan",nodeName:"mi",freq:0,label:"tan",iconClass:""},{input:"cot",map:"cot",nodeName:"mi",freq:0,label:"cot",iconClass:""}],getProposals:function(g){return b.filter(this.keywords,function(b){return 0==b.input.indexOf(g)})}}})}}});
define("mathEditor/Editor","dojo/_base/declare,dojo/_base/lang,dojo/_base/event,dijit/_WidgetBase,dojo/on,dojo/sniff,dojo/keys,dojo/aspect,dojo/dom-construct,dojo/dom-style,dojo/dom-class,mathEditor/Model,mathEditor/View,mathEditor/ContentAssist".split(","),function(b,g,i,e,j,k,m,l,n,d,a,c,f,h){return b("mathEditor.Editor",[e],{model:null,view:null,textarea:null,value:"",_getValueAttr:function(){return this.model.getXML()},_setValueAttr:function(a){this.model.clear();a&&""!=a&&this.model.setData({data:a})},
postCreate:function(){this.inherited(arguments);d.set(this.domNode,{position:"relative"});var b=this.textarea=n.create("textarea",{style:{position:"absolute"}},this.domNode);a.add(b,"drip_text_input");b.wrap="off";b.autocorrect="off";b.autocapitalize="off";b.spellcheck=!1;var e=this.model=new c;this.view=new f({model:this.model,parentNode:this.domNode,textarea:this.textarea});var o=this.contentAssist=new h({view:this.view});l.after(o,"apply",function(a,c,d){e.setData({data:a,nodeName:c,removeCount:d});
setTimeout(function(){b.value=""})},!0);if(k("chrome"))j(b,"textInput",g.hitch(this,function(a){this._onTextInput(a.data)}));else{var r=!1;j(b,"input",g.hitch(this,function(){if(!r)inputData=b.value,""!=inputData&&this._onTextInput(inputData)}));j(b,"compositionstart",g.hitch(this,function(){r=!0}));j(b,"compositionend",g.hitch(this,function(){r=!1}))}j(b,"blur",g.hitch(this,function(){this.view.blur()}));j(b,"keydown",g.hitch(this,function(a){a.keyCode===m.LEFT_ARROW?(this.model.moveLeft(),this.view.showCursor()):
a.keyCode===m.RIGHT_ARROW?this.model.moveRight():a.keyCode===m.UP_ARROW?this.contentAssist.opened?this.contentAssist.selectPrev():this.model.moveUp():a.keyCode===m.DOWN_ARROW?this.contentAssist.opened?this.contentAssist.selectNext():this.model.moveDown():a.keyCode===m.BACKSPACE?this.model.doDelete():a.altKey&&191===a.keyCode?(this.contentAssist.open(),i.stop(a)):a.keyCode===m.ENTER?(this.contentAssist.opened?this.contentAssist.enter(a):this.model.setData({data:"\n"}),i.stop(a)):a.keyCode==m.TAB&&
(this.model.setData({data:"\t"}),i.stop(a))}))},_onTextInput:function(a){var b=this.contentAssist.show(a);null!=b&&(a=b);this.model.setData({data:a});var c=this.textarea;setTimeout(function(){c.value=""})}})});