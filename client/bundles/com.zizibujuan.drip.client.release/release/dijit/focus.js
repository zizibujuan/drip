//>>built
define("dijit/focus","dojo/aspect,dojo/_base/declare,dojo/dom,dojo/dom-attr,dojo/dom-construct,dojo/Evented,dojo/_base/lang,dojo/on,dojo/domReady,dojo/sniff,dojo/Stateful,dojo/_base/window,dojo/window,./a11y,./registry,./main".split(","),function(m,q,n,r,o,s,i,t,u,j,v,w,p,x,k,l){var g=new (q([v,s],{curNode:null,activeStack:[],constructor:function(){var a=i.hitch(this,function(a){n.isDescendant(this.curNode,a)&&this.set("curNode",null);n.isDescendant(this.prevNode,a)&&this.set("prevNode",null)});m.before(o,
"empty",a);m.before(o,"destroy",a)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(a,e){var d=this,b=function(a){d._justMouseDowned=!0;setTimeout(function(){d._justMouseDowned=!1},0);if(!j("ie")||!a||!(a.srcElement&&null==a.srcElement.parentNode))d._onTouchNode(e||a.target||a.srcElement,"mouse")},c=j("ie")?a.document.documentElement:a.document;if(c){if(j("ie")){a.document.body.attachEvent("onmousedown",b);var f=function(a){if(a.srcElement.tagName){var b=
a.srcElement.tagName.toLowerCase();"#document"==b||"body"==b||(x.isTabNavigable(a.srcElement)?d._onFocusNode(e||a.srcElement):d._onTouchNode(e||a.srcElement))}};c.attachEvent("onfocusin",f);var g=function(a){d._onBlurNode(e||a.srcElement)};c.attachEvent("onfocusout",g);return{remove:function(){a.document.detachEvent("onmousedown",b);c.detachEvent("onfocusin",f);c.detachEvent("onfocusout",g);c=null}}}c.body.addEventListener("mousedown",b,!0);c.body.addEventListener("touchstart",b,!0);var h=function(a){d._onFocusNode(e||
a.target)};c.addEventListener("focus",h,!0);var i=function(a){d._onBlurNode(e||a.target)};c.addEventListener("blur",i,!0);return{remove:function(){c.body.removeEventListener("mousedown",b,!0);c.body.removeEventListener("touchstart",b,!0);c.removeEventListener("focus",h,!0);c.removeEventListener("blur",i,!0);c=null}}}},_onBlurNode:function(){this._clearFocusTimer&&clearTimeout(this._clearFocusTimer);this._clearFocusTimer=setTimeout(i.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",
null)}),0);if(!this._justMouseDowned)this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),this._clearActiveWidgetsTimer=setTimeout(i.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0)},_onTouchNode:function(a,e){this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);var d=[];try{for(;a;){var b=r.get(a,"dijitPopupParent");if(b)a=k.byId(b).domNode;else if(a.tagName&&"body"==a.tagName.toLowerCase()){if(a===
w.body())break;a=p.get(a.ownerDocument).frameElement}else{var c=a.getAttribute&&a.getAttribute("widgetId"),f=c&&k.byId(c);f&&!("mouse"==e&&f.get("disabled"))&&d.unshift(c);a=a.parentNode}}}catch(g){}this._setStack(d,e)},_onFocusNode:function(a){a&&9!=a.nodeType&&(this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(a),a!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",a)))},_setStack:function(a,e){var d=this.activeStack,b=
d.length-1,c=a.length-1;if(a[c]!=d[b]){this.set("activeStack",a);var f;for(f=b;0<=f&&d[f]!=a[f];f--)if(b=k.byId(d[f]))b._hasBeenBlurred=!0,b.set("focused",!1),b._focusManager==this&&b._onBlur(e),this.emit("widget-blur",b,e);for(f++;f<=c;f++)if(b=k.byId(a[f]))b.set("focused",!0),b._focusManager==this&&b._onFocus(e),this.emit("widget-focus",b,e)}},focus:function(a){if(a)try{a.focus()}catch(e){}}}));u(function(){var a=g.registerWin(p.get(document));j("ie")&&t(window,"unload",function(){a&&(a.remove(),
a=null)})});l.focus=function(a){g.focus(a)};for(var h in g)/^_/.test(h)||(l.focus[h]="function"==typeof g[h]?i.hitch(g,h):g[h]);g.watch(function(a,e,d){l.focus[a]=d});return g});