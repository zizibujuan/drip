//>>built
define("dijit/_MenuBase",["dojo/_base/array","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/_base/lang","dojo/mouse","dojo/on","dojo/window","./a11yclick","./popup","./registry","./_Widget","./_CssStateMixin","./_KeyNavContainer","./_TemplatedMixin"],function(array,declare,dom,domAttr,domClass,lang,mouse,on,winUtils,a11yclick,pm,registry,_Widget,_CssStateMixin,_KeyNavContainer,_TemplatedMixin){return declare("dijit._MenuBase",[_Widget,_TemplatedMixin,_KeyNavContainer,_CssStateMixin],{parentMenu:null,popupDelay:500,autoFocus:!1,childSelector:function(node){var widget=registry.byNode(node);return node.parentNode==this.containerNode&&widget&&widget.focus},postCreate:function(){var self=this,matches=typeof this.childSelector=="string"?this.childSelector:lang.hitch(this,"childSelector");this.own(on(this.containerNode,on.selector(matches,mouse.enter),function(){self.onItemHover(registry.byNode(this))}),on(this.containerNode,on.selector(matches,mouse.leave),function(){self.onItemUnhover(registry.byNode(this))}),on(this.containerNode,on.selector(matches,a11yclick),function(evt){self.onItemClick(registry.byNode(this),evt),evt.stopPropagation(),evt.preventDefault()})),this.inherited(arguments)},onKeyboardSearch:function(item,evt,searchString,numMatches){this.inherited(arguments),!!item&&(numMatches==-1||!!item.popup&&numMatches==1)&&this.onItemClick(item,evt)},_keyboardSearchCompare:function(item,searchString){return item.shortcutKey?searchString==item.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(evt){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,evt);else{var topMenu=this._getTopMenu();topMenu&&topMenu._isMenuBar&&topMenu.focusNext()}},_onPopupHover:function(){if(this.currentPopup&&this.currentPopup._pendingClose_timer){var parentMenu=this.currentPopup.parentMenu;parentMenu.focusedChild&&parentMenu.focusedChild._setSelected(!1),parentMenu.focusedChild=this.currentPopup.from_item,parentMenu.focusedChild._setSelected(!0),this._stopPendingCloseTimer(this.currentPopup)}},onItemHover:function(item){this.isActive&&(this.focusChild(item),item.popup&&!item.disabled&&!this.hover_timer&&(this.hover_timer=this.defer(lang.hitch(this,"_openPopup",item),this.popupDelay))),this.focusedChild&&this.focusChild(item),this._hoveredChild=item,item._set("hovering",!0)},_onChildBlur:function(item){this._stopPopupTimer(),item._setSelected(!1);var itemPopup=item.popup;itemPopup&&(this._stopPendingCloseTimer(itemPopup),itemPopup._pendingClose_timer=this.defer(function(){itemPopup._pendingClose_timer=null,itemPopup.parentMenu&&(itemPopup.parentMenu.currentPopup=null),pm.close(itemPopup)},this.popupDelay))},onItemUnhover:function(item){this.isActive&&this._stopPopupTimer(),this._hoveredChild==item&&(this._hoveredChild=null),item._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(popup){popup._pendingClose_timer&&(popup._pendingClose_timer=popup._pendingClose_timer.remove())},_stopFocusTimer:function(){this._focus_timer&&(this._focus_timer=this._focus_timer.remove())},_getTopMenu:function(){for(var top=this;top.parentMenu;top=top.parentMenu);return top},onItemClick:function(item,evt){typeof this.isShowingNow=="undefined"&&this._markActive(),this.focusChild(item);if(item.disabled)return!1;item.popup?this._openPopup(item,/^key/.test(evt.type)):(this.onExecute(),item._onClick?item._onClick(evt):item.onClick(evt))},_openPopup:function(from_item,focus){this._stopPopupTimer();var popup=from_item.popup;if(!popup.isShowingNow){this.currentPopup&&(this._stopPendingCloseTimer(this.currentPopup),pm.close(this.currentPopup)),popup.parentMenu=this,popup.from_item=from_item;var self=this;pm.open({parent:this,popup:popup,around:from_item.domNode,orient:this._orient||["after","before"],onCancel:function(){self.focusChild(from_item),self._cleanUp(),from_item._setSelected(!0),self.focusedChild=from_item},onExecute:lang.hitch(this,"_cleanUp")}),this.currentPopup=popup,popup.connect(popup.domNode,"onmouseenter",lang.hitch(self,"_onPopupHover"))}focus&&popup.focus&&(popup._focus_timer=this.defer(lang.hitch(popup,function(){this._focus_timer=null,this.focus()})))},_markActive:function(){this.isActive=!0,domClass.replace(this.domNode,"dijitMenuActive","dijitMenuPassive")},onOpen:function(){this.isShowingNow=!0,this._markActive()},_markInactive:function(){this.isActive=!1,domClass.replace(this.domNode,"dijitMenuPassive","dijitMenuActive")},onClose:function(){this._stopFocusTimer(),this._markInactive(),this.isShowingNow=!1,this.parentMenu=null},_closeChild:function(){this._stopPopupTimer(),this.currentPopup&&(array.indexOf(this._focusManager.activeStack,this.id)>=0&&(domAttr.set(this.focusedChild.focusNode,"tabIndex",this.tabIndex),this.focusedChild.focusNode.focus()),pm.close(this.currentPopup),this.currentPopup=null),this.focusedChild&&(this.focusedChild._setSelected(!1),this.onItemUnhover(this.focusedChild)),domAttr.set(this.domNode,"tabIndex",this.tabIndex),this.focusedChild&&(this.focusedChild.set("tabIndex","-1"),this._set("focusedChild",null))},_onItemFocus:function(item){this._hoveredChild&&this._hoveredChild!=item&&this.onItemUnhover(this._hoveredChild)},_onBlur:function(){this._cleanUp(),this.inherited(arguments)},_cleanUp:function(){this._closeChild(),typeof this.isShowingNow=="undefined"&&this._markInactive()}})})