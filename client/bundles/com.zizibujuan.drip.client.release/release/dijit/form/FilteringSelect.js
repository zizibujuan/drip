//>>built
define("dijit/form/FilteringSelect",["dojo/_base/declare","dojo/_base/lang","dojo/when","./MappedTextBox","./ComboBoxMixin"],function(declare,lang,when,MappedTextBox,ComboBoxMixin){return declare("dijit.form.FilteringSelect",[MappedTextBox,ComboBoxMixin],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||!this.required&&this.get("displayedValue")==""},_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(result,query,options,priorityChange){if(query&&query[this.searchAttr]!==this._lastQuery||!query&&result.length&&this.store.getIdentity(result[0])!=this._lastQuery)return;result.length?this.set("item",result[0],priorityChange):this.set("value","",priorityChange||priorityChange===undefined&&!this.focused,this.textbox.value,null)},_openResultList:function(results,query,options){if(query[this.searchAttr]!==this._lastQuery)return;this.inherited(arguments),this.item===undefined&&this.validate(!0)},_getValueAttr:function(){return this.valueNode.value},_getValueField:function(){return"value"},_setValueAttr:function(value,priorityChange,displayedValue,item){this._onChangeActive||(priorityChange=null);if(item===undefined){if(value===null||value===""){value="";if(!lang.isString(displayedValue)){this._setDisplayedValueAttr(displayedValue||"",priorityChange);return}}var self=this;this._lastQuery=value,when(this.store.get(value),function(item){self._callbackSetLabel(item?[item]:[],undefined,undefined,priorityChange)})}else this.valueNode.value=value,this.inherited(arguments)},_setItemAttr:function(item,priorityChange,displayedValue){this.inherited(arguments),this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(text){return text.replace(/([\\\*\?])/g,"\\$1")},_setDisplayedValueAttr:function(label,priorityChange){label==null&&(label="");if(!this._created){if(!("displayedValue"in this.params))return;priorityChange=!1}if(this.store){this.closeDropDown();var query=lang.clone(this.query),qs=this._getDisplayQueryString(label),q;this.store._oldAPI?q=qs:(q=this._patternToRegExp(qs),q.toString=function(){return qs}),this._lastQuery=query[this.searchAttr]=q,this.textbox.value=label,this._lastDisplayedValue=label,this._set("displayedValue",label);var _this=this,options={ignoreCase:this.ignoreCase,deep:!0};lang.mixin(options,this.fetchProperties),this._fetchHandle=this.store.query(query,options),when(this._fetchHandle,function(result){_this._fetchHandle=null,_this._callbackSetLabel(result||[],query,options,priorityChange)},function(err){_this._fetchHandle=null,_this._cancelingQuery||0})}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})})