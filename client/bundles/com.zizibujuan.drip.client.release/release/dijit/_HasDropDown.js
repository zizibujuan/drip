//>>built
define("dijit/_HasDropDown",["dojo/_base/declare","dojo/_base/Deferred","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/keys","dojo/_base/lang","dojo/on","dojo/window","./registry","./focus","./popup","./_FocusMixin"],function(declare,Deferred,dom,domAttr,domClass,domGeometry,domStyle,has,keys,lang,on,winUtils,registry,focus,popup,_FocusMixin){return declare("dijit._HasDropDown",_FocusMixin,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:0,dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(e){if(this.disabled||this.readOnly)return;e.preventDefault(),this._docHandler=this.own(on(this.ownerDocument,"mouseup",lang.hitch(this,"_onDropDownMouseUp")))[0],this.toggleDropDown()},_onDropDownMouseUp:function(e){e&&this._docHandler&&this.disconnect(this._docHandler);var dropDown=this.dropDown,overMenu=!1;if(e&&this._opened){var c=domGeometry.position(this._buttonNode,!0);if(!(e.pageX>=c.x&&e.pageX<=c.x+c.w)||!(e.pageY>=c.y&&e.pageY<=c.y+c.h)){var t=e.target;while(t&&!overMenu)domClass.contains(t,"dijitPopup")?overMenu=!0:t=t.parentNode;if(overMenu){t=e.target;if(dropDown.onItemClick){var menuItem;while(t&&!(menuItem=registry.byNode(t)))t=t.parentNode;menuItem&&menuItem.onClick&&menuItem.getParent&&menuItem.getParent().onItemClick(menuItem,e)}return}}}this._opened?dropDown.focus&&dropDown.autoFocus!==!1&&(this._focusDropDownTimer=this.defer(function(){dropDown.focus(),delete this._focusDropDownTimer})):this.defer("focus"),has("touch")&&(this._justGotMouseUp=!0,this.defer(function(){this._justGotMouseUp=!1}))},_onDropDownClick:function(e){has("touch")&&!this._justGotMouseUp&&(this._onDropDownMouseDown(e),this._onDropDownMouseUp(e)),this._stopClickEvents&&(e.stopPropagation(),e.preventDefault())},buildRendering:function(){this.inherited(arguments),this._buttonNode=this._buttonNode||this.focusNode||this.domNode,this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var defaultPos={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||this.dropDownPosition[0]||"Down";domClass.add(this._arrowWrapperNode||this._buttonNode,"dijit"+defaultPos+"ArrowButton")},postCreate:function(){this.inherited(arguments);var keyboardEventNode=this.focusNode||this.domNode;this.own(on(this._buttonNode,"mousedown",lang.hitch(this,"_onDropDownMouseDown")),on(this._buttonNode,"click",lang.hitch(this,"_onDropDownClick")),on(keyboardEventNode,"keydown",lang.hitch(this,"_onKey")),on(keyboardEventNode,"keyup",lang.hitch(this,"_onKeyUp")))},destroy:function(){this.dropDown&&(this.dropDown._destroyed||this.dropDown.destroyRecursive(),delete this.dropDown),this.inherited(arguments)},_onKey:function(e){if(this.disabled||this.readOnly)return;var d=this.dropDown,target=e.target;if(d&&this._opened&&d.handleKey&&d.handleKey(e)===!1){e.stopPropagation(),e.preventDefault();return}d&&this._opened&&e.keyCode==keys.ESCAPE?(this.closeDropDown(),e.stopPropagation(),e.preventDefault()):!this._opened&&(e.keyCode==keys.DOWN_ARROW||(e.keyCode==keys.ENTER||e.keyCode==keys.SPACE)&&((target.tagName||"").toLowerCase()!=="input"||target.type&&target.type.toLowerCase()!=="text"))&&(this._toggleOnKeyUp=!0,e.stopPropagation(),e.preventDefault())},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp,this.toggleDropDown();var d=this.dropDown;d&&d.focus&&this.defer(lang.hitch(d,"focus"),1)}},_onBlur:function(){var focusMe=focus.curNode&&this.dropDown&&dom.isDescendant(focus.curNode,this.dropDown.domNode);this.closeDropDown(focusMe),this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(loadCallback){loadCallback()},loadAndOpenDropDown:function(){var d=new Deferred,afterLoad=lang.hitch(this,function(){this.openDropDown(),d.resolve(this.dropDown)});return this.isLoaded()?afterLoad():this.loadDropDown(afterLoad),d},toggleDropDown:function(){if(this.disabled||this.readOnly)return;this._opened?this.closeDropDown():this.loadAndOpenDropDown()},openDropDown:function(){var dropDown=this.dropDown,ddNode=dropDown.domNode,aroundNode=this._aroundNode||this.domNode,self=this;this._preparedNode||(this._preparedNode=!0,ddNode.style.width&&(this._explicitDDWidth=!0),ddNode.style.height&&(this._explicitDDHeight=!0));if(this.maxHeight||this.forceWidth||this.autoWidth){var myStyle={display:"",visibility:"hidden"};this._explicitDDWidth||(myStyle.width=""),this._explicitDDHeight||(myStyle.height=""),domStyle.set(ddNode,myStyle);var maxHeight=this.maxHeight;if(maxHeight==-1){var viewport=winUtils.getBox(this.ownerDocument),position=domGeometry.position(aroundNode,!1);maxHeight=Math.floor(Math.max(position.y,viewport.h-(position.y+position.h)))}popup.moveOffScreen(dropDown),dropDown.startup&&!dropDown._started&&dropDown.startup();var mb=domGeometry.getMarginSize(ddNode),overHeight=maxHeight&&mb.h>maxHeight;domStyle.set(ddNode,{overflowX:"visible",overflowY:overHeight?"auto":"visible"}),overHeight?(mb.h=maxHeight,"w"in mb&&(mb.w+=16)):delete mb.h,this.forceWidth?mb.w=aroundNode.offsetWidth:this.autoWidth?mb.w=Math.max(mb.w,aroundNode.offsetWidth):delete mb.w,lang.isFunction(dropDown.resize)?dropDown.resize(mb):domGeometry.setMarginBox(ddNode,mb)}var retVal=popup.open({parent:this,popup:dropDown,around:aroundNode,orient:this.dropDownPosition,onExecute:function(){self.closeDropDown(!0)},onCancel:function(){self.closeDropDown(!0)},onClose:function(){domAttr.set(self._popupStateNode,"popupActive",!1),domClass.remove(self._popupStateNode,"dijitHasDropDownOpen"),self._set("_opened",!1)}});return domAttr.set(this._popupStateNode,"popupActive","true"),domClass.add(this._popupStateNode,"dijitHasDropDownOpen"),this._set("_opened",!0),this._popupStateNode.setAttribute("aria-expanded","true"),this._popupStateNode.setAttribute("aria-owns",dropDown.id),ddNode.getAttribute("role")!=="presentation"&&!ddNode.getAttribute("aria-labelledby")&&ddNode.setAttribute("aria-labelledby",this.id),retVal},closeDropDown:function(focus){this._focusDropDownTimer&&(this._focusDropDownTimer.remove(),delete this._focusDropDownTimer),this._opened&&(this._popupStateNode.setAttribute("aria-expanded","false"),focus&&this.focus(),popup.close(this.dropDown),this._opened=!1)}})})