//>>built
define("dijit/tree/ObjectStoreModel",["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/when"],function(array,aspect,declare,lang,when){return declare("dijit.tree.ObjectStoreModel",null,{store:null,labelAttr:"name",root:null,query:null,constructor:function(args){lang.mixin(this,args),this.childrenCache={}},destroy:function(){for(var id in this.childrenCache)this.childrenCache[id].close&&this.childrenCache[id].close()},getRoot:function(onItem,onError){if(this.root)onItem(this.root);else{var res;when(res=this.store.query(this.query),lang.hitch(this,function(items){if(items.length!=1)throw new Error("dijit.tree.ObjectStoreModel: root query returned "+items.length+" items, but must return exactly one");this.root=items[0],onItem(this.root),res.observe&&res.observe(lang.hitch(this,function(obj){this.onChange(obj)}),!0)}),onError)}},mayHaveChildren:function(){return!0},getChildren:function(parentItem,onComplete,onError){var id=this.store.getIdentity(parentItem);if(this.childrenCache[id]){when(this.childrenCache[id],onComplete,onError);return}var res=this.childrenCache[id]=this.store.getChildren(parentItem);when(res,onComplete,onError),res.observe&&res.observe(lang.hitch(this,function(obj,removedFrom,insertedInto){this.onChange(obj),removedFrom!=insertedInto&&when(res,lang.hitch(this,"onChildrenChange",parentItem))}),!0)},isItem:function(){return!0},getIdentity:function(item){return this.store.getIdentity(item)},getLabel:function(item){return item[this.labelAttr]},newItem:function(args,parent,insertIndex,before){return this.store.put(args,{parent:parent,before:before})},pasteItem:function(childItem,oldParentItem,newParentItem,bCopy,insertIndex,before){if(!bCopy){var oldParentChildren=[].concat(this.childrenCache[this.getIdentity(oldParentItem)]),index=array.indexOf(oldParentChildren,childItem);oldParentChildren.splice(index,1),this.onChildrenChange(oldParentItem,oldParentChildren)}return this.store.put(childItem,{overwrite:!0,parent:newParentItem,before:before})},onChange:function(){},onChildrenChange:function(){},onDelete:function(){}})})