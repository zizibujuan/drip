//>>built
define("drip/userSession",["dojo/dom","dojo/dom-construct","dojo/request/xhr"],function(dom,domConstruct,xhr){var userSession={},userInfo=null;return userSession.getLoggedUserInfo=function(){return userInfo!=null?userInfo:(userInfo=xhr("/login/",{method:"POST",handleAs:"json"}).then(function(data){return 0,data},function(error){0,window.location.href="/"}),userInfo)},userSession.showProfile=function(){this.getLoggedUserInfo().then(function(user){var profileDiv=dom.byId("userProfile"),href="#",aImg=domConstruct.create("a",{href:href},profileDiv);user.headUrl||(user.headUrl="");var imgUser=domConstruct.create("img",{alt:user.displayName,src:user.headUrl,width:"80px",height:"80px"},aImg),aLabel=domConstruct.create("a",{href:href,alt:user.displayName,innerHTML:user.displayName},profileDiv),aFanCount=domConstruct.create("a",{href:"#"},profileDiv),fanCountSpan=domConstruct.create("span",{innerHTML:"粉丝"+user.fanCount},aFanCount),aFollowCount=domConstruct.create("a",{href:"#"},profileDiv),followCountSpan=domConstruct.create("span",{innerHTML:"关注"+user.followCount},aFollowCount)})},userSession.logout=function(){xhr("/logout/",{method:"POST",handleAs:"json"}).then(function(data){},function(error){window.location="/"})},userSession})