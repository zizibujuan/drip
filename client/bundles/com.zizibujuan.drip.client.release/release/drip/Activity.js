//>>built
define("drip/Activity","dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/event dojo/request/xhr dojo/dom-construct dojo/dom-prop dojo/dom-style dojo/query dojo/on dojo/json dijit/_WidgetBase dijit/_TemplatedMixin dijit/form/Button drip/classCode drip/prettyDate drip/_StoreMixin mathEditor/Editor mathEditor/dataUtil dojo/text!./templates/ActivityNode.html dojo/text!./templates/ActivityList.html drip/MiniCard".split(" "),function(q,k,e,v,r,c,g,n,w,h,x,s,t,E,f,u,y,z,p,A,B,C){var D=q("drip.ActivityNode",
[s,t],{templateString:A,data:{},postCreate:function(){this.inherited(arguments);debugger;this._showActionLabel();this.miniCard=new C;var a=this.data.exercise,b=a.id;this._createExercise(a);var l=a.exerType,d=this.data.answer;if(d&&(this._isOptionExercise(l)&&(this._optionLabels=[],k.forEach(d.detail,e.hitch(this,this._setOptionAnswer)),(this.answerDiv=c.create("div",{"class":"answer"},this.exerciseNode,"after")).innerHTML=0<this._optionLabels.length?"\u7b54\u6848\u662f\uff1a\x3cspan\x3e"+this._optionLabels.join(",")+
"\x3c/span\x3e":"\u7b54\u6848\u662f\uff1a\x3cspan\x3e\u60a8\u8fd8\u6ca1\u6709\u4f5c\u7b54\u3002\t\x3c/span\x3e"),(d=d.guide)&&""!=d)){var d=p.xmlStringToHtml(d),m=this.guideContainerDiv=c.create("div",{"class":"guide"},this.exerciseNode);c.create("div",{innerHTML:"\u4e60\u9898\u89e3\u6790"},m);c.create("div",{innerHTML:d},m)}h(this.btnAnswer,"click",e.hitch(this,function(d){this.answerDiv&&n.set(this.answerDiv,"display","none");this.guideContainerDiv&&n.set(this.guideContainerDiv,"display","none");
this._isOptionExercise(l)&&this._getOptionEls().forEach(function(a,d){g.set(a,"disabled",!1);!0==g.get(a,"checked")&&g.set(a,"checked",!1)});d=this.doAnswerPane=c.create("div",null,this.exerciseNode,"after");var f=c.create("div",{"class":"guide"},d);c.create("div",{innerHTML:"\u4e60\u9898\u89e3\u6790"},f);var m=new z({rows:5,width:650});m.placeAt(f);f=c.create("div",{style:"width:98%;margin-top:5px;text-align:right"},d);d=c.create("a",{"class":"drip_op_cancel",innerHTML:"\u53d6\u6d88",href:"#"},f);
f=c.place('\x3cbutton class\x3d"minibutton"\x3e\x3ci class\x3d"icon-save"\x3e\x3c/i\x3e \u4fdd\u5b58\x3c/button\x3e',f);h(f,"click",e.hitch(this,function(d){var b={};b.exerId=a.id;b.detail=[];this._isOptionExercise(l)&&this._getOptionEls().forEach(e.hitch(this,function(a,d){if(!0===g.get(a,"checked")){var c={optionId:g.get(a,"optionId")};b.detail.push(c)}}));d=m.get("value");""!=d&&(b.guide=d);r.post("/answers/",{handleAs:"json",data:x.stringify(b)}).then(e.hitch(this,function(a){this._destroyAnswerPane();
this._showAnswerArea(!0)}),e.hitch(this,function(a){}))}));h(d,"click",e.hitch(this,function(a){v.stop(a);this._destroyAnswerPane();this.answerDiv&&n.set(this.answerDiv,"display","");this.guideContainerDiv&&n.set(this.guideContainerDiv,"display","");(a=this.data.answer)&&this._isOptionExercise(l)&&k.forEach(a.detail,e.hitch(this,this._setOptionAnswer));this._showAnswerArea(!0)}));(this._answerWidget=[]).push(m);r.get("/answers/",{query:{exerId:b},handleAs:"json"}).then(e.hitch(this,function(a){this._currentUserAnswer=
a;a.guide&&m.set("value",a.guide);a.detail&&0<a.detail.length&&k.forEach(a.detail,e.hitch(this,this._setOptionAnswer))}));this._showAnswerArea(!1)}));var f=this.data.userInfo.digitalId;h(this.userLinkNode,"mouseover",e.hitch(this,function(a){this.miniCard.show(a.target,f)}));h(this.userInfo,"mouseover",e.hitch(this,function(a){this.miniCard.show(a.target,f)}));h(this.userLinkNode,"mouseout",e.hitch(this,function(a){this.miniCard.hide()}));h(this.userInfo,"mouseout",e.hitch(this,function(a){this.miniCard.hide()}))},
_showAnswerArea:function(a){var b="";!1==a&&(b="none");n.set(this.answerAreaNode,"display",b)},_destroyAnswerPane:function(){this._answerWidget&&(k.forEach(this._answerWidget,function(a,b){a.destroyRecursive()}),delete this._answerWidget);c.destroy(this.doAnswerPane)},_isOptionExercise:function(a){return a==f.ExerciseType.SINGLE_OPTION||a==f.ExerciseType.MULTI_OPTION},_setOptionAnswer:function(a,b){var c=a.optionId;this._getOptionEls().some(e.hitch(this,function(a,b){return g.get(a,"optionId")==c?
(g.set(a,"checked",!0),this._optionLabels&&this._optionLabels.push(a.parentNode.nextSibling.firstChild.firstChild.innerHTML),!0):!1}))},_getOptionEls:function(){this._optionEls||(this._optionEls=w("input[type\x3dradio]",this.table));return this._optionEls},_showActionLabel:function(){var a=this.data;this.userInfo.innerHTML=a.userInfo.nickName;this.action.innerHTML=f.ActionTypeMap[a.actionType];this.time.innerHTML=u.pretty(a.createTime);this.time.title=a.createTime.replace("T"," ");this.time.datetime=
a.createTime;this.userImageNode.src=a.userInfo.smallImageUrl||"/drip/resources/images/profile_50_50.gif"},_createExercise:function(a){var b=p.xmlStringToHtml(a.content);c.create("div",{innerHTML:b,"class":"content"},this.exerciseNode);if((b=a.options)&&0<b.length){var l="radio";a.exerType==f.ExerciseType.SINGLE_OPTION?l="radio":a.exerType==f.ExerciseType.MULTI_OPTION&&(l="checkbox");a=c.create("div",{"class":"option"},this.exerciseNode);a=this.table=c.create("table",null,a);k.forEach(b,e.hitch(this,
this._createOption,a,l))}},_createOption:function(a,b,e,d){var f=this.id+"_"+e.id,h="opt_"+this.id;a=c.place("\x3ctr\x3e\x3c/tr\x3e",a);var k=c.place("\x3ctd\x3e\x3c/td\x3e",a);b=c.create("input",{type:b,name:h,id:f},k);g.set(b,{disabled:!0,optionId:e.id});b=c.place("\x3ctd\x3e\x3c/td\x3e",a);b=c.place("\x3clabel\x3e\x3c/label\x3e",b);g.set(b,"for",f);c.place('\x3cspan style\x3d"padding-right:5px"\x3e'+"ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(d)+"\x3c/span\x3e",b);d=c.place("\x3cspan\x3e\x3c/span\x3e",
b);e=p.xmlStringToHtml(e.content);d.innerHTML=e}});return q("Activity",[s,t,y],{templateString:B,postCreate:function(){this.inherited(arguments);n.set(this.domNode,{"padding-top":"10px","padding-left":"10px","padding-right":"10px"});this.refresh()},_load:function(a){0==a.length?this.domNode.innerHTML=this.noDataMessage:(this.domNode.innerHTML="",k.forEach(a,e.hitch(this,function(a,c){var d=new D({data:a});this.domNode.appendChild(d.domNode)})),u.setInterval(this.domNode,6E4),MathJax.Hub.Queue(["Typeset",
MathJax.Hub,this.domNode]))},refresh:function(){this.domNode.innerHTML=this.loadingMessage;this.store&&this.store.query(this.query).then(e.hitch(this,this._load))}})});
require({cache:{"url:drip/templates/ActivityNode.html":'\x3cdiv class\x3d"item"\x3e\n\t\x3cdiv\x3e\n\t\t\x3cdiv class\x3d"drip_face"\x3e\n\t\t\t\x3c!-- TODO\uff1a\u653e\u7f6e\u7528\u6237\u5934\u50cf --\x3e\n\t\t\t\x3ca href\x3d"#" data-dojo-attach-point\x3d"userLinkNode"\x3e\x3cimg data-dojo-attach-point\x3d"userImageNode" src\x3d"" width\x3d"50px" height\x3d"50px"/\x3e\x3c/a\x3e\n\t\t\x3c/div\x3e\n\t\t\x3cdiv class\x3d"drip_detail"\x3e\n\t\t\t\x3cdiv\x3e\n\t\t\t\t\x3ca href\x3d"#" data-dojo-attach-point\x3d"userInfo"\x3e\x3c/a\x3e\n\t\t\t\t\x3cspan data-dojo-attach-point\x3d"action"\x3e\x3c/span\x3e\n\t\t\t\t\x3cspan class\x3d"time" style\x3d"margin-left: 20px;"\x3e\x3ctime title\x3d"" data-dojo-attach-point\x3d"time"\x3e\u4e09\u5206\u949f\u524d\x3c/time\x3e\x3c/span\x3e\n\t\t\t\x3c/div\x3e\n\t\t\t\x3cdiv\x3e\n\t\t\t\t\x3cdiv\x3e\n\t\t\t\t\t\x3cdiv class\x3d"exercise" data-dojo-attach-point\x3d"exerciseNode"\x3e\n\t\t\t\t\t\t\n\t\t\t\t\t\x3c/div\x3e\n\t\t\t\t\t\x3cdiv style\x3d"float: right"\x3e\n\t\t\t\t\t\x3c!-- \n\t\t\t\t\t\t\x3ca href\x3d"#"\x3e\u5173\u6ce8(100)\x3c/a\x3e\n\t\t\t\t\t\t\x3ci style\x3d"margin-left:6px;margin-right:8px; color:#AEAEAE"\x3e|\x3c/i\x3e\n\t\t\t\t\t\t\x3ca href\x3d"#"\x3e\u6536\u85cf(100)\x3c/a\x3e\n\t\t\t\t\t\t\x3ci style\x3d"margin-left:6px;margin-right:8px; color:#AEAEAE"\x3e|\x3c/i\x3e\n\t\t\t\t\t --\x3e\n\t\t\t\t\t\t\x3c!-- \u89e3\u7b54\u662f\u4e00\u4e2a\u6309\u94ae\uff0c\u6570\u5b57\u7528\u4e00\u4e2a\u6846\u62ec\u4f4f\u3002\u70b9\u51fb\u6309\u94ae\u540e\uff0c\u9690\u85cf\uff1b\u70b9\u51fb\u53d6\u6d88\u4e4b\u540e\uff0c\u518d\u663e\u793a --\x3e\n\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"answerAreaNode"\x3e\n\t\t\t\t\t\t\t\x3c!-- \u89e3\u7b54 --\x3e\n\t\t\t\t\t\t\t\x3cbutton data-dojo-attach-point\x3d"btnAnswer"\n\t\t\t\t\t\t\t class\x3d"minibutton"\x3e\x3ci class\x3d"icon-comment-alt"\x3e\x3c/i\x3e \u89e3\u7b54\x3c/button\x3e\n\t\t\t\t\t\t\t\x3ca href\x3d"#" class\x3d"drip_answer_count"\x3e0\x3c/a\x3e\n\t\t\t\t\t\t\x3c/span\x3e\n\t\t\t\t\t\x3c/div\x3e\n\t\t\t\t\x3c/div\x3e\n\t\t\t\x3c/div\x3e\n\t\t\x3c/div\x3e\n\t\x3c/div\x3e\n\x3c/div\x3e\t',"url:drip/templates/ActivityList.html":'\x3cdiv class\x3d"activities"\x3e\n\x3c!-- \u5206\u9875 --\x3e\n\x3c/div\x3e'}});
//@ sourceMappingURL=Activity.js.map