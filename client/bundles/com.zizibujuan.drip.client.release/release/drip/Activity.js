//>>built
require({cache:{"url:drip/templates/ActivityNode.html":'<div class="item">\n\t<div>\n\t\t<div class="drip_face">\n\t\t\t<\!-- TODO\uff1a\u653e\u7f6e\u7528\u6237\u5934\u50cf --\>\n\t\t\t<a href="#" data-dojo-attach-point="userLinkNode"><img data-dojo-attach-point="userImageNode" src="" width="50px" height="50px"/></a>\n\t\t</div>\n\t\t<div class="drip_detail">\n\t\t\t<div>\n\t\t\t\t<a href="#" data-dojo-attach-point="userInfo"></a>\n\t\t\t\t<span data-dojo-attach-point="action"></span>\n\t\t\t\t<span class="time" style="margin-left: 20px;"><time title="" data-dojo-attach-point="time">\u4e09\u5206\u949f\u524d</time></span>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<div>\n\t\t\t\t\t<div class="exercise" data-dojo-attach-point="exerciseNode">\n\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style="float: right">\n\t\t\t\t\t<\!-- \n\t\t\t\t\t\t<a href="#">\u5173\u6ce8(100)</a>\n\t\t\t\t\t\t<i style="margin-left:6px;margin-right:8px; color:#AEAEAE">|</i>\n\t\t\t\t\t\t<a href="#">\u6536\u85cf(100)</a>\n\t\t\t\t\t\t<i style="margin-left:6px;margin-right:8px; color:#AEAEAE">|</i>\n\t\t\t\t\t --\>\n\t\t\t\t\t\t<\!-- \u89e3\u7b54\u662f\u4e00\u4e2a\u6309\u94ae\uff0c\u6570\u5b57\u7528\u4e00\u4e2a\u6846\u62ec\u4f4f\u3002\u70b9\u51fb\u6309\u94ae\u540e\uff0c\u9690\u85cf\uff1b\u70b9\u51fb\u53d6\u6d88\u4e4b\u540e\uff0c\u518d\u663e\u793a --\>\n\t\t\t\t\t\t<span data-dojo-attach-point="answerAreaNode">\n\t\t\t\t\t\t\t<\!-- \u89e3\u7b54 --\>\n\t\t\t\t\t\t\t<input type="button" value="\u89e3\u7b54" class="drip_to_answer" data-dojo-attach-point="btnAnswer"></input>\n\t\t\t\t\t\t\t<a href="#" class="drip_answer_count">0</a>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\t',
"url:drip/templates/ActivityList.html":'<div class="activities">\n<\!-- \u5206\u9875 --\>\n</div>'}});
define("drip/Activity","dojo/_base/declare,dojo/_base/array,dojo/_base/lang,dojo/_base/event,dojo/request/xhr,dojo/dom-construct,dojo/dom-prop,dojo/dom-style,dojo/query,dojo/on,dojo/json,dijit/_WidgetBase,dijit/_TemplatedMixin,dijit/form/Button,dojo/store/JsonRest,drip/classCode,drip/prettyDate,mathEditor/Editor,dojo/text!./templates/ActivityNode.html,dojo/text!./templates/ActivityList.html,drip/MiniCard".split(","),function(m,k,d,s,n,c,g,l,t,h,u,o,p,B,v,e,q,w,x,y,z){var A=m("drip.ActivityNode",[o,
p],{templateString:x,data:{},postCreate:function(){this.inherited(arguments);this._showActionLabel();this.miniCard=new z;var a=this.data.exercise,b=a.id;this._createExercise(a);var j=a.exerType,f=this.data.answer;if(f){if(this._isOptionExercise(j))this._optionLabels=[],k.forEach(f.detail,d.hitch(this,this._setOptionAnswer)),(this.answerDiv=c.create("div",{"class":"answer"},this.exerciseNode,"after")).innerHTML=0<this._optionLabels.length?"\u7b54\u6848\u662f\uff1a<span>"+this._optionLabels.join(",")+
"</span>":"\u7b54\u6848\u662f\uff1a<span>\u60a8\u8fd8\u6ca1\u6709\u4f5c\u7b54\u3002\t</span>";if((f=f.guide)&&""!=f){var e=this.guideContainerDiv=c.create("div",{"class":"guide"},this.exerciseNode);c.create("div",{innerHTML:"\u4e60\u9898\u89e3\u6790"},e);c.create("div",{innerHTML:f},e)}}h(this.btnAnswer,"click",d.hitch(this,function(){this.answerDiv&&l.set(this.answerDiv,"display","none");this.guideContainerDiv&&l.set(this.guideContainerDiv,"display","none");this._isOptionExercise(j)&&this._getOptionEls().forEach(function(a){g.set(a,
"disabled",!1);!0==g.get(a,"checked")&&g.set(a,"checked",!1)});var e=this.doAnswerPane=c.create("div",null,this.exerciseNode,"after"),f=c.create("div",{"class":"guide"},e);c.create("div",{innerHTML:"\u4e60\u9898\u89e3\u6790"},f);var i=new w({style:"height:50px;width:98%"});i.placeAt(f);f=c.create("div",{style:"width:98%;margin-top:5px;text-align:right"},e);e=c.create("a",{"class":"drip_op_cancel",innerHTML:"\u53d6\u6d88",href:"#"},f);f=c.create("input",{type:"button",value:"\u4fdd\u5b58"},f);h(f,
"click",d.hitch(this,function(){var b={};b.exerId=a.id;b.detail=[];this._isOptionExercise(j)&&this._getOptionEls().forEach(d.hitch(this,function(a){!0===g.get(a,"checked")&&(a={optionId:g.get(a,"optionId")},b.detail.push(a))}));var c=i.get("value");if(""!=c)b.guide=c;n.post("/answers/",{handleAs:"json",data:u.stringify(b)}).then(d.hitch(this,function(){this._destroyAnswerPane();this._showAnswerArea(!0)}),d.hitch(this,function(){}))}));h(e,"click",d.hitch(this,function(a){s.stop(a);this._destroyAnswerPane();
this.answerDiv&&l.set(this.answerDiv,"display","");this.guideContainerDiv&&l.set(this.guideContainerDiv,"display","");(a=this.data.answer)&&this._isOptionExercise(j)&&k.forEach(a.detail,d.hitch(this,this._setOptionAnswer));this._showAnswerArea(!0)}));(this._answerWidget=[]).push(i);n.get("/answers/",{query:{exerId:b},handleAs:"json"}).then(d.hitch(this,function(a){this._currentUserAnswer=a;a.guide&&i.set("value",a.guide);a.detail&&0<a.detail.length&&k.forEach(a.detail,d.hitch(this,this._setOptionAnswer))}));
this._showAnswerArea(!1)}));var i=this.data.localUserId,r=this.data.mapUserId;h(this.userLinkNode,"mouseover",d.hitch(this,function(a){this.miniCard.show(a.target,i,r)}));h(this.userInfo,"mouseover",d.hitch(this,function(a){this.miniCard.show(a.target,i,r)}));h(this.userLinkNode,"mouseout",d.hitch(this,function(){this.miniCard.hide()}));h(this.userInfo,"mouseout",d.hitch(this,function(){this.miniCard.hide()}))},_showAnswerArea:function(a){var b="";!1==a&&(b="none");l.set(this.answerAreaNode,"display",
b)},_destroyAnswerPane:function(){this._answerWidget&&(k.forEach(this._answerWidget,function(a){a.destroyRecursive()}),delete this._answerWidget);c.destroy(this.doAnswerPane)},_isOptionExercise:function(a){return a==e.ExerciseType.SINGLE_OPTION||a==e.ExerciseType.MULTI_OPTION},_setOptionAnswer:function(a){var b=a.optionId;this._getOptionEls().some(d.hitch(this,function(a){return g.get(a,"optionId")==b?(g.set(a,"checked",!0),this._optionLabels&&this._optionLabels.push(a.parentNode.nextSibling.firstChild.firstChild.innerHTML),
!0):!1}))},_getOptionEls:function(){if(!this._optionEls)this._optionEls=t("input[type=radio]",this.table);return this._optionEls},_showActionLabel:function(){var a=this.data;this.userInfo.innerHTML=a.userInfo.nickName;this.action.innerHTML=e.ActionTypeMap[a.actionType];this.time.innerHTML=q.pretty(a.createTime);this.time.title=a.createTime.replace("T"," ");this.time.datetime=a.createTime;this.userImageNode.src=a.userInfo.smallImageUrl},_createExercise:function(a){c.create("div",{innerHTML:a.content.replace(/&amp;/g,
"&"),"class":"content"},this.exerciseNode);var b=a.options;if(b&&0<b.length){var j="radio";a.exerType==e.ExerciseType.SINGLE_OPTION?j="radio":a.exerType==e.ExerciseType.MULTI_OPTION&&(j="checkbox");a=c.create("div",{"class":"option"},this.exerciseNode);a=this.table=c.create("table",null,a);k.forEach(b,d.hitch(this,this._createOption,a,j))}},_createOption:function(a,b,d,f){var e=this.id+"_"+d.id,i="opt_"+this.id,a=c.place("<tr></tr>",a),h=c.place("<td></td>",a),b=c.create("input",{type:b,name:i,id:e},
h);g.set(b,{disabled:!0,optionId:d.id});b=c.place("<td></td>",a);b=c.place("<label></label>",b);g.set(b,"for",e);c.place('<span style="padding-right:5px">'+"ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(f)+"</span>",b);c.place("<span></span>",b).innerHTML=d.content}});return m("Activity",[o,p],{templateString:y,store:new v({target:"/activities/"}),postCreate:function(){this.inherited(arguments);this.store.query().then(d.hitch(this,this._load))},_load:function(a){0==a.length?this.domNode.innerHTML="\u6ca1\u6709\u6d3b\u52a8\uff0c\u5feb\u53bb\u5f55\u5165\u65b0\u9898\u76ee\uff0c\u6216\u5230\u9898\u5e93\u4e2d\u89e3\u7b54\u4e60\u9898":
(k.forEach(a,d.hitch(this,function(a){this.domNode.appendChild((new A({data:a})).domNode)})),q.setInterval(this.domNode,6E4),MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.domNode]))}})});