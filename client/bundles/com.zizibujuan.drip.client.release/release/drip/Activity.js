//>>built
define("drip/Activity","dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/event dojo/request/xhr dojo/dom-construct dojo/dom-prop dojo/dom-style dojo/query dojo/on dojo/json dijit/_WidgetBase dijit/_TemplatedMixin dijit/form/Button drip/classCode drip/prettyDate drip/_StoreMixin mathEditor/Editor dojo/text!./templates/ActivityNode.html dojo/text!./templates/ActivityList.html drip/MiniCard".split(" "),function(p,k,d,u,q,b,g,n,v,h,w,r,s,D,e,t,x,y,z,A,B){var C=p("drip.ActivityNode",[r,s],
{templateString:z,data:{},postCreate:function(){this.inherited(arguments);this._showActionLabel();this.miniCard=new B;var a=this.data.exercise,c=a.id;this._createExercise(a);var l=a.exerType,f=this.data.answer;if(f&&(this._isOptionExercise(l)&&(this._optionLabels=[],k.forEach(f.detail,d.hitch(this,this._setOptionAnswer)),(this.answerDiv=b.create("div",{"class":"answer"},this.exerciseNode,"after")).innerHTML=0<this._optionLabels.length?"\u7b54\u6848\u662f\uff1a\x3cspan\x3e"+this._optionLabels.join(",")+
"\x3c/span\x3e":"\u7b54\u6848\u662f\uff1a\x3cspan\x3e\u60a8\u8fd8\u6ca1\u6709\u4f5c\u7b54\u3002\t\x3c/span\x3e"),(f=f.guide)&&""!=f)){var m=this.guideContainerDiv=b.create("div",{"class":"guide"},this.exerciseNode);b.create("div",{innerHTML:"\u4e60\u9898\u89e3\u6790"},m);b.create("div",{innerHTML:f},m)}h(this.btnAnswer,"click",d.hitch(this,function(f){this.answerDiv&&n.set(this.answerDiv,"display","none");this.guideContainerDiv&&n.set(this.guideContainerDiv,"display","none");this._isOptionExercise(l)&&
this._getOptionEls().forEach(function(a,c){g.set(a,"disabled",!1);!0==g.get(a,"checked")&&g.set(a,"checked",!1)});f=this.doAnswerPane=b.create("div",null,this.exerciseNode,"after");var e=b.create("div",{"class":"guide"},f);b.create("div",{innerHTML:"\u4e60\u9898\u89e3\u6790"},e);var m=new y({rows:5,width:500});m.placeAt(e);e=b.create("div",{style:"width:98%;margin-top:5px;text-align:right"},f);f=b.create("a",{"class":"drip_op_cancel",innerHTML:"\u53d6\u6d88",href:"#"},e);e=b.place('\x3cbutton class\x3d"minibutton"\x3e\x3ci class\x3d"icon-save"\x3e\x3c/i\x3e \u4fdd\u5b58\x3c/button\x3e',
e);h(e,"click",d.hitch(this,function(c){var b={};b.exerId=a.id;b.detail=[];this._isOptionExercise(l)&&this._getOptionEls().forEach(d.hitch(this,function(a,c){if(!0===g.get(a,"checked")){var f={optionId:g.get(a,"optionId")};b.detail.push(f)}}));c=m.get("value");""!=c&&(b.guide=c);q.post("/answers/",{handleAs:"json",data:w.stringify(b)}).then(d.hitch(this,function(a){this._destroyAnswerPane();this._showAnswerArea(!0)}),d.hitch(this,function(a){}))}));h(f,"click",d.hitch(this,function(a){u.stop(a);this._destroyAnswerPane();
this.answerDiv&&n.set(this.answerDiv,"display","");this.guideContainerDiv&&n.set(this.guideContainerDiv,"display","");(a=this.data.answer)&&this._isOptionExercise(l)&&k.forEach(a.detail,d.hitch(this,this._setOptionAnswer));this._showAnswerArea(!0)}));(this._answerWidget=[]).push(m);q.get("/answers/",{query:{exerId:c},handleAs:"json"}).then(d.hitch(this,function(a){this._currentUserAnswer=a;a.guide&&m.set("value",a.guide);a.detail&&0<a.detail.length&&k.forEach(a.detail,d.hitch(this,this._setOptionAnswer))}));
this._showAnswerArea(!1)}));var e=this.data.userInfo.digitalId;h(this.userLinkNode,"mouseover",d.hitch(this,function(a){this.miniCard.show(a.target,e)}));h(this.userInfo,"mouseover",d.hitch(this,function(a){this.miniCard.show(a.target,e)}));h(this.userLinkNode,"mouseout",d.hitch(this,function(a){this.miniCard.hide()}));h(this.userInfo,"mouseout",d.hitch(this,function(a){this.miniCard.hide()}))},_showAnswerArea:function(a){var c="";!1==a&&(c="none");n.set(this.answerAreaNode,"display",c)},_destroyAnswerPane:function(){this._answerWidget&&
(k.forEach(this._answerWidget,function(a,c){a.destroyRecursive()}),delete this._answerWidget);b.destroy(this.doAnswerPane)},_isOptionExercise:function(a){return a==e.ExerciseType.SINGLE_OPTION||a==e.ExerciseType.MULTI_OPTION},_setOptionAnswer:function(a,c){var b=a.optionId;this._getOptionEls().some(d.hitch(this,function(a,c){return g.get(a,"optionId")==b?(g.set(a,"checked",!0),this._optionLabels&&this._optionLabels.push(a.parentNode.nextSibling.firstChild.firstChild.innerHTML),!0):!1}))},_getOptionEls:function(){this._optionEls||
(this._optionEls=v("input[type\x3dradio]",this.table));return this._optionEls},_showActionLabel:function(){var a=this.data;this.userInfo.innerHTML=a.userInfo.nickName;this.action.innerHTML=e.ActionTypeMap[a.actionType];this.time.innerHTML=t.pretty(a.createTime);this.time.title=a.createTime.replace("T"," ");this.time.datetime=a.createTime;this.userImageNode.src=a.userInfo.smallImageUrl||"/drip/resources/images/profile_50_50.gif"},_createExercise:function(a){b.create("div",{innerHTML:a.content.replace(/&amp;/g,
"\x26"),"class":"content"},this.exerciseNode);var c=a.options;if(c&&0<c.length){var l="radio";a.exerType==e.ExerciseType.SINGLE_OPTION?l="radio":a.exerType==e.ExerciseType.MULTI_OPTION&&(l="checkbox");a=b.create("div",{"class":"option"},this.exerciseNode);a=this.table=b.create("table",null,a);k.forEach(c,d.hitch(this,this._createOption,a,l))}},_createOption:function(a,c,d,f){var e=this.id+"_"+d.id,h="opt_"+this.id;a=b.place("\x3ctr\x3e\x3c/tr\x3e",a);var k=b.place("\x3ctd\x3e\x3c/td\x3e",a);c=b.create("input",
{type:c,name:h,id:e},k);g.set(c,{disabled:!0,optionId:d.id});c=b.place("\x3ctd\x3e\x3c/td\x3e",a);c=b.place("\x3clabel\x3e\x3c/label\x3e",c);g.set(c,"for",e);b.place('\x3cspan style\x3d"padding-right:5px"\x3e'+"ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(f)+"\x3c/span\x3e",c);b.place("\x3cspan\x3e\x3c/span\x3e",c).innerHTML=d.content}});return p("Activity",[r,s,x],{templateString:A,postCreate:function(){this.inherited(arguments);n.set(this.domNode,{"padding-top":"10px","padding-left":"10px","padding-right":"10px"});
this.refresh()},_load:function(a){0==a.length?this.domNode.innerHTML=this.noDataMessage:(this.domNode.innerHTML="",k.forEach(a,d.hitch(this,function(a,b){var d=new C({data:a});this.domNode.appendChild(d.domNode)})),t.setInterval(this.domNode,6E4),MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.domNode]))},refresh:function(){this.domNode.innerHTML=this.loadingMessage;this.store&&this.store.query(this.query).then(d.hitch(this,this._load))}})});
require({cache:{"url:drip/templates/ActivityNode.html":'\x3cdiv class\x3d"item"\x3e\n\t\x3cdiv\x3e\n\t\t\x3cdiv class\x3d"drip_face"\x3e\n\t\t\t\x3c!-- TODO\uff1a\u653e\u7f6e\u7528\u6237\u5934\u50cf --\x3e\n\t\t\t\x3ca href\x3d"#" data-dojo-attach-point\x3d"userLinkNode"\x3e\x3cimg data-dojo-attach-point\x3d"userImageNode" src\x3d"" width\x3d"50px" height\x3d"50px"/\x3e\x3c/a\x3e\n\t\t\x3c/div\x3e\n\t\t\x3cdiv class\x3d"drip_detail"\x3e\n\t\t\t\x3cdiv\x3e\n\t\t\t\t\x3ca href\x3d"#" data-dojo-attach-point\x3d"userInfo"\x3e\x3c/a\x3e\n\t\t\t\t\x3cspan data-dojo-attach-point\x3d"action"\x3e\x3c/span\x3e\n\t\t\t\t\x3cspan class\x3d"time" style\x3d"margin-left: 20px;"\x3e\x3ctime title\x3d"" data-dojo-attach-point\x3d"time"\x3e\u4e09\u5206\u949f\u524d\x3c/time\x3e\x3c/span\x3e\n\t\t\t\x3c/div\x3e\n\t\t\t\x3cdiv\x3e\n\t\t\t\t\x3cdiv\x3e\n\t\t\t\t\t\x3cdiv class\x3d"exercise" data-dojo-attach-point\x3d"exerciseNode"\x3e\n\t\t\t\t\t\t\n\t\t\t\t\t\x3c/div\x3e\n\t\t\t\t\t\x3cdiv style\x3d"float: right"\x3e\n\t\t\t\t\t\x3c!-- \n\t\t\t\t\t\t\x3ca href\x3d"#"\x3e\u5173\u6ce8(100)\x3c/a\x3e\n\t\t\t\t\t\t\x3ci style\x3d"margin-left:6px;margin-right:8px; color:#AEAEAE"\x3e|\x3c/i\x3e\n\t\t\t\t\t\t\x3ca href\x3d"#"\x3e\u6536\u85cf(100)\x3c/a\x3e\n\t\t\t\t\t\t\x3ci style\x3d"margin-left:6px;margin-right:8px; color:#AEAEAE"\x3e|\x3c/i\x3e\n\t\t\t\t\t --\x3e\n\t\t\t\t\t\t\x3c!-- \u89e3\u7b54\u662f\u4e00\u4e2a\u6309\u94ae\uff0c\u6570\u5b57\u7528\u4e00\u4e2a\u6846\u62ec\u4f4f\u3002\u70b9\u51fb\u6309\u94ae\u540e\uff0c\u9690\u85cf\uff1b\u70b9\u51fb\u53d6\u6d88\u4e4b\u540e\uff0c\u518d\u663e\u793a --\x3e\n\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"answerAreaNode"\x3e\n\t\t\t\t\t\t\t\x3c!-- \u89e3\u7b54 --\x3e\n\t\t\t\t\t\t\t\x3cbutton data-dojo-attach-point\x3d"btnAnswer"\n\t\t\t\t\t\t\t class\x3d"minibutton"\x3e\x3ci class\x3d"icon-comment-alt"\x3e\x3c/i\x3e \u89e3\u7b54\x3c/button\x3e\n\t\t\t\t\t\t\t\x3ca href\x3d"#" class\x3d"drip_answer_count"\x3e0\x3c/a\x3e\n\t\t\t\t\t\t\x3c/span\x3e\n\t\t\t\t\t\x3c/div\x3e\n\t\t\t\t\x3c/div\x3e\n\t\t\t\x3c/div\x3e\n\t\t\x3c/div\x3e\n\t\x3c/div\x3e\n\x3c/div\x3e\t',"url:drip/templates/ActivityList.html":'\x3cdiv class\x3d"activities"\x3e\n\x3c!-- \u5206\u9875 --\x3e\n\x3c/div\x3e'}});
//@ sourceMappingURL=Activity.js.map