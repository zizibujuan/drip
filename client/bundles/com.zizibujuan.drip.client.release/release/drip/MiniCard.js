//>>built
require({cache:{"url:drip/templates/MiniCard.html":'<div>\n	<div class="minicard">\n		<div class="minicard_body clearfix">\n			<dl class="clearfix">\n				<dt class="minicard_name">\n					<a href="#" target="_blank" data-dojo-attach-point="userImgLinkNode">\n						<img alt="" src="#" data-dojo-attach-point="userImgNode">\n					</a>\n				</dt>\n				<dd>\n					<p>\n						<a href="#" target="_blank" data-dojo-attach-point="userNameLinkNode">用户名</a>\n					</p>\n					<p>\n						<span data-dojo-attach-point="userSexNode">性别</span>\n						<span data-dojo-attach-point="userAddrNode">地址</span>\n						<!-- TODO：显示学校信息 -->\n					</p>\n					\n					<div>\n						<ul class="userData clearfix">\n							<li>关注<a href="#" data-dojo-attach-point="followNode">0</a></li>\n							<li>|</li>\n							<li>粉丝<a href="#" data-dojo-attach-point="fanNode">0</a></li>\n							<li>|</li>\n							<li>答题<a href="#" data-dojo-attach-point="answerNode">0</a></li>\n						</ul>\n					</div>\n				</dd>\n			</dl>\n			<dl class="intro">\n				<dt></dt>\n				<dd data-dojo-attach-point="introNode">自我介绍</dd>\n			</dl>\n		</div>\n		<div class="minicard_footer dijitDialogPaneActionBar">\n			<div class="ft_left" data-dojo-attach-point="fromSiteNode">\n			</div>\n			<div class="ft_right" data-dojo-attach-point="actionsNode">\n				<!-- 关注按钮 -->\n			</div>\n		</div>\n	</div>\n</div>'}}),define("drip/MiniCard",["dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/request/xhr","dojo/dom-construct","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/TooltipDialog","dijit/popup","dojo/text!./templates/MiniCard.html","drip/userSession","drip/classCode"],function(declare,lang,on,xhr,domConstruct,_WidgetBase,_TemplatedMixin,TooltipDialog,popup,miniCardTemplate,userSession,classCode){var MiniCardBody=declare("drip.MiniCardBody",[_WidgetBase,_TemplatedMixin],{templateString:miniCardTemplate,postCreate:function(){this.inherited(arguments)},update:function(localUserId,mapUserId){return xhr("/users/"+localUserId,{handleAs:"json",query:{mapUserId:mapUserId}}).then(lang.hitch(this,function(userInfo){0;var userLinkSubfix=userInfo.id+"?mapUserId="+userInfo.mapUserId,displayName=userInfo.displayName||"",userActionLink="/actions/"+userLinkSubfix;this.userImgLinkNode.href=userActionLink,this.userImgNode.src=userInfo.largeImageUrl||"",this.userImgNode.alt=displayName,this.userNameLinkNode.innerHTML=displayName,this.userNameLinkNode.href=userActionLink,this.userSexNode.innerHTML=classCode.sex[userInfo.sex||""],userInfo.homeCity?this.userAddrNode.innerHTML=userInfo.homeCity.province+" "+userInfo.homeCity.city:this.userAddrNode.innerHTML="",this.followNode.innerHTML=userInfo.followCount||0,this.followNode.href="/follows/"+userLinkSubfix,this.fanNode.innerHTML=userInfo.fanCount||0,this.fanNode.href="/fans/"+userLinkSubfix,this.answerNode.innerHTML=userInfo.answerCount||0,this.answerNode.href="/answers/"+userLinkSubfix,this.introNode.innerHTML=userInfo.introduce||"";if(userInfo.fromSite==101){var key="'"+useInfo.fromSite+"'";this.fromSiteNode.innerHTML="来自<strong>"+classCode.site[key]+"</strong>"}else this.fromSiteNode.innerHTML="来自<strong>孜孜不倦</strong>";domConstruct.empty(this.actionsNode);var localUserId=userInfo.id,loginMapUserId=userSession.getLoggedUserInfo().mapped_user_id;loginMapUserId==userInfo.mapUserId?domConstruct.empty(this.actionsNode):userInfo.userRelationId?this._createWatchButton(this.actionsNode,localUserId):this._createCancelWatchButton(this.actionsNode,localUserId)}))},_createWatchButton:function(container,localUserId){var label=domConstruct.create("strong",null,container);label.innerHTML="√ 已关注";var cancelWatch=domConstruct.create("input",{type:"button",value:"取消",style:"margin-left:10px;margin-right:15px"},container);on.once(cancelWatch,"click",lang.hitch(this,function(e){xhr.put("/follow/"+localUserId,{handleAs:"json",query:{op:"off"}},lang.hitch(this,function(response){domConstruct.empty(this.actionsNode),this._createCancelWatchButton(container,localUserId)}),lang.hitch(this,function(error){}))}))},_createCancelWatchButton:function(container,localUserId){var watch=domConstruct.create("input",{type:"button",value:"+ 关注",style:"margin-right:15px"},container);on.once(watch,"click",lang.hitch(this,function(e){xhr.put("/follow/"+localUserId,{handleAs:"json",query:{op:"on"}},lang.hitch(this,function(response){domConstruct.empty(this.actionsNode),this._createWatchButton(container,localUserId)}),lang.hitch(this,function(error){}))}))}});return declare("drip.MiniCard",null,{constructor:function(args){lang.mixin(this,args);var self=this,dialog=this.dialog=new TooltipDialog({onMouseLeave:function(){popup.close(dialog)},onMouseEnter:function(){self._closePopup&&clearTimeout(self._closePopup)}});this.miniCardBody=new MiniCardBody},show:function(target,localUserId,mapUserId){this._closePopup&&clearTimeout(this._closePopup);var dialog=this.dialog;popup.open({popup:dialog,around:target}),this._show=!0;var miniCardBody=this.miniCardBody;dialog.containerNode.innerHTML="正在加载中，请稍后...",miniCardBody.update(localUserId,mapUserId).then(function(){dialog.containerNode.innerHTML="",dialog.containerNode.appendChild(miniCardBody.domNode)})},hide:function(){if(this._show){var dialog=this.dialog;this._closePopup=setTimeout(function(){popup.close(dialog),self._show=!1},300)}}})})