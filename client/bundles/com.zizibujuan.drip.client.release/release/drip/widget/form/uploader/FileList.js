//>>built
define("drip/widget/form/uploader/FileList","dojo/_base/fx,dojo/dom-style,dojo/dom-class,dojo/dom-prop,dojo/dom-construct,dojo/_base/declare,dojo/_base/lang,dojo/_base/array,dojo/on,dijit/_base/manager,dojox/form/uploader/_Base".split(","),function(l,f,m,g,b,h,e,n,i,j,k){return h("drip.widget.form.uploader.FileList",[k],{uploaderId:"",uploader:null,_upCheckCnt:0,fileId:"",fileInfo:null,templateString:"<div></div>",rowAmt:0,postCreate:function(){this.setUploader()},getData:function(){return fileId},
reset:function(){this.fileId=""},setUploader:function(){if(this.uploaderId||this.uploader)if(this.uploaderId&&!this.uploader)this.uploader=j.byId(this.uploaderId);else if(4<this._upCheckCnt)return;this.uploader?(this.connect(this.uploader,"onChange","_onUploaderChange"),this.connect(this.uploader,"reset","reset"),this.connect(this.uploader,"onBegin",function(){this.showProgressBar();this.showProgress(!0)}),this.connect(this.uploader,"onProgress","_progress"),this.connect(this.uploader,"onComplete",
function(a){var c;c=this.fileInfo=a[0],a=c;this.fileId=a.fileId;this.thumbImageNode.src=a.url;g.set(this.thumbImageNode.parentNode,{href:a.url,target:"_blank"});this._addSuccessBar()}),this._fileSizeAvail={html5:1,flash:1}[this.uploader.uploadType]):(this._upCheckCnt++,setTimeout(e.hitch(this,"setUploader"),250))},showProgressBar:function(){},hideProgress:function(a){this._hideShowProgress(a?{ani:!0,endDisp:"none",beg:15,end:0}:{endDisp:"none",ani:!1})},showProgress:function(a){this._hideShowProgress(a?
{ani:!0,endDisp:"inline",beg:0,end:15}:{endDisp:"inline",ani:!1})},_progress:function(a){f.set(this.percentBarNode,"width",a.percent)},_hideShowProgress:function(){},_onUploaderChange:function(a){b.empty(this.domNode);this.rowAmt=0;a=a[0];this._addRow(1,this.getFileType(a.name),a.name,a.size)},_addSuccessBar:function(){var a=this.fileInfo,c=this.uploadItemNode;b.empty(c);this._addImageLabel(b.create("a",{"class":"drip_upload_label_success",target:"_blank",href:a.url},c),a.name,a.size);this._addDeleteNode(c)},
_addFailureBar:function(){var a=this.fileInfo,c=this.uploadItemNode;b.empty(c);this._addImageLabel(b.create("span",{"class":"drip_upload_label_fail"},c),a.name,a.size);a=b.create("span",{style:"float:right"},c);b.create("span",{innerHTML:"\u9644\u4ef6\u4e0a\u4f20\u5931\u8d25",style:"color:#C00, font-weight:bold"},a);b.create("span",{innerHTML:"\u91cd\u8bd5",style:"margin-left: 5px;color: #222;text-decoration: underline;cursor: pointer;"},a);this._addDeleteNode(a)},_addRow:function(a,c,d,e){c=b.place("<div></div>",
this.domNode);a=this.uploadItemNode=b.place("<div class='drip_upload_item'></div>",c);c=b.create("a",null,c);this.thumbImageNode=b.place("<img class='drip_upload_thumb_image'/>",c);a=b.place("<table></table>",a).insertRow();c=a.insertCell(0);f.set(c,"padding","0px");this._addImageLabel(b.place("<div></div>",c),d,e);d=a.insertCell(1);d=b.place("<div></div>",d);d=b.place("<div></div>",d);d=b.place("<div class='drip_upload_progress'></div>",d);this.percentBarNode=b.place("<div class='drip_upload_percent_bar'></div>",
d);this._addDeleteNode(a.insertCell(2));this.rowAmt++},_addImageLabel:function(a,c,d){b.place("<div class='drip_upload_image_name'></div>",a).innerHTML=c;if(this._fileSizeAvail)b.place("<div class='drip_upload_image_size'></div>",a).innerHTML="("+this.convertBytes(d).value+")"},_addDeleteNode:function(a){a=b.place("<div class='drip_upload_delete_icon'></div>",a);i.once(a,"click",e.hitch(this,function(){b.empty(this.domNode);this.fileId=this.fileInfo=null}))}})});