//>>built
define("drip/exercises/ExerciseForm","dojo/_base/declare,dojo/_base/lang,dojo/_base/array,dojo/_base/event,dojo/request/xhr,dijit/_WidgetBase,dijit/registry,dojo/dom,dojo/dom-attr,dojo/dom-style,dojo/dom-class,dojo/dom-construct,dojo/on,dojo/query,dojo/json,mathEditor/Editor,drip/classCode,dojox/form/Uploader,drip/widget/form/uploader/FileList".split(","),function(p,g,q,j,r,s,k,l,i,v,o,b,h,m,t,u,n){return p("drip.exercises.ExerciseForm",[s],{data:{},optionLength:4,_optionName:"exercise-option",postCreate:function(){this.inherited(arguments);
debugger;this._createExerciseTypeBar();this._createSingleSelectForm();var a=b.create("div",{"class":"drip_form_actions"},this.domNode),a=this.btnNewExercise=b.create("input",{type:"button",value:"\u4fdd\u5b58"},a);h(a,"click",g.hitch(this,this.doSave))},doSave:function(){i.set(this.btnNewExercise,"disabled",!0);var a=this.data;a.content=this.editorExerContent.get("value");a.options=[];k.findWidgets(this.tblOption).forEach(function(b){a.options.push(b.get("value"))});var d={},b=[];m("[name="+this._optionName+
"]:checked",this.tblOption).forEach(function(a){b.push({seq:a.value})});if(0<b.length)d.detail=b;var c=this.editorGuide.get("value");if(null!=c&&0<c.length)d.guide=c;if(d.detail||d.guide)a.answer=d;r("/exercises/",{method:"POST",data:t.stringify(a)}).then(g.hitch(this,function(){this._reset();i.set(this.btnNewExercise,"disabled",!1)}),g.hitch(this,function(){i.set(this.btnNewExercise,"disabled",!1)}))},_reset:function(){this.data={};this.editorExerContent.set("value","");this.editorGuide.set("value",
"");m("[name="+this._optionName+"]:checked",this.tblOption).forEach(function(a){i.set(a,"checked",!1)});k.findWidgets(this.tblOption).forEach(function(a){a.set("value","")})},empty:function(){},_createExerciseTypeBar:function(){var a=l.byId("single");this._toggleSelection(a);h(a,"click",g.hitch(this,this._showSingleSelectForm));h(l.byId("multiple"),"click",g.hitch(this,this._showMultipleSelectForm));h(l.byId("fill"),"click",g.hitch(this,this._showFillForm));h(l.byId("essayQuestion"),"click",g.hitch(this,
this._showEssayQuestionForm))},_toggleSelection:function(a){this._selectedExerTypeElement&&o.remove(this._selectedExerTypeElement,"selected");this._selectedExerTypeElement=a;o.add(this._selectedExerTypeElement,"selected")},_showSingleSelectForm:function(a){a.target!=this._selectedExerTypeElement&&(this._toggleSelection(a.target),this._createSingleSelectForm())},_showMultipleSelectForm:function(a){a.target!=this._selectedExerTypeElement&&(this._toggleSelection(a.target),this._createMultipleSelectForm())},
_showFillForm:function(a){a.target!=this._selectedExerTypeElement&&this._toggleSelection(a.target)},_showEssayQuestionForm:function(a){a.target!=this._selectedExerTypeElement&&(this._toggleSelection(a.target),this._createEssayQuestionForm())},_createSingleSelectForm:function(){this.data.exerType=n.ExerciseType.SINGLE_OPTION;if(this.optionPane){if("none"==this.optionPane.style.display)this.optionPane.style.display="";""==this.optionPane.style.display&&m("input",this.optionPane).forEach(function(a){a.type=
"radio"})}else this._createSelectForm("radio")},_createMultipleSelectForm:function(){this.data.exerType=n.ExerciseType.MULTI_OPTION;if(this.optionPane){if("none"==this.optionPane.style.display)this.optionPane.style.display="";""==this.optionPane.style.display&&m("input",this.optionPane).forEach(function(a){a.type="checkbox"})}else this._createSelectForm("checkbox")},_createSelectForm:function(a){this._createContentInput();this._createImageInput();this._createOptionPane(a);this._createGuideInput()},
_createEssayQuestionForm:function(){this.data.exerType=n.ExerciseType.ESSAY_QUESTION;if(this.optionPane&&""==this.optionPane.style.display)this.optionPane.style.display="none"},_createContentInput:function(){var a=b.create("div",null,this.domNode);b.place('<div class="drip-title">\u5185\u5bb9</div>',a);this.editorExerContent=this._createEditor(a,150)},_createEditor:function(a,b,f){var c={};c.style="height:"+b+"px; width:"+f+"px";b=new u(c);b.placeAt(a);return b},_createImageInput:function(){var a=
b.create("div",null,this.domNode),a=b.place('<div class="drip-title" style="margin-bottom: 5px;"></div>',a),d=new dojox.form.Uploader({label:"\u9644\u56fe",multiple:!0,type:"file",uploadOnSelect:!0,url:"/uploads/exerciseImage"});d.placeAt(a);d.startup();(new widget.form.uploader.FileList({uploader:d})).placeAt(a)},_createOptionPane:function(a){var d=this.optionPane=b.create("div",null,this.domNode);b.place('<div class="drip-title">\u9009\u9879\u548c\u7b54\u6848</div>',d);for(var d=b.place("<div></div>",
d),f=this.tblOption=b.place('<table class="drip-exercise-option"></table',d),c=this.optionLength,e=0;e<c;e++)this._createOption(f,e,a);this._refreshOption();d=b.place("<div></div>",d);d=b.place('<a href="#"><img src="/resources/images/add_20.png"/></a>',d);h(d,"click",g.hitch(this,function(b){this._createOption(f,this.optionLength++,a);j.stop(b)}))},_getOptionId:function(){if(!this.optionId)this.optionId=0;return this.optionId++},_createOption:function(a,d,f){var c=b.place("<tr></tr>",a),e=b.place("<td></td>",
c);this._getOptionId();b.place('<input type="'+f+'" name="'+this._optionName+'"/>',e);f=b.place("<td></td>",c);b.place("<label>"+"ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(d)+"</label>",f);this._createEditor(b.place("<td></td>",c),25,550);e=b.place("<td></td>",c);d=b.place('<a href="#"><img alt="\u5220\u9664" src="/resources/images/delete.png"></a>',e);f=b.place('<a href="#"><img alt="\u4e0b\u79fb" src="/resources/images/arrow_down.gif"></a>',e);e=b.place('<a href="#"><img alt="\u4e0a\u79fb" src="/resources/images/arrow_up.gif"></a>',
e);h(d,"click",g.hitch(this,function(a){this.optionLength--;k.findWidgets(c).forEach(function(a){a.destroyRecursive()});b.destroy(c);this._refreshOption();j.stop(a)}));h(f,"click",g.hitch(this,function(d){c.nextSibling?b.place(c,c.nextSibling,"after"):b.place(c,a,"first");this._refreshOption();j.stop(d)}));h(e,"click",g.hitch(this,function(d){c.previousSibling?b.place(c,c.previousSibling,"before"):b.place(c,a,"last");this._refreshOption();j.stop(d)}))},_refreshOption:function(){q.forEach(this.tblOption.childNodes,
function(a,b){var f="ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(b),c=a.cells[0].firstChild,e="option"+(b+1);i.set(c,"id",e);c.value=b;c=a.cells[1].firstChild;i.set(c,"for",e);c.innerHTML=f})},_createGuideInput:function(){var a=b.create("div",null,this.domNode);b.place('<div class="drip-title">\u4e60\u9898\u89e3\u6790</div>',a);this.editorGuide=this._createEditor(a,100)},_destroyForm:function(){var a=this.domNode;k.findWidgets(a).forEach(function(a){a.destroyRecursive()});b.empty(a)}})});