//>>built
define("drip/exercises/ExerciseForm","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/event dojo/request/xhr dijit/_WidgetBase dijit/registry dojo/dom dojo/dom-attr dojo/dom-style dojo/dom-class dojo/dom-construct dojo/on dojo/query dojo/json mathEditor/Editor drip/classCode dojox/form/Uploader drip/widget/form/uploader/FileList".split(" "),function(s,g,t,n,u,v,p,y,h,z,A,c,k,q,w,x,l,B,C){var r=[{id:"essayQuestion",label:"\u95ee\u7b54\u9898",type:l.ExerciseType.ESSAY_QUESTION},{id:"single",
label:"\u5355\u9879\u9009\u62e9\u9898",type:l.ExerciseType.SINGLE_OPTION},{id:"multiple",label:"\u591a\u9879\u9009\u62e9\u9898",type:l.ExerciseType.MULTI_OPTION}];return s("drip.exercises.ExerciseForm",[v],{data:{},optionLength:4,_optionName:"exercise-option",postCreate:function(){this.inherited(arguments);this.leftDiv=c.place('\x3cdiv style\x3d"width: 660px; float: left;"\x3e\x3c/div\x3e',this.domNode);this.rightDiv=c.place('\x3cdiv style\x3d"width: 240px; float: right;"\x3e\x3c/div\x3e',this.domNode);
this._createForm(l.ExerciseType.ESSAY_QUESTION);var a=c.create("div",{"class":"drip_form_actions"},this.leftDiv),a=this.btnSave=c.place('\x3cbutton class\x3d"minibutton primary"\x3e\x3ci class\x3d"icon-save icon-large"\x3e\x3c/i\x3e \u4fdd\u5b58\x3c/button\x3e',a);k(a,"click",g.hitch(this,this.doSave))},_createForm:function(a){this.data.exerType=a;this._createQuestionTypeOptions(a);this._createContentInput();var b=null;a===l.ExerciseType.SINGLE_OPTION?b="radio":a===l.ExerciseType.MULTI_OPTION&&(b=
"checkbox");this._showOptionPane(b);this._createGuideInput();this._createCourseOptions();this._createImageInput()},_createQuestionTypeOptions:function(a){if(!this._questionTypeInput){var b=c.create("div",{"class":"form clearfix"},this.leftDiv);c.place('\x3cdiv class\x3d"drip-title"\x3e\u9898\u578b\x3c/div\x3e',b);for(var b=c.place('\x3cul class\x3d"radio-group"\x3e\x3c/ul\x3e',b),f=0;f<r.length;f++){var d=r[f],e=d.type==a,m=c.create("li",null,b),e=c.create("input",{type:"radio",name:"questionType",
id:d.type,checked:e},m);c.create("label",{"for":d.type,innerHTML:d.label},m);k(e,"click",g.hitch(this,function(a){a=a.target;a.id!=this.data.exerType&&this._createForm(a.id)}))}this._questionTypeInput=!0}},_createContentInput:function(){this.exerContentEditor||(this.contentPane=(this.exerContentEditor=this._createMathInput("\u4e60\u9898\u5185\u5bb9",10)).domNode.parentNode)},_createCourseOptions:function(){if(!this.coursePane){var a=c.create("div",{"class":"form clearfix"},this.leftDiv);c.place('\x3cdiv class\x3d"drip-title"\x3e\u79d1\u76ee\x3c/div\x3e',
a);for(var b=[{id:"higherMath",label:"\u9ad8\u7b49\u6570\u5b66"},{id:"linearAlgebra",label:"\u7ebf\u6027\u4ee3\u6570"},{id:"probability",label:"\u6982\u7387\u8bba\u4e0e\u6570\u7406\u7edf\u8ba1"}],f=c.place('\x3cul class\x3d"radio-group"\x3e\x3c/ul\x3e',a),d=0;d<b.length;d++){var e=b[d],m=c.create("li",null,f);c.create("input",{type:"radio",name:"course",id:e.id},m);c.create("label",{"for":e.id,innerHTML:e.label},m)}this.coursePane=a}},_createGuideInput:function(){this.guideEditor||(this.guideEditor=
this._createMathInput("\u4e60\u9898\u89e3\u6790",5))},_createMathInput:function(a,b){var f=c.create("div",{"class":"form"},this.leftDiv);c.place('\x3cdiv class\x3d"drip-title"\x3e'+a+"\x3c/div\x3e",f);return this._createEditor(f,b)},_createEditor:function(a,b,c){var d={};d.width=c;d.rows=b;b=new x(d);b.placeAt(a);return b},_createImageInput:function(){if(!this._imageInput){var a=c.create("div",{"class":"form"},this.rightDiv),a=c.place('\x3cdiv class\x3d"drip-title" style\x3d"margin-bottom: 5px;"\x3e\x3c/div\x3e',
a),b=new dojox.form.Uploader({label:"\u4e0a\u4f20\u56fe\u7247",multiple:!0,type:"file",uploadOnSelect:!0,url:"/uploads/exerciseImage"});b.placeAt(a);b.startup();(new drip.widget.form.uploader.FileList({uploader:b})).placeAt(a);this._imageInput=!0}},_showOptionPane:function(a){this.optionPane?null==a?""==this.optionPane.style.display&&(this.optionPane.style.display="none"):("none"==this.optionPane.style.display&&(this.optionPane.style.display=""),a!=this._optionType&&q("input",this.optionPane).forEach(function(b,
c){b.type=a})):null!=a&&this._createOptionPane(a);this._optionType=a},_getFormData:function(){var a=this.data;a.content=this.exerContentEditor.get("value");this.tblOption&&(a.options=[],p.findWidgets(this.tblOption).forEach(function(b,c){a.options.push(b.get("value"))}));var b={};if(this.tblOption){var c=[];q("[name\x3d"+this._optionName+"]:checked",this.tblOption).forEach(function(a,b){c.push({seq:a.value})});0<c.length&&(b.detail=c)}var d=this.guideEditor.get("value");null!=d&&0<d.length&&(b.guide=
d);if(b.detail||b.guide)a.answer=b;return a},doSave:function(a){h.set(this.btnSave,"disabled",!0);a=this._getFormData();u("/exercises/",{method:"POST",data:w.stringify(a)}).then(g.hitch(this,function(a){this._reset();h.set(this.btnSave,"disabled",!1)}),g.hitch(this,function(a){h.set(this.btnSave,"disabled",!1)}))},_reset:function(){this.data={};this.exerContentEditor.set("value","");this.guideEditor.set("value","");q("[name\x3d"+this._optionName+"]:checked",this.tblOption).forEach(function(a,b){h.set(a,
"checked",!1)});p.findWidgets(this.tblOption).forEach(function(a,b){a.set("value","")})},empty:function(){},_createOptionPane:function(a){var b=this.optionPane=c.create("div",null,this.contentPane,"after");c.place('\x3cdiv class\x3d"drip-title"\x3e\u9009\u9879\u548c\u7b54\u6848\x3c/div\x3e',b);for(var b=c.place("\x3cdiv\x3e\x3c/div\x3e",b),f=this.tblOption=c.place('\x3ctable class\x3d"drip-exercise-option"\x3e\x3c/table\x3e',b),d=this.optionLength,e=0;e<d;e++)this._createOption(f,e,a);this._refreshOption();
b=c.place("\x3cdiv\x3e\x3c/div\x3e",b);b=c.place('\x3ca href\x3d"#"\x3e\x3ci class\x3d"icon-plus"\x3e\x3c/i\x3e \u6dfb\u52a0\u9009\u9879\x3c/a\x3e',b);k(b,"click",g.hitch(this,function(b){this._createOption(f,this.optionLength++,a);n.stop(b)}))},_getOptionId:function(){this.optionId||(this.optionId=0);return this.optionId++},_createOption:function(a,b,f){var d=c.place("\x3ctr\x3e\x3c/tr\x3e",a),e=c.place("\x3ctd\x3e\x3c/td\x3e",d);this._getOptionId();c.place('\x3cinput type\x3d"'+f+'" name\x3d"'+
this._optionName+'"/\x3e',e);f=c.place("\x3ctd\x3e\x3c/td\x3e",d);c.place("\x3clabel\x3e"+"ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(b)+"\x3c/label\x3e",f);b=c.place("\x3ctd\x3e\x3c/td\x3e",d);this._createEditor(b,2,550);e=c.place("\x3ctd\x3e\x3c/td\x3e",d);b=c.place('\x3ca href\x3d"#" class\x3d"iconbutton" title\x3d"\u5220\u9664"\x3e\x3ci class\x3d"icon-trash"\x3e\x3c/i\x3e\x3c/a\x3e',e);f=c.place('\x3ca href\x3d"#" class\x3d"iconbutton" title\x3d"\u4e0b\u79fb"\x3e\x3ci class\x3d"icon-arrow-down"\x3e\x3c/i\x3e\x3c/a\x3e',
e);e=c.place('\x3ca href\x3d"#" class\x3d"iconbutton" title\x3d"\u4e0a\u79fb"\x3e\x3ci class\x3d"icon-arrow-up"\x3e\x3c/i\x3e\x3c/a\x3e',e);k(b,"click",g.hitch(this,function(a){this.optionLength--;p.findWidgets(d).forEach(function(a,b){a.destroyRecursive()});c.destroy(d);this._refreshOption();n.stop(a)}));k(f,"click",g.hitch(this,function(b){d.nextSibling?c.place(d,d.nextSibling,"after"):c.place(d,a,"first");this._refreshOption();n.stop(b)}));k(e,"click",g.hitch(this,function(b){d.previousSibling?
c.place(d,d.previousSibling,"before"):c.place(d,a,"last");this._refreshOption();n.stop(b)}))},_refreshOption:function(){t.forEach(this.tblOption.childNodes,function(a,b){var c="ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(b),d=a.cells[0].firstChild,e="option"+(b+1);h.set(d,"id",e);d.value=b;d=a.cells[1].firstChild;h.set(d,"for",e);d.innerHTML=c})},_destroyForm:function(){var a=this.domNode;p.findWidgets(a).forEach(function(a,c){a.destroyRecursive()});c.empty(a)}})});
//@ sourceMappingURL=ExerciseForm.js.map