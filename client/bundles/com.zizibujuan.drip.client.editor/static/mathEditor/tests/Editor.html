<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>View Test</title>
<link type="text/css" rel="stylesheet" href="/mathEditor/resources/editor.css" />
<script type="text/javascript" src="/dojo/dojo.js" data-dojo-config="isDebug:true,async:true,cacheBust:new Date()"></script>
<script type="text/javascript"
   src="/mathJax/MathJax.js?config=MML_HTMLorMML">
</script>
<script type="text/javascript">
require([ "doh", 
          "dojo/dom",
          "dojo/dom-construct",
          "dojo/dom-class",
          "dojo/dom-style",
          "mathEditor/Editor", 
          "dojo/domReady!" ], function(
        		  doh, 
        		  dom,
        		  domConstruct,
        		  domClass,
        		  domStyle,
        		  Editor) {
	doh.register("Editor", [ 
	{
		name: "测试编辑器初始高度",
		setUp: function(){
			var editorContainer = this.editorContainer = domConstruct.create("div", null,document.body);
			this.editor = new Editor({style:"width:100px", rows:2}, editorContainer);
		},
		runTest: function(t){
			// clientHeight = css height + css apddiing - height of hScroll（包含水平滚动条的高度）
			// clientWidth = css width + css padding (不包含垂直滚动条的宽度)
			
			// 默认的lineHeight为15,边框的宽度为1，paddingTop为2
			// 所以编辑器的内容高度clientHeight应该为15*2 + paddingTop，总体高度offsetHeight应该为 15*2 + paddingTop + 1*2
			var editorContainer = this.editorContainer;
			t.is(32, editorContainer.clientHeight);
			t.is(34, editorContainer.offsetHeight);
			t.is(32, editorContainer.scrollHeight);
			
			var scroller = editorContainer.lastChild;
			t.is(32, scroller.clientHeight);
			t.is(32, scroller.offsetHeight);
			t.is(32, scroller.scrollHeight);
			
			var content = scroller.firstChild;
			t.is(32, content.clientHeight);
			t.is(32, content.offsetHeight);
			t.is(32, content.scrollHeight);			
		},
		tearDown: function(){
			//this.editor.destroyRecursive();
		}		
	},{
		name: "当输入三行时，编辑器的高度响应扩展,此时没有水平滚动轴",
		setUp: function(){
			var editorContainer = this.editorContainer = domConstruct.create("div", null,document.body);
			this.editor = new Editor({style:"width:100px", rows:2}, editorContainer);
		},
		runTest: function(t){
			// 默认的lineHeight为15,边框的宽度为1，
			// 所以编辑器的内容高度clientHeight应该为30，总体高度offsetHeight应该为32
			this.editor.inputEnter();
			this.editor.inputEnter();
			var editorContainer = this.editorContainer;
			var deferred = new doh.Deferred();
			this.editor.view._asyncExecute(deferred.getTestCallback(function(){
		    	
				t.is(45, editorContainer.clientHeight);
				t.is(47, editorContainer.offsetHeight);
				t.is(45, editorContainer.scrollHeight);
				
				// 滚动轴层的高度，border为0， clientHeight为30
				var scroller = editorContainer.lastChild;
				t.is(45, scroller.clientHeight);
				t.is(45, scroller.offsetHeight);
				t.is(45, scroller.scrollHeight);
				
				// 文本内容层的高度，border为0， clientHeight为30
				var content = scroller.firstChild;
				t.is(45, content.clientHeight);
				t.is(45, content.offsetHeight);
				t.is(45, content.scrollHeight);	
		    }));
		    return deferred;
		},
		tearDown: function(){
			//this.editor.destroyRecursive();
		}		
	}]);
	doh.runOnLoad();
});

</script>
</head>
<body>
</body>
</html>